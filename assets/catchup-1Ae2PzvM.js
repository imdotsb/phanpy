import{a as Ge,b as qe,N as je,r as Ve,o as Ke}from"./main-2c6hEdo9.js";import{ac as Ye,a as Xe,q as We,p as D,h as Qe,v as G,a3 as Ze,$ as Je,s as xe,F as le,al as Le,ak as ie,D as et,_ as te,X as tt,e,c as Te,d as Ce,k as pe,I as x,g as M,K as st,L as nt,aj as rt,R as Be,A as ge,M as it,N as $e,w as lt,aq as ot,aa as at,aG as ct,i as Re}from"./db--LMpZogT.js";import{u as dt}from"./index-_Y-Lyw2n.js";import"./intl-segmenter-polyfill-XHDQHdV5.js";const ht=""+new URL("catch-up-DuauQu-W.png",import.meta.url).href,ut="home",j=[{label:"last 1 hour",value:1},{label:"last 2 hours",value:2},{label:"last 3 hours",value:3},{label:"last 4 hours",value:4},{label:"last 5 hours",value:5},{label:"last 6 hours",value:6},{label:"last 7 hours",value:7},{label:"last 8 hours",value:8},{label:"last 9 hours",value:9},{label:"last 10 hours",value:10},{label:"last 11 hours",value:11},{label:"last 12 hours",value:12},{label:"beyond 12 hours",value:13}],pt=["Original","Replies","Boosts","Followed tags","Groups","Filtered"],gt=["createdAt","repliesCount","favouritesCount","reblogsCount","density"],ft=[null,"account"],Ee={Filtered:"filtered",Groups:"group",Boosts:"boost",Replies:"reply","Followed tags":"followedTags",Original:"original"},mt={Filtered:"filtered posts",Groups:"group posts",Boosts:"boosts",Replies:"replies","Followed tags":"followed-tag posts",Original:"original posts"},bt={createdAt:["oldest","latest"],repliesCount:["fewest replies","most replies"],favouritesCount:["fewest likes","most likes"],reblogsCount:["fewest boosts","most boosts"],density:["least dense","most dense"]};function Lt(){Ye("Catch-up","/catchup");const{masto:f,instance:d}=Xe(),[p,a]=We(),h=p.get("id"),[g,w]=D("start"),[m,c]=D(!1),I=G(()=>Qe.session.get("currentAccount"),[]),L=t=>t===I;async function Q({maxCreatedAt:t}){var r,y,k;const s=t?new Date(t):null,i=[],n=f.v1.timelines.home.list({limit:40});e:for(;;)try{const o=await n.next(),{value:T}=o;if(T!=null&&T.length){await Ge(T,d);let A=!1;for(let U=0;U<T.length;U++){const R=T[U],J=new Date(R.createdAt);if(!s||J>=s){const v=!L(((y=(r=R.reblog)==null?void 0:r.account)==null?void 0:y.id)||R.account.id)&&Ze(((k=R.reblog)==null?void 0:k.filtered)||R.filtered,ut);if((v==null?void 0:v.action)==="hide")continue;R._filtered=v;const q=Je(R.id,d);R._followedTags=xe.statusFollowedTags[q]?[...xe.statusFollowedTags[q]]:[],i.push(R),A=!0}if(!A)break e}}else break e;await new Promise(A=>setTimeout(A,1e3))}catch{break e}return i.forEach(o=>{if(o!=null&&o.inReplyToId){const T=i.find(A=>A.id===o.inReplyToId);T&&!T.inReplyToId&&(T._thread=!0)}}),i}const[u,V]=D([]),$=le(),fe=G(()=>Le(),[]),oe=et(async({duration:t}={})=>{const s=Date.now(),i=t?s-t:null;w("loading");const n=await Q({maxCreatedAt:i}),r=`${fe}-${dt()}`;try{await ie.catchup.set(r,{id:r,posts:n,count:n.length,startAt:i,endAt:s}),a({id:r})}catch{}},[]);te(()=>{h?(async()=>{const t=await ie.catchup.get(h);t&&(t.posts.sort((s,i)=>s.createdAt>i.createdAt?1:-1),V(t.posts),w("results"))})():g==="results"&&(V([]),w("start"))},[h]);const[_,E]=tt(t=>t+1,0),[P,z]=D(null),[F,Ae]=D([]);te(()=>{(async()=>{try{const t=await ie.catchup.keys();if(t.length){const s=Le(),i=t.filter(n=>n.startsWith(`${s}-`));if(i.length){let n=await ie.catchup.getMany(i);n.sort((o,T)=>T.endAt-o.endAt);let r=n.slice(0,3),y=n.slice(3);const k=r.map(o=>{const{id:T,count:A,startAt:U,endAt:R}=o;return{id:T,count:A,startAt:U,endAt:R}});Ae(k),z(r[0].endAt),n=null,r=null,queueMicrotask(()=>{y.length&&ie.catchup.delMany(y.map(o=>o.id)).then(()=>{y=null}).catch(o=>{})});return}}}catch{}Ae([])})()},[_]),te(()=>{g==="start"&&E()},[g==="start"]);const[me,ce]=G(()=>{var T,A,U,R,J;let t=0,s=0,i=0,n=0,r=0,y=0;const k={};for(const l of u){l._filtered?(t++,l.__FILTER="filtered"):l.group?(s++,l.__FILTER="group"):l.reblog?(i++,l.__FILTER="boost"):(T=l._followedTags)!=null&&T.length?(r++,l.__FILTER="followedTags"):l.inReplyToId&&l.inReplyToAccountId!==((A=l.account)==null?void 0:A.id)?(n++,l.__FILTER="reply"):(y++,l.__FILTER="original");const v=l.reblog||l;if(l.__FILTER!=="filtered"&&((U=v.card)!=null&&U.url)&&((R=v.card)!=null&&R.image)&&((J=v.card)==null?void 0:J.type)==="link"){const{card:q,favouritesCount:ue,reblogsCount:ee}=v;let{url:S}=q;if(S=S.replace(/\/$/,""),!k[S])k[S]={postID:v.id,card:q,shared:1,sharers:[l.account],likes:ue,boosts:ee};else{if(k[S].sharers.find(re=>re.id===l.account.id))continue;k[S].shared++,k[S].sharers.push(l.account),k[S].postID!==v.id&&(k[S].likes+=ue,k[S].boosts+=ee)}}}let o=[];for(const l in k)o.push({url:l,...k[l]});if(o.sort((l,v)=>l.shared>v.shared?-1:l.shared<v.shared?1:l.boosts>v.boosts?-1:l.boosts<v.boosts?1:l.likes>v.likes?-1:l.likes<v.likes?1:0),o.length>10)e:for(let l=10;l<o.length;l++){const{shared:v}=o[l];if(v<=1){o=o.slice(0,l);break e}}return[{Filtered:t,Groups:s,Boosts:i,Replies:n,"Followed tags":r,Original:y},o]},[u]),[N,be]=D("All"),[b,se]=D(null),[K,Me]=D(1),[C,Ie]=D("createdAt"),[Y,ye]=D("asc"),[H,Se]=D(null),[ae,O,Z]=G(()=>{const t={},s=new Map;let i=u.filter(r=>{const y=N==="All"||r.__FILTER===Ee[N];return y&&(t[r.account.id]=r.account,s.set(r.account.id,(s.get(r.account.id)||0)+1)),y});const n={};return i=i.filter(r=>{if(r.reblog){if(n[r.reblog.id])return n[r.reblog.id].__BOOSTERS?n[r.reblog.id].__BOOSTERS.add(r.account):n[r.reblog.id].__BOOSTERS=new Set([r.account]),!1;n[r.reblog.id]=r}return!0}),b&&s.has(b)&&(i=i.filter(r=>r.account.id===b||[...r.__BOOSTERS||[]].find(y=>y.id===b))),[i,t,Object.fromEntries(s)]},[N,b,u]),de=G(()=>{const t={};return ae.forEach(s=>{t[s.id]=s}),t},[ae]),B=G(()=>Object.keys(Z).sort((t,s)=>Z[s]-Z[t]),[Z]),Pe=G(()=>{const t={};return B.forEach((s,i)=>{t[s]=i}),ae.sort((s,i)=>{if(H==="account"){const n=s.account.id,r=i.account.id,y=t[n],k=t[r],o=y-k;if(o!==0)return o}if(C!=="createdAt"&&(s=s.reblog||s,i=i.reblog||i,C!=="density"&&s[C]===i[C]))return s.createdAt>i.createdAt?1:-1;if(C==="density"){const n=Fe(s),r=Fe(i);return Y==="asc"?n>r?1:-1:r>n?1:-1}return Y==="asc"?s[C]>i[C]?1:-1:i[C]>s[C]?1:-1})},[ae,C,Y,H,B]),ve=le(null),ne=le(null),_e=le(!1);te(()=>{u.length>100||_e.current||ne.current&&(qe(ne.current,{duration:200}),_e.current=!0)},[u,ne]);const we=u.length>160?"3d":"2d",ze=G(()=>we!=="2d"?null:u.map(t=>{const s=de[t.id];return e("span",{class:`post-dot ${s?"post-dot-highlight":""}`},t.id)}),[de]),Ne=G(()=>we!=="3d"||!(u!=null&&u.length)?null:It(u,"createdAt",320).map((s,i)=>e("div",{class:"posts-bin",children:s.map(n=>{const r=de[n.id];return e("span",{class:`post-dot ${r?"post-dot-highlight":""}`},n.id)})},i)),[de]),X=le(null),De=G(()=>P?(Date.now()-P)/1e3/60/60:null,[P,K]);te(()=>{if(g!=="results")return;const t=b&&O[b]?O[b].username:"",s=Y==="asc"?0:1,i={account:"authors"};let n=Te({duration:5e3,text:`Showing ${mt[N]||"all posts"}${t?` by @${t}`:""}, ${bt[C][s]} first${H?`, grouped by ${H==="account"?i[H]:""}`:""}`});return()=>{var r;(r=n==null?void 0:n.hideToast)==null||r.call(n)}},[g,N,b,C,Y,H,O]),te(()=>{var t;if(b&&O[b]){const s=ne.current.querySelector(`[data-author="${b}"]`),i=(t=ne.current)==null?void 0:t.getBoundingClientRect(),n=s==null?void 0:s.getBoundingClientRect();(n.left<i.left||n.right>i.right)&&s.scrollIntoView({block:"nearest",inline:"center",behavior:"smooth"})}},[b,O]);const[He,ke]=D(!1),he=".catchup-list > li > a";return Ce("j",()=>{const t=document.activeElement.closest(he),s=t==null?void 0:t.getBoundingClientRect(),i=Array.from(X.current.querySelectorAll(he));if(t&&s.top<X.current.clientHeight&&s.bottom>0){const n=i.indexOf(t),r=i[n+1];r&&(r.focus(),r.scrollIntoView({block:"center",inline:"center",behavior:"smooth"}))}else{const n=i.find(r=>r.getBoundingClientRect().top>=0);n&&(n.focus(),n.scrollIntoView({block:"nearest",inline:"center",behavior:"smooth"}))}},{preventDefault:!0,ignoreModifiers:!0}),Ce("k",()=>{const t=document.activeElement.closest(he),s=t==null?void 0:t.getBoundingClientRect(),i=Array.from(X.current.querySelectorAll(he));if(t&&s.top<X.current.clientHeight&&s.bottom>0){const n=i.indexOf(t);let r=i[n-1];r&&(r.focus(),r.scrollIntoView({block:"center",inline:"center",behavior:"smooth"}))}else{const n=i.find(r=>{const y=r.getBoundingClientRect();return y.top>=44&&y.left>=0});n&&(n.focus(),n.scrollIntoView({block:"nearest",inline:"center",behavior:"smooth"}))}},{preventDefault:!0,ignoreModifiers:!0}),Ce("h, l",(t,s)=>{if(b){const i=s.keys[0],n=B.indexOf(b);i==="h"?n>0&&n<B.length&&se(B[n-1]):i==="l"&&n<B.length-1&&n>=0&&se(B[n+1])}},{preventDefault:!0,ignoreModifiers:!0,enableOnFormTags:!0}),e("div",{ref:X,id:"catchup-page",class:"deck-container",tabIndex:"-1",children:[e("div",{class:"timeline-deck deck wide",children:[e("header",{class:`${g==="loading"?"loading":""}`,onClick:t=>{var s;t.target.closest("a, button")||(s=X.current)==null||s.scrollTo({top:0,behavior:"smooth"})},children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(je,{}),g==="results"&&e(pe,{to:"/catchup",class:"button plain",children:e(x,{icon:"history2",size:"l"})}),g==="start"&&e(pe,{to:"/",class:"button plain",children:e(x,{icon:"home",size:"l"})})]}),e("h1",{children:g!=="start"&&e(M,{children:["Catch-up ",e("sup",{children:"beta"})]})}),e("div",{class:"header-side",children:g!=="start"&&g!=="loading"&&e("button",{type:"button",class:"plain",onClick:()=>{ke(!0)},children:"Help"})})]})}),e("main",{children:[g==="start"&&e("div",{class:"catchup-start",children:[e("h1",{children:["Catch-up ",e("sup",{children:"beta"})]}),e("details",{children:[e("summary",{children:"What is this?"}),e("p",{children:"Catch-up is a separate timeline for your followings, offering a high-level view at a glance, with a simple, email-inspired interface to effortlessly sort and filter through posts."}),e("img",{src:ht,width:"1200",height:"900",alt:"Preview of Catch-up UI"}),e("p",{children:e("button",{type:"button",onClick:t=>{t.target.closest("details").open=!1},children:"Let's catch up"})})]}),e("p",{children:"Let's catch up on the posts from your followings."}),e("p",{children:e("b",{children:"Show me all posts fromâ€¦"})}),e("div",{class:"catchup-form",children:[e("input",{ref:$,type:"range",value:K,min:j[0].value,max:j[j.length-1].value,step:"1",list:"catchup-ranges",onChange:t=>Me(+t.target.value)})," ",e("span",{style:{width:"8em"},children:[j[K-1].label,e("br",{}),e("small",{class:"insignificant",children:K==j[j.length-1].value?"until the max":st(new Date(Date.now()-K*60*60*1e3))})]}),e("datalist",{id:"catchup-ranges",children:j.map(({label:t,value:s})=>e("option",{value:s,label:t}))})," ",e("button",{type:"button",onClick:()=>{if(K<j[j.length-1].value){const t=K*60*60*1e3;oe({duration:t})}else oe()},children:"Catch up"})]}),De&&K>De&&e("p",{class:"catchup-info",children:[e(x,{icon:"info"})," Overlaps with your last catch-up"]}),e("p",{class:"insignificant",children:e("small",{children:"Note: your instance might only show a maximum of 800 posts in the Home timeline regardless of the time range. Could be less or more."})}),!!(F!=null&&F.length)&&e("div",{class:"catchup-prev",children:[e("p",{children:"Previouslyâ€¦"}),e("ul",{children:F.map(t=>e("li",{children:[e(pe,{to:`/catchup?id=${t.id}`,children:[e(x,{icon:"history2"})," ",e("span",{children:Oe(new Date(t.startAt),new Date(t.endAt))})]})," ",e("span",{children:[e("small",{class:"ib insignificant",children:[t.count," posts"]})," ",e("button",{type:"button",class:"light danger small",onClick:async()=>{var i;if(confirm("Remove this catch-up?")){let n=Te(`Removing Catch-up ${t.id}`);await ie.catchup.del(t.id),(i=n==null?void 0:n.hideToast)==null||i.call(n),Te(`Catch-up ${t.id} removed`),E()}},children:e(x,{icon:"x"})})]})]},t.id))}),F.length>=3&&e("p",{children:e("small",{children:"Note: Only max 3 will be stored. The rest will be automatically removed."})})]})]}),g==="loading"&&e("div",{class:"ui-state catchup-start",children:[e(nt,{abrupt:!0}),e("p",{class:"insignificant",children:"Fetching postsâ€¦"}),e("p",{class:"insignificant",children:"This might take a while."})]}),g==="results"&&e(M,{children:[e("div",{class:"catchup-header",children:[u.length>0&&e("p",{children:e("b",{class:"ib",children:Oe(new Date(u[0].createdAt),new Date(u[u.length-1].createdAt))})}),e("aside",{children:[e("button",{hidden:N==="All"&&!b&&C==="createdAt"&&Y==="asc",type:"button",class:"plain4 small",onClick:()=>{be("All"),se(null),Ie("createdAt"),Se(null),ye("asc")},children:"Reset filters"}),(ce==null?void 0:ce.length)>0&&e("button",{type:"button",class:"plain small",onClick:()=>c(!m),children:["Top links"," ",e(x,{icon:"chevron-down",style:{transform:m?"rotate(180deg)":"rotate(0deg)"}})]})]})]}),e("div",{class:"shazam-container no-animation",hidden:!m,children:e("div",{class:"shazam-container-inner",children:e("div",{class:"catchup-top-links links-bar",children:ce.map(t=>{const{card:s,shared:i,sharers:n,likes:r,boosts:y}=t,{blurhash:k,title:o,description:T,url:A,image:U,imageDescription:R,language:J,width:l,height:v,publishedAt:q}=s,ue=new URL(A).hostname.replace(/^www\./,"").replace(/\/$/,"");let ee;if(k){const S=rt(k),re=Ve(S);ee=Ke([.6,re[1],re[2]])}return e("a",{href:A,target:"_blank",rel:"noopener noreferrer",style:ee?{"--accent-color":`rgb(${ee.join(",")})`,"--accent-alpha-color":`rgba(${ee.join(",")}, 0.4)`}:{},children:e("article",{children:[e("figure",{children:e("img",{src:U,alt:R,width:l,height:v,loading:"lazy"})}),e("div",{class:"article-body",children:[e("header",{children:[e("div",{class:"article-meta",children:[e("span",{class:"domain",children:ue})," ",!!q&&e(M,{children:"Â· "}),!!q&&e(M,{children:e(Be,{datetime:q,format:"micro"})})]}),!!o&&e("h1",{class:"title",lang:J,dir:"auto",children:o})]}),!!T&&e("p",{class:"description",lang:J,dir:"auto",children:T}),e("hr",{}),e("p",{style:{whiteSpace:"nowrap"},children:["Shared by"," ",n.map(S=>{const{avatarStatic:re,displayName:Ue}=S;return e(ge,{url:re,size:"s",alt:Ue})})]})]})]})},A)})})})}),u.length>=5&&(we==="3d"?e("div",{class:"catchup-posts-viz-time-bar",children:Ne}):e("div",{class:"catchup-posts-viz-bar",children:ze})),u.length>=2&&e("div",{class:"catchup-filters",children:[e("label",{class:"filter-cat",children:[e("input",{type:"radio",name:"filter-cat",checked:N.toLowerCase()==="all",onChange:()=>{be("All")}}),"All ",e("span",{class:"count",children:u.length})]}),pt.map(t=>!!me[t]&&e("label",{class:"filter-cat",title:(me[t]/u.length*100).toFixed(2)+"%",children:[e("input",{type:"radio",name:"filter-cat",checked:N.toLowerCase()===t.toLowerCase(),onChange:()=>{be(t)}}),t," ",e("span",{class:"count",children:me[t]})]},t))]}),u.length>=2&&!!Z&&e("div",{class:"catchup-filters authors-filters",ref:ne,children:[B.map(t=>e("label",{class:"filter-author","data-author":t,children:[e("input",{type:"radio",name:"filter-author",checked:b===t,onChange:()=>{se(t)},onClick:()=>{b===t&&se(null)}}),e(ge,{url:O[t].avatarStatic||O[t].avatar,size:"xxl",alt:`${O[t].displayName} (@${O[t].username})`})," ",e("span",{class:"count",children:Z[t]}),e("span",{class:"username",children:O[t].username})]},`${t}-${Z[t]}`)),B.length>5&&e("small",{style:{whiteSpace:"nowrap",paddingInline:"1em",opacity:.33},children:[B.length," authors"]},"authors-count")]}),u.length>=2&&e("div",{class:"catchup-filters",children:[e("span",{class:"filter-label",children:"Sort"})," ",e("fieldset",{class:"radio-field-group",children:gt.map(t=>e("label",{class:"filter-sort",onClick:s=>{C===t&&(s.preventDefault(),s.stopPropagation(),ye(Y==="asc"?"desc":"asc"))},children:[e("input",{type:"radio",name:"filter-sort-cat",checked:C===t,onChange:()=>{Ie(t);const s=/(replies|favourites|reblogs)/.test(t)?"desc":"asc";ye(s)}}),{createdAt:"Date",repliesCount:"Replies",favouritesCount:"Likes",reblogsCount:"Boosts",density:"Density"}[t],C===t&&(Y==="asc"?" â†‘":" â†“")]},t))}),e("span",{class:"filter-label",children:"Group"})," ",e("fieldset",{class:"radio-field-group",children:ft.map(t=>e("label",{class:"filter-group",children:[e("input",{type:"radio",name:"filter-group",checked:H===t,onChange:()=>{Se(t)},disabled:t==="account"&&b}),{account:"Authors"}[t]||"None"]},t||"none"))}),b&&B.length>1?e("button",{type:"button",class:"plain6 small",onClick:()=>{se(null)},style:{whiteSpace:"nowrap"},children:"Show all authors"}):null]}),e("ul",{class:`catchup-list catchup-filter-${Ee[N]||""} ${C?`catchup-sort-${C}`:""} ${b&&O[b]?"catchup-selected-author":""} ${H?`catchup-group-${H}`:""}`,children:Pe.map((t,s)=>{var r;const i=((r=t.reblog)==null?void 0:r.id)||t.id;let n=!1;return H==="account"&&(ve.current&&t.account.id!==ve.current&&s>0&&(n=!0),ve.current=t.account.id),e(M,{children:[n&&e("li",{class:"separator"}),e(vt,{to:`/${d}/s/${i}`,post:t,root:X.current})]},`${t.id}-${n}`)})}),e("footer",{children:ae.length>5&&e("p",{children:[N==="Boosts"?"You don't have to read everything.":"That's all."," ",e("button",{type:"button",class:"textual",onClick:()=>{X.current.scrollTop=0},children:"Back to top"}),"."]})})]})]})]}),He&&e(it,{onClose:()=>ke(!1),children:e("div",{class:"sheet",id:"catchup-help-sheet",children:[e("button",{type:"button",class:"sheet-close",onClick:()=>ke(!1),children:e(x,{icon:"x"})}),e("header",{children:e("h2",{children:"Help"})}),e("main",{children:e("dl",{children:[e("dt",{children:"Top links"}),e("dd",{children:"Links shared by followings, sorted by shared counts, boosts and likes."}),e("dt",{children:"Sort: Density"}),e("dd",{children:'Posts are sorted by information density or depth. Shorter posts are "lighter" while longer posts are "heavier". Posts with photos are "heavier" than posts without photos.'}),e("dt",{children:"Group: Authors"}),e("dd",{children:"Posts are grouped by authors, sorted by posts count per author."})]})})]})})]})}const yt=lt(function({post:f}){const{id:d,account:p,group:a,reblog:h,inReplyToId:g,inReplyToAccountId:w,_followedTags:m,_filtered:c,visibility:I,__BOOSTERS:L}=f,Q=g&&w!==p.id,u=!!c,V=$=>{$.shiftKey};return e("article",{class:`post-line ${a?"group":h?"reblog":m!=null&&m.length?"followed-tags":""} ${Q?"reply-to":""} ${u?"filtered":""} visibility-${I}`,onMouseEnter:V,children:[e("span",{class:"post-author",children:h?e("span",{class:"post-reblog-avatar",children:[e(ge,{url:p.avatarStatic||p.avatar,squircle:p.bot}),(L==null?void 0:L.size)>0?[...L].map($=>e(ge,{url:$.avatarStatic||$.avatar,squircle:$.bot})):""," ",e(x,{icon:"rocket"})," ",e($e,{account:h.account,showAvatar:!0})]}):e($e,{account:p,showAvatar:!0})}),e(Tt,{post:h||f,filterInfo:c}),e("span",{class:"post-meta",children:[e(Ct,{post:h||f})," ",e(Be,{datetime:new Date((h==null?void 0:h.createdAt)||f.createdAt),format:"micro"})]})]})},(f,d)=>{var p,a;return((p=f==null?void 0:f.post)==null?void 0:p.id)===((a=d==null?void 0:d.post)==null?void 0:a.id)}),vt=({root:f,to:d,...p})=>{const a=le(),[h,g]=D(!1);return te(()=>{const w=new IntersectionObserver(m=>{m[0].isIntersecting&&(queueMicrotask(()=>g(!0)),w.unobserve(a.current))},{root:f,rootMargin:`${Math.max(320,screen.height*.75)}px`});return a.current&&w.observe(a.current),()=>{a.current&&w.unobserve(a.current)}},[]),h?e("li",{children:e(pe,{to:d,children:e(yt,{...p})})}):e("li",{ref:a,style:{height:"4em"}})},wt=8,kt=8;function Fe(f){var c;const{spoilerText:d,content:p,poll:a,mediaAttachments:h,card:g}=f,w=(c=a==null?void 0:a.options)!=null&&c.length?a.options.reduce((I,L)=>I+L.title,""):"";return(d.length+ot(p)+w.length)/140+(h!=null&&h.length?wt*h.length:g!=null&&g.image?kt:0)}const W=48;function Tt({post:f,filterInfo:d}){var oe;const{spoilerText:p,sensitive:a,content:h,emojis:g,poll:w,mediaAttachments:m,card:c,inReplyToId:I,inReplyToAccountId:L,account:Q,_thread:u}=f,V=I&&L===Q.id||!!u,$=!p&&!a,fe=h?at(f):"";return e("div",{class:"post-peek",title:p?"":fe,children:[e("span",{class:"post-peek-content",children:d?e(M,{children:[V&&e(M,{children:[e("span",{class:"post-peek-tag post-peek-thread",children:"Thread"})," "]}),e("span",{class:"post-peek-filtered",children:["Filtered",d!=null&&d.titlesStr?`: ${d.titlesStr}`:""]})]}):p?e(M,{children:[V&&e(M,{children:[e("span",{class:"post-peek-tag post-peek-thread",children:"Thread"})," "]}),e("span",{class:"post-peek-spoiler",children:[e(x,{icon:"eye-close"})," ",p]})]}):e("div",{class:"post-peek-html",children:[V&&e(M,{children:[e("span",{class:"post-peek-tag post-peek-thread",children:"Thread"})," "]}),!!h&&e("div",{dangerouslySetInnerHTML:{__html:ct(h,g)}}),!!((oe=w==null?void 0:w.options)!=null&&oe.length)&&w.options.map(_=>e("div",{children:[w.multiple?"â–ªï¸":"â€¢"," ",_.title]})),!h&&(m==null?void 0:m.length)===1&&m[0].description&&e(M,{children:[e("span",{class:"post-peek-tag post-peek-alt",children:"ALT"})," ",e("div",{children:m[0].description})]})]})}),!d&&e("span",{class:"post-peek-post-content",children:[!!w&&e("span",{class:"post-peek-tag post-peek-poll",children:[e(x,{icon:"poll",size:"s"}),"Poll"]}),m!=null&&m.length?m.map(_=>{const E=_.previewUrl||_.url,P=_.previewRemoteUrl||_.remoteUrl;return e("span",{class:"post-peek-media",children:{image:(E||P)&&$?e("img",{src:E,width:W,height:W,alt:_.description,loading:"lazy",onError:z=>{const{src:F}=z.target;F===E&&(z.target.src=P)}}):e("span",{class:"post-peek-faux-media",children:"ðŸ–¼"}),gifv:(E||P)&&$?e("img",{src:E,width:W,height:W,alt:_.description,loading:"lazy",onError:z=>{const{src:F}=z.target;F===E&&(z.target.src=P)}}):e("span",{class:"post-peek-faux-media",children:"ðŸŽžï¸"}),video:(E||P)&&$?e("img",{src:E,width:W,height:W,alt:_.description,loading:"lazy",onError:z=>{const{src:F}=z.target;F===E&&(z.target.src=P)}}):e("span",{class:"post-peek-faux-media",children:"ðŸ“¹"}),audio:e("span",{class:"post-peek-faux-media",children:"ðŸŽµ"})}[_.type]||null},_.id)}):!!c&&c.image&&$&&e("span",{class:`post-peek-media post-peek-card card-${c.type||""}`,children:c.image?e("img",{src:c.image,width:W,height:W,alt:c.title||c.description||c.imageDescription,loading:"lazy"}):e("span",{class:"post-peek-faux-media",children:"ðŸ”—"})})]})]})}function Ct({post:f}){const{reblogsCount:d,repliesCount:p,favouritesCount:a}=f;return e("span",{class:"post-stats",children:[p>0&&e("span",{class:"post-stat-replies",children:[e(x,{icon:"comment2",size:"s"})," ",Re(p)]}),a>0&&e("span",{class:"post-stat-likes",children:[e(x,{icon:"heart",size:"s"})," ",Re(a)]}),d>0&&e("span",{class:"post-stat-boosts",children:[e(x,{icon:"rocket",size:"s"})," ",Re(d)]})]})}const{locale:Rt}=new Intl.DateTimeFormat().resolvedOptions(),At=new Intl.DateTimeFormat(Rt,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"});function Oe(f,d){return At.formatRange(f,d)}function It(f,d,p){const a=f.map(c=>new Date(c[d])),h=a.reduce((c,I)=>I<c?I:c,a[0]),w=a.reduce((c,I)=>I>c?I:c,a[0]).getTime()-h.getTime(),m=Array.from({length:p},()=>[]);return f.forEach(c=>{const L=(new Date(c[d]).getTime()-h.getTime())/w,Q=Math.floor(L*(p-1));m[Q].push(c)}),m}export{Lt as default};
//# sourceMappingURL=catchup-1Ae2PzvM.js.map
