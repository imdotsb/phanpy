import{a as B,s as v,b as kt,u as on,o as _n,I as w,M as mt,c as J,A as Ot,N as Le,d as Et,L as H,g as Gt,e as cn,l as Fn,t as Fe,R as Ae,f as zn,h as Nt,i as an,j as we,E as rn,k as Dt,m as Bn,n as Ft,p as On,q as rt,r as gt,v as ze,T as ln,w as Yt,x as dn,y as Be,z as qn,B as It,C as Hn,S as wt,D as Vn,F as jn,G as un,H as hn,J as Re,K as St,O as fn,P as Wn,Q as Gn,U as Kn,V as ne,W as Jn,X as Oe,Y as Yn,Z as Xn,_ as qe}from"./useTitle-128c296e.js";import{_ as P,p as F,x as qt,h as x,u as vt,o as t,a as at,k as $,s as he,M as Ht,b as Z,c as At,d as Zn,F as ft,S as Qn,I as Qt,y as Pt,g as ts,m as He,l as Ve,e as es,f as pn,i as Me,j as ns,n as Ut,A as ss,q as is,J as os,C as mn,r as gn,t as bn,T as Kt,v as Vt,w as cs,z as as,B as Zt,D as rs,E as je,G as ls,H as ds,R as ge,K as pt,L as us,N as hs}from"./vendor-32c42d6d.js";function de(e=()=>{},n=[]){const l=P(e);F(()=>{l.current=e},[n]),F(()=>{const c=()=>{const o=document.hidden||document.visibilityState==="hidden";l.current(!o)};return document.addEventListener("visibilitychange",c),()=>document.removeEventListener("visibilitychange",c)},[])}const fs=qt(function({isLoggedIn:n}){const[l,c]=x(!0);de(c);const o=P();F(()=>{if(n&&l){const{masto:i,instance:m}=B();(async()=>{var a;if(v.notificationsLast){const u=i.v1.notifications.list({limit:1,since_id:v.notificationsLast.id}),{value:f}=await u.next();if(f!=null&&f.length){let p;try{const r=await i.v1.markers.fetch({timeline:"notifications"});p=(a=r==null?void 0:r.notifications)==null?void 0:a.lastReadId}catch{}p?f[0].id!==p&&(v.notificationsShowNew=!0):v.notificationsShowNew=!0}}o.current=await i.ws.stream("/api/v1/streaming",{stream:"user:notification"}),o.current.on("notification",u=>{u.status&&kt(u.status,m,{skipThreading:!0}),v.notificationsShowNew=!0}),o.current.ws.onclose=()=>{}})()}return()=>{o.current&&(o.current.ws.close(),o.current=null)}},[l,n]);const s=P(),d=()=>{s.current=Date.now(),fetch("./version.json").then(i=>i.json()).then(i=>{i&&(v.appVersion=i)}).catch(i=>{})};return on(d,l&&1e3*60*30),de(i=>{i&&(s.current?Date.now()-s.current>1e3*60*60&&d():d())}),null});function ps(){function e(n){n.shiftKey?_n()||(alert("Looks like your browser is blocking popups."),v.showCompose=!0):v.showCompose=!0}return vt("c, shift+c",e,{ignoreEventWhen:n=>!!document.querySelector("#modal-container > *")}),t("button",{type:"button",id:"compose-button",onClick:e,children:t(w,{icon:"quill",size:"xl",alt:"Compose"})})}const ms=qt(function(){const n=at(v);function l(){v.showKeyboardShortcutsHelp=!1}vt("?, shift+?",o=>{v.showKeyboardShortcutsHelp=!0},{ignoreEventWhen:o=>!!document.querySelector("#modal-container > *")});const c=vt("esc",l,[]);return!!n.showKeyboardShortcutsHelp&&t(mt,{class:"light",onClick:o=>{o.target===o.currentTarget&&l()},children:t("div",{id:"keyboard-shortcuts-help-container",class:"sheet",tabindex:"-1",ref:c,children:[t("button",{type:"button",class:"sheet-close",onClick:l,children:t(w,{icon:"x"})}),t("header",{children:t("h2",{children:"Keyboard shortcuts"})}),t("main",{children:t("table",{children:[{action:"Keyboard shortcuts help",keys:t("kbd",{children:"?"})},{action:"Next post",keys:t("kbd",{children:"j"})},{action:"Previous post",keys:t("kbd",{children:"k"})},{action:"Skip carousel to next post",keys:t($,{children:[t("kbd",{children:"Shift"})," + ",t("kbd",{children:"j"})]})},{action:"Skip carousel to previous post",keys:t($,{children:[t("kbd",{children:"Shift"})," + ",t("kbd",{children:"k"})]})},{action:"Open post details",keys:t($,{children:[t("kbd",{children:"Enter"})," or ",t("kbd",{children:"o"})]})},{action:"Toggle expanded/collapsed thread",keys:t("kbd",{children:"x"})},{action:"Close post or dialogs",keys:t($,{children:[t("kbd",{children:"Esc"})," or ",t("kbd",{children:"Backspace"})]})},{action:"Focus column in multi-column mode",keys:t($,{children:[t("kbd",{children:"1"})," to ",t("kbd",{children:"9"})]})},{action:"Compose new post",keys:t("kbd",{children:"c"})},{action:"Send post",keys:t($,{children:[t("kbd",{children:"Ctrl"})," + ",t("kbd",{children:"Enter"})," or ",t("kbd",{children:"⌘"})," +"," ",t("kbd",{children:"Enter"})]})},{action:"Search",keys:t("kbd",{children:"/"})},{action:"Reply",keys:t("kbd",{children:"r"})},{action:"Favourite",keys:t("kbd",{children:"f"})},{action:"Boost",keys:t($,{children:[t("kbd",{children:"Shift"})," + ",t("kbd",{children:"b"})]})},{action:"Bookmark",keys:t("kbd",{children:"d"})}].map(({action:o,keys:s})=>t("tr",{children:[t("th",{children:o}),t("td",{children:s})]},o))})})]})})});function gs({onClose:e}){const{masto:n}=B(),l=J.local.getJSON("accounts"),c=J.session.get("currentAccount"),o=l.length>1,[s,d]=x(0),[i,m]=he(a=>a+1,0);return t("div",{id:"accounts-container",class:"sheet",tabIndex:"-1",children:[!!e&&t("button",{type:"button",class:"sheet-close",onClick:e,children:t(w,{icon:"x"})}),t("header",{class:"header-grid",children:t("h2",{children:"Accounts"})}),t("main",{children:t("section",{children:[t("ul",{class:"accounts-list",children:l.map((a,u)=>{const f=a.info.id===c,p=u===(s||0);return t("li",{children:[t("div",{children:[o&&t("span",{class:`current ${f?"is-current":""}`,children:t(w,{icon:"check-circle",alt:"Current"})}),t(Ot,{url:a.info.avatarStatic,size:"xxl",onDblClick:async()=>{if(f)try{const r=await n.v1.accounts.fetch(a.info.id);a.info=r,J.local.setJSON("accounts",l),m()}catch{}}}),t(Le,{account:o?{...a.info,acct:/@/.test(a.info.acct)?a.info.acct:`${a.info.acct}@${a.instanceURL}`}:a.info,showAcct:!0,onClick:()=>{f?v.showAccount=`${a.info.username}@${a.instanceURL}`:(J.session.set("currentAccount",a.info.id),location.reload())}})]}),t("div",{class:"actions",children:[p&&o&&t($,{children:[t("span",{class:"tag",children:"Default"})," "]}),t(Ht,{align:"end",menuButton:t("button",{type:"button",title:"More",class:"plain more-button",children:t(w,{icon:"more",size:"l",alt:"More"})}),children:[t(Z,{onClick:()=>{v.showAccount=`${a.info.username}@${a.instanceURL}`},children:[t(w,{icon:"user"}),t("span",{children:"View profile…"})]}),t(At,{}),o&&t(Z,{disabled:p,onClick:()=>{l.splice(u,1),l.unshift(a),J.local.setJSON("accounts",l),d(u)},children:[t(w,{icon:"check-circle"}),t("span",{children:"Set as default"})]}),t(Et,{subMenu:!0,confirmLabel:t($,{children:[t(w,{icon:"exit"}),t("span",{children:["Log out @",a.info.acct,"?"]})]}),disabled:!f,menuItemClassName:"danger",onClick:()=>{l.splice(u,1),J.local.setJSON("accounts",l),location.href=location.pathname||"/"},children:[t(w,{icon:"exit"}),t("span",{children:"Log out…"})]})]})]})]},u+a.id)})}),t("p",{children:t(H,{to:"/login",class:"button plain2",onClick:e,children:[t(w,{icon:"plus"})," ",t("span",{children:"Add an existing account"})]})}),o&&t("p",{children:t("small",{children:["Note: ",t("i",{children:"Default"})," account will always be used for first load. Switched accounts will persist during the session."]})})]})})]})}const yn=""+new URL("logo-4e67d38a.svg",import.meta.url).href;function We(e){const{masto:n}=B();return n.v1.webPushSubscriptions.create(e)}function bs(){const{masto:e}=B();return e.v1.webPushSubscriptions.fetch()}function ys(e){const{masto:n}=B();return n.v1.webPushSubscriptions.update(e)}function ws(){const{masto:e}=B();return e.v1.webPushSubscriptions.remove()}function fe(){return"serviceWorker"in navigator&&"PushManager"in window}function wn(){return navigator.serviceWorker.getRegistration()}async function De(){const e=await wn(),n=e?await e.pushManager.getSubscription():void 0;return{registration:e,subscription:n}}function vn(e){const n="=".repeat((4-e.length%4)%4),l=`${e}${n}`.replace(/-/g,"+").replace(/_/g,"/"),c=window.atob(l),o=new Uint8Array(c.length);for(let s=0;s<c.length;++s)o[s]=c.charCodeAt(s);return o}async function vs(){if(!fe())return;const{subscription:e}=await De();let n=null;try{n=await bs()}catch(l){if(!/(not found|unknown)/i.test(l.message))throw l}if(n&&e){const l=n.endpoint===e.endpoint,{vapidKey:c}=Gt(),o=n.serverKey===c;if(!l)throw new Error("Backend subscription endpoint changed");if(!o)throw new Error("Backend subscription key and vapid key changed")}if(e&&!n){const{vapidKey:l}=Gt(),{applicationServerKey:c}=e.options,o=vn(l).toString(),s=new Uint8Array(c).toString();if(!(o===s))throw await e.unsubscribe(),new Error("Subscription key and vapid key changed")}return{subscription:e,backendSubscription:n}}async function Ge({data:e,policy:n}){if(!fe())return;let{registration:l,subscription:c}=await De(),o=null;if(c)try{o=await ys({data:e,policy:n})}catch{o=await We({subscription:c,data:e,policy:n})}else{const{vapidKey:s}=Gt();if(!s)throw new Error("No server key found");c=await l.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:vn(s)}),o=await We({subscription:c,data:e,policy:n})}return{subscription:c,backendSubscription:o}}async function Ke(){if(!fe())return;const{subscription:e}=await De();e&&(await ws(),await e.unsubscribe())}const Je=16,Bt=[16,17,18,19,20];function ks({onClose:e}){const n=at(v),l=J.local.get("theme")||"auto",c=P(),o=n.settings.contentTranslationTargetLanguage||null,s=cn(),d=Fn(s),i=J.local.get("textSize")||Je,[m,a]=x(J.account.get("preferences")||{}),{masto:u,authenticated:f,instance:p}=B();return t("div",{id:"settings-container",class:"sheet",tabIndex:"-1",children:[!!e&&t("button",{type:"button",class:"sheet-close",onClick:e,children:t(w,{icon:"x"})}),t("header",{children:t("h2",{children:"Settings"})}),t("main",{children:[t("section",{children:t("ul",{children:[t("li",{children:[t("div",{children:t("label",{children:"Appearance"})}),t("div",{children:t("form",{ref:c,onInput:r=>{r.preventDefault();const b=new FormData(c.current).get("theme"),y=document.documentElement;b==="auto"?y.classList.remove("is-light","is-dark"):(y.classList.toggle("is-light",b==="light"),y.classList.toggle("is-dark",b==="dark")),document.querySelector('meta[name="color-scheme"]').setAttribute("content",b==="auto"?"dark light":b),b==="auto"?J.local.del("theme"):J.local.set("theme",b)},children:t("div",{class:"radio-group",children:[t("label",{children:[t("input",{type:"radio",name:"theme",value:"light",defaultChecked:l==="light"}),t("span",{children:"Light"})]}),t("label",{children:[t("input",{type:"radio",name:"theme",value:"dark",defaultChecked:l==="dark"}),t("span",{children:"Dark"})]}),t("label",{children:[t("input",{type:"radio",name:"theme",value:"auto",defaultChecked:l!=="light"&&l!=="dark"}),t("span",{children:"Auto"})]})]})})})]}),t("li",{children:[t("div",{children:t("label",{children:"Text size"})}),t("div",{class:"range-group",children:[t("span",{style:{fontSize:Bt[0]},children:"A"})," ",t("input",{type:"range",min:Bt[0],max:Bt[Bt.length-1],step:"1",value:i,list:"sizes",onChange:r=>{const h=parseInt(r.target.value,10);document.documentElement.style.setProperty("--text-size",`${h}px`),h===Je?J.local.del("textSize"):J.local.set("textSize",r.target.value)}})," ",t("span",{style:{fontSize:Bt[Bt.length-1]},children:"A"}),t("datalist",{id:"sizes",children:Bt.map(r=>t("option",{value:r}))})]})]})]})}),f&&t($,{children:[t("h3",{children:"Posting"}),t("section",{children:t("ul",{children:t("li",{children:[t("div",{children:t("label",{for:"posting-privacy-field",children:["Default visibility"," ",t(w,{icon:"cloud",alt:"Synced",class:"synced-icon"})]})}),t("div",{children:t("select",{id:"posting-privacy-field",value:m["posting:default:visibility"]||"public",onChange:r=>{const{value:h}=r.target;(async()=>{try{await u.v1.accounts.updateCredentials({source:{privacy:h}}),a({...m,"posting:default:visibility":h}),J.account.set("preferences",{...m,"posting:default:visibility":h})}catch{alert("Failed to update posting privacy")}})()},children:[t("option",{value:"public",children:"Public"}),t("option",{value:"unlisted",children:"Unlisted"}),t("option",{value:"private",children:"Followers only"})]})})]})})}),t("p",{class:"section-postnote",children:[t(w,{icon:"cloud",alt:"Synced",class:"synced-icon"})," ",t("small",{children:["Synced to your instance server's settings."," ",t("a",{href:`https://${p}/`,target:"_blank",rel:"noopener noreferrer",children:["Go to your instance (",p,") for more settings."]})]})]})]}),t("h3",{children:"Experiments"}),t("section",{children:t("ul",{children:[t("li",{children:t("label",{children:[t("input",{type:"checkbox",checked:n.settings.autoRefresh,onChange:r=>{v.settings.autoRefresh=r.target.checked}})," ","Auto refresh timeline posts"]})}),t("li",{children:t("label",{children:[t("input",{type:"checkbox",checked:n.settings.boostsCarousel,onChange:r=>{v.settings.boostsCarousel=r.target.checked}})," ","Boosts carousel"]})}),t("li",{children:[t("label",{children:[t("input",{type:"checkbox",checked:n.settings.contentTranslation,onChange:r=>{const{checked:h}=r.target;v.settings.contentTranslation=h,h||(v.settings.contentTranslationTargetLanguage=null)}})," ","Post translation"]}),t("div",{class:`sub-section ${n.settings.contentTranslation?"":"more-insignificant"}`,children:[t("div",{children:t("label",{children:["Translate to"," ",t("select",{value:o||"",disabled:!n.settings.contentTranslation,onChange:r=>{v.settings.contentTranslationTargetLanguage=r.target.value||null},children:[t("option",{value:"",children:["System language (",d,")"]}),t("option",{disabled:!0,children:"──────────"}),Fe.map(r=>t("option",{value:r.code,children:r.name}))]})]})}),t("hr",{}),t("p",{class:"checkbox-fieldset",children:['Hide "Translate" button for',n.settings.contentTranslationHideLanguages.length>0&&t($,{children:[" ","(",n.settings.contentTranslationHideLanguages.length,")"]}),":",t("div",{class:"checkbox-fields",children:Fe.map(r=>t("label",{children:[t("input",{type:"checkbox",checked:n.settings.contentTranslationHideLanguages.includes(r.code),onChange:h=>{const{checked:b}=h.target;b?v.settings.contentTranslationHideLanguages.push(r.code):v.settings.contentTranslationHideLanguages=n.settings.contentTranslationHideLanguages.filter(y=>y!==r.code)}})," ",r.name]}))})]}),t("p",{class:"insignificant",children:t("small",{children:["Note: This feature uses an external API to translate, powered by"," ",t("a",{href:"https://github.com/thedaviddelta/lingva-translate",target:"_blank",rel:"noopener noreferrer",children:"Lingva Translate"}),"."]})}),t("hr",{}),t("div",{children:[t("label",{children:[t("input",{type:"checkbox",checked:n.settings.contentTranslationAutoInline,disabled:!n.settings.contentTranslation,onChange:r=>{v.settings.contentTranslationAutoInline=r.target.checked}})," ","Auto inline translation"]}),t("p",{class:"insignificant",children:t("small",{children:["Automatically show translation for posts in timeline. Only works for ",t("b",{children:"short"})," posts without content warning, media and poll."]})})]})]})]}),t("li",{children:[t("label",{children:[t("input",{type:"checkbox",checked:n.settings.cloakMode,onChange:r=>{v.settings.cloakMode=r.target.checked}})," ","Cloak mode"," ",t("span",{class:"insignificant",children:["(",t("samp",{children:"Text"})," → ",t("samp",{children:"████"}),")"]})]}),t("div",{class:"sub-section insignificant",children:t("small",{children:"Replace text as blocks, useful when taking screenshots, for privacy reasons."})})]}),f&&t("li",{children:t("button",{type:"button",class:"light",onClick:()=>{v.showDrafts=!0,v.showSettings=!1},children:"Unsent drafts"})})]})}),f&&t(Ss,{onClose:e}),t("h3",{children:"About"}),t("section",{children:[t("div",{style:{display:"flex",gap:8,lineHeight:1.25,alignItems:"center",marginTop:8},children:[t("img",{src:yn,alt:"",width:"64",height:"64",style:{aspectRatio:"1/1",verticalAlign:"middle",background:"#b7cdf9",borderRadius:12}}),t("div",{children:[t("b",{children:"Phanpy"})," ",t("a",{href:"https://hachyderm.io/@phanpy",rel:"noopener noreferrer",onClick:r=>{r.preventDefault(),v.showAccount="phanpy@hachyderm.io"},children:"@phanpy"}),t("br",{}),t("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",rel:"noopener noreferrer",children:"Built"})," ","by"," ",t("a",{href:"https://mastodon.social/@cheeaun",rel:"noopener noreferrer",onClick:r=>{r.preventDefault(),v.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"})]})]}),t("p",{children:[t("a",{href:"https://github.com/sponsors/cheeaun",target:"_blank",rel:"noopener noreferrer",children:"Sponsor"})," ","·"," ",t("a",{href:"https://www.buymeacoffee.com/cheeaun",target:"_blank",rel:"noopener noreferrer",children:"Donate"})," ","·"," ",t("a",{href:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",target:"_blank",rel:"noopener noreferrer",children:"Privacy Policy"})]}),t("p",{children:[t("span",{class:"insignificant",children:"Last build:"})," ",t(Ae,{datetime:new Date("2023-10-20T02:30:24.582Z")})," ",t($,{children:["(",t("a",{href:"https://github.com/cheeaun/phanpy/commit/12d0e6a",target:"_blank",rel:"noopener noreferrer",children:t("code",{children:"12d0e6a"})}),")"]})]})]})]})]})}function Ss({onClose:e}){if(!fe())return null;const{instance:n}=B(),[l,c]=x("default"),o=P(),[s,d]=x(!1),[i,m]=x(!1),a=P();F(()=>{(async()=>{c("loading");try{const{subscription:f,backendSubscription:p}=await vs();if(p!=null&&p.policy&&p.policy!=="none"){d(!0);const{alerts:r,policy:h}=p;a.current=h;const{elements:b}=o.current,y=b.namedItem(h);y&&(y.value=h),Object.keys(r).forEach(g=>{const k=b.namedItem(g);(k==null?void 0:k.type)==="checkbox"&&(k.checked=!0)})}c("default")}catch(f){/outside.*authorized/i.test(f.message)?m(!0):alert((f==null?void 0:f.message)||f),c("error")}})()},[]);const u=l==="loading";return t("form",{ref:o,onChange:()=>{const f=Object.fromEntries(new FormData(o.current)),p=!!f["policy-allow"],r={policy:f.policy,data:{alerts:{mention:!!f.mention,favourite:!!f.favourite,reblog:!!f.reblog,follow:!!f.follow,follow_request:!!f.followRequest,poll:!!f.poll,update:!!f.update,status:!!f.status}}};let h=0;Object.keys(r.data.alerts).forEach(y=>{r.data.alerts[y]?h++:delete r.data.alerts[y]});const b=a.current!==r.policy;p&&h>0?b?Ke().then(()=>{Ge(r)}).catch(y=>{alert("Failed to update subscription. Please try again.")}):Ge(r).catch(y=>{alert("Failed to update subscription. Please try again.")}):Ke().catch(y=>{alert("Failed to remove subscription. Please try again.")})},children:[t("h3",{children:"Push Notifications (beta)"}),t("section",{children:t("ul",{children:t("li",{children:[t("label",{children:[t("input",{type:"checkbox",disabled:u||i,name:"policy-allow",checked:s,onChange:async f=>{const{checked:p}=f.target;if(p){const r=await Notification.requestPermission();r==="granted"?d(!0):(d(!1),r==="denied"&&alert("Push notifications are blocked. Please enable them in your browser settings."))}else d(!1)}})," ","Allow from"," ",t("select",{name:"policy",disabled:u||i||!s,children:[{value:"all",label:"anyone"},{value:"followed",label:"people I follow"},{value:"follower",label:"followers"}].map(f=>t("option",{value:f.value,children:f.label}))})]}),t("div",{class:"shazam-container no-animation",style:{width:"100%"},hidden:!s,children:t("div",{class:"shazam-container-inner",children:t("div",{class:"sub-section",children:t("ul",{children:[{value:"mention",label:"Mentions"},{value:"favourite",label:"Favourites"},{value:"reblog",label:"Boosts"},{value:"follow",label:"Follows"},{value:"followRequest",label:"Follow requests"},{value:"poll",label:"Polls"},{value:"update",label:"Post edits"},{value:"status",label:"New posts"}].map(f=>t("li",{children:t("label",{children:[t("input",{type:"checkbox",name:f.value})," ",f.label]})}))})})})}),i&&t("div",{class:"sub-section",children:t("p",{children:["Push permission was not granted since your last login. You'll need to"," ",t(H,{to:`/login?instance=${n}`,onClick:e,children:[t("b",{children:"log in"})," again to grant push permission"]}),"."]})})]})})}),t("p",{class:"section-postnote",children:t("small",{children:["NOTE: Push notifications only work for ",t("b",{children:"one account"}),"."]})})]})}const ve=()=>{let e=setTimeout(()=>{if(!document.getElementById("columns")){const l=document.querySelectorAll("#modal-container > *");if(l!=null&&l.length){const d=l[l.length-1],i=d.querySelector('[tabindex="-1"]')||d;if(i){i.focus();return}}if(document.querySelector(".deck-backdrop"))return;const o=document.querySelectorAll(".deck-container"),s=o[o.length-1];s&&s.tabIndex===-1&&s.focus()}},100);return()=>clearTimeout(e)};function Ee({list:e,onClose:n}){const{masto:l}=B(),[c,o]=x("default"),s=!!e,d=P(),i=P(),m=P();F(()=>{s&&(d.current.value=e.title,i.current.value=e.repliesPolicy,m.current&&(m.current.checked=e.exclusive))},[s]);const a=zn("@mastodon/list-exclusive");return t("div",{class:"sheet",children:[!!n&&t("button",{type:"button",class:"sheet-close",onClick:n,children:t(w,{icon:"x"})})," ",t("header",{children:t("h2",{children:s?"Edit list":"New list"})}),t("main",{children:t("form",{class:"list-form",onSubmit:u=>{u.preventDefault();const f=new FormData(u.target),p=f.get("title"),r=f.get("replies_policy"),h=f.get("exclusive")==="on";o("loading"),(async()=>{try{let b;s?b=await l.v1.lists.update(e.id,{title:p,replies_policy:r,exclusive:h}):b=await l.v1.lists.create({title:p,replies_policy:r,exclusive:h}),o("default"),n==null||n({state:"success",list:b})}catch{o("error"),alert(s?"Unable to edit list.":"Unable to create list.")}})()},children:[t("div",{class:"list-form-row",children:t("label",{for:"list-title",children:["Name"," ",t("input",{ref:d,type:"text",id:"list-title",name:"title",required:!0,disabled:c==="loading",dir:"auto"})]})}),t("div",{class:"list-form-row",children:t("select",{ref:i,name:"replies_policy",required:!0,disabled:c==="loading",children:[t("option",{value:"list",children:"Show replies to list members"}),t("option",{value:"followed",children:"Show replies to people I follow"}),t("option",{value:"none",children:"Don't show replies"})]})}),a&&t("div",{class:"list-form-row",children:t("label",{class:"label-block",children:[t("input",{ref:m,type:"checkbox",name:"exclusive",disabled:c==="loading"})," ","Hide posts on this list from Home/Following"]})}),t("div",{class:"list-form-footer",children:[t("button",{type:"submit",disabled:c==="loading",children:s?"Save":"Create"}),s&&t(Et,{disabled:c==="loading",align:"end",menuItemClassName:"danger",confirmLabel:"Delete this list?",onClick:()=>{o("loading"),(async()=>{try{await l.v1.lists.remove(e.id),o("default"),n==null||n({state:"deleted"})}catch{o("error"),alert("Unable to delete list.")}})()},children:t("button",{type:"button",class:"light danger",disabled:c==="loading",children:"Delete…"})})]})]})})]})}const Is=[1e3*60*5,1e3*60*30,1e3*60*60,1e3*60*60*6,1e3*60*60*24,1e3*60*60*24*3,1e3*60*60*24*7,0],Ye={0:"Forever",3e5:"5 minutes",18e5:"30 minutes",36e5:"1 hour",216e5:"6 hours",864e5:"1 day",2592e5:"3 days",6048e5:"1 week"},Xe=80,ke=Zn({familiarFollowers:[]});function kn({account:e,fetchAccount:n=()=>{},standalone:l,instance:c,authenticated:o}){const{masto:s}=B({instance:c}),[d,i]=x("default"),m=typeof e=="string",[a,u]=x(m?null:e),f=at(ke),p=ft(()=>e.id===J.session.get("currentAccount"),[e==null?void 0:e.id]),r=ft(()=>c===B().instance,[c]);F(()=>{if(!m){u(e);return}i("loading"),(async()=>{try{const C=await n();v.accounts[`${C.id}@${c}`]=C,u(C),i("default")}catch{u(null),i("error")}})()},[m,e,n]);const{acct:h,avatar:b,avatarStatic:y,bot:g,createdAt:k,displayName:S,emojis:I,fields:R,followersCount:z,followingCount:A,group:L,id:V,lastStatusAt:N,locked:M,note:D,statusesCount:ot,url:Y,username:Ct,memorial:lt,moved:Tt,roles:Lt}=a||{};let nt=!1,{header:U,headerStatic:K}=a||{};(!U||/missing\.png$/.test(U))&&b&&!/missing\.png$/.test(b)&&(U=b,nt=!0,y&&!/missing\.png$/.test(y)&&(K=y));const ct=ft(()=>Y?new URL(Y).hostname:null,[Y]),[ht,xt]=x([]),$t=P(),O=P([]);async function tt(C){(C||!$t.current)&&($t.current=s.v1.accounts.listFollowers(V,{limit:Xe}));const E=await $t.current.next();if(p||!r)return E;const{value:q}=E;let W=[];if(C){const Q=await s.v1.accounts.fetchFamiliarFollowers(V);O.current=Q[0].accounts,W=[...O.current,...q.filter(it=>!O.current.some(X=>X.id===it.id))]}else q!=null&&q.length&&(W=q.filter(Q=>!O.current.some(it=>it.id===Q.id)));return{...E,value:W}}const G=P();async function st(C){return(C||!G.current)&&(G.current=s.v1.accounts.listFollowing(V,{limit:Xe})),await G.current.next()}const T=l?"div":H,_=c?`/${c}/a/${V}`:`/a/${V}`;return t("div",{class:`account-container  ${d==="loading"?"skeleton":""}`,style:{"--header-color-1":ht[0],"--header-color-2":ht[1],"--header-color-3":ht[2],"--header-color-4":ht[3]},children:[d==="error"&&t("div",{class:"ui-state",children:[t("p",{children:"Unable to load account."}),t("p",{children:t("a",{href:m?e:Y,target:"_blank",rel:"noopener noreferrer",children:["Go to account page ",t(w,{icon:"external"})]})})]}),d==="loading"?t($,{children:[t("header",{children:t(Nt,{avatarSize:"xxxl",skeleton:!0})}),t("main",{children:[t("div",{class:"note",children:[t("p",{children:"████████ ███████"}),t("p",{children:"███████████████ ███████████████"})]}),t("p",{class:"stats",children:[t("div",{children:[t("span",{children:"██"})," Followers"]}),t("div",{children:[t("span",{children:"██"})," Following"]}),t("div",{children:[t("span",{children:"██"})," Posts"]}),t("div",{children:"Joined ██"})]})]})]}):a&&t($,{children:[!!Tt&&t("div",{class:"account-moved",children:[t("p",{children:[t("b",{children:S})," has indicated that their new account is now:"]}),t(Nt,{account:Tt,instance:c,onClick:C=>{C.stopPropagation(),v.showAccount=Tt}})]}),U&&!/missing\.png$/.test(U)&&t("img",{src:U,alt:"",class:`header-banner ${nt?"header-is-avatar":""}`,onError:C=>{C.target.crossOrigin?C.target.src!==K?C.target.src=K:(C.target.removeAttribute("crossorigin"),C.target.src=U):C.target.src!==K?C.target.src=K:C.target.remove()},crossOrigin:"anonymous",onLoad:C=>{C.target.classList.add("loaded");try{const E=document.createElement("canvas"),q=E.getContext("2d",{willReadFrequently:!0});E.width=C.target.width,E.height=C.target.height,q.drawImage(C.target,0,0);const W=10,it=[q.getImageData(0,0,W,W).data,q.getImageData(C.target.width-W,0,W,W).data,q.getImageData(0,C.target.height-W,W,W).data,q.getImageData(C.target.width-W,C.target.height-W,W,W).data].map(X=>{let et=0,dt=0,ut=0,bt=0;for(let Mt=0;Mt<X.length;Mt+=4)et+=X[Mt],dt+=X[Mt+1],ut+=X[Mt+2],bt+=X[Mt+3];const Rt=X.length/4;return[et/Rt,dt/Rt,ut/Rt,bt/Rt]}).map(X=>{const[et,dt,ut,bt]=xs(X);return`rgba(${et}, ${dt}, ${ut}, ${bt})`});xt(it)}catch{}}}),t("header",{children:t(Nt,{account:a,instance:c,avatarSize:"xxxl",external:l,internal:!l})}),t("main",{tabIndex:"-1",children:[!!lt&&t("span",{class:"tag",children:"In Memoriam"}),!!g&&t("span",{class:"tag",children:[t(w,{icon:"bot"})," Automated"]}),!!L&&t("span",{class:"tag",children:[t(w,{icon:"group"})," Group"]}),Lt==null?void 0:Lt.map(C=>t("span",{class:"tag",children:[C.name,!!ct&&t($,{children:[" ",t("span",{class:"more-insignificant",children:ct})]})]})),t("div",{class:"note",dir:"auto",onClick:an({instance:c}),dangerouslySetInnerHTML:{__html:we(D,{emojis:I})}}),t("div",{class:"account-metadata-box",children:[(R==null?void 0:R.length)>0&&t("div",{class:"profile-metadata",children:R.map(({name:C,value:E,verifiedAt:q},W)=>t("div",{class:`profile-field ${q?"profile-verified":""}`,dir:"auto",children:[t("b",{children:[t(rn,{text:C,emojis:I})," ",!!q&&t(w,{icon:"check-circle",size:"s"})]}),t("p",{dangerouslySetInnerHTML:{__html:we(E,{emojis:I})}})]},C+W))}),t("div",{class:"stats",children:[t(T,{tabIndex:0,to:_,onClick:()=>{v.showAccount=!1,v.showGenericAccounts={heading:"Followers",fetchAccounts:tt}},children:[!!f.familiarFollowers.length&&t("span",{class:"shazam-container-horizontal",children:t("span",{class:"shazam-container-inner stats-avatars-bunch",children:(f.familiarFollowers||[]).map(C=>t(Ot,{url:C.avatarStatic,size:"s",alt:`${C.displayName} @${C.acct}`,squircle:C==null?void 0:C.bot}))})}),t("span",{title:z,children:Dt(z)})," ","Followers"]}),t(T,{class:"insignificant",tabIndex:0,to:_,onClick:()=>{v.showAccount=!1,v.showGenericAccounts={heading:"Following",fetchAccounts:st}},children:[t("span",{title:A,children:Dt(A)})," ","Following",t("br",{})]}),t(T,{class:"insignificant",to:_,onClick:l?void 0:()=>{Bn()},children:[t("span",{title:ot,children:Dt(ot)})," ","Posts"]}),!!k&&t("div",{class:"insignificant",children:["Joined"," ",t("time",{datetime:k,children:Ft(k,{hideTime:!0})})]})]})]}),t(Ts,{info:a,instance:c,authenticated:o,standalone:l})]})]})]})}const Cs=3;function Ts({info:e,instance:n,authenticated:l,standalone:c}){var _;if(!e)return null;const{masto:o,instance:s,authenticated:d}=B(),i=n===s,[m,a]=x("default"),[u,f]=x(null),[p,r]=x(),{id:h,acct:b,url:y,username:g,locked:k,lastStatusAt:S,note:I,fields:R,moved:z}=e,A=P(h),{following:L,showingReblogs:V,notifying:N,followedBy:M,blocking:D,blockedBy:ot,muting:Y,mutingNotifications:Ct,requested:lt,domainBlocking:Tt,endorsed:Lt}=u||{},[nt,U]=x(null),[K,ct]=x(!1);F(()=>{if(e){const C=J.session.get("currentAccount");let E;(async()=>{if(i&&l)E=h;else if(!i&&d){const W=e.acct.includes("@");try{const Q=await o.v2.search({q:W?e.acct:`${e.username}@${n}`,type:"accounts",limit:1,resolve:!0});Q.accounts.length&&(E=Q.accounts[0].id,U(Q.accounts[0]))}catch{}}if(!E)return;if(C===E){ct(!0);return}if(A.current=E,z)return;a("loading"),ke.familiarFollowers=[],r(null);const q=o.v1.accounts.fetchRelationships([E]);try{const W=await q;if(a("default"),W.length){const Q=W[0];if(f(Q),!Q.following)try{const it=o.v1.accounts.fetchFamiliarFollowers(E),X=o.v1.accounts.listStatuses(E,{limit:20}).next(),et=await it;if(ke.familiarFollowers=et[0].accounts.slice(0,Cs),!c){const{value:dt}=await X,ut={total:dt.length,originals:0,replies:0,boosts:0};dt.forEach(bt=>{bt.reblog?ut.boosts++:bt.inReplyToAccountId!==E&&bt.inReplyToId?ut.replies++:ut.originals++}),ut.daysSinceLastPost=Math.ceil((Date.now()-new Date(dt[dt.length-1].createdAt))/864e5),r(ut)}}catch{}}}catch{a("error")}})()}},[e,l]),F(()=>{e&&K&&On(e)},[e,K]);const ht=m==="loading",xt=P(null),[$t,O]=x(!1),[tt,G]=x(!1),st=(p==null?void 0:p.total)>=3,T=n?`/${n}/a/${h}`:`/a/${h}`;return t($,{children:[st&&t(H,{to:T,class:"account-metadata-box",onClick:()=>{v.showAccount=!1},children:t("div",{class:"shazam-container",children:t("div",{class:"shazam-container-inner",children:t("div",{class:"posting-stats",title:`${Math.round(p.originals/p.total*100)}% original posts, ${Math.round(p.replies/p.total*100)}% replies, ${Math.round(p.boosts/p.total*100)}% boosts`,children:[t("div",{children:p.daysSinceLastPost<365?`Last ${p.total} posts in the past 
                    ${p.daysSinceLastPost} day${p.daysSinceLastPost>1?"s":""}`:`
                     Last ${p.total} posts in the past year(s)
                    `}),t("div",{class:"posting-stats-bar",style:{"--originals-percentage":`${p.originals/p.total*100}%`,"--replies-percentage":`${(p.originals+p.replies)/p.total*100}%`}}),t("div",{class:"posting-stats-legends",children:[t("span",{class:"ib",children:[t("span",{class:"posting-stats-legend-item posting-stats-legend-item-originals"})," ","Original"]})," ",t("span",{class:"ib",children:[t("span",{class:"posting-stats-legend-item posting-stats-legend-item-replies"})," ","Replies"]})," ",t("span",{class:"ib",children:[t("span",{class:"posting-stats-legend-item posting-stats-legend-item-boosts"})," ","Boosts"]})]})]})})})}),t("p",{class:"actions",children:[t("span",{children:[M?t("span",{class:"tag",children:"Following you"}):S?t("small",{class:"insignificant",children:["Last post:"," ",Ft(S,{hideTime:!0})]}):t("span",{}),Y&&t("span",{class:"tag danger",children:"Muted"}),D&&t("span",{class:"tag danger",children:"Blocked"})]})," ",t("span",{class:"buttons",children:[t(Ht,{instanceRef:xt,portal:{target:document.body},containerProps:{style:{zIndex:1001},onClick:C=>{var E,q;C.target===C.currentTarget&&((q=(E=xt.current)==null?void 0:E.closeMenu)==null||q.call(E))}},align:"center",position:"anchor",overflow:"auto",boundingBoxPadding:"8 8 8 8",menuButton:t("button",{type:"button",title:"More",class:"plain",disabled:ht,children:t(w,{icon:"more",size:"l",alt:"More"})}),children:[d&&!K&&t($,{children:[t(Z,{onClick:()=>{v.showCompose={draftStatus:{status:`@${(nt==null?void 0:nt.acct)||b} `}}},children:[t(w,{icon:"at"}),t("span",{children:["Mention @",g]})]}),t(Z,{onClick:()=>{O(!0)},children:[t(w,{icon:"translate"}),t("span",{children:"Translate bio"})]}),L&&t(Z,{onClick:()=>{G(!0)},children:[t(w,{icon:"list"}),t("span",{children:"Add/remove from Lists"})]}),t(At,{})]}),t(Z,{href:y,target:"_blank",children:[t(w,{icon:"external"}),t("small",{class:"menu-double-lines",children:$s(y)})]}),t("div",{class:"menu-horizontal",children:[t(Z,{onClick:()=>{try{navigator.clipboard.writeText(y),rt("Link copied")}catch{rt("Unable to copy link")}},children:[t(w,{icon:"link"}),t("span",{children:"Copy"})]}),(navigator==null?void 0:navigator.share)&&((_=navigator==null?void 0:navigator.canShare)==null?void 0:_.call(navigator,{url:y}))&&t(Z,{onClick:()=>{try{navigator.share({url:y})}catch{alert("Sharing doesn't seem to work.")}},children:[t(w,{icon:"share"}),t("span",{children:"Share…"})]})]}),!!u&&t($,{children:[t(At,{}),Y?t(Z,{onClick:()=>{a("loading"),(async()=>{try{const C=await o.v1.accounts.unmute((nt==null?void 0:nt.id)||h);f(C),a("default"),rt(`Unmuted @${g}`),v.reloadGenericAccounts.id="mute",v.reloadGenericAccounts.counter++}catch{a("error")}})()},children:[t(w,{icon:"unmute"}),t("span",{children:["Unmute @",g]})]}):t(Qn,{openTrigger:"clickOnly",direction:"bottom",overflow:"auto",shift:16,label:t($,{children:[t(w,{icon:"mute"}),t("span",{class:"menu-grow",children:["Mute @",g,"…"]}),t("span",{style:{textOverflow:"clip"},children:[t(w,{icon:"time"}),t(w,{icon:"chevron-right"})]})]}),children:t("div",{class:"menu-wrap",children:Is.map(C=>t(Z,{onClick:()=>{a("loading"),(async()=>{try{const E=await o.v1.accounts.mute((nt==null?void 0:nt.id)||h,{duration:C});f(E),a("default"),rt(`Muted @${g} for ${Ye[C]}`),v.reloadGenericAccounts.id="mute",v.reloadGenericAccounts.counter++}catch{a("error"),rt(`Unable to mute @${g}`)}})()},children:Ye[C]}))})}),t(Et,{subMenu:!0,confirm:!D,confirmLabel:t($,{children:[t(w,{icon:"block"}),t("span",{children:["Block @",g,"?"]})]}),menuItemClassName:"danger",onClick:()=>{a("loading"),(async()=>{try{if(D){const C=await o.v1.accounts.unblock((nt==null?void 0:nt.id)||h);f(C),a("default"),rt(`Unblocked @${g}`)}else{const C=await o.v1.accounts.block((nt==null?void 0:nt.id)||h);f(C),a("default"),rt(`Blocked @${g}`)}v.reloadGenericAccounts.id="block",v.reloadGenericAccounts.counter++}catch{a("error"),D?rt(`Unable to unblock @${g}`):rt(`Unable to block @${g}`)}})()},children:D?t($,{children:[t(w,{icon:"unblock"}),t("span",{children:["Unblock @",g]})]}):t($,{children:[t(w,{icon:"block"}),t("span",{children:["Block @",g,"…"]})]})})]})]}),!u&&m==="loading"&&t(gt,{abrupt:!0}),!!u&&t(Et,{confirm:L||lt,confirmLabel:t("span",{children:lt?"Withdraw follow request?":`Unfollow @${e.acct||e.username}?`}),menuItemClassName:"danger",align:"end",disabled:ht,onClick:()=>{a("loading"),(async()=>{try{let C;L||lt?C=await o.v1.accounts.unfollow(A.current):C=await o.v1.accounts.follow(A.current),C&&f(C),a("default")}catch(C){alert(C),a("error")}})()},children:t("button",{type:"button",class:`${L||lt?"light swap":""}`,"data-swap-state":L||lt?"danger":"",disabled:ht,children:L?t($,{children:[t("span",{children:"Following"}),t("span",{children:"Unfollow…"})]}):lt?t($,{children:[t("span",{children:"Requested"}),t("span",{children:"Withdraw…"})]}):k?t($,{children:[t(w,{icon:"lock"})," ",t("span",{children:"Follow"})]}):"Follow"})})]})]}),!!$t&&t(mt,{class:"light",onClose:()=>{O(!1)},children:t(Ls,{note:I,fields:R,onClose:()=>O(!1)})}),!!tt&&t(mt,{class:"light",onClose:()=>{G(!1)},children:t(As,{accountID:A.current,onClose:()=>G(!1)})})]})}function xs([e,n,l]){const c=.2126*e+.7152*n+.0722*l;let o;return c>=220?o=1:c<=50?o=.1:o=c/255,o=Math.min(1,o),[e,n,l,o]}function $s(e){if(!e)return;const n=new URL(e),{host:l,pathname:c}=n,o=c.replace(/\/$/,"").replace(/^\//,"");return t($,{children:[t("span",{class:"more-insignificant",children:[l,"/"]}),t("wbr",{}),t("span",{children:o})]})}function Ls({note:e,fields:n,onClose:l}){const c=(n==null?void 0:n.map(({name:s,value:d})=>`${s}
${ze(d)}`).join(`

`))||"",o=ze(e)+(c?`

${c}`:"");return t("div",{class:"sheet",children:[!!l&&t("button",{type:"button",class:"sheet-close",onClick:l,children:t(w,{icon:"x"})}),t("header",{children:t("h2",{children:"Translated Bio"})}),t("main",{children:[t("p",{style:{whiteSpace:"pre-wrap"},children:o}),t(ln,{forceTranslate:!0,text:o})]})]})}function As({accountID:e,onClose:n}){const{masto:l}=B(),[c,o]=x("default"),[s,d]=x([]),[i,m]=x([]),[a,u]=he(r=>r+1,0);F(()=>{o("loading"),(async()=>{try{const r=await l.v1.lists.list(),h=await l.v1.accounts.listLists(e);d(r),m(h),o("default")}catch{o("error")}})()},[a]);const[f,p]=x(!1);return t("div",{class:"sheet",id:"list-add-remove-container",children:[!!n&&t("button",{type:"button",class:"sheet-close",onClick:n,children:t(w,{icon:"x"})}),t("header",{children:t("h2",{children:"Add/Remove from Lists"})}),t("main",{children:[s.length>0?t("ul",{class:"list-add-remove",children:s.map(r=>{const h=i.some(b=>b.id===r.id);return t("li",{children:t("button",{type:"button",class:`light ${h?"checked":""}`,disabled:c==="loading",onClick:()=>{o("loading"),(async()=>{try{h?await l.v1.lists.removeAccount(r.id,{accountIds:[e]}):await l.v1.lists.addAccount(r.id,{accountIds:[e]}),u()}catch{o("error"),alert(h?"Unable to remove from list.":"Unable to add to list.")}})()},children:[t(w,{icon:"check-circle"}),t("span",{children:r.title})]})})})}):c==="loading"?t("p",{class:"ui-state",children:t(gt,{abrupt:!0})}):c==="error"?t("p",{class:"ui-state",children:"Unable to load lists."}):t("p",{class:"ui-state",children:"No lists."}),t("button",{type:"button",class:"plain2",onClick:()=>p(!0),disabled:c!=="default",children:[t(w,{icon:"plus",size:"l"})," ",t("span",{children:"New list"})]})]}),f&&t(mt,{class:"light",onClick:r=>{r.target===r.currentTarget&&p(!1)},children:t(Ee,{list:f==null?void 0:f.list,onClose:r=>{r.state==="success"&&u(),p(!1)}})})]})}function Rs({account:e,instance:n,onClose:l}){const{masto:c,instance:o,authenticated:s}=B({instance:n}),d=typeof e=="string";return F(()=>{d||(v.accounts[`${e.id}@${o}`]=e)},[e]),t("div",{class:"sheet",onClick:i=>{i.target.closest(".account-block")&&l({destination:"account-statuses"})},children:[!!l&&t("button",{type:"button",class:"sheet-close outer",onClick:l,children:t(w,{icon:"x"})}),t(kn,{instance:o,authenticated:s,account:e,fetchAccount:async()=>{if(d)try{return await c.v1.accounts.lookup({acct:e,skip_webfinger:!1})}catch{const m=await c.v2.search({q:e,type:"accounts",limit:1,resolve:s});if(m.accounts.length)return m.accounts[0];if(/https?:\/\/[^/]+\/@/.test(e)){const u=new URL(e).pathname.replace(/^\//,""),f=await c.v2.search({q:u,type:"accounts",limit:1,resolve:s});if(f.accounts.length)return f.accounts[0]}}else return e}})]})}function Ms({onClose:e}){const{masto:n}=B(),[l,c]=x("default"),[o,s]=x([]),[d,i]=he(a=>a+1,0);F(()=>{c("loading"),(async()=>{try{const a=await Yt.drafts.keys();if(a.length){const u=dn(),f=a.filter(p=>p.startsWith(u));if(f.length){const p=await Yt.drafts.getMany(f);p.sort((r,h)=>new Date(h.updatedAt).getTime()-new Date(r.updatedAt).getTime()),s(p)}else s([])}else s([]);c("default")}catch{c("error")}})()},[d]);const m=(o==null?void 0:o.length)>0;return t("div",{class:"sheet",children:[!!e&&t("button",{type:"button",class:"sheet-close",onClick:e,children:t(w,{icon:"x"})}),t("header",{children:[t("h2",{children:["Unsent drafts ",t(gt,{abrupt:!0,hidden:l!=="loading"})]}),m&&t("div",{class:"insignificant",children:"Looks like you have unsent drafts. Let's continue where you left off."})]}),t("main",{children:m?t($,{children:[t("ul",{class:"drafts-list",children:o.map(a=>{const{updatedAt:u,key:f,draftStatus:p,replyTo:r}=a,h=new Date(u);return t("li",{children:[t("div",{class:"mini-draft-meta",children:[t("b",{children:[t(w,{icon:r?"reply":"quill",size:"s"})," ",t("time",{children:[!!r&&t($,{children:["@",r.account.acct,t("br",{})]}),Ft(h)]})]}),t(Et,{confirmLabel:t("span",{children:"Delete this draft?"}),menuItemClassName:"danger",align:"end",disabled:l==="loading",onClick:()=>{(async()=>{try{await Yt.drafts.del(f),i()}catch{alert("Error deleting draft! Please try again.")}})()},children:t("button",{type:"button",class:"small light",disabled:l==="loading",children:"Delete…"})})]}),t("button",{type:"button",disabled:l==="loading",class:"draft-item",onClick:async()=>{let b;if(r){c("loading");try{b=await n.v1.statuses.fetch(r.id)}catch{alert("Error fetching reply-to status!"),c("default");return}c("default")}window.__COMPOSE__={draftStatus:p,replyToStatus:b},v.showCompose=!0,v.showDrafts=!1},children:t(Ds,{draft:a})})]},u)})}),o.length>1&&t("p",{children:t(Et,{confirmLabel:t("span",{children:"Delete all drafts?"}),menuItemClassName:"danger",disabled:l==="loading",onClick:()=>{(async()=>{c("loading");try{await Yt.drafts.delMany(o.map(a=>a.key)),c("default"),i()}catch{alert("Error deleting drafts! Please try again."),c("error")}})()},children:t("button",{type:"button",class:"light danger",disabled:l==="loading",children:"Delete all…"})})})]}):t("p",{children:"No drafts found."})})]})}function Ds({draft:e}){var f;const{draftStatus:n,replyTo:l}=e,{status:c,spoilerText:o,poll:s,mediaAttachments:d}=n,i=((f=s==null?void 0:s.options)==null?void 0:f.length)>0,m=(d==null?void 0:d.length)>0,a=i||m,u=ft(()=>{if(!m)return;const p=d.find(b=>/image/.test(b.type));if(!p)return;const{file:r}=p;return URL.createObjectURL(r)},[m,d]);return t($,{children:t("div",{class:"mini-draft",children:[a&&t("div",{class:`mini-draft-aside ${u?"has-image":""}`,style:u?{"--bg-image":`url(${u})`}:{},children:[i&&t(w,{icon:"poll"}),m&&t("span",{children:[t(w,{icon:"attachment"})," ",t("small",{children:d==null?void 0:d.length})]})]}),t("div",{class:"mini-draft-main",children:[!!o&&t("div",{class:"mini-draft-spoiler",children:o}),!!c&&t("div",{class:"mini-draft-status",children:c})]})]})})}function Es({onClose:e=()=>{}}){const n=at(v),[l,c]=x("default"),[o,s]=x([]),[d,i]=x(!1);if(!n.showGenericAccounts)return null;const{id:m,heading:a,fetchAccounts:u,accounts:f,showReactions:p}=n.showGenericAccounts,r=h=>{u&&(h&&s([]),c("loading"),(async()=>{try{const{done:b,value:y}=await u(h);Array.isArray(y)?(s(h?y:g=>[...g,...y]),i(!b)):i(!1),c("default")}catch{c("error")}})())};return F(()=>{(f==null?void 0:f.length)>0?s(f):r(!0)},[f,u]),F(()=>{var h;((h=n.reloadGenericAccounts)==null?void 0:h.id)===m&&r(!0)},[n.reloadGenericAccounts.counter]),t("div",{id:"generic-accounts-container",class:"sheet",tabindex:"-1",children:[t("button",{type:"button",class:"sheet-close",onClick:e,children:t(w,{icon:"x"})}),t("header",{children:t("h2",{children:a||"Accounts"})}),t("main",{children:o.length>0?t($,{children:[t("ul",{class:"accounts-list",children:o.map(h=>{var b;return t("li",{children:[p&&((b=h._types)==null?void 0:b.length)>0&&t("div",{class:"reactions-block",children:h._types.map(y=>t(w,{icon:{reblog:"rocket",favourite:"heart"}[y],class:`${y}-icon`}))}),t(Nt,{account:h})]},h.id+(h._types||""))})}),l==="default"?d?t(Qt,{onChange:h=>{h&&r()},children:t("button",{type:"button",class:"plain block",onClick:()=>r(),children:"Show more…"})}):t("p",{class:"ui-state insignificant",children:"The end."}):l==="loading"&&t("p",{class:"ui-state",children:t(gt,{abrupt:!0})})]}):l==="loading"?t("p",{class:"ui-state",children:t(gt,{abrupt:!0})}):l==="error"?t("p",{class:"ui-state",children:"Error loading accounts"}):t("p",{class:"ui-state insignificant",children:"Nothing to show"})})]})}function Sn({alt:e,lang:n,onClose:l}){const c=at(v),[o,s]=x(!1),d=cn(!0),i=c.settings.contentTranslationHideLanguages||[],m=!!n&&n!==d&&!Be([n],[d])&&!i.find(a=>n===a||Be([n],[a]));return t("div",{class:"sheet",children:[!!l&&t("button",{type:"button",class:"sheet-close outer",onClick:l,children:t(w,{icon:"x"})}),t("header",{class:"header-grid",children:[t("h2",{children:"Media description"}),t("div",{class:"header-side",children:t(Ht,{align:"end",menuButton:t("button",{type:"button",class:"plain4",children:t(w,{icon:"more",alt:"More",size:"xl"})}),children:t(Z,{disabled:o,onClick:()=>{s(!0)},children:[t(w,{icon:"translate"}),t("span",{children:"Translate"})]})})})]}),t("main",{lang:n,dir:"auto",children:[t("p",{style:{whiteSpace:"pre-wrap"},children:e}),(m||o)&&t(ln,{forceTranslate:o,sourceLanguage:n,text:e})]})]})}function In({mediaAttachments:e,statusID:n,instance:l,lang:c,index:o=0,onClose:s=()=>{}}){var b,y;const d=P(null),[i,m]=x(o),a=P(null);Pt(()=>{var g;(g=a.current)==null||g.scrollIntoView()},[]);const u=P(n);F(()=>{const g=o*d.current.clientWidth,k=u.current!==n;k&&(u.current=n),d.current.scrollTo({left:g,behavior:k?"auto":"smooth"}),d.current.focus()},[o,n]);const[f,p]=x(!0);F(()=>{let g=()=>{s()};return d.current&&d.current.addEventListener("swiped-down",g),()=>{d.current&&d.current.removeEventListener("swiped-down",g)}},[]),vt("esc",s,[s]);const[r,h]=x(!1);return F(()=>{let g=()=>{const{clientWidth:k,scrollLeft:S}=d.current,I=Math.round(S/k);m(I)};return d.current&&d.current.addEventListener("scroll",g,{passive:!0}),()=>{d.current&&d.current.removeEventListener("scroll",g)}},[]),F(()=>{let g=setTimeout(()=>{var k,S;(S=(k=d.current)==null?void 0:k.focus)==null||S.call(k)},100);return()=>clearTimeout(g)},[]),t("div",{class:"media-modal-container",children:[t("div",{ref:d,tabIndex:"0","data-swipe-threshold":"44",class:"carousel",onClick:g=>{(g.target.classList.contains("carousel-item")||g.target.classList.contains("media")||g.target.classList.contains("media-zoom"))&&s()},children:e==null?void 0:e.map((g,k)=>{const{blurhash:S}=g,I=S?ts(S):null;return t("div",{class:"carousel-item",style:{"--average-color":`rgb(${I==null?void 0:I.join(",")})`,"--average-color-alpha":`rgba(${I==null?void 0:I.join(",")}, .5)`},tabindex:"0",ref:k===i?a:null,onClick:R=>{R.target!==R.currentTarget&&p(!f)},children:[!!g.description&&t("button",{type:"button",class:"media-alt",hidden:!f,onClick:()=>{h({alt:g.description,lang:c})},children:[t("span",{class:"alt-badge",children:"ALT"}),t("span",{class:"media-alt-desc",lang:c,dir:"auto",children:g.description})]}),t(qn,{media:g,showOriginal:!0,lang:c})]},g.id)})}),t("div",{class:"carousel-top-controls",hidden:!f,children:[t("span",{children:t("button",{type:"button",class:"carousel-button",onClick:()=>s(),children:t(w,{icon:"x"})})}),(e==null?void 0:e.length)>1?t("span",{class:"carousel-dots",children:e==null?void 0:e.map((g,k)=>t("button",{type:"button",disabled:k===i,class:`carousel-dot ${k===i?"active":""}`,onClick:S=>{S.preventDefault(),S.stopPropagation(),d.current.scrollTo({left:d.current.clientWidth*k,behavior:"smooth"}),d.current.focus()},children:t(w,{icon:"round",size:"s"})},g.id))}):t("span",{}),t("span",{children:[t(Ht,{overflow:"auto",align:"end",position:"anchor",boundingBoxPadding:"8 8 8 8",gap:4,menuClassName:"glass-menu",menuButton:t("button",{type:"button",class:"carousel-button",children:t(w,{icon:"more",alt:"More"})}),children:t(It,{href:((b=e[i])==null?void 0:b.remoteUrl)||((y=e[i])==null?void 0:y.url),class:"carousel-button",target:"_blank",title:"Open original media in new window",children:[t(w,{icon:"popout"}),t("span",{children:"Open original media"})]})})," ",t(H,{to:`${l?`/${l}`:""}/s/${n}${window.matchMedia("(min-width: calc(40em + 350px))").matches?`?media=${i+1}`:""}`,class:"button carousel-button media-post-link",children:[t("span",{class:"button-label",children:"See post "}),"»"]})]})]}),(e==null?void 0:e.length)>1&&t("div",{class:"carousel-controls",hidden:!f,children:[t("button",{type:"button",class:"carousel-button",hidden:i===0,onClick:g=>{g.preventDefault(),g.stopPropagation(),d.current.focus(),d.current.scrollTo({left:d.current.clientWidth*(i-1),behavior:"smooth"})},children:t(w,{icon:"arrow-left"})}),t("button",{type:"button",class:"carousel-button",hidden:i===e.length-1,onClick:g=>{g.preventDefault(),g.stopPropagation(),d.current.focus(),d.current.scrollTo({left:d.current.clientWidth*(i+1),behavior:"smooth"})},children:t(w,{icon:"arrow-right"})})]}),!!r&&t(mt,{class:"light",onClick:g=>{g.target===g.currentTarget&&(h(!1),d.current.focus())},children:t(Sn,{alt:r.alt||r,lang:r==null?void 0:r.lang,onClose:()=>h(!1)})})]})}const Ns=""+new URL("floating-button-75249db6.svg",import.meta.url).href,Ps=""+new URL("multi-column-61af26f8.svg",import.meta.url).href,Us=""+new URL("tab-menu-bar-6b58beea.svg",import.meta.url).href;function Se({children:e}){if(typeof e=="string")return e;const[n,l]=x("");return F(()=>{Promise.resolve(e).then(l)},[e]),n}const Wt=9,_s=["following","mentions","notifications","list","public","trending","hashtag","bookmarks","favourites"],Cn={following:"Home / Following",notifications:"Notifications",list:"List",public:"Public (Local / Federated)",search:"Search","account-statuses":"Account",bookmarks:"Bookmarks",favourites:"Favourites",hashtag:"Hashtag",trending:"Trending",mentions:"Mentions"},ae={list:[{text:"List ID",name:"id"}],public:[{text:"Local only",name:"local",type:"checkbox"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],trending:[{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],search:[{text:"Search term",name:"query",type:"text"}],"account-statuses":[{text:"@",name:"id",type:"text",placeholder:"cheeaun@mastodon.social"}],hashtag:[{text:"#",name:"hashtag",type:"text",placeholder:"e.g. PixelArt (Max 5, space-separated)",pattern:"[^#]+"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}]},ue={following:{id:"home",title:(e,n)=>n===0?"Home":"Following",path:"/",icon:"home"},mentions:{id:"mentions",title:"Mentions",path:"/mentions",icon:"at"},notifications:{id:"notifications",title:"Notifications",path:"/notifications",icon:"notification"},list:{id:"list",title:He(async({id:e})=>(await B().masto.v1.lists.fetch(e)).title,{cacheKey:([{id:e}])=>e}),path:({id:e})=>`/l/${e}`,icon:"list"},public:{id:"public",title:({local:e})=>e?"Local":"Federated",subtitle:({instance:e})=>e||B().instance,path:({local:e,instance:n})=>`/${n}/p${e?"/l":""}`,icon:({local:e})=>e?"group":"earth"},trending:{id:"trending",title:"Trending",subtitle:({instance:e})=>e||B().instance,path:({instance:e})=>`/${e}/trending`,icon:"chart"},search:{id:"search",title:({query:e})=>e,path:({query:e})=>`/search?q=${e}`,icon:"search"},"account-statuses":{id:"account-statuses",title:He(async({id:e})=>{const n=await B().masto.v1.accounts.fetch(e);return n.username||n.acct||n.displayName},{cacheKey:([{id:e}])=>e}),path:({id:e})=>`/a/${e}`,icon:"user"},bookmarks:{id:"bookmarks",title:"Bookmarks",path:"/b",icon:"bookmark"},favourites:{id:"favourites",title:"Favourites",path:"/f",icon:"heart"},hashtag:{id:"hashtag",title:({hashtag:e})=>e,subtitle:({instance:e})=>e||B().instance,path:({hashtag:e,instance:n})=>`${n?`/${n}`:""}/t/${e.split(/\s+/).join("+")}`,icon:"hashtag"}};function Fs({onClose:e}){const n=at(v),{masto:l}=B(),{shortcuts:c}=n,[o,s]=x([]),[d,i]=x([]),[m,a]=x(!1),[u,f]=x(!1);return F(()=>{(async()=>{try{const p=await l.v1.lists.list();s(p)}catch{}})(),(async()=>{try{const p=l.v1.followedTags.list(),r=[];do{const{value:h,done:b}=await p.next();if(b||(h==null?void 0:h.length)===0)break;r.push(...h)}while(!0);i(r)}catch{}})()},[]),t("div",{id:"shortcuts-settings-container",class:"sheet",tabindex:"-1",children:[!!e&&t("button",{type:"button",class:"sheet-close",onClick:e,children:t(w,{icon:"x"})}),t("header",{children:t("h2",{children:[t(w,{icon:"shortcut"})," Shortcuts"," ",t("sup",{style:{fontSize:12,opacity:.5,textTransform:"uppercase"},children:"beta"})]})}),t("main",{children:[t("p",{children:["Specify a list of shortcuts that'll appear as:",t("div",{class:"shortcuts-view-mode",children:[{value:"float-button",label:"Floating button",imgURL:Ns},{value:"tab-menu-bar",label:"Tab/Menu bar",imgURL:Us},{value:"multi-column",label:"Multi-column",imgURL:Ps}].map(({value:p,label:r,imgURL:h})=>t("label",{children:[t("input",{type:"radio",name:"shortcuts-view-mode",value:p,checked:n.settings.shortcutsViewMode===p||p==="float-button"&&!n.settings.shortcutsViewMode,onChange:b=>{v.settings.shortcutsViewMode=b.target.value}})," ",t("img",{src:h,alt:"",width:"80",height:"58"})," ",t("span",{children:r})]}))})]}),c.length>0?t("ol",{class:"shortcuts-list",children:c.filter(Boolean).map((p,r)=>{const h=r+Object.values(p),{type:b}=p;if(!ue[b])return null;let{icon:y,title:g,subtitle:k}=ue[b];return typeof g=="function"&&(g=g(p,r)),typeof k=="function"&&(k=k(p,r)),typeof y=="function"&&(y=y(p,r)),t("li",{children:[t(w,{icon:y}),t("span",{class:"shortcut-text",children:[t(Se,{children:g}),k&&t($,{children:[" ",t("small",{class:"ib insignificant",children:k})]})]}),t("span",{class:"shortcut-actions",children:[t("button",{type:"button",class:"plain small",disabled:r===0,onClick:()=>{const S=Array.from(v.shortcuts);if(r>0){const I=v.shortcuts[r-1];S[r-1]=p,S[r]=I,v.shortcuts=S}},children:t(w,{icon:"arrow-up",alt:"Move up"})}),t("button",{type:"button",class:"plain small",disabled:r===c.length-1,onClick:()=>{const S=Array.from(v.shortcuts);if(r<v.shortcuts.length-1){const I=v.shortcuts[r+1];S[r+1]=p,S[r]=I,v.shortcuts=S}},children:t(w,{icon:"arrow-down",alt:"Move down"})}),t("button",{type:"button",class:"plain small",onClick:()=>{a({shortcut:p,shortcutIndex:r})},children:t(w,{icon:"pencil",alt:"Edit"})})]})]},h)})}):t("div",{class:"ui-state insignificant",children:[t("p",{children:"No shortcuts yet. Tap on the Add shortcut button."}),t("p",{children:["Not sure what to add?",t("br",{}),"Try adding"," ",t("a",{href:"#",onClick:p=>{p.preventDefault(),v.shortcuts=[{type:"following"},{type:"notifications"}]},children:"Home / Following and Notifications"})," ","first."]})]}),t("p",{class:"insignificant",children:c.length>=Wt&&`Max ${Wt} shortcuts`}),t("p",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t("button",{type:"button",class:"light",onClick:()=>f(!0),children:"Import/export"}),t("button",{type:"button",disabled:c.length>=Wt,onClick:()=>a(!0),children:[t(w,{icon:"plus"})," ",t("span",{children:"Add shortcut"})]})]})]}),m&&t(mt,{class:"light",onClick:p=>{p.target===p.currentTarget&&a(!1)},children:t(zs,{shortcut:m.shortcut,shortcutIndex:m.shortcutIndex,lists:o,followedHashtags:d,onSubmit:({result:p,mode:r})=>{r==="edit"?v.shortcuts[m.shortcutIndex]=p:v.shortcuts.push(p)},onClose:()=>a(!1)})}),u&&t(mt,{class:"light",onClick:p=>{p.target===p.currentTarget&&f(!1)},children:t(Bs,{shortcuts:c,onClose:()=>f(!1)})})]})}function zs({lists:e,followedHashtags:n,onSubmit:l,disabled:c,shortcut:o,shortcutIndex:s,onClose:d}){var f,p;const i=!!o,[m,a]=x((o==null?void 0:o.type)||null),u=P();return F(()=>{if(i&&m&&ae[m]){const r=u.current;ae[m].forEach(({name:h,type:b})=>{const y=r.querySelector(`[name="${h}"]`);y&&o[h]&&(b==="checkbox"?y.checked=o[h]==="on":y.value=o[h])})}},[i,m]),t("div",{id:"shortcut-settings-form",class:"sheet",children:[!!d&&t("button",{type:"button",class:"sheet-close",onClick:d,children:t(w,{icon:"x"})}),t("header",{children:t("h2",{children:[i?"Edit":"Add"," shortcut"]})}),t("main",{tabindex:"-1",children:t("form",{ref:u,onSubmit:r=>{r.preventDefault();const h=new FormData(r.target),b={};h.forEach((y,g)=>{b[g]=y==null?void 0:y.trim(),g==="instance"&&(b[g]=b[g].replace(/^https?:\/\//,"").replace(/\/+$/,""),b[g]=b[g].replace(/^@?[^@]+@/,""))}),b.type&&(l({result:b,mode:i?"edit":"add"}),r.target.reset(),a(null),d==null||d())},children:[t("p",{children:t("label",{children:[t("span",{children:"Timeline"}),t("select",{required:!0,disabled:c,onChange:r=>{a(r.target.value)},defaultValue:i?o.type:void 0,name:"type",children:[t("option",{}),_s.map(r=>t("option",{value:r,children:Cn[r]}))]})]})}),(p=(f=ae[m])==null?void 0:f.map)==null?void 0:p.call(f,({text:r,name:h,type:b,placeholder:y,pattern:g,notRequired:k})=>m==="list"?t("p",{children:t("label",{children:[t("span",{children:"List"}),t("select",{name:"id",required:!k,disabled:c,children:e.map(S=>t("option",{value:S.id,children:S.title}))})]})}):t("p",{children:t("label",{children:[t("span",{children:r})," ",t("input",{type:b,name:h,placeholder:y,required:b==="text"&&!k,disabled:c,list:m==="hashtag"?"followed-hashtags-datalist":null,autocorrect:"off",autocapitalize:"off",spellcheck:!1,pattern:g}),m==="hashtag"&&n.length>0&&t("datalist",{id:"followed-hashtags-datalist",children:n.map(S=>t("option",{value:S.name}))})]})})),t("footer",{children:[t("button",{type:"submit",class:"block",disabled:c,children:i?"Save":"Add"}),i&&t("button",{type:"button",class:"light danger",onClick:()=>{v.shortcuts.splice(s,1),d==null||d()},children:"Remove"})]})]})})]})}function Bs({shortcuts:e,onClose:n}){var a;const l=ft(()=>!e||!e.filter(Boolean).length?"":Ve.compressToEncodedURIComponent(JSON.stringify(e.filter(Boolean))),[e]),[c,o]=x(""),[s,d]=x("default"),i=ft(()=>{if(!c)return d("default"),null;try{const u=JSON.parse(Ve.decompressFromEncodedURIComponent(c));if(!Array.isArray(u))throw new Error("Not an array");return d("default"),u}catch{try{const f=JSON.parse(c);if(!Array.isArray(f))throw new Error("Not an array");return d("default"),f}catch{return d("error"),null}}},[c]),m=v.shortcuts.length>0;return t("div",{id:"import-export-container",class:"sheet",children:[!!n&&t("button",{type:"button",class:"sheet-close",onClick:n,children:t(w,{icon:"x"})}),t("header",{children:t("h2",{children:["Import/Export ",t("small",{class:"ib insignificant",children:"Shortcuts"})]})}),t("main",{tabindex:"-1",children:[t("section",{children:[t("h3",{children:[t(w,{icon:"arrow-down-circle",size:"l",class:"insignificant"})," ",t("span",{children:"Import"})]}),t("p",{children:t("input",{type:"text",name:"import",placeholder:"Paste shortcuts here",class:"block",onInput:u=>{o(u.target.value)}})}),!!i&&Array.isArray(i)&&t($,{children:[t("p",{children:[t("b",{children:i.length})," shortcut",i.length>1?"s":""," ",t("small",{class:"insignificant",children:["(",c.length," characters)"]})]}),t("ol",{class:"import-settings-list",children:i.map(u=>{var f,p;return t("li",{children:[t("span",{style:{opacity:e.some(r=>Object.keys(r).every(h=>r[h]===u[h]))?1:0},children:"*"}),t("span",{children:[Cn[u.type],u.type==="list"&&" ⚠️"," ",(p=(f=ae[u.type])==null?void 0:f.map)==null?void 0:p.call(f,({text:r,name:h,type:b})=>u[h]?t($,{children:[t("span",{class:"tag collapsed insignificant",children:[r,":"," ",b==="checkbox"?u[h]==="on"?"✅":"❌":u[h]]})," "]}):null)]})]})})}),t("p",{children:[t("small",{children:"* Exists in current shortcuts"}),t("br",{}),t("small",{children:"⚠️ List may not work if it's from a different account."})]})]}),s==="error"&&t("p",{class:"error",children:t("small",{children:"⚠️ Invalid settings format"})}),t("p",{children:[m&&t($,{children:[t(Et,{confirmLabel:"Append to current shortcuts?",menuFooter:t("div",{class:"footer",children:"Only shortcuts that don’t exist in current shortcuts will be appended."}),onClick:()=>{const u=i.filter(r=>!v.shortcuts.some(h=>Object.keys(h).every(b=>h[b]===r[b])));if(!u.length){rt("No new shortcuts to import");return}let f=[...v.shortcuts,...u];const p=f.length>Wt;p&&(f=f.slice(0,Wt)),v.shortcuts=f,rt(p?`Shortcuts imported. Exceeded max ${Wt}, so the rest are not imported.`:"Shortcuts imported"),n==null||n()},children:t("button",{type:"button",class:"plain2",disabled:!i,children:"Import & append…"})})," "]}),t(Et,{confirmLabel:m?"Override current shortcuts?":"Import shortcuts?",menuItemClassName:m?"danger":void 0,onClick:()=>{v.shortcuts=i,rt("Shortcuts imported"),n==null||n()},children:t("button",{type:"button",class:"plain2",disabled:!i,children:m?"or override…":"Import…"})})]})]}),t("section",{children:[t("h3",{children:[t(w,{icon:"arrow-up-circle",size:"l",class:"insignificant"})," ",t("span",{children:"Export"})]}),t("p",{children:t("input",{style:{width:"100%"},type:"text",value:l,readOnly:!0,onClick:u=>{if(u.target.value){u.target.select();try{navigator.clipboard.writeText(u.target.value),rt("Shortcuts copied")}catch{rt("Unable to copy shortcuts")}}}})}),t("p",{children:[t("button",{type:"button",class:"plain2",disabled:!l,onClick:()=>{try{navigator.clipboard.writeText(l),rt("Shortcut settings copied")}catch{rt("Unable to copy shortcut settings")}},children:[t(w,{icon:"clipboard"})," ",t("span",{children:"Copy"})]})," ",(navigator==null?void 0:navigator.share)&&((a=navigator==null?void 0:navigator.canShare)==null?void 0:a.call(navigator,{text:l}))&&t("button",{type:"button",class:"plain2",disabled:!l,onClick:()=>{try{navigator.share({text:l})}catch{alert("Sharing doesn't seem to work.")}},children:[t(w,{icon:"share"})," ",t("span",{children:"Share"})]})," ",l.length>0&&t("small",{class:"insignificant",children:[l.length," characters"]})]}),!!l&&t("details",{children:[t("summary",{class:"insignificant",children:t("small",{children:"Raw Shortcuts JSON"})}),t("textarea",{style:{width:"100%"},rows:10,readOnly:!0,children:JSON.stringify(e.filter(Boolean),null,2)})]})]})]})]})}es(v,e=>{for(const[n,l,c,o]of e)/^show/i.test(l)&&!c&&ve()});function Os(){var c,o,s,d,i,m,a,u;const e=at(v),n=pn(),l=Me();return t($,{children:[!!e.showCompose&&t(mt,{children:t(Hn,{replyToStatus:typeof e.showCompose!="boolean"?e.showCompose.replyToStatus:((c=window.__COMPOSE__)==null?void 0:c.replyToStatus)||null,editStatus:((o=v.showCompose)==null?void 0:o.editStatus)||((s=window.__COMPOSE__)==null?void 0:s.editStatus)||null,draftStatus:((d=v.showCompose)==null?void 0:d.draftStatus)||((i=window.__COMPOSE__)==null?void 0:i.draftStatus)||null,onClose:f=>{const{newStatus:p,instance:r,type:h}=f||{};v.showCompose=!1,window.__COMPOSE__=null,p&&(v.reloadStatusPage++,rt({text:{post:"Post published. Check it out.",reply:"Reply posted. Check it out.",edit:"Post updated. Check it out."}[h||"post"],delay:1e3,duration:1e4,onClick:b=>{b.hideToast(),v.prevLocation=l,n(r?`/${r}/s/${p.id}`:`/s/${p.id}`)}}))}})}),!!e.showSettings&&t(mt,{onClose:()=>{v.showSettings=!1},children:t(ks,{onClose:()=>{v.showSettings=!1}})}),!!e.showAccounts&&t(mt,{onClose:()=>{v.showAccounts=!1},children:t(gs,{onClose:()=>{v.showAccounts=!1}})}),!!e.showAccount&&t(mt,{class:"light",onClose:()=>{v.showAccount=!1},children:t(Rs,{account:((m=e.showAccount)==null?void 0:m.account)||e.showAccount,instance:(a=e.showAccount)==null?void 0:a.instance,onClose:({destination:f}={})=>{v.showAccount=!1,f&&(v.showAccounts=!1)}})}),!!e.showDrafts&&t(mt,{onClose:()=>{v.showDrafts=!1},children:t(Ms,{onClose:()=>v.showDrafts=!1})}),!!e.showMediaModal&&t(mt,{onClick:f=>{(f.target===f.currentTarget||f.target.classList.contains("media"))&&(v.showMediaModal=!1)},children:t(In,{mediaAttachments:e.showMediaModal.mediaAttachments,instance:e.showMediaModal.instance,index:e.showMediaModal.index,statusID:e.showMediaModal.statusID,onClose:()=>{v.showMediaModal=!1}})}),!!e.showShortcutsSettings&&t(mt,{class:"light",onClose:()=>{v.showShortcutsSettings=!1},children:t(Fs,{onClose:()=>v.showShortcutsSettings=!1})}),!!e.showGenericAccounts&&t(mt,{class:"light",onClose:()=>{v.showGenericAccounts=!1},children:t(Es,{onClose:()=>v.showGenericAccounts=!1})}),!!e.showMediaAlt&&t(mt,{class:"light",onClick:f=>{f.target===f.currentTarget&&(v.showMediaAlt=!1)},children:t(Sn,{alt:e.showMediaAlt.alt||e.showMediaAlt,lang:(u=e.showMediaAlt)==null?void 0:u.lang,onClose:()=>{v.showMediaAlt=!1}})})]})}function Ie({accountID:e,onChange:n}){const{masto:l}=B(),[c,o]=x("default"),[s,d]=x(null),[i,m]=x(null),a=i!==null;return t("p",{class:"follow-request-buttons",children:[t("button",{type:"button",disabled:c==="loading",onClick:()=>{o("loading"),d("accept"),(async()=>{try{const u=await l.v1.followRequests.authorize(e);if(!(u!=null&&u.followedBy))throw new Error("Follow request not accepted");m(u),n()}catch{}o("default")})()},children:"Accept"})," ",t("button",{type:"button",disabled:c==="loading",class:"light danger",onClick:()=>{o("loading"),d("reject"),(async()=>{try{const u=await l.v1.followRequests.reject(e);if(u!=null&&u.followedBy)throw new Error("Follow request not rejected");m(u),n()}catch{o("default")}})()},children:"Reject"}),t("span",{class:"follow-request-states",children:a&&s?s==="accept"?t(w,{icon:"check-circle",alt:"Accepted",class:"follow-accepted"}):t(w,{icon:"x-circle",alt:"Rejected",class:"follow-rejected"}):t(gt,{hidden:c!=="loading"})})]})}const Ze={mention:"comment",status:"notification",reblog:"rocket",follow:"follow",follow_request:"follow-add",favourite:"heart",poll:"poll",update:"pencil","admin.signup":"account-edit","admin.report":"account-warning"},jt={mention:"mentioned you in their post.",status:"published a post.",reblog:"boosted your post.","reblog+account":e=>`boosted ${e} of your posts.`,reblog_reply:"boosted your reply.",follow:"followed you.",follow_request:"requested to follow you.",favourite:"favourited your post.","favourite+account":e=>`favourited ${e} of your posts.`,favourite_reply:"favourited your reply.",poll:"A poll you have voted in or created has ended.","poll-self":"A poll you have created has ended.","poll-voted":"A poll you have voted in has ended.",update:"A post you interacted with has been edited.","favourite+reblog":"boosted & favourited your post.","favourite+reblog+account":e=>`boosted & favourited ${e} of your posts.`,"favourite+reblog_reply":"boosted & favourited your reply.","admin.signup":"signed up.","admin.report":"reported a post."},be=50;function Ne({notification:e,instance:n,reload:l,isStatic:c}){var z,A,L,V;const{id:o,status:s,account:d,_accounts:i,_statuses:m}=e;let{type:a}=e;const u=(s==null?void 0:s.reblog)||s,f=u==null?void 0:u.id,p=J.session.get("currentAccount"),r=p===(d==null?void 0:d.id),h=(z=s==null?void 0:s.poll)==null?void 0:z.voted,b=!!(s!=null&&s.inReplyToAccountId)&&(s==null?void 0:s.inReplyToAccountId)!==p&&((A=s==null?void 0:s.account)==null?void 0:A.id)===p;let y=0,g=0;if(a==="favourite+reblog"){for(const N of i)(L=N._types)!=null&&L.includes("favourite")&&y++,(V=N._types)!=null&&V.includes("reblog")&&g++;!g&&y&&(a="favourite"),!y&&g&&(a="reblog")}let k;if(a==="poll"?k=jt[r?"poll-self":h?"poll-voted":"poll"]:a==="reblog"||a==="favourite"||a==="favourite+reblog"?(m==null?void 0:m.length)>1?k=jt[`${a}+account`]:b?k=jt[`${a}_reply`]:k=jt[a]:jt[a]?k=jt[a]:k=`[Unknown notification type: ${a}]`,typeof k=="function"&&(k=k((m==null?void 0:m.length)||(i==null?void 0:i.length))),a==="mention"&&!s)return null;const S=e.createdAt&&new Date(e.createdAt).toLocaleString(),I={"favourite+reblog":"Boosted/Favourited by…",favourite:"Favourited by…",reblog:"Boosted by…",follow:"Followed by…"}[a]||"Accounts",R=()=>{v.showGenericAccounts={heading:I,accounts:i,showReactions:a==="favourite+reblog"}};return t("div",{class:`notification notification-${a}`,tabIndex:"0",children:[t("div",{class:`notification-type notification-${a}`,title:S,children:a==="favourite+reblog"?t($,{children:[t(w,{icon:"rocket",size:"xl",alt:a,class:"reblog-icon"}),t(w,{icon:"heart",size:"xl",alt:a,class:"favourite-icon"})]}):t(w,{icon:Ze[a]||"notification",size:"xl",alt:a})}),t("div",{class:"notification-content",children:[a!=="mention"&&t($,{children:[t("p",{children:[!/poll|update/i.test(a)&&t($,{children:(i==null?void 0:i.length)>1?t($,{children:[t("b",{tabIndex:"0",onClick:R,children:[t("span",{title:i.length,children:Dt(i.length)})," ","people"]})," "]}):t($,{children:[t(Le,{account:d,showAvatar:!0})," "]})}),k,a==="mention"&&t("span",{class:"insignificant",children:[" ","•"," ",t(Ae,{datetime:e.createdAt,format:"micro"})]})]}),a==="follow_request"&&t(Ie,{accountID:d.id,onChange:()=>{}})]}),(i==null?void 0:i.length)>1&&t("p",{class:"avatars-stack",children:[i.slice(0,be).map((N,M)=>t($,{children:[t("a",{href:N.url,rel:"noopener noreferrer",class:"account-avatar-stack",onClick:D=>{D.preventDefault(),v.showAccount=N},children:[t(Ot,{url:N.avatarStatic,size:i.length<=10?"xxl":i.length<20?"xl":i.length<30?"l":i.length<40?"m":"s",alt:`${N.displayName} @${N.acct}`,squircle:N==null?void 0:N.bot},N.id),a==="favourite+reblog"&&t("div",{class:"account-sub-icons",children:N._types.map(D=>t(w,{icon:Ze[D],size:"s",class:`${D}-icon`}))})]})," "]})),t("button",{type:"button",class:"small plain",onClick:R,children:[i.length>be&&`+${i.length-be}`,t(w,{icon:"chevron-down"})]})]}),(m==null?void 0:m.length)>1&&t("ul",{class:"notification-group-statuses",children:m.map(N=>t("li",{children:t(Qe,{class:`status-link status-type-${a}`,to:n?`/${n}/s/${N.id}`:`/s/${N.id}`,children:t(wt,{status:N,size:"s"})})},N.id))}),s&&(!(m!=null&&m.length)||(m==null?void 0:m.length)<=1)&&t(Qe,{class:`status-link status-type-${a}`,to:n?`/${n}/s/${f}`:`/s/${f}`,onContextMenu:N=>{const M=N.target.querySelector(".status");if(M){if(N.metaKey)return;N.preventDefault(),M.dispatchEvent(new MouseEvent("contextmenu",{clientX:N.clientX,clientY:N.clientY}))}},children:c?t(wt,{status:u,size:"s"}):t(wt,{statusID:f,size:"s"})})]})]})}function Qe(e){const n=Vn();return t(H,{...e,"data-read-more":"Read more →",ref:n})}const qs=qt(function(){if(!("serviceWorker"in navigator))return null;const n=at(v),{routeNotification:l}=n,{id:c,accessToken:o}=l||{},[s,d]=x(!1);Pt(()=>{if(!c||!o)return;const{instance:m}=B(),{masto:a,instance:u}=B({accessToken:o}),f=m===u,p=o?jn(o):Gt();(async()=>{const r=await a.v1.notifications.fetch(c);if(r&&p){const h=p.instanceURL,{type:b,status:y,account:g}=r,k=!!document.querySelector("#modal-container > *"),S=b==="follow"&&!!(g!=null&&g.id),I=!!(g!=null&&g.id),R=!!(y!=null&&y.id);S&&f?v.showAccount={account:g,instance:h}:k||!f||I&&R?d({id:c,account:p,notification:r,sameInstance:f}):R?location.hash=`/${m}/s/${y.id}`:S?location.hash=`/${m}/a/${g.id}`:location.hash="/notifications"}})()},[c,o]),Pt(()=>{const m=a=>{const{type:u,id:f,accessToken:p}=(a==null?void 0:a.data)||{};u==="notification"&&(v.routeNotification={id:f,accessToken:p})};return navigator.serviceWorker.addEventListener("message",m),()=>{navigator.serviceWorker.removeEventListener("message",m)}},[]),Pt(()=>{navigator!=null&&navigator.clearAppBadge&&navigator.clearAppBadge()},[]),de(m=>{m&&(navigator!=null&&navigator.clearAppBadge)&&navigator.clearAppBadge()});const i=()=>{d(!1),v.routeNotification=null,/\/notifications\?id=/i.test(location.hash)&&(location.hash="/notifications")};if(s){const{id:m,account:a,notification:u,sameInstance:f}=s;return t(mt,{class:"light",onClick:p=>{p.target===p.currentTarget&&i()},children:t("div",{class:"sheet",tabIndex:"-1",children:[t("button",{type:"button",class:"sheet-close",onClick:i,children:t(w,{icon:"x"})}),t("header",{children:t("b",{children:"Notification"})}),t("main",{children:[!f&&t("p",{children:"This notification is from your other account."}),t("div",{class:"notification-peek",onClick:p=>{const{target:r}=p;(p.target.tagName==="BUTTON"||p.target.tagName==="A")&&i()},children:t(Ne,{instance:a.instanceURL,notification:u,isStatic:!0})}),t("div",{style:{textAlign:"end"},children:t(H,{to:"/notifications",class:"button light",onClick:i,children:[t("span",{children:"View all notifications"})," ",t(w,{icon:"arrow-right"})]})})]})]})})}return null});const Tn=ns((e,n)=>{const{instance:l}=B(),[c,o]=Ut(),[s,d]=x(!1),[i,m]=x(c.get("q")||""),a=c.get("type"),u=P(null),f=P(null);return ss(n,()=>({setValue:p=>{m(p)},focus:()=>{f.current.focus()},select:()=>{f.current.select()},blur:()=>{f.current.blur()}})),t("form",{ref:u,class:"search-popover-container",onSubmit:p=>{var h;if(p.preventDefault(),/\/search/.test(location.hash))if(i){const b={q:i};a&&(b.type=a),o(b)}else o({});else i?location.hash=`/search?q=${encodeURIComponent(i)}${a?`&type=${a}`:""}`:location.hash="/search";(h=e==null?void 0:e.onSubmit)==null||h.call(e,p)},children:[t("input",{ref:f,value:i,name:"q",type:"search",placeholder:"Search",dir:"auto",autocomplete:"off",autocorrect:"off",autocapitalize:"off",onSearch:p=>{p.target.value||o({})},onInput:p=>{m(p.target.value),d(!0)},onFocus:()=>{d(!0)},onBlur:()=>{var p,r;setTimeout(()=>{d(!1)},100),(r=(p=u.current)==null?void 0:p.querySelector(".search-popover-item.focus"))==null||r.classList.remove("focus")},onKeyDown:p=>{var h;const{key:r}=p;switch(r){case"Escape":d(!1);break;case"Down":case"ArrowDown":if(p.preventDefault(),s){const b=u.current.querySelector(".search-popover-item.focus");if(b){let y=b.nextElementSibling;for(;y&&y.hidden;)y=y.nextElementSibling;y&&(y.classList.add("focus"),Array.from(y.parentElement.children).filter(k=>k!==y).forEach(k=>{k.classList.remove("focus")}))}else{const y=u.current.querySelector(".search-popover-item");y&&y.classList.add("focus")}}break;case"Up":case"ArrowUp":if(p.preventDefault(),s){const b=document.querySelector(".search-popover-item.focus");if(b){let y=b.previousElementSibling;for(;y&&y.hidden;)y=y.previousElementSibling;y&&(y.classList.add("focus"),Array.from(y.parentElement.children).filter(k=>k!==y).forEach(k=>{k.classList.remove("focus")}))}else{const y=document.querySelector(".search-popover-item:last-child");y&&y.classList.add("focus")}}break;case"Enter":if(s){const b=document.querySelector(".search-popover-item.focus");b&&(p.preventDefault(),b.click()),d(!1),(h=e==null?void 0:e.onSubmit)==null||h.call(e,p)}break}}}),t("div",{class:"search-popover",hidden:!s||!i,children:!!i&&[{label:t($,{children:["Posts with ",t("q",{children:i})]}),to:`/search?q=${encodeURIComponent(i)}&type=statuses`,hidden:/^https?:/.test(i)},{label:t($,{children:["Posts tagged with ",t("mark",{children:["#",i.replace(/^#/,"")]})]}),to:`/${l}/t/${i.replace(/^#/,"")}`,hidden:/^@/.test(i)||/^https?:/.test(i)||/\s/.test(i),top:/^#/.test(i),type:"link"},{label:t($,{children:["Look up ",t("mark",{children:i})]}),to:`/${i}`,hidden:!/^https?:/.test(i),top:/^https?:/.test(i),type:"link"},{label:t($,{children:["Accounts with ",t("q",{children:i})]}),to:`/search?q=${encodeURIComponent(i)}&type=accounts`}].sort((p,r)=>p.top&&!r.top?-1:!p.top&&r.top?1:0).map(({label:p,to:r,hidden:h,type:b})=>t(H,{to:r,class:"search-popover-item",hidden:h,onClick:y=>{var g;(g=e==null?void 0:e.onSubmit)==null||g.call(e,y)},children:[t(w,{icon:b==="link"?"arrow-right":"search",class:"more-insignificant"}),t("span",{children:p})," "]}))})]})}),Hs=qt(function({onClose:n=()=>{}}){const[l,c]=x(!1),o=P(null);vt("/",d=>{c(!0),setTimeout(()=>{var i,m,a,u;(m=(i=o.current)==null?void 0:i.focus)==null||m.call(i),(u=(a=o.current)==null?void 0:a.select)==null||u.call(a)},0)},{preventDefault:!0,ignoreEventWhen:d=>{const i=/\/search/.test(location.hash),m=!!document.querySelector("#modal-container > *");return i||m}});const s=()=>{c(!1),n()};return vt("esc",d=>{var i,m;(m=(i=o.current)==null?void 0:i.blur)==null||m.call(i),s()},{enabled:l,enableOnFormTags:!0,preventDefault:!0}),t("div",{id:"search-command-container",hidden:!l,onClick:d=>{d.target===d.currentTarget&&s()},children:t(Tn,{ref:o,onSubmit:()=>{s()}})})});function Vs(){const{instance:e}=B(),n=at(v),{shortcuts:l}=n;if(!l.length)return null;const c=P(),o=ft(()=>l.map((d,i)=>{const{type:m,...a}=d;if(!ue[m])return null;let{id:u,path:f,title:p,subtitle:r,icon:h}=ue[m];return typeof u=="function"&&(u=u(a,i)),typeof f=="function"&&(f=f({...a,instance:a.instance||e},i)),typeof p=="function"&&(p=p(a,i)),typeof r=="function"&&(r=r(a,i)),typeof h=="function"&&(h=h(a,i)),{id:u,path:f,title:p,subtitle:r,icon:h}}).filter(Boolean),[l]),s=pn();return vt(["1","2","3","4","5","6","7","8","9"],(d,i)=>{var a,u;const m=parseInt(i.keys[0],10)-1;if(m<o.length){const{path:f}=o[m];f&&(s(f),(u=(a=c.current)==null?void 0:a.closeMenu)==null||u.call(a))}}),t("div",{id:"shortcuts",children:n.settings.shortcutsViewMode==="tab-menu-bar"?t("nav",{class:"tab-bar",children:t("ul",{children:o.map(({id:d,path:i,title:m,subtitle:a,icon:u},f)=>t("li",{children:t(H,{class:a?"has-subtitle":"",to:i,onClick:p=>{if(p.target.classList.contains("is-active")){p.preventDefault();const r=document.getElementById(`${d}-page`);if(r){r.scrollTop=0;const h=r.querySelector(".updates-button");h&&h.click()}}},children:[t(w,{icon:u,size:"xl",alt:m}),t("span",{children:[t(Se,{children:m}),a&&t($,{children:[t("br",{}),t("small",{children:a})]})]})]})},f+m))})}):t(Ht,{instanceRef:c,overflow:"auto",viewScroll:"close",boundingBoxPadding:"8 8 8 8",menuClassName:"glass-menu shortcuts-menu",gap:8,position:"anchor",menuButton:t("button",{type:"button",id:"shortcuts-button",class:"plain",onTransitionStart:d=>{var i,m;try{const{target:a}=d;getComputedStyle(a).pointerEvents==="none"&&((m=(i=c.current)==null?void 0:i.closeMenu)==null||m.call(i))}catch{}},children:t(w,{icon:"shortcut",size:"xl",alt:"Shortcuts"})}),children:o.map(({path:d,title:i,subtitle:m,icon:a},u)=>t(It,{to:d,class:"glass-menu-item",children:[t(w,{icon:a,size:"l"})," ",t("span",{class:"menu-grow",children:[t("span",{children:t(Se,{children:i})}),m&&t($,{children:[" ",t("small",{class:"more-insignificant",children:m})]})]}),t("span",{class:"menu-shortcut hide-until-focus-visible",children:u+1})]},u+i))})})}function te(e){const{containerProps:n}=e,l=is(),c=P();return t(Ht,{boundingBoxPadding:un(),repositionFlag:`${l.width}x${l.height}`,...e,instanceRef:c,containerProps:{onClick:o=>{var s,d,i;o.target===o.currentTarget&&((d=(s=c.current)==null?void 0:s.closeMenu)==null||d.call(s)),(i=n==null?void 0:n.onClick)==null||i.call(n,o)},...n}})}function js(e){var o;let n=[],l=[],c=0;for(let s=0;s<e.length;s++){const d=e[s];d.reblog&&!((o=d.account)!=null&&o.group)?(l.push(d),c++):(n.push(d),c<3&&(c=0))}if(e.length>10&&(l.length>e.length/4||c>=3)){const s=l.map(d=>d.id);if(l.length>e.length*3/4)n=[...n,{id:s,items:l,type:"boosts"}];else{const d=Math.floor(n.length/2);n=[...n.slice(0,d),{id:s,items:l,type:"boosts"},...n.slice(d)]}return n}else return e}function tn(e,n){const l=J.account.get("boostedStatusIDs")||{},c=e.filter(s=>{if(!s.reblog)return!0;const d=`${n}-${s.reblog.id}`,i=l[d];return i&&i!==s.id?!1:(l[d]=s.id,!0)}),o=Object.keys(l);return o.length>50&&o.slice(0,o.length-50).forEach(s=>{delete l[s]}),J.account.set("boostedStatusIDs",l),c}function Ws(e){const n=[];let l=0;e.forEach(s=>{for(let i=0;i<n.length;i++){if(n[i].find(m=>m.id===s.id))return;if(n[i].find(m=>m.id===s.inReplyToId)||n[i].find(m=>m.inReplyToId===s.id)){n[i].push(s);return}}const d=e.find(i=>i.id===s.inReplyToId);d&&(n[l++]=[s,d])});for(let s=0;s<n.length;s++)for(let d=s+1;d<n.length;d++)n[s].find(m=>n[d].includes(m))&&(n[s]=[...n[s],...n[d]],n[s]=n[s].filter((m,a,u)=>u.findIndex(f=>f.id===m.id)===a),n.splice(d,1),d--);n.forEach(s=>{s.sort((d,i)=>!d.inReplyToId&&!i.inReplyToId?new Date(d.createdAt)-new Date(i.createdAt):d.inReplyToId===i.id?1:i.inReplyToId===d.id||!d.inReplyToId?-1:i.inReplyToId?new Date(d.createdAt)-new Date(i.createdAt):1)}),n.forEach(s=>{const d=s[0].account.id;s.forEach(i=>{i.account.id!==d&&(i._differentAuthor=!0)})}),n.length;const c=[],o=[];return e.forEach(s=>{if(s.reblog){c.push(s);return}for(let d=0;d<n.length;d++)if(n[d].find(i=>i.id===s.id)){if(o.includes(d))return;const i=n[d];i.sort((a,u)=>{const f=new Date(a.createdAt),p=new Date(u.createdAt);return f-p});const m=i[0].account.id;c.push({id:i.map(a=>a.id),items:i,type:i.every(a=>a.account.id===m)?"thread":"conversation"}),o.push(d);return}c.push(s)}),c}function pe({scrollableRef:e,distanceFromStart:n=1,distanceFromEnd:l=1,scrollThresholdStart:c=10,scrollThresholdEnd:o=10,direction:s="vertical",distanceFromStartPx:d,distanceFromEndPx:i}={}){const[m,a]=x(null),[u,f]=x(!1),[p,r]=x(!1),[h,b]=x(!1),[y,g]=x(!1),k=s==="vertical";return Pt(()=>{const S=e.current;if(!S)return{};let I=k?S.scrollTop:S.scrollLeft;function R(){const{scrollTop:z,scrollLeft:A,scrollHeight:L,scrollWidth:V,clientHeight:N,clientWidth:M}=S,D=k?z:A,ot=k?L:V,Y=k?N:M,Ct=Math.abs(D-I),lt=d||Math.min(Y*n,ot,D),Tt=i||Math.min(Y*l,ot,ot-D-Y);Ct>=(I<D?o:c)&&(a(I<D?"end":"start"),I=D),f(D<=0),r(D+Y>=ot),b(D<=lt),g(D+Y>=ot-Tt)}return S.addEventListener("scroll",R,{passive:!0}),()=>S.removeEventListener("scroll",R)},[n,l,c,o]),{scrollDirection:m,reachStart:u,reachEnd:p,nearReachStart:h,nearReachEnd:y,init:()=>{e.current&&e.current.dispatchEvent(new Event("scroll"))}}}function ee(e){var S,I,R,z,A;const n=at(v),{masto:l,instance:c,authenticated:o}=B(),[s,d]=x(),[i,m]=x(!1);F(()=>{const L=J.local.getJSON("accounts")||[],V=L.find(N=>N.info.id===J.session.get("currentAccount"));V&&d(V),m(L.length>1)},[]);const a=(n.settings.shortcutsColumnsMode||n.settings.shortcutsViewMode==="multi-column")&&!n.shortcuts.find(L=>L.type==="following"),u=os(()=>{v.showAccounts=!0},{threshold:600,detect:"touch",cancelOnMovement:!0}),f=P(),[p,r]=x(void 0),h=un([0,0,n.settings.shortcutsViewMode==="tab-menu-bar"?50:0,0]),b=P();async function y(L){return(L||!b.current)&&(b.current=l.v1.mutes.list({limit:80})),await b.current.next()}const g=P();async function k(L){return(L||!g.current)&&(g.current=l.v1.blocks.list({limit:80})),await g.current.next()}return t($,{children:[t("button",{ref:f,type:"button",class:`button plain nav-menu-button ${i?"with-avatar":""} ${open?"active":""}`,style:{position:"relative"},onClick:()=>{r(L=>L?void 0:"open")},onContextMenu:L=>{L.preventDefault(),v.showAccounts=!0},...u(),children:[i&&t(Ot,{url:((S=s==null?void 0:s.info)==null?void 0:S.avatar)||((I=s==null?void 0:s.info)==null?void 0:I.avatarStatic),size:"l",squircle:(R=s==null?void 0:s.info)==null?void 0:R.bot}),t(w,{icon:"menu",size:i?"s":"l"})]}),t(mn,{menuClassName:"nav-menu",state:p,anchorRef:f,onClose:()=>{r(void 0)},containerProps:{style:{zIndex:10},onClick:()=>{r(void 0)}},portal:{target:document.body},...e,overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:h,unmountOnClose:!0,children:[!!((z=n.appVersion)!=null&&z.commitHash)&&n.appVersion.commitHash!=="12d0e6a"&&t("div",{class:"top-menu",children:[t(Z,{onClick:()=>{confirm("Reload page now to update?")&&(async()=>{try{location.reload()}catch{}})()},children:[t(w,{icon:"sparkles",class:"sparkle-icon",size:"l"})," ",t("span",{children:"New update available…"})]}),t(At,{})]}),t("section",{children:[t(It,{to:"/",children:[t(w,{icon:"home",size:"l"})," ",t("span",{children:"Home"})]}),o&&t($,{children:[a&&t(It,{to:"/following",children:[t(w,{icon:"following",size:"l"})," ",t("span",{children:"Following"})]}),t(It,{to:"/mentions",children:[t(w,{icon:"at",size:"l"})," ",t("span",{children:"Mentions"})]}),t(It,{to:"/notifications",children:[t(w,{icon:"notification",size:"l"})," ",t("span",{children:"Notifications"}),n.notificationsShowNew&&t("sup",{title:"New",style:{opacity:.5},children:[" ","•"]})]}),t(At,{}),t(It,{to:"/l",children:[t(w,{icon:"list",size:"l"})," ",t("span",{children:"Lists"})]}),t(It,{to:"/ft",children:[t(w,{icon:"hashtag",size:"l"})," ",t("span",{children:"Followed Hashtags"})]}),t(It,{to:"/b",children:[t(w,{icon:"bookmark",size:"l"})," ",t("span",{children:"Bookmarks"})]}),t(It,{to:"/f",children:[t(w,{icon:"heart",size:"l"})," ",t("span",{children:"Favourites"})]})]}),t(At,{}),t(It,{to:"/search",children:[t(w,{icon:"search",size:"l"})," ",t("span",{children:"Search"})]}),t(It,{to:`/${c}/p/l`,children:[t(w,{icon:"group",size:"l"})," ",t("span",{children:"Local"})]}),t(It,{to:`/${c}/p`,children:[t(w,{icon:"earth",size:"l"})," ",t("span",{children:"Federated"})]}),t(It,{to:`/${c}/trending`,children:[t(w,{icon:"chart",size:"l"})," ",t("span",{children:"Trending"})]})]}),t("section",{children:o?t($,{children:[t(At,{}),((A=s==null?void 0:s.info)==null?void 0:A.id)&&t(It,{to:`/${c}/a/${s.info.id}`,children:[t(w,{icon:"user",size:"l"})," ",t("span",{children:"Profile"})]}),t(Z,{onClick:()=>{v.showAccounts=!0},children:[t(w,{icon:"group",size:"l"})," ",t("span",{children:"Accounts…"})]}),t(Z,{onClick:()=>{v.showGenericAccounts={id:"mute",heading:"Muted users",fetchAccounts:y}},children:[t(w,{icon:"mute",size:"l"})," Muted users…"]}),t(Z,{onClick:()=>{v.showGenericAccounts={id:"block",heading:"Blocked users",fetchAccounts:k}},children:[t(w,{icon:"block",size:"l"}),"Blocked users…"]}),t(Z,{onClick:()=>{v.showKeyboardShortcutsHelp=!0},children:[t(w,{icon:"keyboard",size:"l"})," ",t("span",{children:"Keyboard shortcuts"})]}),t(Z,{onClick:()=>{v.showShortcutsSettings=!0},children:[t(w,{icon:"shortcut",size:"l"})," ",t("span",{children:"Shortcuts Settings…"})]}),t(Z,{onClick:()=>{v.showSettings=!0},children:[t(w,{icon:"gear",size:"l"})," ",t("span",{children:"Settings…"})]})]}):t($,{children:[t(At,{}),t(It,{to:"/login",children:[t(w,{icon:"user",size:"l"})," ",t("span",{children:"Log in"})]}),t(Z,{onClick:()=>{v.showSettings=!0},children:[t(w,{icon:"gear",size:"l"})," ",t("span",{children:"Settings…"})]})]})})]})]})}const se={block:"nearest",inline:"center",behavior:"smooth"};function _t({title:e,titleComponent:n,id:l,instance:c,emptyText:o,errorText:s,useItemID:d,boostsCarousel:i,fetchItems:m=()=>{},checkForUpdates:a=()=>{},checkForUpdatesInterval:u=6e4,headerStart:f,headerEnd:p,timelineStart:r,allowFilters:h,refresh:b}){const y=at(v),[g,k]=x([]),[S,I]=x("default"),[R,z]=x(!1),[A,L]=x(!1),[V,N]=x(!0),M=P(),D=gn(O=>{L(!1),S!=="loading"&&(I("loading"),(async()=>{try{let{done:tt,value:G}=await m(O);Array.isArray(G)?(i&&(G=js(G)),G=Ws(G),k(O?G:st=>[...st,...G]),G.length||(tt=!0),z(!tt)):z(!1),I("default")}catch{I("error")}finally{D.cancel()}})())},1500,{leading:!0,trailing:!1}),ot=".timeline-item, .timeline-item-alt",Y=vt("j, shift+j",(O,tt)=>{const G=document.activeElement.closest(ot),st=G==null?void 0:G.getBoundingClientRect(),T=Array.from(M.current.querySelectorAll(ot));if(G&&st.top<M.current.clientHeight&&st.bottom>0){const _=T.indexOf(G);let C=T[_+1];tt.shift&&(C=T.find((E,q)=>q>_&&!E.classList.contains("timeline-item-alt"))),C&&(C.focus(),C.scrollIntoView(se))}else{const _=T.find(C=>{const E=C.getBoundingClientRect();return E.top>=44&&E.left>=0});_&&(_.focus(),_.scrollIntoView(se))}}),Ct=vt("k, shift+k",(O,tt)=>{const G=document.activeElement.closest(ot),st=G==null?void 0:G.getBoundingClientRect(),T=Array.from(M.current.querySelectorAll(ot));if(G&&st.top<M.current.clientHeight&&st.bottom>0){const _=T.indexOf(G);let C=T[_-1];tt.shift&&(C=T.findLast((E,q)=>q<_&&!E.classList.contains("timeline-item-alt"))),C&&(C.focus(),C.scrollIntoView(se))}else{const _=T.find(C=>{const E=C.getBoundingClientRect();return E.top>=44&&E.left>=0});_&&(_.focus(),_.scrollIntoView(se))}}),lt=vt(["enter","o"],()=>{const O=document.activeElement.closest(ot);O&&O.click()}),{scrollDirection:Tt,nearReachStart:Lt,nearReachEnd:nt,reachStart:U,reachEnd:K}=pe({scrollableRef:M,distanceFromEnd:2,scrollThresholdStart:44});F(()=>{var O;(O=M.current)==null||O.scrollTo({top:0}),D(!0)},[]),F(()=>{D(!0)},[b]),F(()=>{U&&D(!0)},[U]),F(()=>{(nt||K&&R)&&D()},[nt,R]);const ct=bn(5e3),ht=Kt(async({disableHoverCheck:O=!1}={})=>{y.settings.autoRefresh&&M.current.scrollTop===0&&(O||ct)&&!Js()?D(!0):await a()&&L(!0)},[l,ct,D,a,y.settings.autoRefresh]),xt=P();de(O=>{if(O){const tt=Date.now()-xt.current;(!xt.current||tt>1e3*60)&&ht({disableHoverCheck:!0})}else xt.current=Date.now();N(O)},[a,ht,y.settings.autoRefresh]),on(ht,V&&!A?u:null);const $t=Tt==="end"&&!Lt;return t("div",{id:`${l}-page`,class:"deck-container",ref:O=>{M.current=O,Y.current=O,Ct.current=O,lt.current=O},tabIndex:"-1",children:t("div",{class:"timeline-deck deck",children:[t("header",{hidden:$t,onClick:O=>{var tt;O.target.closest("a, button")||(tt=M.current)==null||tt.scrollTo({top:0,behavior:"smooth"})},onDblClick:O=>{O.target.closest("a, button")||D(!0)},class:S==="loading"?"loading":"",children:[t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:[t(ee,{}),f??t(H,{to:"/",class:"button plain home-button",children:t(w,{icon:"home",size:"l"})})]}),e&&(n||t("h1",{children:e})),t("div",{class:"header-side",children:!!p&&p})]}),g.length>0&&S!=="loading"&&!$t&&A&&t("button",{class:"updates-button shiny-pill",type:"button",onClick:()=>{var O;D(!0),(O=M.current)==null||O.scrollTo({top:0,behavior:"smooth"})},children:[t(w,{icon:"arrow-up"})," New posts"]})]}),!!r&&t("div",{class:"timeline-start",children:r}),g.length?t($,{children:[t("ul",{class:"timeline",children:[g.map(O=>{const{id:tt,reblog:G,items:st,type:T,_pinned:_}=O,C=(G==null?void 0:G.id)||tt,E=c?`/${c}/s/${C}`:`/s/${C}`;let q="";T==="boosts"?q=`${st.length} Boosts`:T==="pinned"&&(q="Pinned posts");const W=T==="boosts"||T==="pinned";if(st){if(W)return st.sort((it,X)=>it._filtered&&!X._filtered?1:!it._filtered&&X._filtered?-1:0),t("li",{class:"timeline-item-carousel",children:t(Gs,{title:q,class:`${T}-carousel`,children:st.map(it=>{const{id:X,reblog:et}=it,dt=(et==null?void 0:et.id)||X,ut=c?`/${c}/s/${dt}`:`/s/${dt}`;return t("li",{children:t(H,{class:"status-carousel-link timeline-item-alt",to:ut,children:d?t(wt,{statusID:X,instance:c,size:"s",contentTextWeight:!0,allowFilters:h}):t(wt,{status:it,instance:c,size:"s",contentTextWeight:!0,allowFilters:h})})},X)})})},`timeline-${tt}`);const Q=st.length>3;return st.map((it,X)=>{const{id:et,_differentAuthor:dt}=it,ut=c?`/${c}/s/${et}`:`/s/${et}`,bt=X>0&&X<st.length-1,Rt=it.sensitive&&!!it.spoilerText,Mt=!dt&&Rt&&X>0||Q&&bt&&(T==="thread"||T==="conversation"&&!dt&&!st[X-1]._differentAuthor&&!st[X+1]._differentAuthor);return t("li",{class:`timeline-item-container timeline-item-container-type-${T} timeline-item-container-${X===0?"start":X===st.length-1?"end":"middle"} ${dt?"timeline-item-diff-author":""}`,children:t(H,{class:"status-link timeline-item",to:ut,children:Mt?t(Ks,{status:it,instance:c}):d?t(wt,{statusID:et,instance:c,allowFilters:h}):t(wt,{status:it,instance:c,allowFilters:h})})},`timeline-${et}`)})}return t("li",{children:t(H,{class:"status-link timeline-item",to:E,children:d?t(wt,{statusID:tt,instance:c,allowFilters:h}):t(wt,{status:O,instance:c,allowFilters:h})})},`timeline-${tt+_}`)}),R&&S==="loading"&&t($,{children:[t("li",{style:{height:"20vh"},children:t(wt,{skeleton:!0})}),t("li",{style:{height:"25vh"},children:t(wt,{skeleton:!0})})]})]}),S==="default"&&(R?t(Qt,{onChange:O=>{O&&D()},children:t("button",{type:"button",class:"plain block",onClick:()=>D(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):t("p",{class:"ui-state insignificant",children:"The end."}))]}):S==="loading"?t("ul",{class:"timeline",children:Array.from({length:5}).map((O,tt)=>t("li",{children:t(wt,{skeleton:!0})},tt))}):S!=="error"&&t("p",{class:"ui-state",children:o}),S==="error"&&t("p",{class:"ui-state",children:[s,t("br",{}),t("br",{}),t("button",{class:"button plain",onClick:()=>D(!g.length),children:"Try again"})]})]})})}function Gs({title:e,class:n,children:l}){const c=P(),{reachStart:o,reachEnd:s,init:d}=pe({scrollableRef:c,direction:"horizontal"});return F(()=>{d==null||d()},[]),t("div",{class:`status-carousel ${n}`,children:[t("header",{children:[t("h3",{children:e}),t("span",{children:[t("button",{type:"button",class:"small plain2",disabled:o,onClick:()=>{var i,m;(m=c.current)==null||m.scrollBy({left:-Math.min(320,(i=c.current)==null?void 0:i.offsetWidth),behavior:"smooth"})},children:t(w,{icon:"chevron-left"})})," ",t("button",{type:"button",class:"small plain2",disabled:s,onClick:()=>{var i,m;(m=c.current)==null||m.scrollBy({left:Math.min(320,(i=c.current)==null?void 0:i.offsetWidth),behavior:"smooth"})},children:t(w,{icon:"chevron-right"})})]})]}),t("ul",{ref:c,children:l})]})}function Ks({status:e,instance:n}){const l=at(v),{id:c}=e,o=hn(e),s=Re(c,n);return t("article",{class:"status compact-thread",tabindex:"-1",children:[l.statusThreadNumber[s]?t("div",{class:"status-thread-badge",children:[t(w,{icon:"thread",size:"s"}),l.statusThreadNumber[s]?` ${l.statusThreadNumber[s]}/X`:""]}):t("div",{class:"status-thread-badge",children:t(w,{icon:"thread",size:"s"})}),t("div",{class:"content-compact",title:o,children:[o,e.sensitive&&e.spoilerText&&t($,{children:[" ",t("span",{class:"spoiler-badge",children:t(w,{icon:"eye-close",size:"s"})})]})]})]})}function Js(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}const Ys=20;function Xs(){const e=at(v),{id:n,...l}=Vt(),[c,o]=Ut(),s=!c.get("replies"),d=!!c.get("boosts"),i=c.get("tagged"),m=!!c.get("media"),{masto:a,instance:u,authenticated:f}=B({instance:l.instance}),p=P();async function r(N){const M=[];if(N){const{value:Y}=await a.v1.accounts.listStatuses(n,{pinned:!0}).next();if(Y!=null&&Y.length&&!i&&!m)if(Y.forEach(Ct=>{Ct._pinned=!0,kt(Ct,u)}),Y.length>=3){const Ct=Y.map(lt=>lt.id);M.push({id:Ct,items:Y,type:"pinned"})}else M.push(...Y)}(N||!p.current)&&(p.current=a.v1.accounts.listStatuses(n,{limit:Ys,exclude_replies:s,exclude_reblogs:d,only_media:m,tagged:i}));const{value:D,done:ot}=await p.current.next();return D!=null&&D.length&&(M.push(...D),D.forEach(Y=>{kt(Y,u)})),{value:M,done:ot}}const[h,b]=x(),[y,g]=x([]);St(`${h!=null&&h.displayName?h.displayName+" ":""}@${h!=null&&h.acct?h.acct:"Account posts"}`,"/:instance?/a/:id"),F(()=>{(async()=>{try{const N=await a.v1.accounts.fetch(n);b(N)}catch{}try{const N=await a.v1.accounts.listFeaturedTags(n);g(N)}catch{}})()},[n]);const{displayName:k,acct:S,emojis:I}=h||{},R=P(),z=ft(()=>{const N=e.accounts[`${n}@${u}`],M=!s||d||i||m;return t($,{children:[t(kn,{instance:u,account:N||n,fetchAccount:()=>a.v1.accounts.fetch(n),authenticated:f,standalone:!0}),t("div",{class:"filter-bar",ref:R,children:[M?t(H,{to:`/${u}/a/${n}`,class:"insignificant filter-clear",title:"Clear filters",children:t(w,{icon:"x",size:"l"})}):t(w,{icon:"filter",class:"insignificant",size:"l"}),t(H,{to:`/${u}/a/${n}${s?"?replies=1":""}`,onClick:()=>{s&&rt("Showing post with replies")},class:s?"":"is-active",children:"+ Replies"}),t(H,{to:`/${u}/a/${n}${d?"":"?boosts=0"}`,onClick:()=>{d||rt("Showing posts without boosts")},class:d?"is-active":"",children:"- Boosts"}),t(H,{to:`/${u}/a/${n}${m?"":"?media=1"}`,onClick:()=>{m||rt("Showing posts with media")},class:m?"is-active":"",children:"Media"}),y.map(D=>t(H,{to:`/${u}/a/${n}${i===D.name?"":`?tagged=${encodeURIComponent(D.name)}`}`,onClick:()=>{i!==D.name&&rt(`Showing posts tagged with #${D.name}`)},class:i===D.name?"is-active":"",children:t("span",{children:[t("span",{class:"more-insignificant",children:"#"}),D.name]})}))]})]})},[n,u,f,s,d,y,i,m]);F(()=>{var M;const N=(M=R.current)==null?void 0:M.querySelector(".is-active");N&&R.current.scrollTo({behavior:"smooth",left:N.offsetLeft-(R.current.offsetWidth-N.offsetWidth)/2})},[y,i,m,s,d]);const A=ft(()=>h!=null&&h.url?new URL(h.url).hostname:null,[h]),V=!!h&&!(u===A);return t(_t,{title:`${h!=null&&h.acct?"@"+h.acct:"Posts"}`,titleComponent:t("h1",{class:"header-account",children:[t("b",{children:t(rn,{text:k,emojis:I})}),t("div",{children:t("span",{children:["@",S]})})]}),id:"account-statuses",instance:u,emptyText:"Nothing to see here yet.",errorText:"Unable to load posts",fetchItems:r,useItemID:!0,boostsCarousel:e.settings.boostsCarousel,timelineStart:z,refresh:s+d+i+m,headerEnd:t(te,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(w,{icon:"more",size:"l"})}),children:t(Z,{disabled:!V,onClick:()=>{(async()=>{try{const{masto:N}=B({instance:A}),M=await N.v1.accounts.lookup({acct:h.acct}),{id:D}=M;location.hash=`/${A}/a/${D}`}catch{alert("Unable to fetch account info")}})()},children:[t(w,{icon:"transfer"})," ",t("small",{class:"menu-double-lines",children:["Switch to account's instance (",t("b",{children:A}),")"]})]})})},n)}const Zs=20;function xn(){St("Bookmarks","/b");const{masto:e,instance:n}=B(),l=P();async function c(o){return(o||!l.current)&&(l.current=e.v1.bookmarks.list({limit:Zs})),await l.current.next()}return t(_t,{title:"Bookmarks",id:"bookmarks",emptyText:"No bookmarks yet. Go bookmark something!",errorText:"Unable to load bookmarks",instance:n,fetchItems:c})}const Qs=20;function $n(){St("Favourites","/f");const{masto:e,instance:n}=B(),l=P();async function c(o){return(o||!l.current)&&(l.current=e.v1.favourites.list({limit:Qs})),await l.current.next()}return t(_t,{title:"Favourites",id:"favourites",emptyText:"No favourites yet. Go favourite something!",errorText:"Unable to load favourites",instance:n,fetchItems:c})}const ti=200;function ei(){const{masto:e,instance:n}=B();St("Followed Hashtags","/ft");const[l,c]=x("default"),[o,s]=x([]);return F(()=>{c("loading"),(async()=>{try{const d=e.v1.followedTags.list({limit:ti}),i=[];do{const{value:m,done:a}=await d.next();if(a||(m==null?void 0:m.length)===0)break;i.push(...m)}while(!0);i.sort((m,a)=>m.name.localeCompare(a.name)),s(i),c("default")}catch{c("error")}})()},[]),t("div",{id:"followed-hashtags-page",class:"deck-container",tabIndex:"-1",children:t("div",{class:"timeline-deck deck",children:[t("header",{children:t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:[t(ee,{}),t(H,{to:"/",class:"button plain",children:t(w,{icon:"home",size:"l"})})]}),t("h1",{children:"Followed Hashtags"}),t("div",{class:"header-side"})]})}),t("main",{children:o.length>0?t("ul",{class:"link-list",children:o.map(d=>t("li",{children:t(H,{to:n?`/${n}/t/${d.name}`:`/t/${d.name}`,children:[t(w,{icon:"hashtag"})," ",t("span",{children:d.name})]})}))}):l==="loading"?t("p",{class:"ui-state",children:t(gt,{abrupt:!0})}):l==="error"?t("p",{class:"ui-state",children:"Unable to load followed hashtags."}):t("p",{class:"ui-state",children:"No hashtags followed yet."})})]})})}function ni(e,n,l){var m;const{filtered:c}=e;if(!(c!=null&&c.length)||l&&((m=e.account)==null?void 0:m.id)===l)return!0;const s=c.filter(a=>{const{filter:u}=a,f=u.context.includes(n);return f?u.expiresAt?new Date(u.expiresAt)>new Date:f:!1});if(!s.length)return!0;if(s.some(a=>a.filter.filterAction==="hide"))return!1;const i=s.some(a=>a.filter.filterAction==="warn");if(i){const a=s.map(u=>u.filter.title);e._filtered={titles:a,titlesStr:a.join(" • ")}}return i}function zt(e,n){if(!(e!=null&&e.length))return[];if(!n)return e;const l=J.session.get("currentAccount");return e.filter(c=>ni(c,n,l))}const si=20;function Pe({title:e,path:n,id:l,...c}){St(e||"Following",n||"/following");const{masto:o,instance:s}=B(),d=at(v),i=P(),m=P();async function a(r){(r||!i.current)&&(i.current=o.v1.timelines.listHome({limit:si}));const h=await i.current.next();let{value:b}=h;return b!=null&&b.length&&(r&&(m.current=b[0].id),b=zt(b,"home"),b.forEach(y=>{kt(y,s)}),b=tn(b,s),b.sort((y,g)=>{const k=new Date(y.createdAt);return new Date(g.createdAt)-k})),{...h,value:b}}async function u(){try{const r=await o.v1.timelines.listHome({limit:5,since_id:m.current}).next();let{value:h}=r;return!!(h!=null&&h.length&&(m.current=h[0].id,h=tn(h,s),h=zt(h,"home"),h.some(b=>!b.reblog)))}catch{return!1}}const f=P(),p=async()=>{if(f.current&&(f.current.readyState===WebSocket.CONNECTING||f.current.readyState===WebSocket.OPEN))return;const r=await o.v1.stream.streamUser();return f.current=r.ws,f.current.__id=Math.random(),r.on("status.update",h=>{kt(h,s)}),r.on("delete",h=>{const b=fn(h,s);b&&(b._deleted=!0)}),r.ws.onclose=()=>{},r};return F(()=>{let r;return(async()=>r=await p())(),()=>{r&&(r.ws.close(),f.current=null)}},[]),t(_t,{title:e||"Following",id:l||"following",emptyText:"Nothing to see here.",errorText:"Unable to load posts.",instance:s,fetchItems:a,checkForUpdates:u,useItemID:!0,boostsCarousel:d.settings.boostsCarousel,...c,allowFilters:!0})}const ii=20,oi=4,en=oi+1;function Ln({columnMode:e,...n}){let{hashtag:l,...c}=e?{}:Vt();n.hashtag&&(l=n.hashtag);let o=l.trim().split(/[\s+]+/);o.sort(),l=o[0];const{masto:s,instance:d,authenticated:i}=B({instance:(n==null?void 0:n.instance)||c.instance}),{authenticated:m}=B(),a=o.map(I=>`#${I}`).join(" "),u=d?`${a} on ${d}`:a;St(u,"/:instance?/t/:hashtag");const f=P(),p=P(void 0);async function r(I){const R=await s.v1.timelines.listHashtag(l,{limit:ii,any:o.slice(1),maxId:I?void 0:p.current}).next(),{value:z}=R;return z!=null&&z.length&&(I&&(f.current=z[0].id),z.forEach(A=>{kt(A,d)}),p.current=z[z.length-1].id),{...R,value:z}}async function h(){try{const I=await s.v1.timelines.listHashtag(l,{limit:1,any:o.slice(1),since_id:f.current}).next(),{value:R}=I;return!!(R!=null&&R.length)}catch{return!1}}const[b,y]=x("default"),[g,k]=x();F(()=>{(async()=>{try{const I=await s.v1.tags.fetch(l);k(I)}catch{}})()},[l]);const S=o.length>=en;return t(_t,{title:u,titleComponent:!!d&&t("h1",{class:"header-account",children:[t("b",{children:a}),t("div",{children:d})]}),id:"hashtag",instance:d,emptyText:"No one has posted anything with this tag yet.",errorText:"Unable to load posts with this tag",fetchItems:r,checkForUpdates:h,useItemID:!0,headerEnd:t(te,{portal:!0,setDownOverflow:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(w,{icon:"more",size:"l"})}),children:[!!g&&o.length===1&&t($,{children:[t(Et,{subMenu:!0,confirm:g.following,confirmLabel:`Unfollow #${l}?`,disabled:b==="loading"||!i,onClick:()=>{y("loading"),g.following?s.v1.tags.unfollow(l).then(()=>{k({...g,following:!1}),rt(`Unfollowed #${l}`)}).catch(I=>{alert(I)}).finally(()=>{y("default")}):s.v1.tags.follow(l).then(()=>{k({...g,following:!0}),rt(`Followed #${l}`)}).catch(I=>{alert(I)}).finally(()=>{y("default")})},children:g.following?t($,{children:[t(w,{icon:"check-circle"})," ",t("span",{children:"Following…"})]}):t($,{children:[t(w,{icon:"plus"})," ",t("span",{children:"Follow"})]})}),t(At,{})]}),t(cs,{className:"menu-field",disabled:S,children:({ref:I})=>t("form",{onSubmit:R=>{var A,L;R.preventDefault();const z=(L=(A=R.target[0].value)==null?void 0:A.trim)==null?void 0:L.call(A);z&&!o.some(V=>V.toLowerCase()===z.toLowerCase())&&(o.push(z),o.sort(),location.hash=d?`/${d}/t/${o.join("+")}`:`/t/${o.join("+")}`)},children:[t(w,{icon:"hashtag"}),t("input",{ref:I,type:"text",placeholder:S?`Max ${en} tags`:"Add hashtag",required:!0,autocorrect:"off",autocapitalize:"off",spellcheck:!1,pattern:"[^#][^\\s#]+[^#]",disabled:S})]})}),t(as,{takeOverflow:!0,children:o.map((I,R)=>t(Z,{disabled:o.length===1,onClick:z=>{o.splice(R,1),o.sort(),location.hash=d?`/${d}/t/${o.join("+")}`:`/t/${o.join("+")}`},children:[t(w,{icon:"x",alt:"Remove hashtag",class:"danger-icon"}),t("span",{children:[t("span",{class:"more-insignificant",children:"#"}),I]})]},I))}),t(At,{}),t(Z,{disabled:!m,onClick:()=>{const I={type:"hashtag",hashtag:o.join(" "),instance:d};v.shortcuts.some(z=>z.type===I.type&&z.hashtag.split(/[\s+]+/).sort().join(" ")===I.hashtag.split(/[\s+]+/).sort().join(" ")&&(z.instance?z.instance===I.instance:!0))?alert("This shortcut already exists"):(v.shortcuts.push(I),rt("Hashtag shortcut added"))},children:[t(w,{icon:"shortcut"})," ",t("span",{children:"Add to Shorcuts"})]}),t(Z,{onClick:()=>{let I=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(I)){I&&alert("Invalid instance");return}I&&(I=I.toLowerCase().trim(),location.hash=`/${I}/t/${o.join("+")}`)},children:[t(w,{icon:"bus"})," ",t("span",{children:"Go to another instance…"})]})]})},d+a)}const ci=20;function An(e){var b;const n=at(v),{masto:l,instance:c}=B(),o=(e==null?void 0:e.id)||((b=Vt())==null?void 0:b.id),s=P(),d=P();async function i(y){(y||!d.current)&&(d.current=l.v1.timelines.listList(o,{limit:ci}));const g=await d.current.next();let{value:k}=g;return k!=null&&k.length&&(y&&(s.current=k[0].id),k=zt(k,"home"),k.forEach(S=>{kt(S,c)})),{...g,value:k}}async function m(){try{const y=await l.v1.timelines.listList(o,{limit:1,since_id:s.current});let{value:g}=y;return g=zt(g,"home"),!!(g!=null&&g.length)}catch{return!1}}const[a,u]=x({title:"List"});St(a.title,"/l/:id"),F(()=>{(async()=>{try{const y=await l.v1.lists.fetch(o);u(y)}catch{}})()},[o]);const[f,p]=x(!1),[r,h]=x(!1);return t($,{children:[t(_t,{title:a.title,id:"list",emptyText:"Nothing yet.",errorText:"Unable to load posts.",instance:c,fetchItems:i,checkForUpdates:m,useItemID:!0,boostsCarousel:n.settings.boostsCarousel,allowFilters:!0,headerStart:t(H,{to:"/l",class:"button plain",children:t(w,{icon:"list",size:"l"})}),headerEnd:t(te,{portal:!0,setDownOverflow:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(w,{icon:"more",size:"l"})}),children:[t(Z,{onClick:()=>p({list:a}),children:[t(w,{icon:"pencil",size:"l"}),t("span",{children:"Edit"})]}),t(Z,{onClick:()=>h(!0),children:[t(w,{icon:"group",size:"l"}),t("span",{children:"Manage members"})]})]})},o),f&&t(mt,{class:"light",onClick:y=>{y.target===y.currentTarget&&p(!1)},children:t(Ee,{list:f==null?void 0:f.list,onClose:y=>{y.state==="success"&&y.list?u(y.list):y.state==="deleted"&&(location.hash="/l"),p(!1)}})}),r&&t(mt,{class:"light",onClick:y=>{y.target===y.currentTarget&&h(!1)},children:t(ri,{listID:o,onClose:()=>h(!1)})})]})}const ai=40;function ri({listID:e,onClose:n}){const{masto:l,instance:c}=B(),[o,s]=x([]),[d,i]=x("default"),[m,a]=x(!1),u=P();async function f(p){a(!1),i("loading"),(async()=>{try{(p||!u.current)&&(u.current=l.v1.lists.listAccounts(e,{limit:ai}));const r=await u.current.next();let{done:h,value:b}=r;b!=null&&b.length?(s(p?b:o.concat(b)),a(!h)):a(!1),i("default")}catch{i("error")}})()}return F(()=>{f(!0)},[]),t("div",{class:"sheet",id:"list-manage-members-container",children:[!!n&&t("button",{type:"button",class:"sheet-close",onClick:n,children:t(w,{icon:"x"})}),t("header",{children:t("h2",{children:"Manage members"})}),t("main",{children:t("ul",{children:[o.map(p=>t("li",{children:[t(Nt,{account:p,instance:c}),t(li,{account:p,listID:e})]},p.id)),m&&d==="default"&&t(Qt,{as:"li",onChange:p=>p&&f(),children:t("button",{type:"button",class:"light block",onClick:f,children:"Show more…"})})]})})]})}function li({account:e,listID:n}){const{masto:l}=B(),[c,o]=x("default"),[s,d]=x(!1);return t(Et,{confirm:!s,confirmLabel:t("span",{children:["Remove @",e.username," from list?"]}),align:"end",menuItemClassName:"danger",onClick:()=>{s?(o("loading"),(async()=>{try{await l.v1.lists.addAccount(n,{accountIds:[e.id]}),o("default"),d(!1)}catch{o("error")}})()):(o("loading"),(async()=>{try{await l.v1.lists.removeAccount(n,{accountIds:[e.id]}),o("default"),d(!0)}catch{o("error")}})())},children:t("button",{type:"button",class:`light ${s?"":"danger"}`,disabled:c==="loading",children:s?"Add":"Remove…"})})}const nn=20,di=new URLSearchParams;function Rn({columnMode:e,...n}){St("Mentions","/mentions");const{masto:l,instance:c}=B(),[o]=e?[di]:Ut(),[s,d]=x(null),i=(n==null?void 0:n.type)||o.get("type")||s,m=P(),a=P();async function u(g){(g||!m.current)&&(m.current=l.v1.notifications.list({limit:nn,types:["mention"]}));const k=await m.current.next();let{value:S}=k;return S!=null&&S.length&&(g&&(a.current=S[0].id),S.forEach(({status:I})=>{kt(I,c)})),{...k,value:S==null?void 0:S.map(I=>I.status)}}const f=P(),p=P();async function r(g){(g||!f.current)&&(f.current=l.v1.conversations.list({limit:nn}));const k=await f.current.next();let{value:S}=k;return S=S==null?void 0:S.filter(I=>I.lastStatus),S!=null&&S.length&&(g&&(p.current=S[0].lastStatus.id),S.forEach(({lastStatus:I})=>{kt(I,c)})),{...k,value:S==null?void 0:S.map(I=>I.lastStatus)}}function h(...g){return i==="private"?r(...g):u(...g)}async function b(){if(i==="private")try{const g=await l.v1.conversations.list({limit:1,since_id:p.current}).next();let{value:k}=g;return k!=null&&k.length?(p.current=k[0].lastStatus.id,!0):!1}catch{return!1}else try{const g=await l.v1.notifications.list({limit:1,types:["mention"],since_id:a.current}).next();let{value:k}=g;return k!=null&&k.length?(a.current=k[0].id,!0):!1}catch{return!1}}const y=ft(()=>t("div",{class:"filter-bar centered",children:[t(H,{to:"/mentions",class:i?"":"is-active",onClick:g=>{e&&(g.preventDefault(),d(null))},children:"All"}),t(H,{to:"/mentions?type=private",class:i==="private"?"is-active":"",onClick:g=>{e&&(g.preventDefault(),d("private"))},children:"Private"})]}),[i]);return t(_t,{title:"Mentions",id:"mentions",emptyText:"No one mentioned you :(",errorText:"Unable to load mentions.",instance:c,fetchItems:h,checkForUpdates:b,useItemID:!0,timelineStart:y,refresh:i})}function Mn(e){const n={},l=[];for(let s=0,d=0;s<e.length;s++){const i=e[s],{status:m,account:a,type:u,createdAt:f}=i,p=new Date(f).toLocaleDateString();let r=u;(u==="favourite"||u==="reblog")&&(r="favourite+reblog");const h=`${m==null?void 0:m.id}-${r}-${p}`,b=n[h];if(r==="follow_request")l[d++]=i;else if(b!=null&&b.account){const y=b._accounts.find(g=>g.id===a.id);y?(y._types.push(u),y._types.sort().reverse()):(a._types=[u],b._accounts.push(a))}else{a._types=[u];let y=n[h]={...i,type:r,_accounts:[a]};l[d++]=y}}const c={},o=[];for(let s=0,d=0;s<l.length;s++){const i=l[s],{account:m,_accounts:a,type:u,createdAt:f}=i,p=new Date(f).toLocaleDateString();if(u==="favourite+reblog"&&m&&a.length===1){const r=`${m==null?void 0:m.id}-${u}-${p}`,h=c[r];if(h)h._statuses.push(i.status);else{let b=c[r]={...i,type:u,_statuses:[i.status]};o[d++]=b}}else o[d++]=i}return o}const ui=30,hi=new URLSearchParams;function fi({columnMode:e}){St("Notifications","/notifications");const{masto:n,instance:l}=B(),c=at(v),[o,s]=x("default"),[d]=e?[hi]:Ut(),i=d.get("id"),m=d.get("access_token"),[a,u]=x(!1),[f,p]=x(!1),r=P(),{nearReachEnd:h,scrollDirection:b,reachStart:y,nearReachStart:g}=pe({scrollableRef:r}),k=b==="end"&&!g,[S,I]=x([]),[R,z]=x([]),A=P();async function L(U){(U||!A.current)&&(A.current=n.v1.notifications.list({limit:ui,excludeTypes:["follow_request"]}));const K=await A.current.next(),ct=K.value;if(ct!=null&&ct.length){ct.forEach(xt=>{kt(xt.status,l,{skipThreading:!0})});const ht=Mn(ct);U?(v.notificationsLast=ct[0],v.notifications=ht,n.v1.markers.create({notifications:{lastReadId:ct[0].id}}).catch(()=>{})):v.notifications.push(...ht)}return v.notificationsShowNew=!1,v.notificationsLastFetchTime=Date.now(),K}function V(){return n.v1.followRequests.list({limit:80})}const N=()=>{s("loading"),(async()=>{try{const U=await V();I(U),s("default")}catch{s("error")}})()};function M(){return n.v1.announcements.list()}const D=U=>{s("loading"),(async()=>{try{const K=L(U),ct=V(),ht=M();if(U){const $t=await ht;$t.sort((tt,G)=>{const st=new Date(tt.updatedAt||tt.createdAt);return new Date(G.updatedAt||G.createdAt)-st}),z($t);const O=await ct;I(O)}const{done:xt}=await K;u(!xt),s("default")}catch{s("error")}})()};F(()=>{D(!0)},[]),F(()=>{y&&D(!0)},[y]),F(()=>{h&&a&&D()},[h,a]);const ot=bn(5e3),Y=Kt(()=>{var U;c.settings.autoRefresh&&((U=r.current)==null?void 0:U.scrollTop)===0&&ot&&!pi()&&c.notificationsShowNew&&o!=="loading"&&D(!0)},[ot,c.notificationsShowNew,c.settings.autoRefresh,o]);F(Y,[c.notificationsShowNew]);const Ct=new Date,lt=new Date(Ct-24*60*60*1e3);let Tt=new Date;const Lt=!c.notifications.some(U=>new Date(U.createdAt).toDateString()===Ct.toDateString()),nt=P();return F(()=>{i&&(v.routeNotification={id:i,accessToken:atob(m)})},[i,m]),F(()=>{o==="default"&&(async()=>{try{const U=await wn();if(U!=null&&U.getNotifications){const K=await U.getNotifications()}}catch{}})()},[o]),t("div",{id:"notifications-page",class:"deck-container",ref:r,tabIndex:"-1",children:t("div",{class:`timeline-deck deck ${f?"only-mentions":""}`,children:[t("header",{hidden:k,onClick:U=>{var K;U.target.closest("a, button")||(K=r.current)==null||K.scrollTo({top:0,behavior:"smooth"})},class:o==="loading"?"loading":"",children:[t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:[t(ee,{}),t(H,{to:"/",class:"button plain",children:t(w,{icon:"home",size:"l",alt:"Home"})})]}),t("h1",{children:"Notifications"}),t("div",{class:"header-side"})]}),c.notificationsShowNew&&o!=="loading"&&t("button",{class:"updates-button shiny-pill",type:"button",onClick:()=>{var U;D(!0),(U=r.current)==null||U.scrollTo({top:0,behavior:"smooth"})},children:[t(w,{icon:"arrow-up"})," New notifications"]})]}),R.length>0&&t("div",{class:"shazam-container",children:t("div",{class:"shazam-container-inner",children:t("details",{class:"announcements",children:[t("summary",{children:[t("span",{children:[t(w,{icon:"announce",class:"announcement-icon",size:"l"})," ",t("b",{children:["Announcement",R.length>1?"s":""]})," ",t("small",{class:"insignificant",children:l})]}),R.length>1&&t("span",{class:"announcements-nav-buttons",children:R.map((U,K)=>t("button",{type:"button",class:"plain2 small",onClick:()=>{var ct;(ct=nt.current)==null||ct.children[K].scrollIntoView({behavior:"smooth",block:"nearest"})},children:K+1}))})]}),t("ul",{class:`announcements-list-${R.length>1?"multiple":"single"}`,ref:nt,children:R.map(U=>t("li",{children:t(mi,{announcement:U})}))})]})})}),S.length>0&&t("div",{class:"follow-requests",children:[t("h2",{class:"timeline-header",children:"Follow requests"}),S.length>5?t("details",{children:[t("summary",{children:[S.length," follow requests"]}),t("ul",{children:S.map(U=>t("li",{children:[t(Nt,{account:U}),t(Ie,{accountID:U.id,onChange:()=>{}})]},U.id))})]}):t("ul",{children:S.map(U=>t("li",{children:[t(Nt,{account:U}),t(Ie,{accountID:U.id,onChange:()=>{}})]},U.id))})]}),t("div",{id:"mentions-option",children:t("label",{children:[t("input",{type:"checkbox",checked:f,onChange:U=>{p(U.target.checked)}})," ","Only mentions"]})}),t("h2",{class:"timeline-header",children:"Today"}),Lt&&!!c.notifications.length&&t("p",{class:"ui-state insignificant",children:o==="default"?"You're all caught up.":t($,{children:"…"})}),c.notifications.length?t($,{children:c.notifications.map(U=>{if(f&&U.type!=="mention")return null;const K=new Date(U.createdAt),ct=K.toDateString()!==Tt.toDateString();ct&&(Tt=K);const ht=K.toDateString()===lt.toDateString()?"Yesterday":Ft(Tt,{hideTime:!0});return t($,{children:[ct&&t("h2",{class:"timeline-header",children:ht}),t(Ne,{instance:l,notification:U,reload:()=>{D(!0),N()}},U.id)]})})}):t($,{children:[o==="loading"&&t($,{children:t("ul",{class:"timeline flat",children:Array.from({length:5}).map((U,K)=>t("li",{class:"notification skeleton",children:[t("div",{class:"notification-type",children:t(w,{icon:"notification",size:"xl"})}),t("div",{class:"notification-content",children:t("p",{children:"███████████ ████"})})]}))})}),o==="error"&&t("p",{class:"ui-state",children:["Unable to load notifications",t("br",{}),t("br",{}),t("button",{type:"button",onClick:()=>D(!0),children:"Try again"})]})]}),a&&t("button",{type:"button",class:"plain block",disabled:o==="loading",onClick:()=>D(),style:{marginBlockEnd:"6em"},children:o==="loading"?t(gt,{abrupt:!0}):t($,{children:"Show more…"})})]})})}function pi(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}function mi({announcement:e}){const{instance:n}=B(),{contact:l}=Wn(),c=l==null?void 0:l.account,{id:o,content:s,startsAt:d,endsAt:i,published:m,allDay:a,publishedAt:u,updatedAt:f,read:p,mentions:r,statuses:h,tags:b,emojis:y,reactions:g}=e,k=new Date(u),S=Ft(k),I=new Date(f),R=Ft(I);return t("div",{class:"announcement-block",children:[t(Nt,{account:c}),t("div",{class:"announcement-content",onClick:an({mentions:r,instance:n}),dangerouslySetInnerHTML:{__html:we(s,{emojis:y})}}),t("p",{class:"insignificant",children:[t("time",{datetime:k.toISOString(),children:Ft(k)}),f&&R!==S&&t($,{children:[" ","•"," ",t("span",{class:"ib",children:["Updated"," ",t("time",{datetime:I.toISOString(),children:Ft(I)})]})]})]}),t("div",{class:"announcement-reactions",hidden:!0,children:g.map(z=>{const{name:A,count:L,me:V,staticUrl:N,url:M}=z;return t("button",{type:"button",class:`plain4 small ${V?"reacted":""}`,children:[M||N?t("img",{src:M||N,alt:A,width:"16",height:"16"}):t("span",{children:A})," ",t("span",{class:"count",children:Dt(L)})]})})})]})}const Dn=qt(fi),gi=20;function Ce({local:e,columnMode:n,...l}){const c=at(v),o=!!e,s=n?{}:Vt(),{masto:d,instance:i}=B({instance:(l==null?void 0:l.instance)||s.instance}),m=`${o?"Local":"Federated"} timeline (${i})`;St(m,o?"/:instance?/p/l":"/:instance?/p");const a=P(),u=P();async function f(r){(r||!u.current)&&(u.current=d.v1.timelines.listPublic({limit:gi,local:o}));const h=await u.current.next();let{value:b}=h;return b!=null&&b.length&&(r&&(a.current=b[0].id),b=zt(b,"public"),b.forEach(y=>{kt(y,i)})),{...h,value:b}}async function p(){try{const r=await d.v1.timelines.listPublic({limit:1,local:o,since_id:a.current}).next();let{value:h}=r;return h=zt(h,"public"),!!(h!=null&&h.length)}catch{return!1}}return t(_t,{title:m,titleComponent:t("h1",{class:"header-account",children:[t("b",{children:o?"Local timeline":"Federated timeline"}),t("div",{children:i})]}),id:"public",instance:i,emptyText:"No one has posted anything yet.",errorText:"Unable to load posts",fetchItems:f,checkForUpdates:p,useItemID:!0,headerStart:t($,{}),boostsCarousel:c.settings.boostsCarousel,allowFilters:!0,headerEnd:t(te,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(w,{icon:"more",size:"l"})}),children:[t(Z,{href:o?`/#/${i}/p`:`/#/${i}/p/l`,children:o?t($,{children:[t(w,{icon:"transfer"})," ",t("span",{children:"Switch to Federated"})]}):t($,{children:[t(w,{icon:"transfer"})," ",t("span",{children:"Switch to Local"})]})}),t(At,{}),t(Z,{onClick:()=>{let r=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(r)){r&&alert("Invalid instance");return}r&&(r=r.toLowerCase().trim(),location.hash=o?`/${r}/p/l`:`/${r}/p`)},children:[t(w,{icon:"bus"})," ",t("span",{children:"Go to another instance…"})]})]})},i+o)}const bi=20;function En({columnMode:e,...n}){const l=at(v),c=e?{}:Vt(),{masto:o,instance:s}=B({instance:(n==null?void 0:n.instance)||c.instance}),d=`Trending (${s})`;St(d,"/:instance?/trending");const i=P(),[m,a]=x([]),u=P();async function f(h){if(h||!u.current){u.current=o.v1.trends.listStatuses({limit:bi});try{const g=o.v1.trends.listTags(),{value:k}=await g.next();a(k)}catch{}}const b=await u.current.next();let{value:y}=b;return y!=null&&y.length&&(h&&(i.current=y[0].id),y=zt(y,"public"),y.forEach(g=>{kt(g,s)})),{...b,value:y}}async function p(){try{const h=await o.v1.trends.listStatuses({limit:1}).next();let{value:b}=h;return b=zt(b,"public"),b!=null&&b.length&&b[0].id!==i.current?(i.current=b[0].id,!0):!1}catch{return!1}}const r=ft(()=>m.length?t("div",{class:"filter-bar",children:[t(w,{icon:"chart",class:"insignificant",size:"l"}),m.map((h,b)=>{const{name:y,history:g}=h,k=g.reduce((S,I)=>S+ +I.uses,0);return t(H,{to:`/${s}/t/${y}`,children:[t("span",{children:[t("span",{class:"more-insignificant",children:"#"}),y]}),t("span",{class:"filter-count",children:k.toLocaleString()})]})})]}):null,[m]);return t(_t,{title:d,titleComponent:t("h1",{class:"header-account",children:[t("b",{children:"Trending"}),t("div",{children:s})]}),id:"trending",instance:s,emptyText:"No trending posts.",errorText:"Unable to load posts",fetchItems:f,checkForUpdates:p,checkForUpdatesInterval:5*60*1e3,useItemID:!0,headerStart:t($,{}),boostsCarousel:l.settings.boostsCarousel,allowFilters:!0,timelineStart:r,headerEnd:t(te,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(w,{icon:"more",size:"l"})}),children:t(Z,{onClick:()=>{let h=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(h)){h&&alert("Invalid instance");return}h&&(h=h.toLowerCase().trim(),location.hash=`/${h}/trending`)},children:[t(w,{icon:"bus"})," ",t("span",{children:"Go to another instance…"})]})})},s)}function yi(){St("Home","/");const e=at(v),{shortcuts:n}=e,l=n.map(c=>{if(!c)return null;const{type:o,...s}=c,d={following:Pe,notifications:Dn,list:An,public:Ce,bookmarks:xn,favourites:$n,hashtag:Ln,mentions:Rn,trending:En}[o];return d?t(d,{...s,columnMode:!0},o+JSON.stringify(s)):null});return vt(["1","2","3","4","5","6","7","8","9"],(c,o)=>{try{const s=parseInt(o.keys[0],10)-1;document.querySelectorAll("#columns > *")[s].focus()}catch{}}),t("div",{id:"columns",children:l})}function wi(){var n;const e=at(v);return F(()=>{(async()=>{const l=await Yt.drafts.keys();if(l.length){const c=dn();l.filter(s=>s.startsWith(c)).length&&(v.showDrafts=!0)}})()},[]),t($,{children:(e.settings.shortcutsColumnsMode||e.settings.shortcutsViewMode==="multi-column")&&((n=e.shortcuts)!=null&&n.length)?t(yi,{}):t(Pe,{title:"Home",path:"/",id:"home",headerStart:!1,headerEnd:t(vi,{})})})}function vi(){const e=at(v),n=P(),[l,c]=x(void 0);return t($,{children:[t(H,{ref:n,to:"/notifications",class:`button plain notifications-button ${e.notificationsShowNew?"has-badge":""} ${l}`,onClick:o=>{o.stopPropagation(),window.matchMedia("(min-width: calc(40em))").matches&&(o.preventDefault(),c(s=>s?void 0:"open"))},children:t(w,{icon:"notification",size:"l",alt:"Notifications"})}),t(Ii,{state:l,anchorRef:n,onClose:()=>c(void 0)})]})}const ki=30,Si=5;function Ii({anchorRef:e,state:n,onClose:l}){const{masto:c,instance:o}=B(),s=at(v),[d,i]=x("default"),m=c.v1.notifications.list({limit:ki});async function a(){const h=await m.next(),b=h.value;if(b!=null&&b.length){b.forEach(g=>{kt(g.status,o,{skipThreading:!0})});const y=Mn(b);v.notificationsLast=b[0],v.notifications=y,c.v1.markers.create({notifications:{lastReadId:b[0].id}}).catch(()=>{})}return v.notificationsShowNew=!1,v.notificationsLastFetchTime=Date.now(),h}const[u,f]=x(!1);function p(){return c.v1.followRequests.list({limit:1})}function r(){i("loading"),(async()=>{try{await a();const h=await p();f(!!(h!=null&&h.length)),i("default")}catch{i("error")}})()}return F(()=>{n==="open"&&r()},[n]),t(mn,{menuClassName:"notifications-menu",state:n,anchorRef:e,onClose:l,portal:{target:document.body},overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:"8 8 8 8",children:[t("header",{children:t("h2",{children:"Notifications"})}),t("main",{children:s.notifications.length?t($,{children:s.notifications.slice(0,Si).map(h=>t(Ne,{instance:o,notification:h},h.id))}):d==="loading"?t("div",{class:"ui-state",children:t(gt,{abrupt:!0})}):d==="error"&&t("div",{class:"ui-state",children:[t("p",{children:"Unable to fetch notifications."}),t("p",{children:t("button",{type:"button",onClick:r,children:"Try again"})})]})}),t("footer",{children:[t(H,{to:"/mentions",class:"button plain",children:[t(w,{icon:"at"})," ",t("span",{children:"Mentions"})]}),t(H,{to:"/notifications",class:"button plain2",children:[u?t($,{children:[t("span",{class:"tag collapsed",children:"New"})," ",t("span",{children:"Follow Requests"})]}):t("b",{children:"See all"})," ",t(w,{icon:"arrow-right"})]})]})]})}const Ci=qt(wi),Ti=/\/@([^@\/]+)@?([^\/]+)?\/([^\/]+)\/?$/i,xi=/\/notes\/([^\/]+)\/?$/i;function Nn(e){const{hostname:n,pathname:l}=new URL(e),[,c,o,s]=l.match(Ti)||[];if(s)return`/${n}/s/${s}`;const[,d]=l.match(xi)||[];if(d)return`/${n}/s/${d}`}function $i(){const n=Me().pathname.replace(/^\//,""),l=Nn(n);return Pt(()=>{l&&setTimeout(()=>{window.location.hash=l+"?view=full"},300)},[l]),t("div",{class:"ui-state",tabIndex:"-1",children:[l?t($,{children:[t("h2",{children:"Redirecting…"}),t("p",{children:t("a",{href:`#${l}?view=full`,children:l})})]}):t($,{children:[t("h2",{children:"Unable to process URL"}),t("p",{children:t("a",{href:n,target:"_blank",rel:"noopener noreferrer",children:n})})]}),t("hr",{}),t("p",{children:t(H,{to:"/",children:"Go home"})})]})}function Li(){const{masto:e}=B();St("Lists","/l");const[n,l]=x("default"),[c,o]=he(a=>a+1,0),[s,d]=x([]);F(()=>{l("loading"),(async()=>{try{const a=await e.v1.lists.list();d(a),l("default")}catch{l("error")}})()},[c]);const[i,m]=x(!1);return t("div",{id:"lists-page",class:"deck-container",tabIndex:"-1",children:[t("div",{class:"timeline-deck deck",children:[t("header",{children:t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:[t(ee,{}),t(H,{to:"/",class:"button plain",children:t(w,{icon:"home",size:"l"})})]}),t("h1",{children:"Lists"}),t("div",{class:"header-side",children:t("button",{type:"button",class:"plain",onClick:()=>m(!0),children:t(w,{icon:"plus",size:"l",alt:"New list"})})})]})}),t("main",{children:s.length>0?t("ul",{class:"link-list",children:s.map(a=>t("li",{children:t(H,{to:`/l/${a.id}`,children:t("span",{children:[t(w,{icon:"list"})," ",t("span",{children:a.title})]})})}))}):n==="loading"?t("p",{class:"ui-state",children:t(gt,{})}):n==="error"?t("p",{class:"ui-state",children:"Unable to load lists."}):t("p",{class:"ui-state",children:"No lists yet."})})]}),i&&t(mt,{class:"light",onClick:a=>{a.target===a.currentTarget&&m(!1)},children:t(Ee,{list:i==null?void 0:i.list,onClose:a=>{a.state==="success"&&o(),m(!1)}})})]})}const Ai=""+new URL("instances-e6f8d558.json",import.meta.url).href,{VITE_CLIENT_NAME:Ri,VITE_WEBSITE:Mi}={VITE_CLIENT_NAME:"IMSB.APP",VITE_CLIENT_ID:"app.imsb.app",VITE_WEBSITE:"https://app.imsb.app",VITE_APP_ENV:"production",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1},Ue="read write follow push";async function Di({instanceURL:e}){const n=new URLSearchParams({client_name:Ri,redirect_uris:location.origin+location.pathname,scopes:Ue,website:Mi});return await(await fetch(`https://${e}/api/v1/apps`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n.toString()})).json()}async function Ei({instanceURL:e,client_id:n}){const l=new URLSearchParams({client_id:n,scope:Ue,redirect_uri:location.origin+location.pathname,response_type:"code"});return`https://${e}/oauth/authorize?${l.toString()}`}async function Ni({instanceURL:e,client_id:n,client_secret:l,code:c}){const o=new URLSearchParams({client_id:n,client_secret:l,redirect_uri:location.origin+location.pathname,grant_type:"authorization_code",code:c,scope:Ue});return await(await fetch(`https://${e}/oauth/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o.toString()})).json()}function Pi(){St("Log in");const e=P(),n=J.local.get("instanceURL"),[l,c]=x("default"),[o]=Ut(),s=o.get("instance"),[d,i]=x(s||(n==null?void 0:n.toLowerCase())||""),[m,a]=x([]);F(()=>{(async()=>{try{const h=await(await fetch(Ai)).json();a(h)}catch{}})()},[]);const u=r=>{J.local.set("instanceURL",r),(async()=>{c("loading");try{const{client_id:h,client_secret:b,vapid_key:y}=await Di({instanceURL:r});h&&b?(J.session.set("clientID",h),J.session.set("clientSecret",b),J.session.set("vapidKey",y),location.href=await Ei({instanceURL:r,client_id:h})):alert("Failed to register application"),c("default")}catch{c("error")}})()},f=r=>{r.preventDefault();const{elements:h}=r.target;let b=h.instanceURL.value.toLowerCase();b=b.replace(/^https?:\/\//,"").replace(/\/+$/,""),b=b.replace(/^@?[^@]+@/,""),/\./.test(b)||(b=m.find(y=>y.includes(b))),u(b)},p=d?m.filter(r=>r.includes(d)).sort((r,h)=>{const b=r.toLowerCase().startsWith(d.toLowerCase()),y=h.toLowerCase().startsWith(d.toLowerCase());return b&&!y?-1:!b&&y?1:0}).slice(0,10):[];return t("main",{id:"login",style:{textAlign:"center"},children:t("form",{onSubmit:f,children:[t("h1",{children:"Log in"}),t("label",{children:[t("p",{children:"Instance"}),t("input",{value:d,required:!0,type:"text",class:"large",id:"instanceURL",ref:e,disabled:l==="loading",autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellcheck:!1,placeholder:"instance domain",onInput:r=>{i(r.target.value)}}),(p==null?void 0:p.length)>0?t("ul",{id:"instances-suggestions",children:p.map(r=>t("li",{children:t("button",{type:"button",class:"plain4",onClick:()=>{u(r)},children:r})}))}):t("div",{id:"instances-eg",children:"e.g. “mastodon.social’"})]}),l==="error"&&t("p",{class:"error",children:"Failed to log in. Please try again or another instance."}),t("div",{children:[t("button",{class:"large",disabled:l==="loading",children:"Log in"})," "]}),t(gt,{hidden:l!=="loading"}),t("hr",{}),t("p",{children:t("a",{href:"https://joinmastodon.org/servers",target:"_blank",children:"Don't have an account? Create one!"})}),t("p",{children:t(H,{to:"/",children:"Go home"})})]})})}const ie=5,ye=40;function Ui(e){const n=Vt(),{masto:l,instance:c,authenticated:o}=B({instance:n.instance}),[s,d]=x("default"),[i]=Ut(),m=P(),a=(e==null?void 0:e.query)||i.get("q"),u=(e==null?void 0:e.type)||i.get("type");St(a?`Search: ${a}${u?` (${{statuses:"Posts",accounts:"Accounts",hashtags:"Hashtags"}[u]})`:""}`:"Search","/search");const[f,p]=x(!1),r=P(0);F(()=>{r.current=0},[a,u]);const h=P();Pt(()=>{var A,L;(L=(A=h.current)==null?void 0:A.scrollTo)==null||L.call(A,0,0)},[a,u]);const[b,y]=x([]),[g,k]=x([]),[S,I]=x([]);F(()=>{y([]),k([]),I([])},[a]);const R={statuses:y,accounts:k,hashtags:I};function z(A){d("loading"),A&&!u&&(y(b.slice(0,ie)),k(g.slice(0,ie)),I(S.slice(0,ie))),(async()=>{var V,N;const L={q:a,resolve:o,limit:ie};u&&(L.limit=ye,L.type=u,o&&(L.offset=r.current));try{const M=await l.v2.search(L);if(u)if(A){R[u](M[u]);const D=(V=M[u])==null?void 0:V.length;r.current=ye,p(!!D)}else{R[u](ot=>[...ot,...M[u]]);const D=(N=M[u])==null?void 0:N.length;r.current=r.current+ye,p(!!D)}else y(M.statuses),k(M.accounts),I(M.hashtags),r.current=0,p(!1);d("default")}catch{d("error")}})()}return F(()=>{var A,L,V,N;a?((L=(A=m.current)==null?void 0:A.setValue)==null||L.call(A,a),z(!0)):(N=(V=m.current)==null?void 0:V.focus)==null||N.call(V)},[a,u,c]),vt("/",A=>{var L,V;(V=(L=m.current)==null?void 0:L.focus)==null||V.call(L)},{preventDefault:!0}),t("div",{id:"search-page",class:"deck-container",ref:h,children:t("div",{class:"timeline-deck deck",children:[t("header",{children:t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:t(ee,{})}),t(Tn,{ref:m}),t("div",{class:"header-side",children:" "})]})}),t("main",{children:[!!a&&t("div",{class:"filter-bar",children:[!!u&&t(H,{to:`/search${a?`?q=${encodeURIComponent(a)}`:""}`,children:"‹ All"}),[{label:"Accounts",type:"accounts",to:`/search?q=${encodeURIComponent(a)}&type=accounts`},{label:"Hashtags",type:"hashtags",to:`/search?q=${encodeURIComponent(a)}&type=hashtags`},{label:"Posts",type:"statuses",to:`/search?q=${encodeURIComponent(a)}&type=statuses`}].sort((A,L)=>A.type===u?-1:L.type===u?1:0).map(A=>t(H,{to:A.to,children:A.label}))]}),a?t($,{children:[(!u||u==="accounts")&&t($,{children:[u!=="accounts"&&t("h2",{class:"timeline-header",children:"Accounts"}),g.length>0?t($,{children:[t("ul",{class:"timeline flat accounts-list",children:g.map(A=>t("li",{children:t(Nt,{account:A,instance:c,showStats:!0})},A.id))}),u!=="accounts"&&t("div",{class:"ui-state",children:t(H,{class:"plain button",to:`/search?q=${a}&type=accounts`,children:["See more accounts ",t(w,{icon:"arrow-right"})]})})]}):!u&&(s==="loading"?t("p",{class:"ui-state",children:t(gt,{abrupt:!0})}):t("p",{class:"ui-state",children:"No accounts found."}))]}),(!u||u==="hashtags")&&t($,{children:[u!=="hashtags"&&t("h2",{class:"timeline-header",children:"Hashtags"}),S.length>0?t($,{children:[t("ul",{class:"link-list hashtag-list",children:S.map(A=>t("li",{children:t(H,{to:c?`/${c}/t/${A.name}`:`/t/${A.name}`,children:[t(w,{icon:"hashtag"}),t("span",{children:A.name})]})},A.name))}),u!=="hashtags"&&t("div",{class:"ui-state",children:t(H,{class:"plain button",to:`/search?q=${a}&type=hashtags`,children:["See more hashtags ",t(w,{icon:"arrow-right"})]})})]}):!u&&(s==="loading"?t("p",{class:"ui-state",children:t(gt,{abrupt:!0})}):t("p",{class:"ui-state",children:"No hashtags found."}))]}),(!u||u==="statuses")&&t($,{children:[u!=="statuses"&&t("h2",{class:"timeline-header",children:"Posts"}),b.length>0?t($,{children:[t("ul",{class:"timeline",children:b.map(A=>t("li",{children:t(H,{class:"status-link",to:c?`/${c}/s/${A.id}`:`/s/${A.id}`,children:t(wt,{status:A})})},A.id))}),u!=="statuses"&&t("div",{class:"ui-state",children:t(H,{class:"plain button",to:`/search?q=${a}&type=statuses`,children:["See more posts ",t(w,{icon:"arrow-right"})]})})]}):!u&&(s==="loading"?t("p",{class:"ui-state",children:t(gt,{abrupt:!0})}):t("p",{class:"ui-state",children:"No posts found."}))]}),!!u&&(s==="default"?f?t(Qt,{onChange:A=>{A&&z()},children:t("button",{type:"button",class:"plain block",onClick:()=>z(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):t("p",{class:"ui-state insignificant",children:"The end."}):s==="loading"&&t("p",{class:"ui-state",children:t(gt,{abrupt:!0})}))]}):s==="loading"?t("p",{class:"ui-state",children:t(gt,{abrupt:!0})}):t("p",{class:"ui-state",children:"Enter your search term or paste a URL above to get started."})]})]})})}const oe=40,_i=10,Fi=5;let Te={},re={},le={};function xe(e){delete re[e],delete le[e]}const ce={block:"nearest",inline:"center",behavior:"smooth"};function zi(e){const{id:n}=e,{masto:l,instance:c}=B({instance:e.instance}),o=at(v),[s,d]=Ut(),i=s.get("media"),m=s.get("media-only"),a=parseInt(i||m,10);let u=a>0;const f=s.get("mediaStatusID"),p=fn(f,c);f&&!p&&(u=!1);const r=u&&!!m,h=Re(n,c),[b,y]=x(v.statuses[h]);F(()=>{v.statuses[h]&&y(v.statuses[h])},[h]);const g=ft(()=>{const{prevLocation:I}=v,R=((I==null?void 0:I.pathname)||"")+((I==null?void 0:I.search)||""),z=Zt("/:instance/s/:id",R)||Zt("/s/:id",R);return!R||z?"/":R},[]);F(()=>{!b&&u&&(async()=>{try{const I=await l.v1.statuses.fetch(n);kt(I,c),y(I)}catch{alert("Unable to load post."),location.hash=g}})()},[u]);const k=f?p==null?void 0:p.mediaAttachments:b==null?void 0:b.mediaAttachments,S=Kt(()=>{!window.matchMedia("(min-width: calc(40em + 350px))").matches&&o.prevLocation?history.back():r?location.hash=g:(s.delete("media"),s.delete("mediaStatusID"),d(s))},[r,g,o.prevLocation]);return t("div",{class:"deck-backdrop",children:[u?k!=null&&k.length?t(In,{mediaAttachments:k,statusID:f||n,instance:c,lang:b==null?void 0:b.language,index:a-1,onClose:S}):t("div",{class:"media-modal-container loading",children:t(gt,{abrupt:!0})}):t(H,{to:g}),!r&&t(Bi,{id:n,instance:e.instance,closeLink:g})]})}function Bi({id:e,closeLink:n="/",instance:l}){var st;const[c,o]=Ut(),s=c.get("media"),d=parseInt(s,10)>0,[i,m]=x(c.get("view")),a=!!parseInt(c.get("translate")),{masto:u,instance:f}=B({instance:l}),{masto:p,instance:r,authenticated:h}=B(),b=f===r,y=at(v),[g,k]=x([]),[S,I]=x("default"),R=P(),z=Re(e,f),A=P(0),L=P();F(()=>{var T;(T=L.current)==null||T.focus()},[]),F(()=>{var _;const T=rs(()=>{if(!L.current)return;const{scrollTop:C}=L.current;S!=="loading"&&(le[e]=C)},50);return(_=L.current)==null||_.addEventListener("scroll",T,{passive:!0}),T(),()=>{var C;T.cancel(),(C=L.current)==null||C.removeEventListener("scroll",T)}},[e,S!=="loading"]);const V=P(),N=({reloadHero:T}={})=>{I("loading");let _;const C=re[e];if(C){const E=C.filter(q=>v.statuses[z]);k(E)}else k([{id:e}]);return(async()=>{var it,X;const E=()=>je(()=>u.v1.statuses.fetch(e),{retries:4}),q=je(()=>u.v1.statuses.fetchContext(e),{retries:8}),W=!!y.statuses[z];let Q=y.statuses[z];if(!(W&&!T))try{Q=await E(),kt(Q,f),await new Promise(et=>{setTimeout(et,100)})}catch{I("error");return}try{let et=function(j){return j==null?void 0:j.map(yt=>({id:yt.id,account:yt.account,repliesCount:yt.repliesCount,content:yt.content,weight:Xt(yt),replies:et(yt.__replies)}))};const dt=await q,{ancestors:ut,descendants:bt}=dt;A.current=(bt==null?void 0:bt.length)||0;const Rt=new Set;ut.forEach(j=>{kt(j,f,{skipThreading:!0}),j.inReplyToId&&!ut.find(yt=>yt.id===j.inReplyToId)&&Rt.add(j.inReplyToId)});const Mt=ut.every(j=>j.account.id===Q.account.id),Jt=[];bt.forEach(j=>{if(kt(j,f,{skipThreading:!0}),j.inReplyToId&&!bt.find(yt=>yt.id===j.inReplyToId)&&j.inReplyToId!==Q.id&&Rt.add(j.inReplyToId),j.inReplyToAccountId===j.account.id)Jt.push(j);else if(j.inReplyToId===Q.id)Jt.push(j);else if(!j.inReplyToAccountId&&Jt.find(yt=>yt.id===j.inReplyToId)&&j.account.id===Q.account.id)Jt.push(j);else{const yt=bt.find(Un=>Un.id===j.inReplyToId);yt&&(yt.__replies||(yt.__replies=[]),yt.__replies.push(j))}}),Rt.size;const me=[...ut.map(j=>({id:j.id,ancestor:!0,isThread:Mt,accountID:j.account.id,account:j.account,repliesCount:j.repliesCount,weight:Xt(j)})),{id:e,accountID:Q.account.id,weight:Xt(Q)},...Jt.map(j=>({id:j.id,account:j.account,accountID:j.account.id,descendant:!0,thread:j.account.id===Q.account.id,weight:Xt(j),replies:et(j.__replies)}))];I("default"),V.current={offsetTop:(it=R.current)==null?void 0:it.offsetTop,scrollTop:(X=L.current)==null?void 0:X.scrollTop};const _e=me.findIndex(j=>j.id===e);_e>=lt&&Tt(_e+1),k(me),re[e]=me,Gn(Q,f)}catch{I("error")}})(),()=>{clearTimeout(_)}};F(N,[e,u]),F(()=>{var _,C;if(!g.length)return;const T=le[e];if(T)L.current.scrollTop=T;else if(V.current){const E={offsetTop:(_=R.current)==null?void 0:_.offsetTop,scrollTop:(C=L.current)==null?void 0:C.scrollTop},q=E.offsetTop-V.current.offsetTop+E.scrollTop;L.current.scrollTop=q}else g.length===1&&(L.current.scrollTop=0);V.current=null},[g]),F(()=>{y.reloadStatusPage<=0||(async()=>{try{const{instanceURL:T}=Gt(),_=`https://${T}/api/v1/statuses/${e}/context`;return await(await caches.open("api")).delete(_,{ignoreVary:!0}),N({reloadHero:!0})}catch{}})()},[y.reloadStatusPage]),F(()=>()=>{le={},v.reloadStatusPage=0,re={},Te={},$e.clear()},[]);const M=y.statuses[z]||y.statuses[e],D=ft(()=>{if(!M)return"";const{account:T}=M,_=document.createElement("div");return _.innerHTML=T.displayName,_.innerText.trim()},[M]),ot=ft(()=>{if(!M)return"";let T=hn(M);return T.length>64&&(T=T.slice(0,64)+"…"),T},[M]);St(D&&ot?`${D}: "${ot}"`:"Status","/:instance?/s/:id");const Y=ft(()=>{if(!M)return;const{url:T}=M;if(T)return new URL(T).hostname},[M]),Ct=ft(()=>{if(Y)return Y===f},[Y,f]),[lt,Tt]=x(oe),Lt=ft(()=>g.length-lt,[g.length,lt]),nt=g.some(T=>T.descendant),U=g.filter(T=>T.ancestor),[K,ct]=x(!0),ht=gn(ct,100),xt=ft(()=>{if(!R.current||K)return null;const{top:T}=R.current.getBoundingClientRect();return T>0?"down":"up"},[K]);vt("esc",()=>{location.hash=n},{enabled:!d}),vt("backspace",()=>{location.hash=n}),vt("j",()=>{const T=document.activeElement.closest(".status-link, .status-focus"),_=T==null?void 0:T.getBoundingClientRect(),C=Array.from(L.current.querySelectorAll(".status-link:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *), .status-focus:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *)"));if(T&&_.top<L.current.clientHeight&&_.bottom>0){const E=C.indexOf(T);let q=C[E+1];q&&(q.focus(),q.scrollIntoView(ce))}else{const E=C.find(q=>{const W=q.getBoundingClientRect();return W.top>=44&&W.left>=0});E&&(E.focus(),E.scrollIntoView(ce))}}),vt("k",()=>{const T=document.activeElement.closest(".status-link, .status-focus"),_=T==null?void 0:T.getBoundingClientRect(),C=Array.from(L.current.querySelectorAll(".status-link:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *), .status-focus:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *)"));if(T&&_.top<L.current.clientHeight&&_.bottom>0){const E=C.indexOf(T);let q=C[E-1];q&&(q.focus(),q.scrollIntoView(ce))}else{const E=C.find(q=>{const W=q.getBoundingClientRect();return W.top>=44&&W.left>=0});E&&(E.focus(),E.scrollIntoView(ce))}}),vt("x",()=>{const T=document.activeElement.closest(".status-link, .status-focus");if(T){const _=T.nextElementSibling;_&&_.tagName.toLowerCase()==="details"&&(_.open=!_.open)}});const{nearReachStart:$t}=pe({scrollableRef:L,distanceFromStartPx:16}),O=P(d?"media+status":"status"),tt=Kt((T,_,C,E)=>{T.preventDefault(),T.stopPropagation(),o({media:_+1,mediaStatusID:E.id})},[e]),G=Kt((T,_)=>{xe(_.id)},[]);return t("div",{tabIndex:"-1",ref:L,class:`status-deck deck contained ${g.length>1?"padded-bottom":""} ${O.current==="status"?"slide-in":""} ${i?`deck-view-${i}`:""}`,onAnimationEnd:T=>{O.current==="status"&&(O.current=null)},children:[t("header",{class:`${K?"inview":""} ${S==="loading"?"loading":""}`,onDblClick:T=>{v.reloadStatusPage++},children:t("div",{class:"header-grid header-grid-2",children:[t("h1",{children:[!!/\/s\//i.test((st=y.prevLocation)==null?void 0:st.pathname)&&t("button",{type:"button",class:"plain deck-back",onClick:()=>{history.back()},children:t(w,{icon:"chevron-left",size:"xl"})}),!K&&M&&S!=="loading"?t($,{children:[t("span",{class:"hero-heading",children:[t(Le,{account:M.account,instance:f,showAvatar:!0,short:!0})," ",t("span",{class:"insignificant",children:["•"," ",t(Ae,{datetime:M.createdAt,format:"micro"})]})]})," ",t("button",{type:"button",class:"ancestors-indicator light small",onClick:T=>{T.preventDefault(),T.stopPropagation(),R.current.scrollIntoView({behavior:"smooth",block:"start"})},title:"Go to main post",children:t(w,{icon:xt==="down"?"arrow-down":"arrow-up"})})]}):t($,{children:["Post"," ",t("button",{type:"button",class:"ancestors-indicator light small",onClick:T=>{T.preventDefault(),T.stopPropagation(),L.current.scrollTo({top:0,behavior:"smooth"})},hidden:!U.length||$t,title:`${U.length} posts above ‒ Go to top`,children:[t(w,{icon:"arrow-up"}),U.filter((T,_,C)=>C.findIndex(E=>E.accountID===T.accountID)===_).slice(0,3).map(T=>t(Ot,{url:T.account.avatar,alt:T.account.displayName},T.account.id)),U.length>3&&t($,{children:[" ",t("span",{class:"insignificant",children:Dt(U.length)})]})]})]})]}),t("div",{class:"header-side",children:[t(Ht,{align:"end",portal:{target:L.current},menuButton:t("button",{type:"button",class:"button plain4",children:t(w,{icon:"more",alt:"Actions",size:"xl"})}),children:[t(Z,{disabled:S==="loading",onClick:()=>{v.reloadStatusPage++},children:[t(w,{icon:"refresh"}),t("span",{children:"Refresh"})]}),t(Z,{className:"menu-switch-view",onClick:()=>{m(i==="full"?null:"full"),c.delete("media"),c.delete("media-only"),i==="full"?c.delete("view"):c.set("view","full"),o(c)},children:[t(w,{icon:{"":"layout5",full:"layout4"}[i||""]}),t("span",{children:["Switch to ",i==="full"?"Side Peek":"Full"," view"]})]}),t(Z,{onClick:()=>{Array.from(L.current.querySelectorAll("button.spoiler:not(.spoiling)")).forEach(_=>{_.click()})},children:[t(w,{icon:"eye-open"})," ",t("span",{children:"Show all sensitive content"})]}),t(At,{}),t(ls,{className:"plain",children:"Experimental"}),t(Z,{disabled:Ct,onClick:()=>{const T=Nn(M.url);T?location.hash=T:alert("Unable to switch")},children:[t(w,{icon:"transfer"}),t("small",{class:"menu-double-lines",children:["Switch to post's instance (",t("b",{children:Y}),")"]})]})]}),t(H,{class:"button plain deck-close",to:n,children:t(w,{icon:"x",size:"xl"})})]})]})}),g.length&&M?t("ul",{class:`timeline flat contextual grow ${S==="loading"?"loading":""}`,children:[g.slice(0,lt).map(T=>{const{id:_,ancestor:C,isThread:E,descendant:q,thread:W,replies:Q,repliesCount:it,weight:X}=T,et=_===e;return t("li",{ref:et?R:null,class:`${C?"ancestor":""} ${q?"descendant":""} ${W?"thread":""} ${et?"hero":""}`,children:[et?t($,{children:[t(Qt,{threshold:.1,onChange:ht,class:"status-focus",tabIndex:0,children:t(wt,{statusID:_,instance:f,withinContext:!0,size:"l",enableTranslate:!0,forceTranslate:a})}),S!=="loading"&&!h?t("div",{class:"post-status-banner",children:[t("p",{children:"You're not logged in. Interactions (reply, boost, etc) are not possible."}),t(H,{to:"/login",class:"button",children:"Log in"})]}):!b&&t("div",{class:"post-status-banner",children:[t("p",{children:["This post is from another instance (",t("b",{children:f}),"). Interactions (reply, boost, etc) are not possible."]}),t("button",{type:"button",disabled:S==="loading",onClick:()=>{I("loading"),(async()=>{try{const dt=await p.v2.search({q:M.url,type:"statuses",resolve:!0,limit:1});if(dt.statuses.length){const ut=dt.statuses[0];location.hash=r?`/${r}/s/${ut.id}`:`/s/${ut.id}`}else throw new Error("No results")}catch(dt){I("default"),alert("Error: "+dt)}})()},children:[t(w,{icon:"transfer"})," Switch to my instance to enable interactions"]})]})]}):t(H,{class:"status-link",to:f?`/${f}/s/${_}`:`/s/${_}`,onClick:()=>{xe(_)},children:[t(wt,{statusID:_,instance:f,withinContext:!0,size:W||C?"m":"s",enableTranslate:!0,onMediaClick:tt,onStatusLinkClick:G}),C&&E&&it>1&&t("div",{class:"replies-link",children:[t(w,{icon:"comment"})," ",t("span",{title:it,children:Dt(it)})]})," "]}),q&&(Q==null?void 0:Q.length)>0&&t(Pn,{instance:f,replies:Q,hasParentThread:W,level:1,accWeight:X,openAll:A.current<_i}),S==="loading"&&et&&!!(M!=null&&M.repliesCount)&&!nt&&t("div",{class:"status-loading",children:t(gt,{})}),S==="error"&&et&&!!(M!=null&&M.repliesCount)&&!nt&&t("div",{class:"status-error",children:["Unable to load replies.",t("br",{}),t("button",{type:"button",class:"plain",onClick:()=>{v.reloadStatusPage++},children:"Try again"})]})]},_)}),Lt>0&&t("li",{children:t("button",{type:"button",class:"plain block show-more",disabled:S==="loading",onClick:()=>Tt(T=>T+oe),style:{marginBlockEnd:"6em"},children:[t("div",{class:"ib",children:g.slice(lt,lt+5).map(T=>t(Ot,{url:T.account.avatarStatic},T.id))})," ",t("div",{class:"ib",children:["Show more…"," ",t("span",{class:"tag",children:Lt>oe?`${oe}+`:Lt})]})]})})]}):t($,{children:[S==="loading"&&t("ul",{class:"timeline flat contextual grow loading",children:t("li",{children:t(wt,{skeleton:!0,size:"l"})})}),S==="error"&&t("p",{class:"ui-state",children:["Unable to load post",t("br",{}),t("br",{}),t("button",{type:"button",onClick:()=>{v.reloadStatusPage++},children:"Try again"})]})]})]})}function Pn({replies:e,instance:n,hasParentThread:l,level:c,accWeight:o,openAll:s}){const[d,i]=Ut(),m=g=>g.reduce((k,S)=>{const{repliesCount:I,replies:R}=S,z=(R==null?void 0:R.length)||I;return k+z+m(R||[])},0),a=e.length+m(e),u=e.length===a,f=e.map(g=>g.account).filter((g,k,S)=>S.findIndex(I=>I.id===g.id)===k).slice(0,3),p=ft(()=>e==null?void 0:e.reduce((g,k)=>g+(k==null?void 0:k.weight),o),[o,e==null?void 0:e.length]);let r=!1;(s||p<=Fi||!l&&a===1&&Xt(e[0])<2)&&(r=!0);const h=Te[e[0].id],b=Kt((g,k,S,I)=>{g.preventDefault(),g.stopPropagation(),i({media:k+1,mediaStatusID:I.id})},[]),y=P();return Pt(()=>{var k;function g(S){S.target.dataset.scrollLeft=S.target.scrollLeft}return(k=y.current)==null||k.addEventListener("scroll",g,{passive:!0}),()=>{var S;(S=y.current)==null||S.removeEventListener("scroll",g)}},[]),t("details",{ref:y,class:"replies",open:h||r,onToggle:g=>{const{open:k}=g.target;Te[e[0].id]=k},style:{"--comments-level":c},"data-comments-level":c,"data-comments-level-overflow":c>4,children:[t("summary",{class:"replies-summary",hidden:r,children:[t("span",{class:"avatars",children:f.map(g=>t(Ot,{url:g.avatarStatic,title:`${g.displayName} @${g.username}`,squircle:g==null?void 0:g.bot},g.id))}),t("span",{children:[t("span",{title:e.length,children:Dt(e.length)})," ","repl",e.length===1?"y":"ies"]}),!u&&a>1&&t($,{children:[" ","·"," ",t("span",{children:[t("span",{title:a,children:Dt(a)})," ","comment",a===1?"":"s"]})]})]}),t("ul",{children:e.map(g=>{var k,S;return t("li",{children:[t(H,{class:"status-link",to:n?`/${n}/s/${g.id}`:`/s/${g.id}`,onClick:()=>{xe(g.id)},children:[t(wt,{statusID:g.id,instance:n,withinContext:!0,size:"s",enableTranslate:!0,onMediaClick:b}),!((k=g.replies)!=null&&k.length)&&g.repliesCount>0&&t("div",{class:"replies-link",children:[t(w,{icon:"comment"})," ",t("span",{title:g.repliesCount,children:Dt(g.repliesCount)})]})]}),((S=g.replies)==null?void 0:S.length)&&t(Pn,{instance:n,replies:g.replies,level:c+1,accWeight:r?p:g.weight,openAll:s})]},g.id)})})]})}const Oi=140,qi=35,Hi=70,Vi=140,$e=new Map;function Xt(e){var r,h;const n=$e.get(e.id);if(n)return n;const{spoilerText:l,content:c,mediaAttachments:o,poll:s,card:d}=e,i=Kn(l+c),m=o!=null&&o.length?Oi:0,a=(((r=s==null?void 0:s.options)==null?void 0:r.length)||0)*qi,u=d&&(o!=null&&o.length||(h=s==null?void 0:s.options)!=null&&h.length)?0:Hi,p=(i+m+a+u)/Vi;return $e.set(e.id,p),p}const ji=qt(zi);function Wi(){const e=Vt(),{id:n,instance:l}=e;return t(ji,{id:n,instance:l})}const Gi=""+new URL("boosts-carousel-c271525c.jpg",import.meta.url).href,Ki=""+new URL("grouped-notifications-3dcc5ef2.jpg",import.meta.url).href,Ji=""+new URL("multi-column-962e6b3c.jpg",import.meta.url).href,Yi=""+new URL("multi-hashtag-timeline-24789e5e.jpg",import.meta.url).href,Xi=""+new URL("nested-comments-thread-38ddecea.jpg",import.meta.url).href,Zi=""+new URL("logo-text-6cd2301b.svg",import.meta.url).href;function sn(){return St(null,["/","/welcome"]),t("main",{id:"welcome",children:[t("div",{class:"hero-container",children:[t("h1",{children:[t("img",{src:yn,alt:"",width:"200",height:"200",style:{aspectRatio:"1/1",marginBlockEnd:-16}}),t("img",{src:Zi,alt:"Phanpy",width:"250"})]}),t("p",{children:t("big",{children:t("b",{children:t(H,{to:"/login",class:"button",children:"Log in"})})})}),t("p",{class:"desc",children:"A minimalistic opinionated Mastodon web client."})]}),t("div",{id:"why-container",children:t("div",{class:"sections",children:[t("section",{children:[t("img",{src:Gi,alt:"Screenshot of Boosts Carousel",loading:"lazy"}),t("h4",{children:"Boosts Carousel"}),t("p",{children:"Visually separate original posts and re-shared posts (boosted posts)."})]}),t("section",{children:[t("img",{src:Xi,alt:"Screenshot of nested comments thread",loading:"lazy"}),t("h4",{children:"Nested comments thread"}),t("p",{children:"Effortlessly follow conversations. Semi-collapsible replies."})]}),t("section",{children:[t("img",{src:Ki,alt:"Screenshot of grouped notifications",loading:"lazy"}),t("h4",{children:"Grouped notifications"}),t("p",{children:"Similar notifications are grouped and collapsed to reduce clutter."})]}),t("section",{children:[t("img",{src:Ji,alt:"Screenshot of multi-column UI",loading:"lazy"}),t("h4",{children:"Single or multi-column"}),t("p",{children:"By default, single column for zen-mode seekers. Configurable multi-column for power users."})]}),t("section",{children:[t("img",{src:Yi,alt:"Screenshot of multi-hashtag timeline with a form to add more hashtags",loading:"lazy"}),t("h4",{children:"Multi-hashtag timeline"}),t("p",{children:"Up to 5 hashtags combined into a single timeline."})]})]})}),t("hr",{}),t("p",{children:[t("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",children:"Built"})," ","by"," ",t("a",{href:"https://mastodon.social/@cheeaun",target:"_blank",onClick:e=>{e.preventDefault(),v.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"}),"."," ",t("a",{href:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",target:"_blank",children:"Privacy Policy"}),"."]})]})}const Qi=window.alert;window.__nativeAlert||(window.__nativeAlert=Qi);window.alert=function(e){e instanceof Error&&(e!=null&&e.message)&&(e=e.message),typeof e!="string"&&(e=JSON.stringify(e));const n=ds({text:e,className:"alert",gravity:"top",position:"center",duration:1e4,offset:{y:48},onClick:()=>{n.hideToast()}});n.showToast()};window.__STATES__=v;setTimeout(()=>{var e,n,l,c;for(const o in ne)Array.isArray(ne[o])?(n=(e=ne[o])[0])==null||n.call(e):(c=(l=ne)[o])==null||c.call(l)},5e3);function to(){const e=at(v),[n,l]=x(!1),[c,o]=x("loading");Pt(()=>{const u=J.local.get("theme");u&&(document.documentElement.classList.add(`is-${u}`),document.querySelector('meta[name="color-scheme"]').setAttribute("content",u==="auto"?"dark light":u));const f=J.local.get("textSize");f&&document.documentElement.style.setProperty("--text-size",`${f}px`)},[]),F(()=>{const u=J.local.get("instanceURL"),f=decodeURIComponent((window.location.search.match(/code=([^&]+)/)||[,""])[1]);if(f){window.history.replaceState({},document.title,s.pathname||"/");const p=J.session.get("clientID"),r=J.session.get("clientSecret"),h=J.session.get("vapidKey");(async()=>{o("loading");const{access_token:b}=await Ni({instanceURL:u,client_id:p,client_secret:r,code:f}),y=Jn({instance:u,accessToken:b});await Promise.allSettled([Oe(y,u),Yn(y,u,b,h)]),Xn(),qe(y),l(!0),o("default")})()}else{const p=Gt();if(p){J.session.set("currentAccount",p.info.id);const{masto:r,instance:h}=B({account:p});qe(r),o("loading"),(async()=>{try{await Oe(r,h)}catch{}finally{l(!0),o("default")}})()}else o("default")}},[]);let s=Me();v.currentLocation=s.pathname,F(ve,[s,n]);const d=e.prevLocation,i=P(d||null);if(ft(()=>Zt("/:instance/s/:id",s.pathname)||Zt("/s/:id",s.pathname),[s.pathname,Zt])?i.current||(i.current=d):i.current=null,/\/https?:/.test(s.pathname))return t($i,{});const a=ft(()=>{const{pathname:u}=s;return!/^\/(login|welcome)/.test(u)},[s]);return F(()=>{var f;const u=document.getElementById("app");u&&(u.dataset.shortcutsViewMode=(f=e.shortcuts)!=null&&f.length?e.settings.shortcutsViewMode:"")},[e.shortcuts,e.settings.shortcutsViewMode]),F(()=>{document.body.classList.toggle("cloak",e.settings.cloakMode)},[e.settings.cloakMode]),t($,{children:[t(ge,{location:a||s,children:[t(pt,{path:"/",element:n?t(Ci,{}):c==="loading"?t(gt,{id:"loader-root"}):t(sn,{})}),t(pt,{path:"/login",element:t(Pi,{})}),t(pt,{path:"/welcome",element:t(sn,{})})]}),t(ge,{location:i.current||s,children:[n&&t(pt,{path:"/notifications",element:t(Dn,{})}),n&&t(pt,{path:"/mentions",element:t(Rn,{})}),n&&t(pt,{path:"/following",element:t(Pe,{})}),n&&t(pt,{path:"/b",element:t(xn,{})}),n&&t(pt,{path:"/f",element:t($n,{})}),n&&t(pt,{path:"/l",children:[t(pt,{index:!0,element:t(Li,{})}),t(pt,{path:":id",element:t(An,{})})]}),n&&t(pt,{path:"/ft",element:t(ei,{})}),t(pt,{path:"/:instance?/t/:hashtag",element:t(Ln,{})}),t(pt,{path:"/:instance?/a/:id",element:t(Xs,{})}),t(pt,{path:"/:instance?/p",children:[t(pt,{index:!0,element:t(Ce,{})}),t(pt,{path:"l",element:t(Ce,{local:!0})})]}),t(pt,{path:"/:instance?/trending",element:t(En,{})}),t(pt,{path:"/:instance?/search",element:t(Ui,{})})]}),c==="default"&&t(ge,{children:t(pt,{path:"/:instance?/s/:id",element:t(Wi,{})})}),n&&t(ps,{}),n&&!e.settings.shortcutsColumnsMode&&e.settings.shortcutsViewMode!=="multi-column"&&t(Vs,{}),t(Os,{}),t(qs,{}),t(fs,{isLoggedIn:n}),t(Hs,{onClose:ve}),t(ms,{})]})}us(t(hs,{children:t(to,{})}),document.getElementById("app"));setTimeout(()=>{try{Object.keys(localStorage).forEach(e=>{e.startsWith("iconify")&&localStorage.removeItem(e)}),Object.keys(sessionStorage).forEach(e=>{e.startsWith("iconify")&&sessionStorage.removeItem(e)}),localStorage.removeItem("settings:boostsCarousel")}catch{}},5e3);window.__CLOAK__=()=>{document.body.classList.toggle("cloak")};
//# sourceMappingURL=main-3b1dbd83.js.map
