import{a as B,s as k,b as Ie,u as yn,o as Qn,I as w,M as we,c as Z,A as Ge,N as vt,d as Ne,L as W,g as nt,e as wn,l as es,t as Yt,f as he,R as Tt,h as ts,p as st,i as Ue,j as vn,k as Et,E as kn,m as Pe,n as qe,q as ns,r as ve,v as Jt,T as Sn,w as ct,x as In,y as Xt,z as ss,B as Ae,C as is,S as Ce,D as os,F as cs,G as Tn,H as Cn,J as Ot,K as xe,O as $n,P as as,Q as rs,U as ls,V as ut,W as ds,X as Zt,Y as hs,Z as Qt,_ as en}from"./useTitle-6fc876ed.js";import{_ as R,p as z,x as Fe,h as C,c as kt,u as $e,o as e,a as pe,k as $,s as Ct,b as xn,M as Ke,d as ee,e as Ee,f as it,F as be,T as We,S as us,I as ot,y as ze,g as Ln,l as tn,i as An,j as Rn,m as fs,n as Be,A as ps,q as ms,J as gs,C as Mn,r as Ye,t as bs,v as ys,w as rt,z as Dn,B as nn,D as ws,E as vs,R as qt,G as ye,H as ks,K as Ss}from"./vendor-9f4c0ba7.js";function St(t=()=>{},n=[]){const c=R(t);z(()=>{c.current=t},[n]),z(()=>{const i=()=>{const s=document.hidden||document.visibilityState==="hidden";c.current(!s)};return document.addEventListener("visibilitychange",i),()=>document.removeEventListener("visibilitychange",i)},[])}const Is=Fe(function({isLoggedIn:n}){const[c,i]=C(!0);St(i);const s=R(),o=kt(()=>{const{masto:u,streaming:d,instance:f}=B();(async()=>{var p;if(k.notificationsLast){const g=u.v1.notifications.list({limit:1,since_id:k.notificationsLast.id}),{value:a}=await g.next();if(a!=null&&a.length){let m;try{const h=await u.v1.markers.fetch({timeline:"notifications"});m=(p=h==null?void 0:h.notifications)==null?void 0:p.lastReadId}catch{}m?k.notificationsShowNew=a[0].id!==m:k.notificationsShowNew=!0}}if(d){let g=s.current=d.user.notification.subscribe();for await(const a of g){if(!g)break;a.event==="notification"&&Ie(a.payload,f,{skipThreading:!0}),k.notificationsShowNew=!0}}})()},3e3);z(()=>(n&&c&&o(),()=>{var u,d,f;(u=o==null?void 0:o.cancel)==null||u.call(o),(f=(d=s.current)==null?void 0:d.unsubscribe)==null||f.call(d),s.current=null}),[c,n]);const l=R(),r=()=>{l.current=Date.now(),fetch("./version.json").then(u=>u.json()).then(u=>{u&&(k.appVersion=u)}).catch(u=>{})};return yn(r,c&&1e3*60*30),St(u=>{u&&(l.current?Date.now()-l.current>1e3*60*60&&r():r())}),null});function Ts(){function t(n){n.shiftKey?Qn()||(alert("Looks like your browser is blocking popups."),k.showCompose=!0):k.showCompose=!0}return $e("c, shift+c",t,{ignoreEventWhen:n=>!!document.querySelector("#modal-container > *")}),e("button",{type:"button",id:"compose-button",onClick:t,children:e(w,{icon:"quill",size:"xl",alt:"Compose"})})}const Cs=Fe(function(){const n=pe(k);function c(){k.showKeyboardShortcutsHelp=!1}$e("?, shift+?",s=>{k.showKeyboardShortcutsHelp=!0},{ignoreEventWhen:s=>!!document.querySelector("#modal-container > *")});const i=$e("esc",c,[]);return!!n.showKeyboardShortcutsHelp&&e(we,{class:"light",onClick:s=>{s.target===s.currentTarget&&c()},children:e("div",{id:"keyboard-shortcuts-help-container",class:"sheet",tabindex:"-1",ref:i,children:[e("button",{type:"button",class:"sheet-close",onClick:c,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Keyboard shortcuts"})}),e("main",{children:e("table",{children:[{action:"Keyboard shortcuts help",keys:e("kbd",{children:"?"})},{action:"Next post",keys:e("kbd",{children:"j"})},{action:"Previous post",keys:e("kbd",{children:"k"})},{action:"Skip carousel to next post",keys:e($,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"j"})]})},{action:"Skip carousel to previous post",keys:e($,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"k"})]})},{action:"Open post details",keys:e($,{children:[e("kbd",{children:"Enter"})," or ",e("kbd",{children:"o"})]})},{action:"Toggle expanded/collapsed thread",keys:e("kbd",{children:"x"})},{action:"Close post or dialogs",keys:e($,{children:[e("kbd",{children:"Esc"})," or ",e("kbd",{children:"Backspace"})]})},{action:"Focus column in multi-column mode",keys:e($,{children:[e("kbd",{children:"1"})," to ",e("kbd",{children:"9"})]})},{action:"Compose new post",keys:e("kbd",{children:"c"})},{action:"Send post",keys:e($,{children:[e("kbd",{children:"Ctrl"})," + ",e("kbd",{children:"Enter"})," or ",e("kbd",{children:"⌘"})," +"," ",e("kbd",{children:"Enter"})]})},{action:"Search",keys:e("kbd",{children:"/"})},{action:"Reply",keys:e("kbd",{children:"r"})},{action:"Like (favourite)",keys:e($,{children:[e("kbd",{children:"l"})," or ",e("kbd",{children:"f"})]})},{action:"Boost",keys:e($,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"b"})]})},{action:"Bookmark",keys:e("kbd",{children:"d"})}].map(({action:s,keys:o})=>e("tr",{children:[e("th",{children:s}),e("td",{children:o})]},s))})})]})})});function $s({onClose:t}){const{masto:n}=B(),c=Z.local.getJSON("accounts"),i=Z.session.get("currentAccount"),s=c.length>1,[o,l]=Ct(u=>u+1,0),[r]=xn();return e("div",{id:"accounts-container",class:"sheet",tabIndex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{class:"header-grid",children:e("h2",{children:"Accounts"})}),e("main",{children:e("section",{children:[e("ul",{class:"accounts-list",ref:r,children:c.map((u,d)=>{const f=u.info.id===i,p=d===0;return e("li",{children:[e("div",{children:[s&&e("span",{class:`current ${f?"is-current":""}`,children:e(w,{icon:"check-circle",alt:"Current"})}),e(Ge,{url:u.info.avatarStatic,size:"xxl",onDblClick:async()=>{if(f)try{const g=await n.v1.accounts.$select(u.info.id).fetch();u.info=g,Z.local.setJSON("accounts",c),l()}catch{}}}),e(vt,{account:s?{...u.info,acct:/@/.test(u.info.acct)?u.info.acct:`${u.info.acct}@${u.instanceURL}`}:u.info,showAcct:!0,onClick:()=>{f?k.showAccount=`${u.info.username}@${u.instanceURL}`:(Z.session.set("currentAccount",u.info.id),location.reload())}})]}),e("div",{class:"actions",children:[p&&s&&e($,{children:[e("span",{class:"tag",children:"Default"})," "]}),e(Ke,{align:"end",menuButton:e("button",{type:"button",title:"More",class:"plain more-button",children:e(w,{icon:"more",size:"l",alt:"More"})}),children:[e(ee,{onClick:()=>{k.showAccount=`${u.info.username}@${u.instanceURL}`},children:[e(w,{icon:"user"}),e("span",{children:"View profile…"})]}),e(Ee,{}),s&&e(ee,{disabled:p,onClick:()=>{c.splice(d,1),c.unshift(u),Z.local.setJSON("accounts",c),l()},children:[e(w,{icon:"check-circle"}),e("span",{children:"Set as default"})]}),e(Ne,{subMenu:!0,confirmLabel:e($,{children:[e(w,{icon:"exit"}),e("span",{children:["Log out @",u.info.acct,"?"]})]}),disabled:!f,menuItemClassName:"danger",onClick:()=>{c.splice(d,1),Z.local.setJSON("accounts",c),location.href=location.pathname||"/"},children:[e(w,{icon:"exit"}),e("span",{children:"Log out…"})]})]})]})]},u.info.id)})}),e("p",{children:e(W,{to:"/login",class:"button plain2",onClick:t,children:[e(w,{icon:"plus"})," ",e("span",{children:"Add an existing account"})]})}),s&&e("p",{children:e("small",{children:["Note: ",e("i",{children:"Default"})," account will always be used for first load. Switched accounts will persist during the session."]})})]})})]})}const En=""+new URL("logo-f0531a6b.svg",import.meta.url).href;function sn(t){const{masto:n}=B();return n.v1.push.subscription.create(t)}function xs(){const{masto:t}=B();return t.v1.push.subscription.fetch()}function Ls(t){const{masto:n}=B();return n.v1.push.subscription.update(t)}function As(){const{masto:t}=B();return t.v1.push.subscription.remove()}function $t(){return"serviceWorker"in navigator&&"PushManager"in window}function Rs(){return navigator.serviceWorker.getRegistration()}async function Ht(){const t=await Rs(),n=t?await t.pushManager.getSubscription():void 0;return{registration:t,subscription:n}}function _n(t){const n="=".repeat((4-t.length%4)%4),c=`${t}${n}`.replace(/-/g,"+").replace(/_/g,"/"),i=window.atob(c),s=new Uint8Array(i.length);for(let o=0;o<i.length;++o)s[o]=i.charCodeAt(o);return s}async function Ms(){if(!$t())return;const{subscription:t}=await Ht();let n=null;try{n=await xs()}catch(c){if(!/(not found|unknown)/i.test(c.message))throw c}if(n&&t){const c=n.endpoint===t.endpoint,{vapidKey:i}=nt(),s=n.serverKey===i;if(!c)throw new Error("Backend subscription endpoint changed");if(!s)throw new Error("Backend subscription key and vapid key changed")}if(t&&!n){const{vapidKey:c}=nt(),{applicationServerKey:i}=t.options,s=_n(c).toString(),o=new Uint8Array(i).toString();if(!(s===o))throw await t.unsubscribe(),new Error("Subscription key and vapid key changed")}return{subscription:t,backendSubscription:n}}async function on({data:t,policy:n}){if(!$t())return;let{registration:c,subscription:i}=await Ht(),s=null;if(i)try{s=await Ls({data:t,policy:n})}catch{s=await sn({subscription:i,data:t,policy:n})}else{const{vapidKey:o}=nt();if(!o)throw new Error("No server key found");i=await c.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:_n(o)}),s=await sn({subscription:i,data:t,policy:n})}return{subscription:i,backendSubscription:s}}async function cn(){if(!$t())return;const{subscription:t}=await Ht();t&&(await As(),await t.unsubscribe())}const an=16,je=[16,17,18,19,20];function Ds({onClose:t}){const n=pe(k),c=Z.local.get("theme")||"auto",i=R(),s=n.settings.contentTranslationTargetLanguage||null,o=wn(),l=es(o),r=Z.local.get("textSize")||an,[u,d]=C(Z.account.get("preferences")||{}),{masto:f,authenticated:p,instance:g}=B();return e("div",{id:"settings-container",class:"sheet",tabIndex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Settings"})}),e("main",{children:[e("section",{children:e("ul",{children:[e("li",{children:[e("div",{children:e("label",{children:"Appearance"})}),e("div",{children:e("form",{ref:i,onInput:a=>{a.preventDefault();const h=new FormData(i.current).get("theme"),b=document.documentElement;h==="auto"?b.classList.remove("is-light","is-dark"):(b.classList.toggle("is-light",h==="light"),b.classList.toggle("is-dark",h==="dark")),document.querySelector('meta[name="color-scheme"]').setAttribute("content",h==="auto"?"dark light":h),h==="auto"?Z.local.del("theme"):Z.local.set("theme",h)},children:e("div",{class:"radio-group",children:[e("label",{children:[e("input",{type:"radio",name:"theme",value:"light",defaultChecked:c==="light"}),e("span",{children:"Light"})]}),e("label",{children:[e("input",{type:"radio",name:"theme",value:"dark",defaultChecked:c==="dark"}),e("span",{children:"Dark"})]}),e("label",{children:[e("input",{type:"radio",name:"theme",value:"auto",defaultChecked:c!=="light"&&c!=="dark"}),e("span",{children:"Auto"})]})]})})})]}),e("li",{children:[e("div",{children:e("label",{children:"Text size"})}),e("div",{class:"range-group",children:[e("span",{style:{fontSize:je[0]},children:"A"})," ",e("input",{type:"range",min:je[0],max:je[je.length-1],step:"1",value:r,list:"sizes",onChange:a=>{const m=parseInt(a.target.value,10);document.documentElement.style.setProperty("--text-size",`${m}px`),m===an?Z.local.del("textSize"):Z.local.set("textSize",a.target.value)}})," ",e("span",{style:{fontSize:je[je.length-1]},children:"A"}),e("datalist",{id:"sizes",children:je.map(a=>e("option",{value:a}))})]})]})]})}),p&&e($,{children:[e("h3",{children:"Posting"}),e("section",{children:e("ul",{children:e("li",{children:[e("div",{children:e("label",{for:"posting-privacy-field",children:["Default visibility"," ",e(w,{icon:"cloud",alt:"Synced",class:"synced-icon"})]})}),e("div",{children:e("select",{id:"posting-privacy-field",value:u["posting:default:visibility"]||"public",onChange:a=>{const{value:m}=a.target;(async()=>{try{await f.v1.accounts.updateCredentials({source:{privacy:m}}),d({...u,"posting:default:visibility":m}),Z.account.set("preferences",{...u,"posting:default:visibility":m})}catch{alert("Failed to update posting privacy")}})()},children:[e("option",{value:"public",children:"Public"}),e("option",{value:"unlisted",children:"Unlisted"}),e("option",{value:"private",children:"Followers only"})]})})]})})}),e("p",{class:"section-postnote",children:[e(w,{icon:"cloud",alt:"Synced",class:"synced-icon"})," ",e("small",{children:["Synced to your instance server's settings."," ",e("a",{href:`https://${g}/`,target:"_blank",rel:"noopener noreferrer",children:["Go to your instance (",g,") for more settings."]})]})]})]}),e("h3",{children:"Experiments"}),e("section",{children:e("ul",{children:[e("li",{children:e("label",{children:[e("input",{type:"checkbox",checked:n.settings.autoRefresh,onChange:a=>{k.settings.autoRefresh=a.target.checked}})," ","Auto refresh timeline posts"]})}),e("li",{children:e("label",{children:[e("input",{type:"checkbox",checked:n.settings.boostsCarousel,onChange:a=>{k.settings.boostsCarousel=a.target.checked}})," ","Boosts carousel"]})}),e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslation,onChange:a=>{const{checked:m}=a.target;k.settings.contentTranslation=m,m||(k.settings.contentTranslationTargetLanguage=null)}})," ","Post translation"]}),e("div",{class:`sub-section ${n.settings.contentTranslation?"":"more-insignificant"}`,children:[e("div",{children:e("label",{children:["Translate to"," ",e("select",{value:s||"",disabled:!n.settings.contentTranslation,onChange:a=>{k.settings.contentTranslationTargetLanguage=a.target.value||null},children:[e("option",{value:"",children:["System language (",l,")"]}),e("option",{disabled:!0,children:"──────────"}),Yt.map(a=>e("option",{value:a.code,children:a.name}))]})]})}),e("hr",{}),e("p",{class:"checkbox-fieldset",children:['Hide "Translate" button for',n.settings.contentTranslationHideLanguages.length>0&&e($,{children:[" ","(",n.settings.contentTranslationHideLanguages.length,")"]}),":",e("div",{class:"checkbox-fields",children:Yt.map(a=>e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslationHideLanguages.includes(a.code),onChange:m=>{const{checked:h}=m.target;h?k.settings.contentTranslationHideLanguages.push(a.code):k.settings.contentTranslationHideLanguages=n.settings.contentTranslationHideLanguages.filter(b=>b!==a.code)}})," ",a.name]}))})]}),e("p",{class:"insignificant",children:e("small",{children:["Note: This feature uses an external API to translate, powered by"," ",e("a",{href:"https://github.com/thedaviddelta/lingva-translate",target:"_blank",rel:"noopener noreferrer",children:"Lingva Translate"}),"."]})}),e("hr",{}),e("div",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslationAutoInline,disabled:!n.settings.contentTranslation,onChange:a=>{k.settings.contentTranslationAutoInline=a.target.checked}})," ","Auto inline translation"]}),e("p",{class:"insignificant",children:e("small",{children:["Automatically show translation for posts in timeline. Only works for ",e("b",{children:"short"})," posts without content warning, media and poll."]})})]})]})]}),e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.cloakMode,onChange:a=>{k.settings.cloakMode=a.target.checked}})," ","Cloak mode"," ",e("span",{class:"insignificant",children:["(",e("samp",{children:"Text"})," → ",e("samp",{children:"████"}),")"]})]}),e("div",{class:"sub-section insignificant",children:e("small",{children:"Replace text as blocks, useful when taking screenshots, for privacy reasons."})})]}),p&&e("li",{children:e("button",{type:"button",class:"light",onClick:()=>{k.showDrafts=!0,k.showSettings=!1},children:"Unsent drafts"})})]})}),p&&e(Es,{onClose:t}),e("h3",{children:"About"}),e("section",{children:[e("div",{style:{display:"flex",gap:8,lineHeight:1.25,alignItems:"center",marginTop:8},children:[e("img",{src:En,alt:"",width:"64",height:"64",style:{aspectRatio:"1/1",verticalAlign:"middle",background:"#b7cdf9",borderRadius:12}}),e("div",{children:[e("b",{children:"Phanpy"})," ",e("a",{href:"https://hachyderm.io/@phanpy",rel:"noopener noreferrer",onClick:a=>{a.preventDefault(),k.showAccount="phanpy@hachyderm.io"},children:"@phanpy"}),e("br",{}),e("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",rel:"noopener noreferrer",children:"Built"})," ","by"," ",e("a",{href:"https://mastodon.social/@cheeaun",rel:"noopener noreferrer",onClick:a=>{a.preventDefault(),k.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"})]})]}),e("p",{children:[e("a",{href:"https://github.com/sponsors/cheeaun",target:"_blank",rel:"noopener noreferrer",children:"Sponsor"})," ","·"," ",e("a",{href:"https://www.buymeacoffee.com/cheeaun",target:"_blank",rel:"noopener noreferrer",children:"Donate"})," ","·"," ",e("a",{href:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",target:"_blank",rel:"noopener noreferrer",children:"Privacy Policy"})]}),e("p",{children:["Version:"," ",e("input",{type:"text",class:"version-string",readOnly:!0,size:"18",value:`${"2023-10-27T09:54:00.188Z".slice(0,10).replace(/-/g,".")}.12d0e6a`,onClick:a=>{a.target.select();try{navigator.clipboard.writeText(a.target.value),he("Version string copied")}catch{he("Unable to copy version string")}}})," ",e("span",{class:"ib insignificant",children:["(",e("a",{href:"https://github.com/cheeaun/phanpy/commit/12d0e6a",target:"_blank",rel:"noopener noreferrer",children:e(Tt,{datetime:new Date("2023-10-27T09:54:00.188Z")})}),")"]})]})]})]})]})}function Es({onClose:t}){if(!$t())return null;const{instance:n}=B(),[c,i]=C("default"),s=R(),[o,l]=C(!1),[r,u]=C(!1),d=R();z(()=>{(async()=>{i("loading");try{const{subscription:p,backendSubscription:g}=await Ms();if(g!=null&&g.policy&&g.policy!=="none"){l(!0);const{alerts:a,policy:m}=g;d.current=m;const{elements:h}=s.current,b=h.namedItem(m);b&&(b.value=m),Object.keys(a).forEach(y=>{const v=h.namedItem(y);(v==null?void 0:v.type)==="checkbox"&&(v.checked=!0)})}i("default")}catch(p){/outside.*authorized/i.test(p.message)?u(!0):alert((p==null?void 0:p.message)||p),i("error")}})()},[]);const f=c==="loading";return e("form",{ref:s,onChange:()=>{const p=Object.fromEntries(new FormData(s.current)),g=!!p["policy-allow"],a={policy:p.policy,data:{alerts:{mention:!!p.mention,favourite:!!p.favourite,reblog:!!p.reblog,follow:!!p.follow,follow_request:!!p.followRequest,poll:!!p.poll,update:!!p.update,status:!!p.status}}};let m=0;Object.keys(a.data.alerts).forEach(b=>{a.data.alerts[b]?m++:delete a.data.alerts[b]});const h=d.current!==a.policy;g&&m>0?h?cn().then(()=>{on(a)}).catch(b=>{alert("Failed to update subscription. Please try again.")}):on(a).catch(b=>{alert("Failed to update subscription. Please try again.")}):cn().catch(b=>{alert("Failed to remove subscription. Please try again.")})},children:[e("h3",{children:"Push Notifications (beta)"}),e("section",{children:e("ul",{children:e("li",{children:[e("label",{children:[e("input",{type:"checkbox",disabled:f||r,name:"policy-allow",checked:o,onChange:async p=>{const{checked:g}=p.target;if(g){const a=await Notification.requestPermission();a==="granted"?l(!0):(l(!1),a==="denied"&&alert("Push notifications are blocked. Please enable them in your browser settings."))}else l(!1)}})," ","Allow from"," ",e("select",{name:"policy",disabled:f||r||!o,children:[{value:"all",label:"anyone"},{value:"followed",label:"people I follow"},{value:"follower",label:"followers"}].map(p=>e("option",{value:p.value,children:p.label}))})]}),e("div",{class:"shazam-container no-animation",style:{width:"100%"},hidden:!o,children:e("div",{class:"shazam-container-inner",children:e("div",{class:"sub-section",children:e("ul",{children:[{value:"mention",label:"Mentions"},{value:"favourite",label:"Likes"},{value:"reblog",label:"Boosts"},{value:"follow",label:"Follows"},{value:"followRequest",label:"Follow requests"},{value:"poll",label:"Polls"},{value:"update",label:"Post edits"},{value:"status",label:"New posts"}].map(p=>e("li",{children:e("label",{children:[e("input",{type:"checkbox",name:p.value})," ",p.label]})}))})})})}),r&&e("div",{class:"sub-section",children:e("p",{children:["Push permission was not granted since your last login. You'll need to"," ",e(W,{to:`/login?instance=${n}`,onClick:t,children:[e("b",{children:"log in"})," again to grant push permission"]}),"."]})})]})})}),e("p",{class:"section-postnote",children:e("small",{children:["NOTE: Push notifications only work for ",e("b",{children:"one account"}),"."]})})]})}const _t=()=>{let t=setTimeout(()=>{if(!document.getElementById("columns")){const c=document.querySelectorAll("#modal-container > *");if(c!=null&&c.length){const l=c[c.length-1],r=l.querySelector('[tabindex="-1"]')||l;if(r){r.focus();return}}if(document.querySelector(".deck-backdrop"))return;const s=document.querySelectorAll(".deck-container"),o=s[s.length-1];o&&o.tabIndex===-1&&o.focus()}},100);return()=>clearTimeout(t)};function Pn(t){if(!t)return;const n=it(),c=R(n.pathname);z(()=>{c.current&&n.pathname!==c.current&&(t==null||t())},[n.pathname,t])}function Vt({list:t,onClose:n}){const{masto:c}=B(),[i,s]=C("default"),o=!!t,l=R(),r=R(),u=R();z(()=>{o&&(l.current.value=t.title,r.current.value=t.repliesPolicy,u.current&&(u.current.checked=t.exclusive))},[o]);const d=ts("@mastodon/list-exclusive");return e("div",{class:"sheet",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})})," ",e("header",{children:e("h2",{children:o?"Edit list":"New list"})}),e("main",{children:e("form",{class:"list-form",onSubmit:f=>{f.preventDefault();const p=new FormData(f.target),g=p.get("title"),a=p.get("replies_policy"),m=p.get("exclusive")==="on";s("loading"),(async()=>{try{let h;o?h=await c.v1.lists.$select(t.id).update({title:g,replies_policy:a,exclusive:m}):h=await c.v1.lists.create({title:g,replies_policy:a,exclusive:m}),s("default"),n==null||n({state:"success",list:h})}catch{s("error"),alert(o?"Unable to edit list.":"Unable to create list.")}})()},children:[e("div",{class:"list-form-row",children:e("label",{for:"list-title",children:["Name"," ",e("input",{ref:l,type:"text",id:"list-title",name:"title",required:!0,disabled:i==="loading",dir:"auto"})]})}),e("div",{class:"list-form-row",children:e("select",{ref:r,name:"replies_policy",required:!0,disabled:i==="loading",children:[e("option",{value:"list",children:"Show replies to list members"}),e("option",{value:"followed",children:"Show replies to people I follow"}),e("option",{value:"none",children:"Don't show replies"})]})}),d&&e("div",{class:"list-form-row",children:e("label",{class:"label-block",children:[e("input",{ref:u,type:"checkbox",name:"exclusive",disabled:i==="loading"})," ","Hide posts on this list from Home/Following"]})}),e("div",{class:"list-form-footer",children:[e("button",{type:"submit",disabled:i==="loading",children:o?"Save":"Create"}),o&&e(Ne,{disabled:i==="loading",align:"end",menuItemClassName:"danger",confirmLabel:"Delete this list?",onClick:()=>{s("loading"),(async()=>{try{await c.v1.lists.$select(t.id).remove(),s("default"),n==null||n({state:"deleted"})}catch{s("error"),alert("Unable to delete list.")}})()},children:e("button",{type:"button",class:"light danger",disabled:i==="loading",children:"Delete…"})})]})]})})]})}const _s=[1e3*60*5,1e3*60*30,1e3*60*60,1e3*60*60*6,1e3*60*60*24,1e3*60*60*24*3,1e3*60*60*24*7,0],rn={0:"Forever",3e5:"5 minutes",18e5:"30 minutes",36e5:"1 hour",216e5:"6 hours",864e5:"1 day",2592e5:"3 days",6048e5:"1 week"},ln=80,Nn=1e3*60*10;function Ps(t,n){return n.v1.accounts.familiarFollowers.fetch({id:[t]})}const Ns=st(Ps,{maxAge:Nn});async function Us(t,n){const c=n.v1.accounts.$select(t).statuses.list({limit:20}).next(),{value:i}=await c,s={total:i.length,originals:0,replies:0,boosts:0};return i.forEach(o=>{o.reblog?s.boosts++:o.inReplyToId&&o.inReplyToAccountId!==o.account.id?s.replies++:s.originals++}),i.length&&(s.daysSinceLastPost=Math.ceil((Date.now()-new Date(i[i.length-1].createdAt))/864e5)),s}const zs=st(Us,{maxAge:Nn});function Un({account:t,fetchAccount:n=()=>{},standalone:c,instance:i,authenticated:s}){const{masto:o}=B({instance:i}),{masto:l}=B(),[r,u]=C("default"),d=typeof t=="string",[f,p]=C(d?null:t),g=be(()=>t.id===Z.session.get("currentAccount"),[t==null?void 0:t.id]),a=be(()=>i===B().instance,[i]);z(()=>{if(!d){p(t);return}u("loading"),(async()=>{try{const U=await n();k.accounts[`${U.id}@${i}`]=U,p(U),u("default")}catch{p(null),u("error")}})()},[d,t,n]);const{acct:m,avatar:h,avatarStatic:b,bot:y,createdAt:v,displayName:I,emojis:S,fields:x,followersCount:M,followingCount:L,group:F,id:P,lastStatusAt:N,locked:H,note:A,statusesCount:ie,url:ce,username:Le,memorial:K,moved:te,roles:j}=f||{};let D=!1,{header:G,headerStatic:Q}=f||{};(!G||/missing\.png$/.test(G))&&h&&!/missing\.png$/.test(h)&&(G=h,D=!0,b&&!/missing\.png$/.test(b)&&(Q=b));const ue=be(()=>ce?new URL(ce).hostname:null,[ce]),[ke,Re]=C([]),ae=R(),q=R([]);async function Y(U){(U||!ae.current)&&(ae.current=o.v1.accounts.$select(P).followers.list({limit:ln}));const le=await ae.current.next();if(g||!a)return le;const{value:fe}=le;let me=[];if(U){const Je=await o.v1.accounts.familiarFollowers.fetch({id:[P]});q.current=Je[0].accounts,me=[...q.current,...fe.filter(_e=>!q.current.some(De=>De.id===_e.id))]}else fe!=null&&fe.length&&(me=fe.filter(Je=>!q.current.some(_e=>_e.id===Je.id)));return{...le,value:me}}const J=R();async function oe(U){return(U||!J.current)&&(J.current=o.v1.accounts.$select(P).following.list({limit:ln})),await J.current.next()}const ne=c?"div":W,O=i?`/${i}/a/${P}`:`/a/${P}`,[T,_]=C([]),[E,X]=C(),[de,re]=C("default"),se=!!(E!=null&&E.total),Te=async U=>{try{const le=await Ns(U,l);_(le[0].accounts.slice(0,Fs))}catch{}},Me=async()=>{if(P){re("loading");try{const U=await zs(P,o);X(U),re("default")}catch{re("error")}}},Se=We(({relationship:U,currentID:le})=>{U.following||(Te(le),c||Me())},[c,P]);return e("div",{tabIndex:"-1",class:`account-container  ${r==="loading"?"skeleton":""}`,style:{"--header-color-1":ke[0],"--header-color-2":ke[1],"--header-color-3":ke[2],"--header-color-4":ke[3]},children:[r==="error"&&e("div",{class:"ui-state",children:[e("p",{children:"Unable to load account."}),e("p",{children:e("a",{href:d?t:ce,target:"_blank",rel:"noopener noreferrer",children:["Go to account page ",e(w,{icon:"external"})]})})]}),r==="loading"?e($,{children:[e("header",{children:e(Ue,{avatarSize:"xxxl",skeleton:!0})}),e("main",{children:[e("div",{class:"note",children:[e("p",{children:"███████ ████ ████"}),e("p",{children:"████ ████████ ██████ █████████ ████ ██"})]}),e("div",{class:"account-metadata-box",children:[e("div",{class:"profile-metadata",children:[e("div",{class:"profile-field",children:[e("b",{class:"more-insignificant",children:"███"}),e("p",{children:"██████"})]}),e("div",{class:"profile-field",children:[e("b",{class:"more-insignificant",children:"████"}),e("p",{children:"███████████"})]})]}),e("div",{class:"stats",children:[e("div",{children:[e("span",{children:"██"})," Followers"]}),e("div",{children:[e("span",{children:"██"})," Following"]}),e("div",{children:[e("span",{children:"██"})," Posts"]})]})]}),e("div",{class:"actions",children:[e("span",{}),e("span",{class:"buttons",children:e("button",{type:"button",title:"More",class:"plain",disabled:!0,children:e(w,{icon:"more",size:"l",alt:"More"})})})]})]})]}):f&&e($,{children:[!!te&&e("div",{class:"account-moved",children:[e("p",{children:[e("b",{children:I})," has indicated that their new account is now:"]}),e(Ue,{account:te,instance:i,onClick:U=>{U.stopPropagation(),k.showAccount=te}})]}),!!G&&!/missing\.png$/.test(G)&&e("img",{src:G,alt:"",class:`header-banner ${D?"header-is-avatar":""}`,onError:U=>{U.target.crossOrigin?U.target.src!==Q?U.target.src=Q:(U.target.removeAttribute("crossorigin"),U.target.src=G):U.target.src!==Q?U.target.src=Q:U.target.remove()},crossOrigin:"anonymous",onLoad:U=>{U.target.classList.add("loaded");try{const le=document.createElement("canvas"),fe=le.getContext("2d",{willReadFrequently:!0});le.width=U.target.width,le.height=U.target.height,fe.drawImage(U.target,0,0);const me=10,_e=[fe.getImageData(0,0,me,me).data,fe.getImageData(U.target.width-me,0,me,me).data,fe.getImageData(0,U.target.height-me,me,me).data,fe.getImageData(U.target.width-me,U.target.height-me,me,me).data].map(De=>{let Ve=0,V=0,ge=0,Xe=0;for(let Ze=0;Ze<De.length;Ze+=4)Ve+=De[Ze],V+=De[Ze+1],ge+=De[Ze+2],Xe+=De[Ze+3];const ht=De.length/4;return[Ve/ht,V/ht,ge/ht,Xe/ht]}).map(De=>{const[Ve,V,ge,Xe]=Os(De);return`rgba(${Ve}, ${V}, ${ge}, ${Xe})`});Re(_e)}catch{}}}),e("header",{children:e(Ue,{account:f,instance:i,avatarSize:"xxxl",external:c,internal:!c})}),e("div",{class:"faux-header-bg","aria-hidden":"true"}),e("main",{children:[!!K&&e("span",{class:"tag",children:"In Memoriam"}),!!y&&e("span",{class:"tag",children:[e(w,{icon:"bot"})," Automated"]}),!!F&&e("span",{class:"tag",children:[e(w,{icon:"group"})," Group"]}),j==null?void 0:j.map(U=>e("span",{class:"tag",children:[U.name,!!ue&&e($,{children:[" ",e("span",{class:"more-insignificant",children:ue})]})]})),e("div",{class:"note",dir:"auto",onClick:vn({instance:i}),dangerouslySetInnerHTML:{__html:Et(A,{emojis:S})}}),e("div",{class:"account-metadata-box",children:[(x==null?void 0:x.length)>0&&e("div",{class:"profile-metadata",children:x.map(({name:U,value:le,verifiedAt:fe},me)=>e("div",{class:`profile-field ${fe?"profile-verified":""}`,dir:"auto",children:[e("b",{children:[e(kn,{text:U,emojis:S})," ",!!fe&&e(w,{icon:"check-circle",size:"s"})]}),e("p",{dangerouslySetInnerHTML:{__html:Et(le,{emojis:S})}})]},U+me))}),e("div",{class:"stats",children:[e(ne,{tabIndex:0,to:O,onClick:()=>{setTimeout(()=>{k.showGenericAccounts={heading:"Followers",fetchAccounts:Y}},0)},children:[!!T.length&&e("span",{class:"shazam-container-horizontal",children:e("span",{class:"shazam-container-inner stats-avatars-bunch",children:T.map(U=>e(Ge,{url:U.avatarStatic,size:"s",alt:`${U.displayName} @${U.acct}`,squircle:U==null?void 0:U.bot}))})}),e("span",{title:M,children:Pe(M)})," ","Followers"]}),e(ne,{class:"insignificant",tabIndex:0,to:O,onClick:()=>{setTimeout(()=>{k.showGenericAccounts={heading:"Following",fetchAccounts:oe}},0)},children:[e("span",{title:L,children:Pe(L)})," ","Following",e("br",{})]}),e(ne,{class:"insignificant",to:O,children:[e("span",{title:ie,children:Pe(ie)})," ","Posts"]}),!!v&&e("div",{class:"insignificant",children:["Joined"," ",e("time",{datetime:v,children:qe(v,{hideTime:!0})})]})]})]}),!!E&&e(ne,{to:O,class:"account-metadata-box",children:e("div",{class:"shazam-container",children:e("div",{class:"shazam-container-inner",children:se?e("div",{class:"posting-stats",title:`${Math.round(E.originals/E.total*100)}% original posts, ${Math.round(E.replies/E.total*100)}% replies, ${Math.round(E.boosts/E.total*100)}% boosts`,children:[e("div",{children:E.daysSinceLastPost<365?`Last ${E.total} post${E.total>1?"s":""} in the past 
                      ${E.daysSinceLastPost} day${E.daysSinceLastPost>1?"s":""}`:`
                      Last ${E.total} posts in the past year(s)
                      `}),e("div",{class:"posting-stats-bar",style:{"--originals-percentage":`${E.originals/E.total*100}%`,"--replies-percentage":`${(E.originals+E.replies)/E.total*100}%`}}),e("div",{class:"posting-stats-legends",children:[e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-originals"})," ","Original"]})," ",e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-replies"})," ","Replies"]})," ",e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-boosts"})," ","Boosts"]})]})]}):e("div",{class:"posting-stats",children:"Post stats unavailable."})})})}),e("div",{class:"account-metadata-box",children:e("div",{class:"shazam-container no-animation",hidden:!!E,children:e("div",{class:"shazam-container-inner",children:e("button",{type:"button",class:"posting-stats-button",disabled:de==="loading",onClick:()=>{Me()},children:[e("div",{class:`posting-stats-bar posting-stats-icon ${de==="loading"?"loading":""}`,style:{"--originals-percentage":"33%","--replies-percentage":"66%"}}),"View post stats"," "]})})})})]}),e("footer",{children:e(Bs,{info:f,instance:i,authenticated:s,onRelationshipChange:Se})})]})]})}const Fs=3;function Bs({info:t,instance:n,authenticated:c,onRelationshipChange:i=()=>{}}){var ne;if(!t)return null;const{masto:s,instance:o,authenticated:l}=B(),r=n===o,[u,d]=C("default"),[f,p]=C(null),{id:g,acct:a,url:m,username:h,locked:b,lastStatusAt:y,note:v,fields:I,moved:S}=t,x=R(g),{following:M,showingReblogs:L,notifying:F,followedBy:P,blocking:N,blockedBy:H,muting:A,mutingNotifications:ie,requested:ce,domainBlocking:Le,endorsed:K,note:te}=f||{},[j,D]=C(null),[G,Q]=C(!1);z(()=>{if(t){const O=Z.session.get("currentAccount");let T;(async()=>{if(r&&c)T=g;else if(!r&&l){const E=t.acct.includes("@");try{const X=await s.v2.search.fetch({q:E?t.acct:`${t.username}@${n}`,type:"accounts",limit:1,resolve:!0});X.accounts.length&&(T=X.accounts[0].id,D(X.accounts[0]))}catch{}}if(!T)return;if(O===T){Q(!0);return}if(x.current=T,S)return;d("loading");const _=s.v1.accounts.relationships.fetch({id:[T]});try{const E=await _;if(d("default"),E.length){const X=E[0];p(X),i({relationship:X,currentID:T})}}catch{d("error")}})()}},[t,c]),z(()=>{t&&G&&ns(t)},[t,G]);const ue=u==="loading",ke=R(null),[Re,ae]=C(!1),[q,Y]=C(!1),[J,oe]=C(!1);return e($,{children:[e("div",{class:"actions",children:[e("span",{children:[P?e("span",{class:"tag",children:"Following you"}):y?e("small",{class:"insignificant",children:["Last post:"," ",e("span",{class:"ib",children:qe(y,{hideTime:!0})})]}):e("span",{}),A&&e("span",{class:"tag danger",children:"Muted"}),N&&e("span",{class:"tag danger",children:"Blocked"})]})," ",e("span",{class:"buttons",children:[!!te&&e("button",{type:"button",class:"private-note-tag",title:"Private note",onClick:()=>{oe(!0)},dir:"auto",children:e("span",{children:te})}),e(Ke,{instanceRef:ke,portal:{target:document.body},containerProps:{style:{zIndex:1001},onClick:O=>{var T,_;O.target===O.currentTarget&&((_=(T=ke.current)==null?void 0:T.closeMenu)==null||_.call(T))}},align:"center",position:"anchor",overflow:"auto",boundingBoxPadding:"8 8 8 8",menuButton:e("button",{type:"button",title:"More",class:"plain",disabled:ue,children:e(w,{icon:"more",size:"l",alt:"More"})}),children:[l&&!G&&e($,{children:[e(ee,{onClick:()=>{k.showCompose={draftStatus:{status:`@${(j==null?void 0:j.acct)||a} `}}},children:[e(w,{icon:"at"}),e("span",{children:["Mention @",h]})]}),e(ee,{onClick:()=>{ae(!0)},children:[e(w,{icon:"translate"}),e("span",{children:"Translate bio"})]}),e(ee,{onClick:()=>{oe(!0)},children:[e(w,{icon:"pencil"}),e("span",{children:te?"Edit private note":"Add private note"})]}),M&&e(ee,{onClick:()=>{Y(!0)},children:[e(w,{icon:"list"}),e("span",{children:"Add/remove from Lists"})]}),e(Ee,{})]}),e(ee,{href:m,target:"_blank",children:[e(w,{icon:"external"}),e("small",{class:"menu-double-lines",children:qs(m)})]}),e("div",{class:"menu-horizontal",children:[e(ee,{onClick:()=>{try{navigator.clipboard.writeText(m),he("Link copied")}catch{he("Unable to copy link")}},children:[e(w,{icon:"link"}),e("span",{children:"Copy"})]}),(navigator==null?void 0:navigator.share)&&((ne=navigator==null?void 0:navigator.canShare)==null?void 0:ne.call(navigator,{url:m}))&&e(ee,{onClick:()=>{try{navigator.share({url:m})}catch{alert("Sharing doesn't seem to work.")}},children:[e(w,{icon:"share"}),e("span",{children:"Share…"})]})]}),!!f&&e($,{children:[e(Ee,{}),A?e(ee,{onClick:()=>{d("loading"),(async()=>{try{const O=await s.v1.accounts.$select((j==null?void 0:j.id)||g).unmute();p(O),d("default"),he(`Unmuted @${h}`),k.reloadGenericAccounts.id="mute",k.reloadGenericAccounts.counter++}catch{d("error")}})()},children:[e(w,{icon:"unmute"}),e("span",{children:["Unmute @",h]})]}):e(us,{openTrigger:"clickOnly",direction:"bottom",overflow:"auto",shift:16,label:e($,{children:[e(w,{icon:"mute"}),e("span",{class:"menu-grow",children:["Mute @",h,"…"]}),e("span",{style:{textOverflow:"clip"},children:[e(w,{icon:"time"}),e(w,{icon:"chevron-right"})]})]}),children:e("div",{class:"menu-wrap",children:_s.map(O=>e(ee,{onClick:()=>{d("loading"),(async()=>{try{const T=await s.v1.accounts.$select((j==null?void 0:j.id)||g).mute({duration:O});p(T),d("default"),he(`Muted @${h} for ${rn[O]}`),k.reloadGenericAccounts.id="mute",k.reloadGenericAccounts.counter++}catch{d("error"),he(`Unable to mute @${h}`)}})()},children:rn[O]}))})}),e(Ne,{subMenu:!0,confirm:!N,confirmLabel:e($,{children:[e(w,{icon:"block"}),e("span",{children:["Block @",h,"?"]})]}),menuItemClassName:"danger",onClick:()=>{d("loading"),(async()=>{try{if(N){const O=await s.v1.accounts.$select((j==null?void 0:j.id)||g).unblock();p(O),d("default"),he(`Unblocked @${h}`)}else{const O=await s.v1.accounts.$select((j==null?void 0:j.id)||g).block();p(O),d("default"),he(`Blocked @${h}`)}k.reloadGenericAccounts.id="block",k.reloadGenericAccounts.counter++}catch{d("error"),N?he(`Unable to unblock @${h}`):he(`Unable to block @${h}`)}})()},children:N?e($,{children:[e(w,{icon:"unblock"}),e("span",{children:["Unblock @",h]})]}):e($,{children:[e(w,{icon:"block"}),e("span",{children:["Block @",h,"…"]})]})})]})]}),!f&&u==="loading"&&e(ve,{abrupt:!0}),!!f&&e(Ne,{confirm:M||ce,confirmLabel:e("span",{children:ce?"Withdraw follow request?":`Unfollow @${t.acct||t.username}?`}),menuItemClassName:"danger",align:"end",disabled:ue,onClick:()=>{d("loading"),(async()=>{try{let O;M||ce?O=await s.v1.accounts.$select(x.current).unfollow():O=await s.v1.accounts.$select(x.current).follow(),O&&p(O),d("default")}catch(O){alert(O),d("error")}})()},children:e("button",{type:"button",class:`${M||ce?"light swap":""}`,"data-swap-state":M||ce?"danger":"",disabled:ue,children:M?e($,{children:[e("span",{children:"Following"}),e("span",{children:"Unfollow…"})]}):ce?e($,{children:[e("span",{children:"Requested"}),e("span",{children:"Withdraw…"})]}):b?e($,{children:[e(w,{icon:"lock"})," ",e("span",{children:"Follow"})]}):"Follow"})})]})]}),!!Re&&e(we,{class:"light",onClose:()=>{ae(!1)},children:e(Hs,{note:v,fields:I,onClose:()=>ae(!1)})}),!!q&&e(we,{class:"light",onClose:()=>{Y(!1)},children:e(Vs,{accountID:x.current,onClose:()=>Y(!1)})}),!!J&&e(we,{class:"light",onClose:()=>{oe(!1)},children:e(js,{account:t,note:te,onRelationshipChange:O=>{p(O)},onClose:()=>oe(!1)})})]})}function Os([t,n,c]){const i=.2126*t+.7152*n+.0722*c;let s;return i>=220?s=1:i<=50?s=.1:s=i/255,s=Math.min(1,s),[t,n,c,s]}function qs(t){if(!t)return;const n=new URL(t),{host:c,pathname:i}=n,s=i.replace(/\/$/,"").replace(/^\//,"");return e($,{children:[e("span",{class:"more-insignificant",children:[c,"/"]}),e("wbr",{}),e("span",{children:s})]})}function Hs({note:t,fields:n,onClose:c}){const i=(n==null?void 0:n.map(({name:o,value:l})=>`${o}
${Jt(l)}`).join(`

`))||"",s=Jt(t)+(i?`

${i}`:"");return e("div",{class:"sheet",children:[!!c&&e("button",{type:"button",class:"sheet-close",onClick:c,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Translated Bio"})}),e("main",{children:[e("p",{style:{whiteSpace:"pre-wrap"},children:s}),e(Sn,{forceTranslate:!0,text:s})]})]})}function Vs({accountID:t,onClose:n}){const{masto:c}=B(),[i,s]=C("default"),[o,l]=C([]),[r,u]=C([]),[d,f]=Ct(a=>a+1,0);z(()=>{s("loading"),(async()=>{try{const a=await c.v1.lists.list();a.sort((h,b)=>h.title.localeCompare(b.title));const m=await c.v1.accounts.$select(t).lists.list();l(a),u(m),s("default")}catch{s("error")}})()},[d]);const[p,g]=C(!1);return e("div",{class:"sheet",id:"list-add-remove-container",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Add/Remove from Lists"})}),e("main",{children:[o.length>0?e("ul",{class:"list-add-remove",children:o.map(a=>{const m=r.some(h=>h.id===a.id);return e("li",{children:e("button",{type:"button",class:`light ${m?"checked":""}`,disabled:i==="loading",onClick:()=>{s("loading"),(async()=>{try{m?await c.v1.lists.$select(a.id).accounts.remove({accountIds:[t]}):await c.v1.lists.$select(a.id).accounts.create({accountIds:[t]}),f()}catch{s("error"),alert(m?"Unable to remove from list.":"Unable to add to list.")}})()},children:[e(w,{icon:"check-circle"}),e("span",{children:a.title})]})})})}):i==="loading"?e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}):i==="error"?e("p",{class:"ui-state",children:"Unable to load lists."}):e("p",{class:"ui-state",children:"No lists."}),e("button",{type:"button",class:"plain2",onClick:()=>g(!0),disabled:i!=="default",children:[e(w,{icon:"plus",size:"l"})," ",e("span",{children:"New list"})]})]}),p&&e(we,{class:"light",onClick:a=>{a.target===a.currentTarget&&g(!1)},children:e(Vt,{list:p==null?void 0:p.list,onClose:a=>{a.state==="success"&&f(),g(!1)}})})]})}function js({account:t,note:n,onRelationshipChange:c=()=>{},onClose:i=()=>{}}){const{masto:s}=B(),[o,l]=C("default"),r=R(null);return z(()=>{let u;return r.current&&!n&&(u=setTimeout(()=>{var d,f;(f=(d=r.current).focus)==null||f.call(d)},100)),()=>{clearTimeout(u)}},[]),e("div",{class:"sheet",id:"private-note-container",children:[!!i&&e("button",{type:"button",class:"sheet-close",onClick:i,children:e(w,{icon:"x"})}),e("header",{children:e("b",{children:["Private note about @",(t==null?void 0:t.username)||(t==null?void 0:t.acct)]})}),e("main",{children:e("form",{onSubmit:u=>{u.preventDefault();const f=new FormData(u.target).get("note");(f==null?void 0:f.trim())!==(n==null?void 0:n.trim())&&(l("loading"),(async()=>{try{const p=await s.v1.accounts.$select(t==null?void 0:t.id).note.create({comment:f});l("default"),c(p),i()}catch(p){l("error"),alert((p==null?void 0:p.message)||"Unable to update private note.")}})())},children:[e("textarea",{ref:r,name:"note",disabled:o==="loading",children:n}),e("footer",{children:[e("button",{type:"button",class:"light",disabled:o==="loading",onClick:()=>{i==null||i()},children:"Cancel"}),e("span",{children:[e(ve,{abrupt:!0,hidden:o!=="loading"}),e("button",{disabled:o==="loading",type:"submit",children:"Save & close"})]})]})]})})]})}function Gs({account:t,instance:n,onClose:c}){const{masto:i,instance:s,authenticated:o}=B({instance:n}),l=typeof t=="string";return z(()=>{l||(k.accounts[`${t.id}@${s}`]=t)},[t]),Pn(c),e("div",{class:"sheet",children:[!!c&&e("button",{type:"button",class:"sheet-close outer",onClick:c,children:e(w,{icon:"x"})}),e(Un,{instance:s,authenticated:o,account:t,fetchAccount:async()=>{if(l)try{return await i.v1.accounts.lookup({acct:t,skip_webfinger:!1})}catch{const u=await i.v2.search.fetch({q:t,type:"accounts",limit:1,resolve:o});if(u.accounts.length)return u.accounts[0];if(/https?:\/\/[^/]+\/@/.test(t)){const f=new URL(t).pathname.replace(/^\//,""),p=await i.v2.search.fetch({q:f,type:"accounts",limit:1,resolve:o});if(p.accounts.length)return p.accounts[0]}}else return t}})]})}function Ws({onClose:t}){const{masto:n}=B(),[c,i]=C("default"),[s,o]=C([]),[l,r]=Ct(d=>d+1,0);z(()=>{i("loading"),(async()=>{try{const d=await ct.drafts.keys();if(d.length){const f=In(),p=d.filter(g=>g.startsWith(f));if(p.length){const g=await ct.drafts.getMany(p);g.sort((a,m)=>new Date(m.updatedAt).getTime()-new Date(a.updatedAt).getTime()),o(g)}else o([])}else o([]);i("default")}catch{i("error")}})()},[l]);const u=(s==null?void 0:s.length)>0;return e("div",{class:"sheet",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:[e("h2",{children:["Unsent drafts ",e(ve,{abrupt:!0,hidden:c!=="loading"})]}),u&&e("div",{class:"insignificant",children:"Looks like you have unsent drafts. Let's continue where you left off."})]}),e("main",{children:u?e($,{children:[e("ul",{class:"drafts-list",children:s.map(d=>{const{updatedAt:f,key:p,draftStatus:g,replyTo:a}=d,m=new Date(f);return e("li",{children:[e("div",{class:"mini-draft-meta",children:[e("b",{children:[e(w,{icon:a?"reply":"quill",size:"s"})," ",e("time",{children:[!!a&&e($,{children:["@",a.account.acct,e("br",{})]}),qe(m)]})]}),e(Ne,{confirmLabel:e("span",{children:"Delete this draft?"}),menuItemClassName:"danger",align:"end",disabled:c==="loading",onClick:()=>{(async()=>{try{await ct.drafts.del(p),r()}catch{alert("Error deleting draft! Please try again.")}})()},children:e("button",{type:"button",class:"small light",disabled:c==="loading",children:"Delete…"})})]}),e("button",{type:"button",disabled:c==="loading",class:"draft-item",onClick:async()=>{let h;if(a){i("loading");try{h=await n.v1.statuses.$select(a.id).fetch()}catch{alert("Error fetching reply-to status!"),i("default");return}i("default")}window.__COMPOSE__={draftStatus:g,replyToStatus:h},k.showCompose=!0,k.showDrafts=!1},children:e(Ks,{draft:d})})]},f)})}),s.length>1&&e("p",{children:e(Ne,{confirmLabel:e("span",{children:"Delete all drafts?"}),menuItemClassName:"danger",disabled:c==="loading",onClick:()=>{(async()=>{i("loading");try{await ct.drafts.delMany(s.map(d=>d.key)),i("default"),r()}catch{alert("Error deleting drafts! Please try again."),i("error")}})()},children:e("button",{type:"button",class:"light danger",disabled:c==="loading",children:"Delete all…"})})})]}):e("p",{children:"No drafts found."})})]})}function Ks({draft:t}){var p;const{draftStatus:n,replyTo:c}=t,{status:i,spoilerText:s,poll:o,mediaAttachments:l}=n,r=((p=o==null?void 0:o.options)==null?void 0:p.length)>0,u=(l==null?void 0:l.length)>0,d=r||u,f=be(()=>{if(!u)return;const g=l.find(h=>/image/.test(h.type));if(!g)return;const{file:a}=g;return URL.createObjectURL(a)},[u,l]);return e($,{children:e("div",{class:"mini-draft",children:[d&&e("div",{class:`mini-draft-aside ${f?"has-image":""}`,style:f?{"--bg-image":`url(${f})`}:{},children:[r&&e(w,{icon:"poll"}),u&&e("span",{children:[e(w,{icon:"attachment"})," ",e("small",{children:l==null?void 0:l.length})]})]}),e("div",{class:"mini-draft-main",children:[!!s&&e("div",{class:"mini-draft-spoiler",children:s}),!!i&&e("div",{class:"mini-draft-status",children:i})]})]})})}function Ys({onClose:t=()=>{}}){const n=pe(k),[c,i]=C("default"),[s,o]=C([]),[l,r]=C(!1);if(Pn(t),!n.showGenericAccounts)return null;const{id:u,heading:d,fetchAccounts:f,accounts:p,showReactions:g}=n.showGenericAccounts,a=m=>{f&&(m&&o([]),i("loading"),(async()=>{try{const{done:h,value:b}=await f(m);Array.isArray(b)?(o(m?b:y=>[...y,...b]),r(!h)):r(!1),i("default")}catch{i("error")}})())};return z(()=>{(p==null?void 0:p.length)>0?o(p):a(!0)},[p,f]),z(()=>{var m;((m=n.reloadGenericAccounts)==null?void 0:m.id)===u&&a(!0)},[n.reloadGenericAccounts.counter]),e("div",{id:"generic-accounts-container",class:"sheet",tabindex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:d||"Accounts"})}),e("main",{children:s.length>0?e($,{children:[e("ul",{class:"accounts-list",children:s.map(m=>{var h;return e("li",{children:[g&&((h=m._types)==null?void 0:h.length)>0&&e("div",{class:"reactions-block",children:m._types.map(b=>e(w,{icon:{reblog:"rocket",favourite:"heart"}[b],class:`${b}-icon`}))}),e(Ue,{account:m})]},m.id+(m._types||""))})}),c==="default"?l?e(ot,{onChange:m=>{m&&a()},children:e("button",{type:"button",class:"plain block",onClick:()=>a(),children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}):c==="loading"&&e("p",{class:"ui-state",children:e(ve,{abrupt:!0})})]}):c==="loading"?e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}):c==="error"?e("p",{class:"ui-state",children:"Error loading accounts"}):e("p",{class:"ui-state insignificant",children:"Nothing to show"})})]})}function Js({alt:t,lang:n,onClose:c}){const i=pe(k),[s,o]=C(!1),l=wn(!0),r=i.settings.contentTranslationHideLanguages||[],u=!!n&&n!==l&&!Xt([n],[l])&&!r.find(d=>n===d||Xt([n],[d]));return e("div",{class:"sheet",tabindex:"-1",children:[!!c&&e("button",{type:"button",class:"sheet-close outer",onClick:c,children:e(w,{icon:"x"})}),e("header",{class:"header-grid",children:[e("h2",{children:"Media description"}),e("div",{class:"header-side",children:e(Ke,{align:"end",menuButton:e("button",{type:"button",class:"plain4",children:e(w,{icon:"more",alt:"More",size:"xl"})}),children:e(ee,{disabled:s,onClick:()=>{o(!0)},children:[e(w,{icon:"translate"}),e("span",{children:"Translate"})]})})})]}),e("main",{lang:n,dir:"auto",children:[e("p",{style:{whiteSpace:"pre-wrap"},children:t}),(u||s)&&e(Sn,{forceTranslate:s,sourceLanguage:n,text:t})]})]})}function Lt(t,n,c){return Math.max(Math.min(t,c),n)}const At=t=>t>=.04045?Math.pow((t+.055)/1.055,2.4):t/12.92,Rt=t=>t>=.0031308?1.055*Math.pow(t,1/2.4)-.055:12.92*t;function zn([t,n,c]){t=At(t/255),n=At(n/255),c=At(c/255);var i=.4122214708*t+.5363325363*n+.0514459929*c,s=.2119034982*t+.6806995451*n+.1073969566*c,o=.0883024619*t+.2817188376*n+.6299787005*c;return i=Math.cbrt(i),s=Math.cbrt(s),o=Math.cbrt(o),[i*.2104542553+s*.793617785+o*-.0040720468,i*1.9779984951+s*-2.428592205+o*.4505937099,i*.0259040371+s*.7827717662+o*-.808675766]}function Fn([t,n,u]){var i=t+n*.3963377774+u*.2158037573,s=t+n*-.1055613458+u*-.0638541728,o=t+n*-.0894841775+u*-1.291485548;i=i**3,s=s**3,o=o**3;var l=i*4.0767416621+s*-3.3077115913+o*.2309699292,r=i*-1.2684380046+s*2.6097574011+o*-.3413193965,u=i*-.0041960863+s*-.7034186147+o*1.707614701;return l=255*Rt(l),r=255*Rt(r),u=255*Rt(u),l=Lt(l,0,255),r=Lt(r,0,255),u=Lt(u,0,255),l=Math.round(l),r=Math.round(r),u=Math.round(u),[l,r,u]}function Bn({mediaAttachments:t,statusID:n,instance:c,lang:i,index:s=0,onClose:o=()=>{}}){var a,m;const l=R(null),[r,u]=C(s),d=R(null);ze(()=>{var h;(h=d.current)==null||h.scrollIntoView()},[]);const f=R(n);z(()=>{const h=s*l.current.clientWidth,b=f.current!==n;b&&(f.current=n),l.current.scrollTo({left:h,behavior:b?"auto":"smooth"}),l.current.focus()},[s,n]);const[p,g]=C(!0);return z(()=>{let h=()=>{o()};return l.current&&l.current.addEventListener("swiped-down",h),()=>{l.current&&l.current.removeEventListener("swiped-down",h)}},[]),$e("esc",o,{ignoreEventWhen:h=>!!document.querySelector("#modal-container > *")},[o]),z(()=>{let h=()=>{const{clientWidth:b,scrollLeft:y}=l.current,v=Math.round(y/b);u(v)};return l.current&&l.current.addEventListener("scroll",h,{passive:!0}),()=>{l.current&&l.current.removeEventListener("scroll",h)}},[]),z(()=>{let h=setTimeout(()=>{var b,y;(y=(b=l.current)==null?void 0:b.focus)==null||y.call(b)},100);return()=>clearTimeout(h)},[]),e("div",{class:"media-modal-container",children:[e("div",{ref:l,tabIndex:"0","data-swipe-threshold":"44",class:"carousel",onClick:h=>{(h.target.classList.contains("carousel-item")||h.target.classList.contains("media")||h.target.classList.contains("media-zoom"))&&o()},children:t==null?void 0:t.map((h,b)=>{const{blurhash:y}=h;let v;if(y){const I=Ln(y),S=zn(I);v=Fn([.6,S[1],S[2]])}return e("div",{class:"carousel-item",style:{"--accent-color":`rgb(${v==null?void 0:v.join(",")})`,"--accent-alpha-color":`rgba(${v==null?void 0:v.join(",")}, 0.4)`},tabindex:"0",ref:b===r?d:null,onClick:I=>{I.target!==I.currentTarget&&g(!p)},children:[!!h.description&&e("button",{type:"button",class:"media-alt",hidden:!p,onClick:()=>{k.showMediaAlt={alt:h.description,lang:i}},children:[e("span",{class:"alt-badge",children:"ALT"}),e("span",{class:"media-alt-desc",lang:i,dir:"auto",children:h.description})]}),e(ss,{media:h,showOriginal:!0,lang:i})]},h.id)})}),e("div",{class:"carousel-top-controls",hidden:!p,children:[e("span",{children:e("button",{type:"button",class:"carousel-button",onClick:()=>o(),children:e(w,{icon:"x"})})}),(t==null?void 0:t.length)>1?e("span",{class:"carousel-dots",children:t==null?void 0:t.map((h,b)=>e("button",{type:"button",disabled:b===r,class:`carousel-dot ${b===r?"active":""}`,onClick:y=>{y.preventDefault(),y.stopPropagation(),l.current.scrollTo({left:l.current.clientWidth*b,behavior:"smooth"}),l.current.focus()},children:e(w,{icon:"round",size:"s"})},h.id))}):e("span",{}),e("span",{children:[e(Ke,{overflow:"auto",align:"end",position:"anchor",boundingBoxPadding:"8 8 8 8",gap:4,menuClassName:"glass-menu",menuButton:e("button",{type:"button",class:"carousel-button",children:e(w,{icon:"more",alt:"More"})}),children:e(Ae,{href:((a=t[r])==null?void 0:a.remoteUrl)||((m=t[r])==null?void 0:m.url),class:"carousel-button",target:"_blank",title:"Open original media in new window",children:[e(w,{icon:"popout"}),e("span",{children:"Open original media"})]})})," ",e(W,{to:`${c?`/${c}`:""}/s/${n}${window.matchMedia("(min-width: calc(40em + 350px))").matches?`?media=${r+1}`:""}`,class:"button carousel-button media-post-link",children:[e("span",{class:"button-label",children:"See post "}),"»"]})]})]}),(t==null?void 0:t.length)>1&&e("div",{class:"carousel-controls",hidden:!p,children:[e("button",{type:"button",class:"carousel-button",hidden:r===0,onClick:h=>{h.preventDefault(),h.stopPropagation(),l.current.focus(),l.current.scrollTo({left:l.current.clientWidth*(r-1),behavior:"smooth"})},children:e(w,{icon:"arrow-left"})}),e("button",{type:"button",class:"carousel-button",hidden:r===t.length-1,onClick:h=>{h.preventDefault(),h.stopPropagation(),l.current.focus(),l.current.scrollTo({left:l.current.clientWidth*(r+1),behavior:"smooth"})},children:e(w,{icon:"arrow-right"})})]})]})}const Xs=""+new URL("floating-button-ef345856.svg",import.meta.url).href,Zs=""+new URL("multi-column-d7f22033.svg",import.meta.url).href,Qs=""+new URL("tab-menu-bar-0b1df8b5.svg",import.meta.url).href;function Pt({children:t}){if(typeof t=="string")return t;const[n,c]=C("");return z(()=>{Promise.resolve(t).then(c)},[t]),n}const tt=9,ei=["following","mentions","notifications","list","public","trending","hashtag","bookmarks","favourites"],On={following:"Home / Following",notifications:"Notifications",list:"List",public:"Public (Local / Federated)",search:"Search","account-statuses":"Account",bookmarks:"Bookmarks",favourites:"Likes",hashtag:"Hashtag",trending:"Trending",mentions:"Mentions"},bt={list:[{text:"List ID",name:"id"}],public:[{text:"Local only",name:"local",type:"checkbox"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],trending:[{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],search:[{text:"Search term",name:"query",type:"text"}],"account-statuses":[{text:"@",name:"id",type:"text",placeholder:"cheeaun@mastodon.social"}],hashtag:[{text:"#",name:"hashtag",type:"text",placeholder:"e.g. PixelArt (Max 5, space-separated)",pattern:"[^#]+"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}]},It={following:{id:"home",title:(t,n)=>n===0?"Home":"Following",path:"/",icon:"home"},mentions:{id:"mentions",title:"Mentions",path:"/mentions",icon:"at"},notifications:{id:"notifications",title:"Notifications",path:"/notifications",icon:"notification"},list:{id:"list",title:st(async({id:t})=>(await B().masto.v1.lists.$select(t).fetch()).title),path:({id:t})=>`/l/${t}`,icon:"list"},public:{id:"public",title:({local:t})=>t?"Local":"Federated",subtitle:({instance:t})=>t||B().instance,path:({local:t,instance:n})=>`/${n}/p${t?"/l":""}`,icon:({local:t})=>t?"group":"earth"},trending:{id:"trending",title:"Trending",subtitle:({instance:t})=>t||B().instance,path:({instance:t})=>`/${t}/trending`,icon:"chart"},search:{id:"search",title:({query:t})=>t,path:({query:t})=>`/search?q=${t}`,icon:"search"},"account-statuses":{id:"account-statuses",title:st(async({id:t})=>{const n=await B().masto.v1.accounts.$select(t).fetch();return n.username||n.acct||n.displayName}),path:({id:t})=>`/a/${t}`,icon:"user"},bookmarks:{id:"bookmarks",title:"Bookmarks",path:"/b",icon:"bookmark"},favourites:{id:"favourites",title:"Likes",path:"/f",icon:"heart"},hashtag:{id:"hashtag",title:({hashtag:t})=>t,subtitle:({instance:t})=>t||B().instance,path:({hashtag:t,instance:n})=>`${n?`/${n}`:""}/t/${t.split(/\s+/).join("+")}`,icon:"hashtag"}};function ti({onClose:t}){const n=pe(k),{masto:c}=B(),{shortcuts:i}=n,[s,o]=C([]),[l,r]=C([]),[u,d]=C(!1),[f,p]=C(!1),[g]=xn();return z(()=>{(async()=>{try{const a=await c.v1.lists.list();a.sort((m,h)=>m.title.localeCompare(h.title)),o(a)}catch{}})(),(async()=>{try{const a=c.v1.followedTags.list(),m=[];do{const{value:h,done:b}=await a.next();if(b||(h==null?void 0:h.length)===0)break;m.push(...h)}while(!0);r(m)}catch{}})()},[]),e("div",{id:"shortcuts-settings-container",class:"sheet",tabindex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:[e(w,{icon:"shortcut"})," Shortcuts"," ",e("sup",{style:{fontSize:12,opacity:.5,textTransform:"uppercase"},children:"beta"})]})}),e("main",{children:[e("p",{children:"Specify a list of shortcuts that'll appear as:"}),e("div",{class:"shortcuts-view-mode",children:[{value:"float-button",label:"Floating button",imgURL:Xs},{value:"tab-menu-bar",label:"Tab/Menu bar",imgURL:Qs},{value:"multi-column",label:"Multi-column",imgURL:Zs}].map(({value:a,label:m,imgURL:h})=>{const b=n.settings.shortcutsViewMode===a||a==="float-button"&&!n.settings.shortcutsViewMode;return e("label",{class:b?"checked":"",children:[e("input",{type:"radio",name:"shortcuts-view-mode",value:a,checked:b,onChange:y=>{k.settings.shortcutsViewMode=y.target.value}})," ",e("img",{src:h,alt:"",width:"80",height:"58"})," ",e("span",{children:m})]},a)})}),i.length>0?e("ol",{class:"shortcuts-list",ref:g,children:i.filter(Boolean).map((a,m)=>{const h=Object.values(a).join("-"),{type:b}=a;if(!It[b])return null;let{icon:y,title:v,subtitle:I}=It[b];return typeof v=="function"&&(v=v(a,m)),typeof I=="function"&&(I=I(a,m)),typeof y=="function"&&(y=y(a,m)),e("li",{children:[e(w,{icon:y}),e("span",{class:"shortcut-text",children:[e(Pt,{children:v}),I&&e($,{children:[" ",e("small",{class:"ib insignificant",children:I})]})]}),e("span",{class:"shortcut-actions",children:[e("button",{type:"button",class:"plain small",disabled:m===0,onClick:()=>{const S=Array.from(k.shortcuts);if(m>0){const x=k.shortcuts[m-1];S[m-1]=a,S[m]=x,k.shortcuts=S}},children:e(w,{icon:"arrow-up",alt:"Move up"})}),e("button",{type:"button",class:"plain small",disabled:m===i.length-1,onClick:()=>{const S=Array.from(k.shortcuts);if(m<k.shortcuts.length-1){const x=k.shortcuts[m+1];S[m+1]=a,S[m]=x,k.shortcuts=S}},children:e(w,{icon:"arrow-down",alt:"Move down"})}),e("button",{type:"button",class:"plain small",onClick:()=>{d({shortcut:a,shortcutIndex:m})},children:e(w,{icon:"pencil",alt:"Edit"})})]})]},h)})}):e("div",{class:"ui-state insignificant",children:[e("p",{children:"No shortcuts yet. Tap on the Add shortcut button."}),e("p",{children:["Not sure what to add?",e("br",{}),"Try adding"," ",e("a",{href:"#",onClick:a=>{a.preventDefault(),k.shortcuts=[{type:"following"},{type:"notifications"}]},children:"Home / Following and Notifications"})," ","first."]})]}),e("p",{class:"insignificant",children:i.length>=tt&&`Max ${tt} shortcuts`}),e("p",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e("button",{type:"button",class:"light",onClick:()=>p(!0),children:"Import/export"}),e("button",{type:"button",disabled:i.length>=tt,onClick:()=>d(!0),children:[e(w,{icon:"plus"})," ",e("span",{children:"Add shortcut"})]})]})]}),u&&e(we,{class:"light",onClick:a=>{a.target===a.currentTarget&&d(!1)},children:e(ni,{shortcut:u.shortcut,shortcutIndex:u.shortcutIndex,lists:s,followedHashtags:l,onSubmit:({result:a,mode:m})=>{m==="edit"?k.shortcuts[u.shortcutIndex]=a:k.shortcuts.push(a)},onClose:()=>d(!1)})}),f&&e(we,{class:"light",onClick:a=>{a.target===a.currentTarget&&p(!1)},children:e(si,{shortcuts:i,onClose:()=>p(!1)})})]})}function ni({lists:t,followedHashtags:n,onSubmit:c,disabled:i,shortcut:s,shortcutIndex:o,onClose:l}){var p,g;const r=!!s,[u,d]=C((s==null?void 0:s.type)||null),f=R();return z(()=>{if(r&&u&&bt[u]){const a=f.current;bt[u].forEach(({name:m,type:h})=>{const b=a.querySelector(`[name="${m}"]`);b&&s[m]&&(h==="checkbox"?b.checked=s[m]==="on":b.value=s[m])})}},[r,u]),e("div",{id:"shortcut-settings-form",class:"sheet",children:[!!l&&e("button",{type:"button",class:"sheet-close",onClick:l,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:[r?"Edit":"Add"," shortcut"]})}),e("main",{tabindex:"-1",children:e("form",{ref:f,onSubmit:a=>{a.preventDefault();const m=new FormData(a.target),h={};m.forEach((b,y)=>{h[y]=b==null?void 0:b.trim(),y==="instance"&&(h[y]=h[y].replace(/^https?:\/\//,"").replace(/\/+$/,""),h[y]=h[y].replace(/^@?[^@]+@/,""))}),h.type&&(c({result:h,mode:r?"edit":"add"}),a.target.reset(),d(null),l==null||l())},children:[e("p",{children:e("label",{children:[e("span",{children:"Timeline"}),e("select",{required:!0,disabled:i,onChange:a=>{d(a.target.value)},defaultValue:r?s.type:void 0,name:"type",children:[e("option",{}),ei.map(a=>e("option",{value:a,children:On[a]}))]})]})}),(g=(p=bt[u])==null?void 0:p.map)==null?void 0:g.call(p,({text:a,name:m,type:h,placeholder:b,pattern:y,notRequired:v})=>u==="list"?e("p",{children:e("label",{children:[e("span",{children:"List"}),e("select",{name:"id",required:!v,disabled:i,children:t.map(I=>e("option",{value:I.id,children:I.title}))})]})}):e("p",{children:e("label",{children:[e("span",{children:a})," ",e("input",{type:h,name:m,placeholder:b,required:h==="text"&&!v,disabled:i,list:u==="hashtag"?"followed-hashtags-datalist":null,autocorrect:"off",autocapitalize:"off",spellcheck:!1,pattern:y}),u==="hashtag"&&n.length>0&&e("datalist",{id:"followed-hashtags-datalist",children:n.map(I=>e("option",{value:I.name}))})]})})),e("footer",{children:[e("button",{type:"submit",class:"block",disabled:i,children:r?"Save":"Add"}),r&&e("button",{type:"button",class:"light danger",onClick:()=>{k.shortcuts.splice(o,1),l==null||l()},children:"Remove"})]})]})})]})}function si({shortcuts:t,onClose:n}){var d;const c=be(()=>!t||!t.filter(Boolean).length?"":tn.compressToEncodedURIComponent(JSON.stringify(t.filter(Boolean))),[t]),[i,s]=C(""),[o,l]=C("default"),r=be(()=>{if(!i)return l("default"),null;try{const f=JSON.parse(tn.decompressFromEncodedURIComponent(i));if(!Array.isArray(f))throw new Error("Not an array");return l("default"),f}catch{try{const p=JSON.parse(i);if(!Array.isArray(p))throw new Error("Not an array");return l("default"),p}catch{return l("error"),null}}},[i]),u=k.shortcuts.length>0;return e("div",{id:"import-export-container",class:"sheet",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:["Import/Export ",e("small",{class:"ib insignificant",children:"Shortcuts"})]})}),e("main",{tabindex:"-1",children:[e("section",{children:[e("h3",{children:[e(w,{icon:"arrow-down-circle",size:"l",class:"insignificant"})," ",e("span",{children:"Import"})]}),e("p",{children:e("input",{type:"text",name:"import",placeholder:"Paste shortcuts here",class:"block",onInput:f=>{s(f.target.value)}})}),!!r&&Array.isArray(r)&&e($,{children:[e("p",{children:[e("b",{children:r.length})," shortcut",r.length>1?"s":""," ",e("small",{class:"insignificant",children:["(",i.length," characters)"]})]}),e("ol",{class:"import-settings-list",children:r.map(f=>{var p,g;return e("li",{children:[e("span",{style:{opacity:t.some(a=>Object.keys(a).every(m=>a[m]===f[m]))?1:0},children:"*"}),e("span",{children:[On[f.type],f.type==="list"&&" ⚠️"," ",(g=(p=bt[f.type])==null?void 0:p.map)==null?void 0:g.call(p,({text:a,name:m,type:h})=>f[m]?e($,{children:[e("span",{class:"tag collapsed insignificant",children:[a,":"," ",h==="checkbox"?f[m]==="on"?"✅":"❌":f[m]]})," "]}):null)]})]})})}),e("p",{children:[e("small",{children:"* Exists in current shortcuts"}),e("br",{}),e("small",{children:"⚠️ List may not work if it's from a different account."})]})]}),o==="error"&&e("p",{class:"error",children:e("small",{children:"⚠️ Invalid settings format"})}),e("p",{children:[u&&e($,{children:[e(Ne,{confirmLabel:"Append to current shortcuts?",menuFooter:e("div",{class:"footer",children:"Only shortcuts that don’t exist in current shortcuts will be appended."}),onClick:()=>{const f=r.filter(a=>!k.shortcuts.some(m=>Object.keys(m).every(h=>m[h]===a[h])));if(!f.length){he("No new shortcuts to import");return}let p=[...k.shortcuts,...f];const g=p.length>tt;g&&(p=p.slice(0,tt)),k.shortcuts=p,he(g?`Shortcuts imported. Exceeded max ${tt}, so the rest are not imported.`:"Shortcuts imported"),n==null||n()},children:e("button",{type:"button",class:"plain2",disabled:!r,children:"Import & append…"})})," "]}),e(Ne,{confirmLabel:u?"Override current shortcuts?":"Import shortcuts?",menuItemClassName:u?"danger":void 0,onClick:()=>{k.shortcuts=r,he("Shortcuts imported"),n==null||n()},children:e("button",{type:"button",class:"plain2",disabled:!r,children:u?"or override…":"Import…"})})]})]}),e("section",{children:[e("h3",{children:[e(w,{icon:"arrow-up-circle",size:"l",class:"insignificant"})," ",e("span",{children:"Export"})]}),e("p",{children:e("input",{style:{width:"100%"},type:"text",value:c,readOnly:!0,onClick:f=>{if(f.target.value){f.target.select();try{navigator.clipboard.writeText(f.target.value),he("Shortcuts copied")}catch{he("Unable to copy shortcuts")}}}})}),e("p",{children:[e("button",{type:"button",class:"plain2",disabled:!c,onClick:()=>{try{navigator.clipboard.writeText(c),he("Shortcut settings copied")}catch{he("Unable to copy shortcut settings")}},children:[e(w,{icon:"clipboard"})," ",e("span",{children:"Copy"})]})," ",(navigator==null?void 0:navigator.share)&&((d=navigator==null?void 0:navigator.canShare)==null?void 0:d.call(navigator,{text:c}))&&e("button",{type:"button",class:"plain2",disabled:!c,onClick:()=>{try{navigator.share({text:c})}catch{alert("Sharing doesn't seem to work.")}},children:[e(w,{icon:"share"})," ",e("span",{children:"Share"})]})," ",c.length>0&&e("small",{class:"insignificant",children:[c.length," characters"]})]}),!!c&&e("details",{children:[e("summary",{class:"insignificant",children:e("small",{children:"Raw Shortcuts JSON"})}),e("textarea",{style:{width:"100%"},rows:10,readOnly:!0,children:JSON.stringify(t.filter(Boolean),null,2)})]})]})]})]})}An(k,t=>{for(const[n,c,i,s]of t)/^show/i.test(c)&&!i&&_t()});function ii(){var i,s,o,l,r,u,d,f;const t=pe(k),n=Rn(),c=it();return e($,{children:[!!t.showCompose&&e(we,{children:e(is,{replyToStatus:typeof t.showCompose!="boolean"?t.showCompose.replyToStatus:((i=window.__COMPOSE__)==null?void 0:i.replyToStatus)||null,editStatus:((s=k.showCompose)==null?void 0:s.editStatus)||((o=window.__COMPOSE__)==null?void 0:o.editStatus)||null,draftStatus:((l=k.showCompose)==null?void 0:l.draftStatus)||((r=window.__COMPOSE__)==null?void 0:r.draftStatus)||null,onClose:p=>{const{newStatus:g,instance:a,type:m}=p||{};k.showCompose=!1,window.__COMPOSE__=null,g&&(k.reloadStatusPage++,he({text:{post:"Post published. Check it out.",reply:"Reply posted. Check it out.",edit:"Post updated. Check it out."}[m||"post"],delay:1e3,duration:1e4,onClick:h=>{h.hideToast(),k.prevLocation=c,n(a?`/${a}/s/${g.id}`:`/s/${g.id}`)}}))}})}),!!t.showSettings&&e(we,{onClose:()=>{k.showSettings=!1},children:e(Ds,{onClose:()=>{k.showSettings=!1}})}),!!t.showAccounts&&e(we,{onClose:()=>{k.showAccounts=!1},children:e($s,{onClose:()=>{k.showAccounts=!1}})}),!!t.showAccount&&e(we,{class:"light",onClose:()=>{k.showAccount=!1},children:e(Gs,{account:((u=t.showAccount)==null?void 0:u.account)||t.showAccount,instance:(d=t.showAccount)==null?void 0:d.instance,onClose:({destination:p}={})=>{k.showAccount=!1}})}),!!t.showDrafts&&e(we,{onClose:()=>{k.showDrafts=!1},children:e(Ws,{onClose:()=>k.showDrafts=!1})}),!!t.showMediaModal&&e(we,{onClick:p=>{(p.target===p.currentTarget||p.target.classList.contains("media"))&&(k.showMediaModal=!1)},children:e(Bn,{mediaAttachments:t.showMediaModal.mediaAttachments,instance:t.showMediaModal.instance,index:t.showMediaModal.index,statusID:t.showMediaModal.statusID,onClose:()=>{k.showMediaModal=!1}})}),!!t.showShortcutsSettings&&e(we,{class:"light",onClose:()=>{k.showShortcutsSettings=!1},children:e(ti,{onClose:()=>k.showShortcutsSettings=!1})}),!!t.showGenericAccounts&&e(we,{class:"light",onClose:()=>{k.showGenericAccounts=!1},children:e(Ys,{onClose:()=>k.showGenericAccounts=!1})}),!!t.showMediaAlt&&e(we,{class:"light",onClose:p=>{k.showMediaAlt=!1},children:e(Js,{alt:t.showMediaAlt.alt||t.showMediaAlt,lang:(f=t.showMediaAlt)==null?void 0:f.lang,onClose:()=>{k.showMediaAlt=!1}})})]})}function Nt({accountID:t,onChange:n}){const{masto:c}=B(),[i,s]=C("default"),[o,l]=C(null),[r,u]=C(null),d=r!==null;return e("p",{class:"follow-request-buttons",children:[e("button",{type:"button",disabled:i==="loading"||d,onClick:()=>{s("loading"),l("accept"),(async()=>{try{const f=await c.v1.followRequests.$select(t).authorize();if(!(f!=null&&f.followedBy))throw new Error("Follow request not accepted");u(f),n()}catch{}s("default")})()},children:"Accept"})," ",e("button",{type:"button",disabled:i==="loading"||d,class:"light danger",onClick:()=>{s("loading"),l("reject"),(async()=>{try{const f=await c.v1.followRequests.$select(t).reject();if(f!=null&&f.followedBy)throw new Error("Follow request not rejected");u(f),n()}catch{s("default")}})()},children:"Reject"}),e("span",{class:"follow-request-states",children:d&&o?o==="accept"?e(w,{icon:"check-circle",alt:"Accepted",class:"follow-accepted"}):e(w,{icon:"x-circle",alt:"Rejected",class:"follow-rejected"}):e(ve,{hidden:i!=="loading"})})]})}const dn={mention:"comment",status:"notification",reblog:"rocket",follow:"follow",follow_request:"follow-add",favourite:"heart",poll:"poll",update:"pencil","admin.signup":"account-edit","admin.report":"account-warning"},Qe={mention:"mentioned you in their post.",status:"published a post.",reblog:"boosted your post.","reblog+account":t=>`boosted ${t} of your posts.`,reblog_reply:"boosted your reply.",follow:"followed you.",follow_request:"requested to follow you.",favourite:"liked your post.","favourite+account":t=>`liked ${t} of your posts.`,favourite_reply:"liked your reply.",poll:"A poll you have voted in or created has ended.","poll-self":"A poll you have created has ended.","poll-voted":"A poll you have voted in has ended.",update:"A post you interacted with has been edited.","favourite+reblog":"boosted & liked your post.","favourite+reblog+account":t=>`boosted & liked ${t} of your posts.`,"favourite+reblog_reply":"boosted & liked your reply.","admin.sign_up":"signed up.","admin.report":t=>e($,{children:["reported ",t]})},Mt=50;function oi({notification:t,instance:n,isStatic:c}){var M,L,F,P;const{id:i,status:s,account:o,report:l,_accounts:r,_statuses:u}=t;let{type:d}=t;const f=(s==null?void 0:s.reblog)||s,p=f==null?void 0:f.id,g=Z.session.get("currentAccount"),a=g===(o==null?void 0:o.id),m=(M=s==null?void 0:s.poll)==null?void 0:M.voted,h=!!(s!=null&&s.inReplyToAccountId)&&(s==null?void 0:s.inReplyToAccountId)!==g&&((L=s==null?void 0:s.account)==null?void 0:L.id)===g;let b=0,y=0;if(d==="favourite+reblog"){for(const N of r)(F=N._types)!=null&&F.includes("favourite")&&b++,(P=N._types)!=null&&P.includes("reblog")&&y++;!y&&b&&(d="favourite"),!b&&y&&(d="reblog")}let v;if(d==="poll"?v=Qe[a?"poll-self":m?"poll-voted":"poll"]:d==="reblog"||d==="favourite"||d==="favourite+reblog"?(u==null?void 0:u.length)>1?v=Qe[`${d}+account`]:h?v=Qe[`${d}_reply`]:v=Qe[d]:Qe[d]?v=Qe[d]:v=`[Unknown notification type: ${d}]`,typeof v=="function"){const N=(u==null?void 0:u.length)||(r==null?void 0:r.length);if(N)v=v(N);else if(d==="admin.report"){const H=l==null?void 0:l.targetAccount;H&&(v=v(e(vt,{account:H,showAvatar:!0})))}}if(d==="mention"&&!s)return null;const I=t.createdAt&&new Date(t.createdAt).toLocaleString(),S={"favourite+reblog":"Boosted/Liked by…",favourite:"Liked by…",reblog:"Boosted by…",follow:"Followed by…"}[d]||"Accounts",x=()=>{k.showGenericAccounts={heading:S,accounts:r,showReactions:d==="favourite+reblog"}};return e("div",{class:`notification notification-${d}`,"data-notification-id":i,tabIndex:"0",children:[e("div",{class:`notification-type notification-${d}`,title:I,children:d==="favourite+reblog"?e($,{children:[e(w,{icon:"rocket",size:"xl",alt:d,class:"reblog-icon"}),e(w,{icon:"heart",size:"xl",alt:d,class:"favourite-icon"})]}):e(w,{icon:dn[d]||"notification",size:"xl",alt:d})}),e("div",{class:"notification-content",children:[d!=="mention"&&e($,{children:[e("p",{children:[!/poll|update/i.test(d)&&e($,{children:(r==null?void 0:r.length)>1?e($,{children:[e("b",{tabIndex:"0",onClick:x,children:[e("span",{title:r.length,children:Pe(r.length)})," ","people"]})," "]}):e($,{children:[e(vt,{account:o,showAvatar:!0})," "]})}),v,d==="mention"&&e("span",{class:"insignificant",children:[" ","•"," ",e(Tt,{datetime:t.createdAt,format:"micro"})]})]}),d==="follow_request"&&e(Nt,{accountID:o.id})]}),(r==null?void 0:r.length)>1&&e("p",{class:"avatars-stack",children:[r.slice(0,Mt).map((N,H)=>e($,{children:[e("a",{href:N.url,rel:"noopener noreferrer",class:"account-avatar-stack",onClick:A=>{A.preventDefault(),k.showAccount=N},children:[e(Ge,{url:N.avatarStatic,size:r.length<=10?"xxl":r.length<20?"xl":r.length<30?"l":r.length<40?"m":"s",alt:`${N.displayName} @${N.acct}`,squircle:N==null?void 0:N.bot},N.id),d==="favourite+reblog"&&e("div",{class:"account-sub-icons",children:N._types.map(A=>e(w,{icon:dn[A],size:"s",class:`${A}-icon`}))})]})," "]})),e("button",{type:"button",class:"small plain",onClick:x,children:[r.length>Mt&&`+${r.length-Mt}`,e(w,{icon:"chevron-down"})]})]}),(u==null?void 0:u.length)>1&&e("ul",{class:"notification-group-statuses",children:u.map(N=>e("li",{children:e(hn,{class:`status-link status-type-${d}`,to:n?`/${n}/s/${N.id}`:`/s/${N.id}`,children:e(Ce,{status:N,size:"s"})})},N.id))}),s&&(!(u!=null&&u.length)||(u==null?void 0:u.length)<=1)&&e(hn,{class:`status-link status-type-${d}`,to:n?`/${n}/s/${p}`:`/s/${p}`,onContextMenu:N=>{const H=N.target.querySelector(".status");if(H){if(N.metaKey)return;N.preventDefault(),H.dispatchEvent(new MouseEvent("contextmenu",{clientX:N.clientX,clientY:N.clientY}))}},children:c?e(Ce,{status:f,size:"s"}):e(Ce,{statusID:p,size:"s"})})]})]})}function hn(t){const n=os();return e(W,{...t,"data-read-more":"Read more →",ref:n})}const jt=Fe(oi),ci=Fe(function(){if(!("serviceWorker"in navigator))return null;const n=pe(k),{routeNotification:c}=n,{id:i,accessToken:s}=c||{},[o,l]=C(!1);ze(()=>{if(!i||!s)return;const{instance:u}=B(),{masto:d,instance:f}=B({accessToken:s}),p=u===f,g=s?cs(s):nt();(async()=>{const a=await d.v1.notifications.$select(i).fetch();if(a&&g){const m=g.instanceURL,{type:h,status:b,account:y}=a,v=!!document.querySelector("#modal-container > *"),I=h==="follow"&&!!(y!=null&&y.id),S=!!(y!=null&&y.id),x=!!(b!=null&&b.id);I&&p?k.showAccount={account:y,instance:m}:v||!p||S&&x?l({id:i,account:g,notification:a,sameInstance:p}):x?location.hash=`/${u}/s/${b.id}`:I?location.hash=`/${u}/a/${y.id}`:location.hash="/notifications"}})()},[i,s]),ze(()=>{const u=d=>{const{type:f,id:p,accessToken:g}=(d==null?void 0:d.data)||{};f==="notification"&&(k.routeNotification={id:p,accessToken:g})};return navigator.serviceWorker.addEventListener("message",u),()=>{navigator.serviceWorker.removeEventListener("message",u)}},[]),ze(()=>{navigator!=null&&navigator.clearAppBadge&&navigator.clearAppBadge()},[]),St(u=>{u&&(navigator!=null&&navigator.clearAppBadge)&&navigator.clearAppBadge()});const r=()=>{l(!1),k.routeNotification=null,/\/notifications\?id=/i.test(location.hash)&&(location.hash="/notifications")};if(o){const{id:u,account:d,notification:f,sameInstance:p}=o;return e(we,{class:"light",onClick:g=>{g.target===g.currentTarget&&r()},children:e("div",{class:"sheet",tabIndex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:r,children:e(w,{icon:"x"})}),e("header",{children:e("b",{children:"Notification"})}),e("main",{children:[!p&&e("p",{children:"This notification is from your other account."}),e("div",{class:"notification-peek",onClick:g=>{const{target:a}=g;(g.target.tagName==="BUTTON"||g.target.tagName==="A")&&r()},children:e(jt,{instance:d.instanceURL,notification:f,isStatic:!0})}),e("div",{style:{textAlign:"end"},children:e(W,{to:"/notifications",class:"button light",onClick:r,children:[e("span",{children:"View all notifications"})," ",e(w,{icon:"arrow-right"})]})})]})]})})}return null});const qn=fs((t,n)=>{const{instance:c}=B(),[i,s]=Be(),[o,l]=C(!1),[r,u]=C(i.get("q")||""),d=i.get("type"),f=R(null),p=R(null);return ps(n,()=>({setValue:g=>{u(g)},focus:()=>{p.current.focus()},select:()=>{p.current.select()},blur:()=>{p.current.blur()}})),e("form",{ref:f,class:"search-popover-container",onSubmit:g=>{var m;if(g.preventDefault(),/\/search/.test(location.hash))if(r){const h={q:r};d&&(h.type=d),s(h)}else s({});else r?location.hash=`/search?q=${encodeURIComponent(r)}${d?`&type=${d}`:""}`:location.hash="/search";(m=t==null?void 0:t.onSubmit)==null||m.call(t,g)},children:[e("input",{ref:p,value:r,name:"q",type:"search",placeholder:"Search",dir:"auto",autocomplete:"off",autocorrect:"off",autocapitalize:"off",onSearch:g=>{g.target.value||s({})},onInput:g=>{u(g.target.value),l(!0)},onFocus:()=>{l(!0)},onBlur:()=>{var g,a;setTimeout(()=>{l(!1)},100),(a=(g=f.current)==null?void 0:g.querySelector(".search-popover-item.focus"))==null||a.classList.remove("focus")},onKeyDown:g=>{var m;const{key:a}=g;switch(a){case"Escape":l(!1);break;case"Down":case"ArrowDown":if(g.preventDefault(),o){const h=f.current.querySelector(".search-popover-item.focus");if(h){let b=h.nextElementSibling;for(;b&&b.hidden;)b=b.nextElementSibling;b&&(b.classList.add("focus"),Array.from(b.parentElement.children).filter(v=>v!==b).forEach(v=>{v.classList.remove("focus")}))}else{const b=f.current.querySelector(".search-popover-item");b&&b.classList.add("focus")}}break;case"Up":case"ArrowUp":if(g.preventDefault(),o){const h=document.querySelector(".search-popover-item.focus");if(h){let b=h.previousElementSibling;for(;b&&b.hidden;)b=b.previousElementSibling;b&&(b.classList.add("focus"),Array.from(b.parentElement.children).filter(v=>v!==b).forEach(v=>{v.classList.remove("focus")}))}else{const b=document.querySelector(".search-popover-item:last-child");b&&b.classList.add("focus")}}break;case"Enter":if(o){const h=document.querySelector(".search-popover-item.focus");h&&(g.preventDefault(),h.click()),l(!1),(m=t==null?void 0:t.onSubmit)==null||m.call(t,g)}break}}}),e("div",{class:"search-popover",hidden:!o||!r,children:!!r&&[{label:e($,{children:["Posts with ",e("q",{children:r})]}),to:`/search?q=${encodeURIComponent(r)}&type=statuses`,hidden:/^https?:/.test(r)},{label:e($,{children:["Posts tagged with ",e("mark",{children:["#",r.replace(/^#/,"")]})]}),to:`/${c}/t/${r.replace(/^#/,"")}`,hidden:/^@/.test(r)||/^https?:/.test(r)||/\s/.test(r),top:/^#/.test(r),type:"link"},{label:e($,{children:["Look up ",e("mark",{children:r})]}),to:`/${r}`,hidden:!/^https?:/.test(r),top:/^https?:/.test(r),type:"link"},{label:e($,{children:["Accounts with ",e("q",{children:r})]}),to:`/search?q=${encodeURIComponent(r)}&type=accounts`}].sort((g,a)=>g.top&&!a.top?-1:!g.top&&a.top?1:0).map(({label:g,to:a,hidden:m,type:h})=>e(W,{to:a,class:"search-popover-item",hidden:m,onClick:b=>{var y;(y=t==null?void 0:t.onSubmit)==null||y.call(t,b)},children:[e(w,{icon:h==="link"?"arrow-right":"search",class:"more-insignificant"}),e("span",{children:g})," "]}))})]})}),ai=Fe(function({onClose:n=()=>{}}){const[c,i]=C(!1),s=R(null);$e("/",l=>{i(!0),setTimeout(()=>{var r,u,d,f;(u=(r=s.current)==null?void 0:r.focus)==null||u.call(r),(f=(d=s.current)==null?void 0:d.select)==null||f.call(d)},0)},{preventDefault:!0,ignoreEventWhen:l=>{const r=/\/search/.test(location.hash),u=!!document.querySelector("#modal-container > *");return r||u}});const o=()=>{i(!1),n()};return $e("esc",l=>{var r,u;(u=(r=s.current)==null?void 0:r.blur)==null||u.call(r),o()},{enabled:c,enableOnFormTags:!0,preventDefault:!0}),e("div",{id:"search-command-container",hidden:!c,onClick:l=>{l.target===l.currentTarget&&o()},children:e(qn,{ref:s,onSubmit:()=>{o()}})})});function ri(){const{instance:t}=B(),n=pe(k),{shortcuts:c,settings:i}=n;if(!c.length||i.shortcutsColumnsMode||i.shortcutsViewMode==="multi-column")return null;const s=R(),o=be(()=>c.map((r,u)=>{const{type:d,...f}=r;if(!It[d])return null;let{id:p,path:g,title:a,subtitle:m,icon:h}=It[d];return typeof p=="function"&&(p=p(f,u)),typeof g=="function"&&(g=g({...f,instance:f.instance||t},u)),typeof a=="function"&&(a=a(f,u)),typeof m=="function"&&(m=m(f,u)),typeof h=="function"&&(h=h(f,u)),{id:p,path:g,title:a,subtitle:m,icon:h}}).filter(Boolean),[c]),l=Rn();return $e(["1","2","3","4","5","6","7","8","9"],(r,u)=>{var f,p;const d=parseInt(u.keys[0],10)-1;if(d<o.length){const{path:g}=o[d];g&&(l(g),(p=(f=s.current)==null?void 0:f.closeMenu)==null||p.call(f))}}),e("div",{id:"shortcuts",children:n.settings.shortcutsViewMode==="tab-menu-bar"?e("nav",{class:"tab-bar",children:e("ul",{children:o.map(({id:r,path:u,title:d,subtitle:f,icon:p},g)=>e("li",{children:e(W,{class:f?"has-subtitle":"",to:u,onClick:a=>{if(a.target.classList.contains("is-active")){a.preventDefault();const m=document.getElementById(`${r}-page`);if(m){m.scrollTop=0;const h=m.querySelector(".updates-button");h&&h.click()}}},children:[e(w,{icon:p,size:"xl",alt:d}),e("span",{children:[e(Pt,{children:d}),f&&e($,{children:[e("br",{}),e("small",{children:f})]})]})]})},g+d))})}):e(Ke,{instanceRef:s,overflow:"auto",viewScroll:"close",boundingBoxPadding:"8 8 8 8",menuClassName:"glass-menu shortcuts-menu",gap:8,position:"anchor",menuButton:e("button",{type:"button",id:"shortcuts-button",class:"plain",onTransitionStart:r=>{var u,d;try{const{target:f}=r;getComputedStyle(f).pointerEvents==="none"&&((d=(u=s.current)==null?void 0:u.closeMenu)==null||d.call(u))}catch{}},children:e(w,{icon:"shortcut",size:"xl",alt:"Shortcuts"})}),children:o.map(({path:r,title:u,subtitle:d,icon:f},p)=>e(Ae,{to:r,class:"glass-menu-item",children:[e(w,{icon:f,size:"l"})," ",e("span",{class:"menu-grow",children:[e("span",{children:e(Pt,{children:u})}),d&&e($,{children:[" ",e("small",{class:"more-insignificant",children:d})]})]}),e("span",{class:"menu-shortcut hide-until-focus-visible",children:p+1})]},p+u))})})}const li=Fe(ri);function lt(t){const{containerProps:n}=t,c=ms(),i=R();return e(Ke,{boundingBoxPadding:Tn(),repositionFlag:`${c.width}x${c.height}`,...t,instanceRef:i,containerProps:{onClick:s=>{var o,l,r;s.target===s.currentTarget&&((l=(o=i.current)==null?void 0:o.closeMenu)==null||l.call(o)),(r=n==null?void 0:n.onClick)==null||r.call(n,s)},...n}})}function di(t){var s;let n=[],c=[],i=0;for(let o=0;o<t.length;o++){const l=t[o];l.reblog&&!((s=l.account)!=null&&s.group)?(c.push(l),i++):(n.push(l),i<3&&(i=0))}if(t.length>10&&(c.length>t.length/4||i>=3)){const o=c.map(l=>l.id);if(c.length>t.length*3/4)n=[...n,{id:o,items:c,type:"boosts"}];else{const l=Math.floor(n.length/2);n=[...n.slice(0,l),{id:o,items:c,type:"boosts"},...n.slice(l)]}return n}else return t}function un(t,n){const c=Z.account.get("boostedStatusIDs")||{},i=t.filter(o=>{if(!o.reblog)return!0;const l=`${n}-${o.reblog.id}`,r=c[l];return r&&r!==o.id?!1:(c[l]=o.id,!0)}),s=Object.keys(c);return s.length>50&&s.slice(0,s.length-50).forEach(o=>{delete c[o]}),Z.account.set("boostedStatusIDs",c),i}function hi(t){const n=[];let c=0;t.forEach(o=>{for(let r=0;r<n.length;r++){if(n[r].find(u=>u.id===o.id))return;if(n[r].find(u=>u.id===o.inReplyToId)||n[r].find(u=>u.inReplyToId===o.id)){n[r].push(o);return}}const l=t.find(r=>r.id===o.inReplyToId);l&&(n[c++]=[o,l])});for(let o=0;o<n.length;o++)for(let l=o+1;l<n.length;l++)n[o].find(u=>n[l].includes(u))&&(n[o]=[...n[o],...n[l]],n[o]=n[o].filter((u,d,f)=>f.findIndex(p=>p.id===u.id)===d),n.splice(l,1),l--);n.forEach(o=>{o.sort((l,r)=>!l.inReplyToId&&!r.inReplyToId?new Date(l.createdAt)-new Date(r.createdAt):l.inReplyToId===r.id?1:r.inReplyToId===l.id||!l.inReplyToId?-1:r.inReplyToId?new Date(l.createdAt)-new Date(r.createdAt):1)}),n.forEach(o=>{const l=o[0].account.id;o.forEach(r=>{r.account.id!==l&&(r._differentAuthor=!0)})}),n.length;const i=[],s=[];return t.forEach(o=>{if(o.reblog){i.push(o);return}for(let l=0;l<n.length;l++)if(n[l].find(r=>r.id===o.id)){if(s.includes(l))return;const r=n[l];r.sort((d,f)=>{const p=new Date(d.createdAt),g=new Date(f.createdAt);return p-g});const u=r[0].account.id;i.push({id:r.map(d=>d.id),items:r,type:r.every(d=>d.account.id===u)?"thread":"conversation"}),s.push(l);return}i.push(o)}),i}function xt({scrollableRef:t,distanceFromStart:n=1,distanceFromEnd:c=1,scrollThresholdStart:i=10,scrollThresholdEnd:s=10,direction:o="vertical",distanceFromStartPx:l,distanceFromEndPx:r}={}){const[u,d]=C(null),[f,p]=C(!1),[g,a]=C(!1),[m,h]=C(!1),[b,y]=C(!1),v=o==="vertical";return ze(()=>{const I=t.current;if(!I)return{};let S=v?I.scrollTop:I.scrollLeft;function x(){const{scrollTop:M,scrollLeft:L,scrollHeight:F,scrollWidth:P,clientHeight:N,clientWidth:H}=I,A=v?M:L,ie=v?F:P,ce=v?N:H,Le=Math.abs(A-S),K=l||Math.min(ce*n,ie,A),te=r||Math.min(ce*c,ie,ie-A-ce);Le>=(S<A?s:i)&&(d(S<A?"end":"start"),S=A),p(A<=0),a(A+ce>=ie),h(A<=K),y(A+ce>=ie-te)}return I.addEventListener("scroll",x,{passive:!0}),()=>I.removeEventListener("scroll",x)},[n,c,i,s]),{scrollDirection:u,reachStart:f,reachEnd:g,nearReachStart:m,nearReachEnd:b,init:()=>{t.current&&t.current.dispatchEvent(new Event("scroll"))}}}function dt(t){var I,S,x,M,L;const n=pe(k),{masto:c,instance:i,authenticated:s}=B(),[o,l]=C(),[r,u]=C(!1);z(()=>{const F=Z.local.getJSON("accounts")||[],P=F.find(N=>N.info.id===Z.session.get("currentAccount"));P&&l(P),u(F.length>1)},[]);const d=(n.settings.shortcutsColumnsMode||n.settings.shortcutsViewMode==="multi-column")&&!n.shortcuts.find(F=>F.type==="following"),f=gs(()=>{k.showAccounts=!0},{threshold:600,detect:"touch",cancelOnMovement:!0}),p=R(),[g,a]=C(void 0),m=Tn([0,0,n.settings.shortcutsViewMode==="tab-menu-bar"?50:0,0]),h=R();async function b(F){return(F||!h.current)&&(h.current=c.v1.mutes.list({limit:80})),await h.current.next()}const y=R();async function v(F){return(F||!y.current)&&(y.current=c.v1.blocks.list({limit:80})),await y.current.next()}return e($,{children:[e("button",{ref:p,type:"button",class:`button plain nav-menu-button ${r?"with-avatar":""} ${open?"active":""}`,style:{position:"relative"},onClick:()=>{a(F=>F?void 0:"open")},onContextMenu:F=>{F.preventDefault(),k.showAccounts=!0},...f(),children:[r&&e(Ge,{url:((I=o==null?void 0:o.info)==null?void 0:I.avatar)||((S=o==null?void 0:o.info)==null?void 0:S.avatarStatic),size:"l",squircle:(x=o==null?void 0:o.info)==null?void 0:x.bot}),e(w,{icon:"menu",size:r?"s":"l"})]}),e(Mn,{menuClassName:"nav-menu",state:g,anchorRef:p,onClose:()=>{a(void 0)},containerProps:{style:{zIndex:10},onClick:()=>{a(void 0)}},portal:{target:document.body},...t,overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:m,unmountOnClose:!0,children:[!!((M=n.appVersion)!=null&&M.commitHash)&&n.appVersion.commitHash!=="12d0e6a"&&e("div",{class:"top-menu",children:[e(ee,{onClick:()=>{confirm("Reload page now to update?")&&(async()=>{try{location.reload()}catch{}})()},children:[e(w,{icon:"sparkles",class:"sparkle-icon",size:"l"})," ",e("span",{children:"New update available…"})]}),e(Ee,{})]}),e("section",{children:[e(Ae,{to:"/",children:[e(w,{icon:"home",size:"l"})," ",e("span",{children:"Home"})]}),s&&e($,{children:[d&&e(Ae,{to:"/following",children:[e(w,{icon:"following",size:"l"})," ",e("span",{children:"Following"})]}),e(Ae,{to:"/mentions",children:[e(w,{icon:"at",size:"l"})," ",e("span",{children:"Mentions"})]}),e(Ae,{to:"/notifications",children:[e(w,{icon:"notification",size:"l"})," ",e("span",{children:"Notifications"}),n.notificationsShowNew&&e("sup",{title:"New",style:{opacity:.5},children:[" ","•"]})]}),e(Ee,{}),e(Ae,{to:"/l",children:[e(w,{icon:"list",size:"l"})," ",e("span",{children:"Lists"})]}),e(Ae,{to:"/ft",children:[e(w,{icon:"hashtag",size:"l"})," ",e("span",{children:"Followed Hashtags"})]}),e(Ae,{to:"/b",children:[e(w,{icon:"bookmark",size:"l"})," ",e("span",{children:"Bookmarks"})]}),e(Ae,{to:"/f",children:[e(w,{icon:"heart",size:"l"})," ",e("span",{children:"Likes"})]})]}),e(Ee,{}),e(Ae,{to:"/search",children:[e(w,{icon:"search",size:"l"})," ",e("span",{children:"Search"})]}),e(Ae,{to:`/${i}/p/l`,children:[e(w,{icon:"group",size:"l"})," ",e("span",{children:"Local"})]}),e(Ae,{to:`/${i}/p`,children:[e(w,{icon:"earth",size:"l"})," ",e("span",{children:"Federated"})]}),e(Ae,{to:`/${i}/trending`,children:[e(w,{icon:"chart",size:"l"})," ",e("span",{children:"Trending"})]})]}),e("section",{children:s?e($,{children:[e(Ee,{}),((L=o==null?void 0:o.info)==null?void 0:L.id)&&e(Ae,{to:`/${i}/a/${o.info.id}`,children:[e(w,{icon:"user",size:"l"})," ",e("span",{children:"Profile"})]}),e(ee,{onClick:()=>{k.showAccounts=!0},children:[e(w,{icon:"group",size:"l"})," ",e("span",{children:"Accounts…"})]}),e(ee,{onClick:()=>{k.showGenericAccounts={id:"mute",heading:"Muted users",fetchAccounts:b}},children:[e(w,{icon:"mute",size:"l"})," Muted users…"]}),e(ee,{onClick:()=>{k.showGenericAccounts={id:"block",heading:"Blocked users",fetchAccounts:v}},children:[e(w,{icon:"block",size:"l"}),"Blocked users…"]}),e(Ee,{className:"divider-grow"}),e(ee,{onClick:()=>{k.showKeyboardShortcutsHelp=!0},children:[e(w,{icon:"keyboard",size:"l"})," ",e("span",{children:"Keyboard shortcuts"})]}),e(ee,{onClick:()=>{k.showShortcutsSettings=!0},children:[e(w,{icon:"shortcut",size:"l"})," ",e("span",{children:"Shortcuts / Columns…"})]}),e(ee,{onClick:()=>{k.showSettings=!0},children:[e(w,{icon:"gear",size:"l"})," ",e("span",{children:"Settings…"})]})]}):e($,{children:[e(Ee,{}),e(Ae,{to:"/login",children:[e(w,{icon:"user",size:"l"})," ",e("span",{children:"Log in"})]}),e(ee,{onClick:()=>{k.showSettings=!0},children:[e(w,{icon:"gear",size:"l"})," ",e("span",{children:"Settings…"})]})]})})]})]})}const ft={block:"nearest",inline:"center",behavior:"smooth"};function Oe({title:t,titleComponent:n,id:c,instance:i,emptyText:s,errorText:o,useItemID:l,boostsCarousel:r,fetchItems:u=()=>{},checkForUpdates:d=()=>{},checkForUpdatesInterval:f=6e4,headerStart:p,headerEnd:g,timelineStart:a,allowFilters:m,refresh:h}){const b=pe(k),[y,v]=C([]),[I,S]=C("default"),[x,M]=C(!1),[L,F]=C(!1),[P,N]=C(!0),H=R(),A=kt(q=>{F(!1),I!=="loading"&&(S("loading"),(async()=>{try{let{done:Y,value:J}=await u(q);Array.isArray(J)?(r&&(J=di(J)),J=hi(J),v(q?J:oe=>[...oe,...J]),J.length||(Y=!0),M(!Y)):M(!1),S("default")}catch{S("error")}finally{A.cancel()}})())},1500,{leading:!0,trailing:!1}),ie=".timeline-item, .timeline-item-alt",ce=$e("j, shift+j",(q,Y)=>{const J=document.activeElement.closest(ie),oe=J==null?void 0:J.getBoundingClientRect(),ne=Array.from(H.current.querySelectorAll(ie));if(J&&oe.top<H.current.clientHeight&&oe.bottom>0){const O=ne.indexOf(J);let T=ne[O+1];Y.shift&&(T=ne.find((_,E)=>E>O&&!_.classList.contains("timeline-item-alt"))),T&&(T.focus(),T.scrollIntoView(ft))}else{const O=ne.find(T=>{const _=T.getBoundingClientRect();return _.top>=44&&_.left>=0});O&&(O.focus(),O.scrollIntoView(ft))}}),Le=$e("k, shift+k",(q,Y)=>{const J=document.activeElement.closest(ie),oe=J==null?void 0:J.getBoundingClientRect(),ne=Array.from(H.current.querySelectorAll(ie));if(J&&oe.top<H.current.clientHeight&&oe.bottom>0){const O=ne.indexOf(J);let T=ne[O-1];Y.shift&&(T=ne.findLast((_,E)=>E<O&&!_.classList.contains("timeline-item-alt"))),T&&(T.focus(),T.scrollIntoView(ft))}else{const O=ne.find(T=>{const _=T.getBoundingClientRect();return _.top>=44&&_.left>=0});O&&(O.focus(),O.scrollIntoView(ft))}}),K=$e(["enter","o"],()=>{const q=document.activeElement.closest(ie);q&&q.click()}),{scrollDirection:te,nearReachStart:j,nearReachEnd:D,reachStart:G,reachEnd:Q}=xt({scrollableRef:H,distanceFromEnd:2,scrollThresholdStart:44});z(()=>{var q;(q=H.current)==null||q.scrollTo({top:0}),A(!0)},[]),z(()=>{A(!0)},[h]),z(()=>{G&&A(!0)},[G]),z(()=>{(D||Q&&x)&&A()},[D,x]);const ue=We(async({disableIdleCheck:q=!1}={})=>{b.settings.autoRefresh&&H.current.scrollTop===0&&(q||window.__IDLE__)&&!pi()?A(!0):await d()&&F(!0)},[c,A,d,b.settings.autoRefresh]),ke=kt(ue,3e3),Re=R();St(q=>{if(q){const Y=Date.now()-Re.current;(!Re.current||Y>1e3*60)&&ke({disableIdleCheck:!0})}else Re.current=Date.now(),ke.cancel();N(q)},[d,ue,b.settings.autoRefresh]),yn(ue,P&&!L?f:null);const ae=te==="end"&&!j;return e("div",{id:`${c}-page`,class:"deck-container",ref:q=>{H.current=q,ce.current=q,Le.current=q,K.current=q},tabIndex:"-1",children:e("div",{class:"timeline-deck deck",children:[e("header",{hidden:ae,onClick:q=>{var Y;q.target.closest("a, button")||(Y=H.current)==null||Y.scrollTo({top:0,behavior:"smooth"})},onDblClick:q=>{q.target.closest("a, button")||A(!0)},class:I==="loading"?"loading":"",children:[e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(dt,{}),p??e(W,{to:"/",class:"button plain home-button",children:e(w,{icon:"home",size:"l"})})]}),t&&(n||e("h1",{children:t})),e("div",{class:"header-side",children:!!g&&g})]}),y.length>0&&I!=="loading"&&!ae&&L&&e("button",{class:"updates-button shiny-pill",type:"button",onClick:()=>{var q;A(!0),(q=H.current)==null||q.scrollTo({top:0,behavior:"smooth"})},children:[e(w,{icon:"arrow-up"})," New posts"]})]}),!!a&&e("div",{class:`timeline-start ${I==="loading"?"loading":""}`,children:a}),y.length?e($,{children:[e("ul",{class:"timeline",children:[y.map(q=>{const{id:Y,reblog:J,items:oe,type:ne,_pinned:O}=q,T=(J==null?void 0:J.id)||Y,_=i?`/${i}/s/${T}`:`/s/${T}`;let E="";ne==="boosts"?E=`${oe.length} Boosts`:ne==="pinned"&&(E="Pinned posts");const X=ne==="boosts"||ne==="pinned";if(oe){if(X)return oe.sort((re,se)=>re._filtered&&!se._filtered?1:!re._filtered&&se._filtered?-1:0),e("li",{class:"timeline-item-carousel",children:e(ui,{title:E,class:`${ne}-carousel`,children:oe.map(re=>{const{id:se,reblog:Te}=re,Me=(Te==null?void 0:Te.id)||se,Se=i?`/${i}/s/${Me}`:`/s/${Me}`;return e("li",{children:e(W,{class:"status-carousel-link timeline-item-alt",to:Se,children:l?e(Ce,{statusID:se,instance:i,size:"s",contentTextWeight:!0,allowFilters:m}):e(Ce,{status:re,instance:i,size:"s",contentTextWeight:!0,allowFilters:m})})},se)})})},`timeline-${Y}`);const de=oe.length>3;return oe.map((re,se)=>{const{id:Te,_differentAuthor:Me}=re,Se=i?`/${i}/s/${Te}`:`/s/${Te}`,U=se>0&&se<oe.length-1,le=re.sensitive&&!!re.spoilerText,fe=!Me&&le&&se>0||de&&U&&(ne==="thread"||ne==="conversation"&&!Me&&!oe[se-1]._differentAuthor&&!oe[se+1]._differentAuthor);return e("li",{class:`timeline-item-container timeline-item-container-type-${ne} timeline-item-container-${se===0?"start":se===oe.length-1?"end":"middle"} ${Me?"timeline-item-diff-author":""}`,children:e(W,{class:"status-link timeline-item",to:Se,children:fe?e(fi,{status:re,instance:i}):l?e(Ce,{statusID:Te,instance:i,allowFilters:m}):e(Ce,{status:re,instance:i,allowFilters:m})})},`timeline-${Te}`)})}return e("li",{children:e(W,{class:"status-link timeline-item",to:_,children:l?e(Ce,{statusID:Y,instance:i,allowFilters:m}):e(Ce,{status:q,instance:i,allowFilters:m})})},`timeline-${Y+O}`)}),x&&I==="loading"&&e($,{children:[e("li",{style:{height:"20vh"},children:e(Ce,{skeleton:!0})}),e("li",{style:{height:"25vh"},children:e(Ce,{skeleton:!0})})]})]}),I==="default"&&(x?e(ot,{onChange:q=>{q&&A()},children:e("button",{type:"button",class:"plain block",onClick:()=>A(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}))]}):I==="loading"?e("ul",{class:"timeline",children:Array.from({length:5}).map((q,Y)=>e("li",{children:e(Ce,{skeleton:!0})},Y))}):I!=="error"&&e("p",{class:"ui-state",children:s}),I==="error"&&e("p",{class:"ui-state",children:[o,e("br",{}),e("br",{}),e("button",{class:"button plain",onClick:()=>A(!y.length),children:"Try again"})]})]})})}function ui({title:t,class:n,children:c}){const i=R(),{reachStart:s,reachEnd:o,init:l}=xt({scrollableRef:i,direction:"horizontal"});return z(()=>{l==null||l()},[]),e("div",{class:`status-carousel ${n}`,children:[e("header",{children:[e("h3",{children:t}),e("span",{children:[e("button",{type:"button",class:"small plain2",disabled:s,onClick:()=>{var r,u;(u=i.current)==null||u.scrollBy({left:-Math.min(320,(r=i.current)==null?void 0:r.offsetWidth),behavior:"smooth"})},children:e(w,{icon:"chevron-left"})})," ",e("button",{type:"button",class:"small plain2",disabled:o,onClick:()=>{var r,u;(u=i.current)==null||u.scrollBy({left:Math.min(320,(r=i.current)==null?void 0:r.offsetWidth),behavior:"smooth"})},children:e(w,{icon:"chevron-right"})})]})]}),e("ul",{ref:i,children:c})]})}function fi({status:t,instance:n}){const c=pe(k),{id:i,visibility:s}=t,o=Cn(t),l=Ot(i,n);return e("article",{class:`status compact-thread ${s==="direct"?"visibility-direct":""}`,tabindex:"-1",children:[c.statusThreadNumber[l]?e("div",{class:"status-thread-badge",children:[e(w,{icon:"thread",size:"s"}),c.statusThreadNumber[l]?` ${c.statusThreadNumber[l]}/X`:""]}):e("div",{class:"status-thread-badge",children:e(w,{icon:"thread",size:"s"})}),e("div",{class:"content-compact",title:o,children:[o,t.sensitive&&t.spoilerText&&e($,{children:[" ",e("span",{class:"spoiler-badge",children:e(w,{icon:"eye-close",size:"s"})})]})]})]})}function pi(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}const et=20,Gt=1983,fn=`${Gt}-01`,mi=(()=>{try{const t=document.createElement("input");return t.setAttribute("type","month"),t.type==="month"}catch{return!1}})();async function gi(t){var i;const{masto:n}=B({instance:t}),c=await n.v2.search.fetch({q:"from:me",type:"statuses",limit:1});return!!((i=c==null?void 0:c.statuses)!=null&&i.length)}const bi=st(gi);function yi(){const t=pe(k),{id:n,...c}=Ye(),[i,s]=Be(),o=i.get("month"),l=!i.get("replies"),r=!!i.get("boosts"),u=i.get("tagged"),d=!!i.get("media"),{masto:f,instance:p,authenticated:g}=B({instance:c.instance}),a=R(),m=[o,l,r,u,d],[h,b]=C(),y=R(0);z(()=>{y.current=0},m);const v=be(()=>p===B().instance,[p]),[I,S]=C(!1);z(()=>{v&&h!=null&&h.acct&&(async()=>{const K=await bi(p);S(K)})()},[p,v,h==null?void 0:h.acct]);async function x(K){var ue,ke,Re;const te=/^\d{4}-[01]\d$/.test(o),j=((ke=(ue=o==null?void 0:o.split)==null?void 0:ue.call(o,"-"))==null?void 0:ke[0])>=Gt;if(te&&j){if(!h)return{value:[],done:!0};const[ae,q]=o.split("-"),Y=parseInt(q,10)-1,J=new Date(ae,Y,0),oe=`${J.getFullYear()}-${(J.getMonth()+1).toString().padStart(2,"0")}-${J.getDate().toString().padStart(2,"0")}`,ne=new Date(ae,Y+1,1),O=`${ne.getFullYear()}-${(ne.getMonth()+1).toString().padStart(2,"0")}-${ne.getDate().toString().padStart(2,"0")}`;let T;K?(T=et+1,y.current=0):(T=et+y.current+1,y.current+=et);const _=await f.v2.search.fetch({q:`from:${h.acct} after:${oe} before:${O}`,type:"statuses",limit:T,offset:y.current});if((Re=_==null?void 0:_.statuses)!=null&&Re.length){const E=_.statuses.slice(0,et);E.forEach(de=>{Ie(de,p)});const X=_.statuses.length<=et;return{value:E,done:X}}else return{value:[],done:!0}}const D=[];if(K){const{value:ae}=await f.v1.accounts.$select(n).statuses.list({pinned:!0}).next();if(ae!=null&&ae.length&&!u&&!d)if(ae.forEach(q=>{q._pinned=!0,Ie(q,p)}),ae.length>=3){const q=ae.map(Y=>Y.id);D.push({id:q,items:ae,type:"pinned"})}else D.push(...ae)}(K||!a.current)&&(a.current=f.v1.accounts.$select(n).statuses.list({limit:et,exclude_replies:l,exclude_reblogs:r,only_media:d,tagged:u}));const{value:G,done:Q}=await a.current.next();return G!=null&&G.length&&(D.push(...G),G.forEach(ae=>{Ie(ae,p)})),{value:D,done:Q}}const[M,L]=C([]);xe(`${h!=null&&h.displayName?h.displayName+" ":""}@${h!=null&&h.acct?h.acct:"Account posts"}`,"/:instance?/a/:id"),z(()=>{(async()=>{try{const K=await f.v1.accounts.$select(n).fetch();b(K)}catch{}try{const K=await f.v1.accounts.$select(n).featuredTags.list();L(K)}catch{}})()},[n]);const{displayName:F,acct:P,emojis:N}=h||{},H=R(),A=be(()=>{const K=t.accounts[`${n}@${p}`],te=!l||r||u||d||!!o;return e($,{children:[e(Un,{instance:p,account:K||n,fetchAccount:()=>f.v1.accounts.$select(n).fetch(),authenticated:g,standalone:!0}),e("div",{class:"filter-bar",ref:H,children:[te?e(W,{to:`/${p}/a/${n}`,class:"insignificant filter-clear",title:"Clear filters",children:e(w,{icon:"x",size:"l"})},"clear-filters"):e(w,{icon:"filter",class:"insignificant",size:"l"}),e(W,{to:`/${p}/a/${n}${l?"?replies=1":""}`,onClick:()=>{l&&he("Showing post with replies")},class:l?"":"is-active",children:"+ Replies"}),e(W,{to:`/${p}/a/${n}${r?"":"?boosts=0"}`,onClick:()=>{r||he("Showing posts without boosts")},class:r?"is-active":"",children:"- Boosts"}),e(W,{to:`/${p}/a/${n}${d?"":"?media=1"}`,onClick:()=>{d||he("Showing posts with media")},class:d?"is-active":"",children:"Media"}),M.map(j=>e(W,{to:`/${p}/a/${n}${u===j.name?"":`?tagged=${encodeURIComponent(j.name)}`}`,onClick:()=>{u!==j.name&&he(`Showing posts tagged with #${j.name}`)},class:u===j.name?"is-active":"",children:e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),j.name]})},j.id)),I&&(mi?e("label",{class:`filter-field ${o?"is-active":""}`,children:[e(w,{icon:"month",size:"l"}),e("input",{type:"month",disabled:!(h!=null&&h.acct),value:o||"",min:fn,max:new Date().toISOString().slice(0,7),onInput:j=>{const{value:D,validity:G}=j.currentTarget;G.valid&&s(D?{month:D}:{})}})]}):e(wi,{class:`filter-field ${o?"is-active":""}`,disabled:!(h!=null&&h.acct),value:o||"",min:fn,max:new Date().toISOString().slice(0,7),onInput:j=>{const{value:D,validity:G}=j;G.valid&&s(D?{month:D}:{})}}))]})]})},[n,p,g,M,I,...m]);z(()=>{var te;const K=(te=H.current)==null?void 0:te.querySelector(".is-active");K&&H.current.scrollTo({behavior:"smooth",left:K.offsetLeft-(H.current.offsetWidth-K.offsetWidth)/2})},[M,I,...m]);const ie=be(()=>h!=null&&h.url?new URL(h.url).hostname:null,[h]),Le=!!h&&!(p===ie);return e(Oe,{title:`${h!=null&&h.acct?"@"+h.acct:"Posts"}`,titleComponent:e("h1",{class:"header-account",children:[e("b",{children:e(kn,{text:F,emojis:N})}),e("div",{children:e("span",{children:["@",P]})})]}),id:"account-statuses",instance:p,emptyText:"Nothing to see here yet.",errorText:"Unable to load posts",fetchItems:x,useItemID:!0,boostsCarousel:t.settings.boostsCarousel,timelineStart:A,refresh:[l,r,u,d,o+(h==null?void 0:h.acct)].toString(),headerEnd:e(lt,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:e(ee,{disabled:!Le,onClick:()=>{(async()=>{try{const{masto:K}=B({instance:ie}),te=await K.v1.accounts.lookup({acct:h.acct}),{id:j}=te;location.hash=`/${ie}/a/${j}`}catch{alert("Unable to fetch account info")}})()},children:[e(w,{icon:"transfer"})," ",e("small",{class:"menu-double-lines",children:["Switch to account's instance (",e("b",{children:ie}),")"]})]})})},n)}function wi(t){const{class:n,disabled:c,value:i,min:s,max:o,onInput:l=()=>{}}=t,[r,u]=(i==null?void 0:i.split("-"))||[],d=R(),f=R(),p=(g,a)=>{const[m,h]=(s==null?void 0:s.split("-"))||[],[b,y]=(o==null?void 0:o.split("-"))||[];return!(a<m||a>b||a===m&&g<h||a===b&&g>y)};return e("div",{class:n,children:[e(w,{icon:"month",size:"l"}),e("select",{ref:d,disabled:c,value:u||"",onInput:g=>{const{value:a}=g.currentTarget,m=f.current.value;if(!p(a,m))return{value:"",validity:{valid:!1}};l({value:a?`${m}-${a}`:"",validity:{valid:!0}})},children:[e("option",{value:"",children:"Month"}),e("option",{disabled:!0,children:"-----"}),Array.from({length:12},(g,a)=>e("option",{value:(a+1).toString().padStart(2,"0"),children:new Date(0,a).toLocaleString("default",{month:"long"})},a))]})," ",e("input",{ref:f,type:"number",disabled:c,value:r||new Date().getFullYear(),min:(s==null?void 0:s.slice(0,4))||Gt,max:(o==null?void 0:o.slice(0,4))||new Date().getFullYear(),onInput:g=>{const{value:a,validity:m}=g.currentTarget,h=d.current.value;if(!m.valid||!p(h,a))return{value:"",validity:{valid:!1}};l({value:a?`${a}-${h}`:"",validity:{valid:!0}})},style:{width:"4.5em"}})]})}const vi=20;function Hn(){xe("Bookmarks","/b");const{masto:t,instance:n}=B(),c=R();async function i(s){return(s||!c.current)&&(c.current=t.v1.bookmarks.list({limit:vi})),await c.current.next()}return e(Oe,{title:"Bookmarks",id:"bookmarks",emptyText:"No bookmarks yet. Go bookmark something!",errorText:"Unable to load bookmarks",instance:n,fetchItems:i})}const ki=20;function Vn(){xe("Likes","/f");const{masto:t,instance:n}=B(),c=R();async function i(s){return(s||!c.current)&&(c.current=t.v1.favourites.list({limit:ki})),await c.current.next()}return e(Oe,{title:"Likes",id:"favourites",emptyText:"No likes yet. Go like something!",errorText:"Unable to load likes",instance:n,fetchItems:i})}const Si=200;function Ii(){const{masto:t,instance:n}=B();xe("Followed Hashtags","/ft");const[c,i]=C("default"),[s,o]=C([]);return z(()=>{i("loading"),(async()=>{try{const l=t.v1.followedTags.list({limit:Si}),r=[];do{const{value:u,done:d}=await l.next();if(d||(u==null?void 0:u.length)===0)break;r.push(...u)}while(!0);r.sort((u,d)=>u.name.localeCompare(d.name)),o(r),i("default")}catch{i("error")}})()},[]),e("div",{id:"followed-hashtags-page",class:"deck-container",tabIndex:"-1",children:e("div",{class:"timeline-deck deck",children:[e("header",{children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(dt,{}),e(W,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l"})})]}),e("h1",{children:"Followed Hashtags"}),e("div",{class:"header-side"})]})}),e("main",{children:s.length>0?e("ul",{class:"link-list",children:s.map(l=>e("li",{children:e(W,{to:n?`/${n}/t/${l.name}`:`/t/${l.name}`,children:[e(w,{icon:"hashtag"})," ",e("span",{children:l.name})]})}))}):c==="loading"?e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}):c==="error"?e("p",{class:"ui-state",children:"Unable to load followed hashtags."}):e("p",{class:"ui-state",children:"No hashtags followed yet."})})]})})}function Ti(t,n,c){var u;const{filtered:i}=t;if(!(i!=null&&i.length)||c&&((u=t.account)==null?void 0:u.id)===c)return!0;const o=i.filter(d=>{const{filter:f}=d,p=f.context.includes(n);return p?f.expiresAt?new Date(f.expiresAt)>new Date:p:!1});if(!o.length)return!0;if(o.some(d=>d.filter.filterAction==="hide"))return!1;const r=o.some(d=>d.filter.filterAction==="warn");if(r){const d=o.map(f=>f.filter.title);t._filtered={titles:d,titlesStr:d.join(" • ")}}return r}function He(t,n){if(!(t!=null&&t.length))return[];if(!n)return t;const c=Z.session.get("currentAccount");return t.filter(i=>Ti(i,n,c))}const Ci=20;function Wt({title:t,path:n,id:c,...i}){xe(t||"Following",n||"/following");const{masto:s,streaming:o,instance:l}=B(),r=pe(k),u=R(),d=R();async function f(g){(g||!u.current)&&(u.current=s.v1.timelines.home.list({limit:Ci}));const a=await u.current.next();let{value:m}=a;return m!=null&&m.length&&(g&&(d.current=m[0].id),m=He(m,"home"),m.forEach(h=>{Ie(h,l)}),m=un(m,l),m.sort((h,b)=>{const y=new Date(h.createdAt);return new Date(b.createdAt)-y})),{...a,value:m}}async function p(){try{const g=await s.v1.timelines.home.list({limit:5,since_id:d.current}).next();let{value:a}=g;return!!(a!=null&&a.length&&(d.current=a[0].id,a=un(a,l),a=He(a,"home"),a.some(m=>!m.reblog)))}catch{return!1}}return z(()=>{let g;return(async()=>{if(o){g=o.user.subscribe();for await(const a of g){if(!g)break;if(a.event==="status.update"){const m=a.payload;Ie(m,l)}else if(a.event==="delete"){const m=a.payload,h=$n(m,l);h&&(h._deleted=!0)}}}})(),()=>{var a;(a=g==null?void 0:g.unsubscribe)==null||a.call(g),g=null}},[o]),e(Oe,{title:t||"Following",id:c||"following",emptyText:"Nothing to see here.",errorText:"Unable to load posts.",instance:l,fetchItems:f,checkForUpdates:p,useItemID:!0,boostsCarousel:r.settings.boostsCarousel,...i,allowFilters:!0})}const $i=20,xi=4,pn=xi+1;function jn({columnMode:t,...n}){let{hashtag:c,...i}=t?{}:Ye();n.hashtag&&(c=n.hashtag);let s=c.trim().split(/[\s+]+/);s.sort(),c=s[0];const{masto:o,instance:l,authenticated:r}=B({instance:(n==null?void 0:n.instance)||i.instance}),{authenticated:u}=B(),d=s.map(S=>`#${S}`).join(" "),f=l?`${d} on ${l}`:d;xe(f,"/:instance?/t/:hashtag");const p=R(),g=R(void 0);async function a(S){const x=await o.v1.timelines.tag.$select(c).list({limit:$i,any:s.slice(1),maxId:S?void 0:g.current}).next(),{value:M}=x;return M!=null&&M.length&&(S&&(p.current=M[0].id),M.forEach(L=>{Ie(L,l)}),g.current=M[M.length-1].id),{...x,value:M}}async function m(){try{const S=await o.v1.timelines.tag.$select(c).list({limit:1,any:s.slice(1),since_id:p.current}).next(),{value:x}=S;return!!(x!=null&&x.length)}catch{return!1}}const[h,b]=C("default"),[y,v]=C();z(()=>{(async()=>{try{const S=await o.v1.tags.$select(c).fetch();v(S)}catch{}})()},[c]);const I=s.length>=pn;return e(Oe,{title:f,titleComponent:!!l&&e("h1",{class:"header-account",children:[e("b",{children:d}),e("div",{children:l})]}),id:"hashtag",instance:l,emptyText:"No one has posted anything with this tag yet.",errorText:"Unable to load posts with this tag",fetchItems:a,checkForUpdates:m,useItemID:!0,headerEnd:e(lt,{portal:!0,setDownOverflow:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[!!y&&s.length===1&&e($,{children:[e(Ne,{subMenu:!0,confirm:y.following,confirmLabel:`Unfollow #${c}?`,disabled:h==="loading"||!r,onClick:()=>{b("loading"),y.following?o.v1.tags.$select(c).unfollow().then(()=>{v({...y,following:!1}),he(`Unfollowed #${c}`)}).catch(S=>{alert(S)}).finally(()=>{b("default")}):o.v1.tags.$select(c).follow().then(()=>{v({...y,following:!0}),he(`Followed #${c}`)}).catch(S=>{alert(S)}).finally(()=>{b("default")})},children:y.following?e($,{children:[e(w,{icon:"check-circle"})," ",e("span",{children:"Following…"})]}):e($,{children:[e(w,{icon:"plus"})," ",e("span",{children:"Follow"})]})}),e(Ee,{})]}),e(bs,{className:"menu-field",disabled:I,children:({ref:S})=>e("form",{onSubmit:x=>{var L,F;x.preventDefault();const M=(F=(L=x.target[0].value)==null?void 0:L.trim)==null?void 0:F.call(L);M&&!s.some(P=>P.toLowerCase()===M.toLowerCase())&&(s.push(M),s.sort(),location.hash=l?`/${l}/t/${s.join("+")}`:`/t/${s.join("+")}`)},children:[e(w,{icon:"hashtag"}),e("input",{ref:S,type:"text",placeholder:I?`Max ${pn} tags`:"Add hashtag",required:!0,autocorrect:"off",autocapitalize:"off",spellcheck:!1,pattern:"[^#][^\\s#]+[^#]",disabled:I})]})}),e(ys,{takeOverflow:!0,children:s.map((S,x)=>e(ee,{disabled:s.length===1,onClick:M=>{s.splice(x,1),s.sort(),location.hash=l?`/${l}/t/${s.join("+")}`:`/t/${s.join("+")}`},children:[e(w,{icon:"x",alt:"Remove hashtag",class:"danger-icon"}),e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),S]})]},S))}),e(Ee,{}),e(ee,{disabled:!u,onClick:()=>{const S={type:"hashtag",hashtag:s.join(" "),instance:l};k.shortcuts.some(M=>M.type===S.type&&M.hashtag.split(/[\s+]+/).sort().join(" ")===S.hashtag.split(/[\s+]+/).sort().join(" ")&&(M.instance?M.instance===S.instance:!0))?alert("This shortcut already exists"):(k.shortcuts.push(S),he("Hashtag shortcut added"))},children:[e(w,{icon:"shortcut"})," ",e("span",{children:"Add to Shorcuts"})]}),e(ee,{onClick:()=>{let S=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(S)){S&&alert("Invalid instance");return}S&&(S=S.toLowerCase().trim(),location.hash=`/${S}/t/${s.join("+")}`)},children:[e(w,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]})]})},l+d)}const Li=20;function Gn(t){var h;const n=pe(k),{masto:c,instance:i}=B(),s=(t==null?void 0:t.id)||((h=Ye())==null?void 0:h.id),o=R(),l=R();async function r(b){(b||!l.current)&&(l.current=c.v1.timelines.list.$select(s).list({limit:Li}));const y=await l.current.next();let{value:v}=y;return v!=null&&v.length&&(b&&(o.current=v[0].id),v=He(v,"home"),v.forEach(I=>{Ie(I,i)})),{...y,value:v}}async function u(){try{const b=await c.v1.timelines.list.$select(s).list({limit:1,since_id:o.current});let{value:y}=b;return y=He(y,"home"),!!(y!=null&&y.length)}catch{return!1}}const[d,f]=C({title:"List"});xe(d.title,"/l/:id"),z(()=>{(async()=>{try{const b=await c.v1.lists.$select(s).fetch();f(b)}catch{}})()},[s]);const[p,g]=C(!1),[a,m]=C(!1);return e($,{children:[e(Oe,{title:d.title,id:"list",emptyText:"Nothing yet.",errorText:"Unable to load posts.",instance:i,fetchItems:r,checkForUpdates:u,useItemID:!0,boostsCarousel:n.settings.boostsCarousel,allowFilters:!0,headerStart:e(W,{to:"/l",class:"button plain",children:e(w,{icon:"list",size:"l"})}),headerEnd:e(lt,{portal:!0,setDownOverflow:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[e(ee,{onClick:()=>g({list:d}),children:[e(w,{icon:"pencil",size:"l"}),e("span",{children:"Edit"})]}),e(ee,{onClick:()=>m(!0),children:[e(w,{icon:"group",size:"l"}),e("span",{children:"Manage members"})]})]})},s),p&&e(we,{class:"light",onClick:b=>{b.target===b.currentTarget&&g(!1)},children:e(Vt,{list:p==null?void 0:p.list,onClose:b=>{b.state==="success"&&b.list?f(b.list):b.state==="deleted"&&(location.hash="/l"),g(!1)}})}),a&&e(we,{class:"light",onClick:b=>{b.target===b.currentTarget&&m(!1)},children:e(Ri,{listID:s,onClose:()=>m(!1)})})]})}const Ai=40;function Ri({listID:t,onClose:n}){const{masto:c,instance:i}=B(),[s,o]=C([]),[l,r]=C("default"),[u,d]=C(!1),f=R();async function p(g){d(!1),r("loading"),(async()=>{try{(g||!f.current)&&(f.current=c.v1.lists.$select(t).accounts.list({limit:Ai}));const a=await f.current.next();let{done:m,value:h}=a;h!=null&&h.length?(o(g?h:s.concat(h)),d(!m)):d(!1),r("default")}catch{r("error")}})()}return z(()=>{p(!0)},[]),e("div",{class:"sheet",id:"list-manage-members-container",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Manage members"})}),e("main",{children:e("ul",{children:[s.map(g=>e("li",{children:[e(Ue,{account:g,instance:i}),e(Mi,{account:g,listID:t})]},g.id)),u&&l==="default"&&e(ot,{as:"li",onChange:g=>g&&p(),children:e("button",{type:"button",class:"light block",onClick:p,children:"Show more…"})})]})})]})}function Mi({account:t,listID:n}){const{masto:c}=B(),[i,s]=C("default"),[o,l]=C(!1);return e(Ne,{confirm:!o,confirmLabel:e("span",{children:["Remove @",t.username," from list?"]}),align:"end",menuItemClassName:"danger",onClick:()=>{o?(s("loading"),(async()=>{try{await c.v1.lists.$select(n).accounts.create({accountIds:[t.id]}),s("default"),l(!1)}catch{s("error")}})()):(s("loading"),(async()=>{try{await c.v1.lists.$select(n).accounts.remove({accountIds:[t.id]}),s("default"),l(!0)}catch{s("error")}})())},children:e("button",{type:"button",class:`light ${o?"":"danger"}`,disabled:i==="loading",children:o?"Add":"Remove…"})})}const mn=20,Di=new URLSearchParams;function Wn({columnMode:t,...n}){xe("Mentions","/mentions");const{masto:c,instance:i}=B(),[s]=t?[Di]:Be(),[o,l]=C(null),r=(n==null?void 0:n.type)||s.get("type")||o,u=R(),d=R();async function f(y){(y||!u.current)&&(u.current=c.v1.notifications.list({limit:mn,types:["mention"]}));const v=await u.current.next();let{value:I}=v;return I!=null&&I.length&&(y&&(d.current=I[0].id),I.forEach(({status:S})=>{Ie(S,i)})),{...v,value:I==null?void 0:I.map(S=>S.status)}}const p=R(),g=R();async function a(y){(y||!p.current)&&(p.current=c.v1.conversations.list({limit:mn}));const v=await p.current.next();let{value:I}=v;return I=I==null?void 0:I.filter(S=>S.lastStatus),I!=null&&I.length&&(y&&(g.current=I[0].lastStatus.id),I.forEach(({lastStatus:S})=>{Ie(S,i)})),{...v,value:I==null?void 0:I.map(S=>S.lastStatus)}}function m(...y){return r==="private"?a(...y):f(...y)}async function h(){if(r==="private")try{const y=await c.v1.conversations.list({limit:1,since_id:g.current}).next();let{value:v}=y;return v!=null&&v.length?(g.current=v[0].lastStatus.id,!0):!1}catch{return!1}else try{const y=await c.v1.notifications.list({limit:1,types:["mention"],since_id:d.current}).next();let{value:v}=y;return v!=null&&v.length?(d.current=v[0].id,!0):!1}catch{return!1}}const b=be(()=>e("div",{class:"filter-bar centered",children:[e(W,{to:"/mentions",class:r?"":"is-active",onClick:y=>{t&&(y.preventDefault(),l(null))},children:"All"}),e(W,{to:"/mentions?type=private",class:r==="private"?"is-active":"",onClick:y=>{t&&(y.preventDefault(),l("private"))},children:"Private"})]}),[r]);return e(Oe,{title:"Mentions",id:"mentions",emptyText:"No one mentioned you :(",errorText:"Unable to load mentions.",instance:i,fetchItems:m,checkForUpdates:h,useItemID:!0,timelineStart:b,refresh:r})}function Kn(t){const n={},c=[];for(let o=0,l=0;o<t.length;o++){const r=t[o],{id:u,status:d,account:f,type:p,createdAt:g}=r,a=new Date(g).toLocaleDateString();let m=p;(p==="favourite"||p==="reblog")&&(m="favourite+reblog");const h=`${d==null?void 0:d.id}-${m}-${a}`,b=n[h];if(m==="follow_request")c[l++]=r;else if(b!=null&&b.account){const y=b._accounts.find(v=>v.id===f.id);y?(y._types.push(p),y._types.sort().reverse(),b.id+=`-${u}`):(f._types=[p],b._accounts.push(f),b.id+=`-${u}`)}else{f._types=[p];let y=n[h]={...r,type:m,_accounts:[f]};c[l++]=y}}const i={},s=[];for(let o=0,l=0;o<c.length;o++){const r=c[o],{id:u,account:d,_accounts:f,type:p,createdAt:g}=r,a=new Date(g).toLocaleDateString();if(p==="favourite+reblog"&&d&&f.length===1){const m=`${d==null?void 0:d.id}-${p}-${a}`,h=i[m];if(h)h._statuses.push(r.status),h.id+=`-${u}`;else{let b=i[m]={...r,type:p,_statuses:[r.status]};s[l++]=b}}else s[l++]=r}return s}const Ei=30,_i=new URLSearchParams;function Pi({columnMode:t}){xe("Notifications","/notifications");const{masto:n,instance:c}=B(),i=pe(k),[s,o]=C("default"),[l]=t?[_i]:Be(),r=l.get("id"),u=l.get("access_token"),[d,f]=C(!1),[p,g]=C(!1),a=R(),{nearReachEnd:m,scrollDirection:h,reachStart:b,nearReachStart:y}=xt({scrollableRef:a}),v=h==="end"&&!y,[I,S]=C([]),[x,M]=C([]),L=R();async function F(D){(D||!L.current)&&(L.current=n.v1.notifications.list({limit:Ei,excludeTypes:["follow_request"]}));const G=await L.current.next(),Q=G.value;if(Q!=null&&Q.length){Q.forEach(ke=>{Ie(ke.status,c,{skipThreading:!0})});const ue=Kn(Q);D?(k.notificationsLast=Q[0],k.notifications=ue,n.v1.markers.create({notifications:{lastReadId:Q[0].id}}).catch(()=>{})):k.notifications.push(...ue)}return k.notificationsShowNew=!1,k.notificationsLastFetchTime=Date.now(),G}async function P(){try{return await n.v1.followRequests.list({limit:80})}catch{return[]}}const N=()=>{o("loading"),(async()=>{try{const D=await P();S(D),o("default")}catch{o("error")}})()};async function H(){try{return await n.v1.announcements.list()}catch{return[]}}const A=D=>{o("loading"),(async()=>{try{const G=F(D),Q=P(),ue=H();if(D){const Re=await ue;Re.sort((q,Y)=>{const J=new Date(q.updatedAt||q.createdAt);return new Date(Y.updatedAt||Y.createdAt)-J}),M(Re);const ae=await Q;S(ae)}const{done:ke}=await G;f(!ke),o("default")}catch{o("error")}})()};z(()=>{A(!0)},[]),z(()=>{b&&A(!0)},[b]);const ie=We(()=>{var D;i.settings.autoRefresh&&((D=a.current)==null?void 0:D.scrollTop)===0&&window.__IDLE__&&!Ni()&&i.notificationsShowNew&&s!=="loading"&&A(!0)},[i.notificationsShowNew,i.settings.autoRefresh,s]);z(ie,[i.notificationsShowNew]);const ce=new Date,Le=new Date(ce-24*60*60*1e3);let K=new Date;const te=!i.notifications.some(D=>new Date(D.createdAt).toDateString()===ce.toDateString()),j=R();return z(()=>{r&&(k.routeNotification={id:r,accessToken:atob(u)})},[r,u]),e("div",{id:"notifications-page",class:"deck-container",ref:a,tabIndex:"-1",children:e("div",{class:`timeline-deck deck ${p?"only-mentions":""}`,children:[e("header",{hidden:v,onClick:D=>{var G;D.target.closest("a, button")||(G=a.current)==null||G.scrollTo({top:0,behavior:"smooth"})},class:s==="loading"?"loading":"",children:[e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(dt,{}),e(W,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l",alt:"Home"})})]}),e("h1",{children:"Notifications"}),e("div",{class:"header-side"})]}),i.notificationsShowNew&&s!=="loading"&&e("button",{class:"updates-button shiny-pill",type:"button",onClick:()=>{var D;A(!0),(D=a.current)==null||D.scrollTo({top:0,behavior:"smooth"})},children:[e(w,{icon:"arrow-up"})," New notifications"]})]}),x.length>0&&e("div",{class:"shazam-container",children:e("div",{class:"shazam-container-inner",children:e("details",{class:"announcements",children:[e("summary",{children:[e("span",{children:[e(w,{icon:"announce",class:"announcement-icon",size:"l"})," ",e("b",{children:["Announcement",x.length>1?"s":""]})," ",e("small",{class:"insignificant",children:c})]}),x.length>1&&e("span",{class:"announcements-nav-buttons",children:x.map((D,G)=>e("button",{type:"button",class:"plain2 small",onClick:()=>{var Q;(Q=j.current)==null||Q.children[G].scrollIntoView({behavior:"smooth",block:"nearest"})},children:G+1}))})]}),e("ul",{class:`announcements-list-${x.length>1?"multiple":"single"}`,ref:j,children:x.map(D=>e("li",{children:e(Ui,{announcement:D})}))})]})})}),I.length>0&&e("div",{class:"follow-requests",children:[e("h2",{class:"timeline-header",children:"Follow requests"}),I.length>5?e("details",{children:[e("summary",{children:[I.length," follow requests"]}),e("ul",{children:I.map(D=>e("li",{children:[e(Ue,{account:D}),e(Nt,{accountID:D.id,onChange:()=>{}})]},D.id))})]}):e("ul",{children:I.map(D=>e("li",{children:[e(Ue,{account:D}),e(Nt,{accountID:D.id,onChange:()=>{}})]},D.id))})]}),e("div",{id:"mentions-option",children:e("label",{children:[e("input",{type:"checkbox",checked:p,onChange:D=>{g(D.target.checked)}})," ","Only mentions"]})}),e("h2",{class:"timeline-header",children:"Today"}),te&&!!i.notifications.length&&e("p",{class:"ui-state insignificant",children:s==="default"?"You're all caught up.":e($,{children:"…"})}),i.notifications.length?e($,{children:i.notifications.filter(D=>D.type!=="follow_request").map(D=>{if(p&&D.type!=="mention")return null;const G=new Date(D.createdAt),Q=G.toDateString()!==K.toDateString();Q&&(K=G);const ue=G.toDateString()===Le.toDateString()?"Yesterday":qe(K,{hideTime:!0});return e($,{children:[Q&&e("h2",{class:"timeline-header",children:ue}),e(jt,{instance:c,notification:D},D.id)]},D.id)})}):e($,{children:[s==="loading"&&e($,{children:e("ul",{class:"timeline flat",children:Array.from({length:5}).map((D,G)=>e("li",{class:"notification skeleton",children:[e("div",{class:"notification-type",children:e(w,{icon:"notification",size:"xl"})}),e("div",{class:"notification-content",children:e("p",{children:"███████████ ████"})})]}))})}),s==="error"&&e("p",{class:"ui-state",children:["Unable to load notifications",e("br",{}),e("br",{}),e("button",{type:"button",onClick:()=>A(!0),children:"Try again"})]})]}),d&&e(ot,{onChange:D=>{D&&A()},children:e("button",{type:"button",class:"plain block",disabled:s==="loading",onClick:()=>A(),style:{marginBlockEnd:"6em"},children:s==="loading"?e(ve,{abrupt:!0}):e($,{children:"Show more…"})})})]})})}function Ni(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}function Ui({announcement:t}){const{instance:n}=B(),{contact:c}=as(),i=c==null?void 0:c.account,{id:s,content:o,startsAt:l,endsAt:r,published:u,allDay:d,publishedAt:f,updatedAt:p,read:g,mentions:a,statuses:m,tags:h,emojis:b,reactions:y}=t,v=new Date(f),I=qe(v),S=new Date(p),x=qe(S);return e("div",{class:"announcement-block",children:[e(Ue,{account:i}),e("div",{class:"announcement-content",onClick:vn({mentions:a,instance:n}),dangerouslySetInnerHTML:{__html:Et(o,{emojis:b})}}),e("p",{class:"insignificant",children:[e("time",{datetime:v.toISOString(),children:qe(v)}),p&&x!==I&&e($,{children:[" ","•"," ",e("span",{class:"ib",children:["Updated"," ",e("time",{datetime:S.toISOString(),children:qe(S)})]})]})]}),e("div",{class:"announcement-reactions",hidden:!0,children:y.map(M=>{const{name:L,count:F,me:P,staticUrl:N,url:H}=M;return e("button",{type:"button",class:`plain4 small ${P?"reacted":""}`,children:[H||N?e("img",{src:H||N,alt:L,width:"16",height:"16"}):e("span",{children:L})," ",e("span",{class:"count",children:Pe(F)})]})})})]})}const Yn=Fe(Pi),zi=20;function Ut({local:t,columnMode:n,...c}){const i=pe(k),s=!!t,o=n?{}:Ye(),{masto:l,instance:r}=B({instance:(c==null?void 0:c.instance)||o.instance}),u=`${s?"Local":"Federated"} timeline (${r})`;xe(u,s?"/:instance?/p/l":"/:instance?/p");const d=R(),f=R();async function p(a){(a||!f.current)&&(f.current=l.v1.timelines.public.list({limit:zi,local:s}));const m=await f.current.next();let{value:h}=m;return h!=null&&h.length&&(a&&(d.current=h[0].id),h=He(h,"public"),h.forEach(b=>{Ie(b,r)})),{...m,value:h}}async function g(){try{const a=await l.v1.timelines.public.list({limit:1,local:s,since_id:d.current}).next();let{value:m}=a;return m=He(m,"public"),!!(m!=null&&m.length)}catch{return!1}}return e(Oe,{title:u,titleComponent:e("h1",{class:"header-account",children:[e("b",{children:s?"Local timeline":"Federated timeline"}),e("div",{children:r})]}),id:"public",instance:r,emptyText:"No one has posted anything yet.",errorText:"Unable to load posts",fetchItems:p,checkForUpdates:g,useItemID:!0,headerStart:e($,{}),boostsCarousel:i.settings.boostsCarousel,allowFilters:!0,headerEnd:e(lt,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[e(ee,{href:s?`/#/${r}/p`:`/#/${r}/p/l`,children:s?e($,{children:[e(w,{icon:"transfer"})," ",e("span",{children:"Switch to Federated"})]}):e($,{children:[e(w,{icon:"transfer"})," ",e("span",{children:"Switch to Local"})]})}),e(Ee,{}),e(ee,{onClick:()=>{let a=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(a)){a&&alert("Invalid instance");return}a&&(a=a.toLowerCase().trim(),location.hash=s?`/${a}/p/l`:`/${a}/p`)},children:[e(w,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]})]})},r+s)}const Fi=20,Bi=st(t=>t.v1.trends.links.list().next(),{maxAge:10*60*1e3});function Jn({columnMode:t,...n}){const c=pe(k),i=t?{}:Ye(),{masto:s,instance:o}=B({instance:(n==null?void 0:n.instance)||i.instance}),l=`Trending (${o})`;xe(l,"/:instance?/trending");const r=R(),[u,d]=C([]),[f,p]=C([]),g=R();async function a(b){var I;if(b||!g.current){g.current=s.v1.trends.statuses.list({limit:Fi});try{const S=s.v1.trends.tags.list(),{value:x}=await S.next();x!=null&&x.length&&d(x)}catch{}try{const{value:S}=await Bi(s),x=(I=S==null?void 0:S.filter)==null?void 0:I.call(S,M=>M.type==="link");x!=null&&x.length&&p(x)}catch{}}const y=await g.current.next();let{value:v}=y;return v!=null&&v.length&&(b&&(r.current=v[0].id),v=He(v,"public"),v.forEach(S=>{Ie(S,o)})),{...y,value:v}}async function m(){try{const b=await s.v1.trends.statuses.list({limit:1}).next();let{value:y}=b;return y=He(y,"public"),y!=null&&y.length&&y[0].id!==r.current?(r.current=y[0].id,!0):!1}catch{return!1}}const h=be(()=>e($,{children:[!!u.length&&e("div",{class:"filter-bar expandable",children:[e(w,{icon:"chart",class:"insignificant",size:"l"}),u.map((b,y)=>{const{name:v,history:I}=b,S=I.reduce((x,M)=>x+ +M.uses,0);return e(W,{to:`/${o}/t/${v}`,children:[e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),v]}),e("span",{class:"filter-count",children:S.toLocaleString()})]},v)})]}),!!f.length&&e("div",{class:"links-bar",children:[e("header",{children:e("h3",{children:"Trending News"})}),f.map(b=>{const{authorName:y,authorUrl:v,blurhash:I,description:S,height:x,image:M,imageDescription:L,language:F,providerName:P,providerUrl:N,publishedAt:H,title:A,url:ie,width:ce}=b,Le=new URL(ie).hostname.replace(/^www\./,"").replace(/\/$/,"");let K;if(I){const te=Ln(I),j=zn(te);K=Fn([.6,j[1],j[2]])}return e("a",{href:ie,target:"_blank",rel:"noopener noreferrer",style:K?{"--accent-color":`rgb(${K.join(",")})`,"--accent-alpha-color":`rgba(${K.join(",")}, 0.4)`}:{},children:e("article",{children:[e("figure",{children:e("img",{src:M,alt:L,width:ce,height:x,loading:"lazy"})}),e("div",{class:"article-body",children:[e("header",{children:[e("div",{class:"article-meta",children:[e("span",{class:"domain",children:Le})," ",!!H&&e($,{children:"· "}),!!H&&e($,{children:e(Tt,{datetime:H,format:"micro"})})]}),!!A&&e("h1",{class:"title",lang:F,dir:"auto",children:A})]}),!!S&&e("p",{class:"description",lang:F,dir:"auto",children:S})]})]})},ie)})]})]}),[u,f]);return e(Oe,{title:l,titleComponent:e("h1",{class:"header-account",children:[e("b",{children:"Trending"}),e("div",{children:o})]}),id:"trending",instance:o,emptyText:"No trending posts.",errorText:"Unable to load posts",fetchItems:a,checkForUpdates:m,checkForUpdatesInterval:5*60*1e3,useItemID:!0,headerStart:e($,{}),boostsCarousel:c.settings.boostsCarousel,allowFilters:!0,timelineStart:h,headerEnd:e(lt,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:e(ee,{onClick:()=>{let b=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(b)){b&&alert("Invalid instance");return}b&&(b=b.toLowerCase().trim(),location.hash=`/${b}/trending`)},children:[e(w,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]})})},o)}function Oi(){xe("Home","/");const t=pe(k),{shortcuts:n}=t,c=n.map(i=>{if(!i)return null;const{type:s,...o}=i,l={following:Wt,notifications:Yn,list:Gn,public:Ut,bookmarks:Hn,favourites:Vn,hashtag:jn,mentions:Wn,trending:Jn}[s];return l?e(l,{...o,columnMode:!0},s+JSON.stringify(o)):null});return $e(["1","2","3","4","5","6","7","8","9"],(i,s)=>{try{const o=parseInt(s.keys[0],10)-1;document.querySelectorAll("#columns > *")[o].focus()}catch{}}),e("div",{id:"columns",children:c})}function qi(){var n;const t=pe(k);return z(()=>{(async()=>{const c=await ct.drafts.keys();if(c.length){const i=In();c.filter(o=>o.startsWith(i)).length&&(k.showDrafts=!0)}})()},[]),e($,{children:(t.settings.shortcutsColumnsMode||t.settings.shortcutsViewMode==="multi-column")&&((n=t.shortcuts)!=null&&n.length)?e(Oi,{}):e(Wt,{title:"Home",path:"/",id:"home",headerStart:!1,headerEnd:e(Hi,{})})})}function Hi(){const t=pe(k),n=R(),[c,i]=C(void 0);return e($,{children:[e(W,{ref:n,to:"/notifications",class:`button plain notifications-button ${t.notificationsShowNew?"has-badge":""} ${c||""}`,onClick:s=>{s.stopPropagation(),window.matchMedia("(min-width: calc(40em))").matches&&(s.preventDefault(),i(o=>o?void 0:"open"))},children:e(w,{icon:"notification",size:"l",alt:"Notifications"})}),e(Gi,{state:c,anchorRef:n,onClose:()=>i(void 0)})]})}const Vi=30,ji=5;function Gi({anchorRef:t,state:n,onClose:c}){const{masto:i,instance:s}=B(),o=pe(k),[l,r]=C("default"),u=i.v1.notifications.list({limit:Vi});async function d(){const m=await u.next(),h=m.value;if(h!=null&&h.length){h.forEach(y=>{Ie(y.status,s,{skipThreading:!0})});const b=Kn(h);k.notificationsLast=h[0],k.notifications=b,i.v1.markers.create({notifications:{lastReadId:h[0].id}}).catch(()=>{})}return k.notificationsShowNew=!1,k.notificationsLastFetchTime=Date.now(),m}const[f,p]=C(!1);function g(){return i.v1.followRequests.list({limit:1})}function a(){r("loading"),(async()=>{try{await d();const m=await g();p(!!(m!=null&&m.length)),r("default")}catch{r("error")}})()}return z(()=>{n==="open"&&a()},[n]),e(Mn,{menuClassName:"notifications-menu",state:n,anchorRef:t,onClose:c,portal:{target:document.body},overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:"8 8 8 8",children:[e("header",{children:e("h2",{children:"Notifications"})}),e("main",{children:o.notifications.length?e($,{children:o.notifications.slice(0,ji).map(m=>e(jt,{instance:s,notification:m},m.id))}):l==="loading"?e("div",{class:"ui-state",children:e(ve,{abrupt:!0})}):l==="error"&&e("div",{class:"ui-state",children:[e("p",{children:"Unable to fetch notifications."}),e("p",{children:e("button",{type:"button",onClick:a,children:"Try again"})})]})}),e("footer",{children:[e(W,{to:"/mentions",class:"button plain",children:[e(w,{icon:"at"})," ",e("span",{children:"Mentions"})]}),e(W,{to:"/notifications",class:"button plain2",children:[f?e($,{children:[e("span",{class:"tag collapsed",children:"New"})," ",e("span",{children:"Follow Requests"})]}):e("b",{children:"See all"})," ",e(w,{icon:"arrow-right"})]})]})]})}const Wi=Fe(qi),Ki=/\/@([^@\/]+)@?([^\/]+)?\/([^\/]+)\/?$/i,Yi=/\/notes\/([^\/]+)\/?$/i;function Xn(t){const{hostname:n,pathname:c}=new URL(t),[,i,s,o]=c.match(Ki)||[];if(o)return`/${n}/s/${o}`;const[,l]=c.match(Yi)||[];if(l)return`/${n}/s/${l}`}function Ji(){const n=it().pathname.replace(/^\//,""),c=Xn(n);return ze(()=>{c&&setTimeout(()=>{window.location.hash=c+"?view=full"},300)},[c]),e("div",{class:"ui-state",tabIndex:"-1",children:[c?e($,{children:[e("h2",{children:"Redirecting…"}),e("p",{children:e("a",{href:`#${c}?view=full`,children:c})})]}):e($,{children:[e("h2",{children:"Unable to process URL"}),e("p",{children:e("a",{href:n,target:"_blank",rel:"noopener noreferrer",children:n})})]}),e("hr",{}),e("p",{children:e(W,{to:"/",children:"Go home"})})]})}function Xi(){const{masto:t}=B();xe("Lists","/l");const[n,c]=C("default"),[i,s]=Ct(d=>d+1,0),[o,l]=C([]);z(()=>{c("loading"),(async()=>{try{const d=await t.v1.lists.list();d.sort((f,p)=>f.title.localeCompare(p.title)),l(d),c("default")}catch{c("error")}})()},[i]);const[r,u]=C(!1);return e("div",{id:"lists-page",class:"deck-container",tabIndex:"-1",children:[e("div",{class:"timeline-deck deck",children:[e("header",{children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(dt,{}),e(W,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l"})})]}),e("h1",{children:"Lists"}),e("div",{class:"header-side",children:e("button",{type:"button",class:"plain",onClick:()=>u(!0),children:e(w,{icon:"plus",size:"l",alt:"New list"})})})]})}),e("main",{children:o.length>0?e("ul",{class:"link-list",children:o.map(d=>e("li",{children:e(W,{to:`/l/${d.id}`,children:e("span",{children:[e(w,{icon:"list"})," ",e("span",{children:d.title})]})})}))}):n==="loading"?e("p",{class:"ui-state",children:e(ve,{})}):n==="error"?e("p",{class:"ui-state",children:"Unable to load lists."}):e("p",{class:"ui-state",children:"No lists yet."})})]}),r&&e(we,{class:"light",onClick:d=>{d.target===d.currentTarget&&u(!1)},children:e(Vt,{list:r==null?void 0:r.list,onClose:d=>{d.state==="success"&&s(),u(!1)}})})]})}const Zi=""+new URL("instances-48462af0.json",import.meta.url).href,{VITE_CLIENT_NAME:Qi,VITE_WEBSITE:eo}={VITE_CLIENT_NAME:"IMSB.APP",VITE_CLIENT_ID:"app.imsb.app",VITE_WEBSITE:"https://app.imsb.app",VITE_APP_ENV:"production",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1},Kt="read write follow push";async function to({instanceURL:t}){const n=new URLSearchParams({client_name:Qi,redirect_uris:location.origin+location.pathname,scopes:Kt,website:eo});return await(await fetch(`https://${t}/api/v1/apps`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n.toString()})).json()}async function no({instanceURL:t,client_id:n}){const c=new URLSearchParams({client_id:n,scope:Kt,redirect_uri:location.origin+location.pathname,response_type:"code"});return`https://${t}/oauth/authorize?${c.toString()}`}async function so({instanceURL:t,client_id:n,client_secret:c,code:i}){const s=new URLSearchParams({client_id:n,client_secret:c,redirect_uri:location.origin+location.pathname,grant_type:"authorization_code",code:i,scope:Kt});return await(await fetch(`https://${t}/oauth/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:s.toString()})).json()}function io(){xe("Log in");const t=R(),n=Z.local.get("instanceURL"),[c,i]=C("default"),[s]=Be(),o=s.get("instance"),[l,r]=C(o||(n==null?void 0:n.toLowerCase())||""),[u,d]=C([]);z(()=>{(async()=>{try{const m=await(await fetch(Zi)).json();d(m)}catch{}})()},[]);const f=a=>{Z.local.set("instanceURL",a),(async()=>{i("loading");try{const{client_id:m,client_secret:h,vapid_key:b}=await to({instanceURL:a});m&&h?(Z.session.set("clientID",m),Z.session.set("clientSecret",h),Z.session.set("vapidKey",b),location.href=await no({instanceURL:a,client_id:m})):alert("Failed to register application"),i("default")}catch{i("error")}})()},p=a=>{a.preventDefault();const{elements:m}=a.target;let h=m.instanceURL.value.toLowerCase();h=h.replace(/^https?:\/\//,"").replace(/\/+$/,""),h=h.replace(/^@?[^@]+@/,""),/\./.test(h)||(h=u.find(b=>b.includes(h))),f(h)},g=l?u.filter(a=>a.includes(l)).sort((a,m)=>{const h=a.toLowerCase().startsWith(l.toLowerCase()),b=m.toLowerCase().startsWith(l.toLowerCase());return h&&!b?-1:!h&&b?1:0}).slice(0,10):[];return e("main",{id:"login",style:{textAlign:"center"},children:e("form",{onSubmit:p,children:[e("h1",{children:"Log in"}),e("label",{children:[e("p",{children:"Instance"}),e("input",{value:l,required:!0,type:"text",class:"large",id:"instanceURL",ref:t,disabled:c==="loading",autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellcheck:!1,placeholder:"instance domain",onInput:a=>{r(a.target.value)}}),(g==null?void 0:g.length)>0?e("ul",{id:"instances-suggestions",children:g.map(a=>e("li",{children:e("button",{type:"button",class:"plain4",onClick:()=>{f(a)},children:a})}))}):e("div",{id:"instances-eg",children:"e.g. “mastodon.social’"})]}),c==="error"&&e("p",{class:"error",children:"Failed to log in. Please try again or another instance."}),e("div",{children:[e("button",{class:"large",disabled:c==="loading",children:"Log in"})," "]}),e(ve,{hidden:c!=="loading"}),e("hr",{}),e("p",{children:e("a",{href:"https://joinmastodon.org/servers",target:"_blank",children:"Don't have an account? Create one!"})}),e("p",{children:e(W,{to:"/",children:"Go home"})})]})})}const pt=5,Dt=40;function oo(t){const n=Ye(),{masto:c,instance:i,authenticated:s}=B({instance:n.instance}),[o,l]=C("default"),[r]=Be(),u=R(),d=(t==null?void 0:t.query)||r.get("q"),f=(t==null?void 0:t.type)||r.get("type");xe(d?`Search: ${d}${f?` (${{statuses:"Posts",accounts:"Accounts",hashtags:"Hashtags"}[f]})`:""}`:"Search","/search");const[p,g]=C(!1),a=R(0);z(()=>{a.current=0},[d,f]);const m=R();ze(()=>{var L,F;(F=(L=m.current)==null?void 0:L.scrollTo)==null||F.call(L,0,0)},[d,f]);const[h,b]=C([]),[y,v]=C([]),[I,S]=C([]);z(()=>{b([]),v([]),S([])},[d]);const x={statuses:b,accounts:v,hashtags:S};function M(L){!L&&!s||(l("loading"),L&&!f&&(b(h.slice(0,pt)),v(y.slice(0,pt)),S(I.slice(0,pt))),(async()=>{var P,N;const F={q:d,resolve:s,limit:pt};f&&(F.limit=Dt,F.type=f,s&&(F.offset=a.current));try{const H=await c.v2.search.fetch(F);if(f)if(L){x[f](H[f]);const A=(P=H[f])==null?void 0:P.length;a.current=Dt,g(!!A)}else{x[f](ie=>[...ie,...H[f]]);const A=(N=H[f])==null?void 0:N.length;a.current=a.current+Dt,g(!!A)}else b(H.statuses),v(H.accounts),S(H.hashtags),a.current=0,g(!1);l("default")}catch{l("error")}})())}return z(()=>{var L,F,P,N;d?((F=(L=u.current)==null?void 0:L.setValue)==null||F.call(L,d),M(!0)):(N=(P=u.current)==null?void 0:P.focus)==null||N.call(P)},[d,f,i]),$e("/",L=>{var F,P;(P=(F=u.current)==null?void 0:F.focus)==null||P.call(F)},{preventDefault:!0}),e("div",{id:"search-page",class:"deck-container",ref:m,children:e("div",{class:"timeline-deck deck",children:[e("header",{class:o==="loading"?"loading":"",children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:e(dt,{})}),e(qn,{ref:u}),e("div",{class:"header-side",children:" "})]})}),e("main",{children:[!!d&&e("div",{class:`filter-bar ${o==="loading"?"loading":""}`,children:[!!f&&e(W,{to:`/search${d?`?q=${encodeURIComponent(d)}`:""}`,children:"‹ All"}),[{label:"Accounts",type:"accounts",to:`/search?q=${encodeURIComponent(d)}&type=accounts`},{label:"Hashtags",type:"hashtags",to:`/search?q=${encodeURIComponent(d)}&type=hashtags`},{label:"Posts",type:"statuses",to:`/search?q=${encodeURIComponent(d)}&type=statuses`}].sort((L,F)=>L.type===f?-1:F.type===f?1:0).map(L=>e(W,{to:L.to,children:L.label},L.type))]}),d?e($,{children:[(!f||f==="accounts")&&e($,{children:[f!=="accounts"&&e("h2",{class:"timeline-header",children:"Accounts"}),y.length>0?e($,{children:[e("ul",{class:"timeline flat accounts-list",children:y.map(L=>e("li",{children:e(Ue,{account:L,instance:i,showStats:!0})},L.id))}),f!=="accounts"&&e("div",{class:"ui-state",children:e(W,{class:"plain button",to:`/search?q=${d}&type=accounts`,children:["See more accounts ",e(w,{icon:"arrow-right"})]})})]}):!f&&(o==="loading"?e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}):e("p",{class:"ui-state",children:"No accounts found."}))]}),(!f||f==="hashtags")&&e($,{children:[f!=="hashtags"&&e("h2",{class:"timeline-header",children:"Hashtags"}),I.length>0?e($,{children:[e("ul",{class:"link-list hashtag-list",children:I.map(L=>e("li",{children:e(W,{to:i?`/${i}/t/${L.name}`:`/t/${L.name}`,children:[e(w,{icon:"hashtag"}),e("span",{children:L.name})]})},L.name))}),f!=="hashtags"&&e("div",{class:"ui-state",children:e(W,{class:"plain button",to:`/search?q=${d}&type=hashtags`,children:["See more hashtags ",e(w,{icon:"arrow-right"})]})})]}):!f&&(o==="loading"?e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}):e("p",{class:"ui-state",children:"No hashtags found."}))]}),(!f||f==="statuses")&&e($,{children:[f!=="statuses"&&e("h2",{class:"timeline-header",children:"Posts"}),h.length>0?e($,{children:[e("ul",{class:"timeline",children:h.map(L=>e("li",{children:e(W,{class:"status-link",to:i?`/${i}/s/${L.id}`:`/s/${L.id}`,children:e(Ce,{status:L})})},L.id))}),f!=="statuses"&&e("div",{class:"ui-state",children:e(W,{class:"plain button",to:`/search?q=${d}&type=statuses`,children:["See more posts ",e(w,{icon:"arrow-right"})]})})]}):!f&&(o==="loading"?e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}):e("p",{class:"ui-state",children:"No posts found."}))]}),!!f&&(o==="default"?p?e(ot,{onChange:L=>{L&&M()},children:e("button",{type:"button",class:"plain block",onClick:()=>M(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}):o==="loading"&&e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}))]}):o==="loading"?e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}):e("p",{class:"ui-state",children:"Enter your search term or paste a URL above to get started."})]})]})})}const mt=40,co=10,ao=5;let zt={},yt={},wt={};function Ft(t){delete yt[t],delete wt[t]}const gt={block:"nearest",inline:"center",behavior:"smooth"};function ro(t){const{id:n}=t,{masto:c,instance:i}=B({instance:t.instance}),s=pe(k),[o,l]=Be(),r=o.get("media"),u=o.get("media-only"),d=parseInt(r||u,10);let f=d>0;const p=o.get("mediaStatusID"),g=$n(p,i);p&&!g&&(f=!1);const a=f&&!!u,m=Ot(n,i),[h,b]=C(k.statuses[m]);z(()=>{k.statuses[m]&&b(k.statuses[m])},[m]);const y=be(()=>{const{prevLocation:S}=k,x=((S==null?void 0:S.pathname)||"")+((S==null?void 0:S.search)||""),M=rt("/:instance/s/:id",x)||rt("/s/:id",x);return!x||M?"/":x},[]);z(()=>{!h&&f&&(async()=>{try{const S=await c.v1.statuses.$select(n).fetch();Ie(S,i),b(S)}catch{alert("Unable to load post."),location.hash=y}})()},[f]);const v=p?g==null?void 0:g.mediaAttachments:h==null?void 0:h.mediaAttachments,I=We(()=>{!window.matchMedia("(min-width: calc(40em + 350px))").matches&&s.prevLocation?history.back():a?location.hash=y:(o.delete("media"),o.delete("mediaStatusID"),l(o))},[a,y,s.prevLocation]);return e("div",{class:"deck-backdrop",children:[f?v!=null&&v.length?e(Bn,{mediaAttachments:v,statusID:p||n,instance:i,lang:h==null?void 0:h.language,index:d-1,onClose:I}):e("div",{class:"media-modal-container loading",children:e(ve,{abrupt:!0})}):e(W,{to:y}),!a&&e(lo,{id:n,instance:t.instance,closeLink:y})]})}function lo({id:t,closeLink:n="/",instance:c}){var O;const[i,s]=Be(),o=i.get("media"),l=parseInt(o,10)>0,r=R(!k.prevLocation&&history.length===1),[u,d]=C(i.get("view")||r.current?"full":null),f=!!parseInt(i.get("translate")),{masto:p,instance:g}=B({instance:c}),{masto:a,instance:m,authenticated:h}=B(),b=g===m,y=pe(k),[v,I]=C([]),[S,x]=C("default"),M=R(),L=Ot(t,g),F=R(0),P=R();z(()=>{var T;(T=P.current)==null||T.focus()},[]),z(()=>{var _;const T=Dn(()=>{if(!P.current)return;const{scrollTop:E}=P.current;S!=="loading"&&(wt[t]=E)},50);return(_=P.current)==null||_.addEventListener("scroll",T,{passive:!0}),T(),()=>{var E;T.cancel(),(E=P.current)==null||E.removeEventListener("scroll",T)}},[t,S!=="loading"]);const N=R(),H=({reloadHero:T}={})=>{x("loading");let _;const E=yt[t];if(E){const X=E.filter(de=>k.statuses[L]);I(X)}else I([{id:t}]);return(async()=>{var Te,Me;const X=()=>nn(()=>p.v1.statuses.$select(t).fetch(),{retries:4}),de=nn(()=>p.v1.statuses.$select(t).context.fetch(),{retries:8}),re=!!y.statuses[L];let se=y.statuses[L];if(!(re&&!T))try{se=await X(),Ie(se,g),await new Promise(Se=>{setTimeout(Se,100)})}catch{x("error");return}try{let Se=function(V){return V==null?void 0:V.map(ge=>({id:ge.id,account:ge.account,repliesCount:ge.repliesCount,content:ge.content,weight:at(ge),replies:Se(ge.__replies)}))};const U=await de,{ancestors:le,descendants:fe}=U;F.current=(fe==null?void 0:fe.length)||0;const me=new Set;le.forEach(V=>{Ie(V,g,{skipThreading:!0}),V.inReplyToId&&!le.find(ge=>ge.id===V.inReplyToId)&&me.add(V.inReplyToId)});const Je=le.every(V=>V.account.id===se.account.id),_e=[];fe.forEach(V=>{if(Ie(V,g,{skipThreading:!0}),V.inReplyToId&&!fe.find(ge=>ge.id===V.inReplyToId)&&V.inReplyToId!==se.id&&me.add(V.inReplyToId),V.inReplyToAccountId===V.account.id)_e.push(V);else if(V.inReplyToId===se.id)_e.push(V);else if(!V.inReplyToAccountId&&_e.find(ge=>ge.id===V.inReplyToId)&&V.account.id===se.account.id)_e.push(V);else{const ge=fe.find(Xe=>Xe.id===V.inReplyToId);ge&&(ge.__replies||(ge.__replies=[]),ge.__replies.push(V))}}),me.size;const De=[...le.map(V=>({id:V.id,ancestor:!0,isThread:Je,accountID:V.account.id,account:V.account,repliesCount:V.repliesCount,weight:at(V)})),{id:t,accountID:se.account.id,weight:at(se)},..._e.map(V=>({id:V.id,account:V.account,accountID:V.account.id,descendant:!0,thread:V.account.id===se.account.id,weight:at(V),replies:Se(V.__replies)}))];x("default"),N.current={offsetTop:(Te=M.current)==null?void 0:Te.offsetTop,scrollTop:(Me=P.current)==null?void 0:Me.scrollTop};const Ve=De.findIndex(V=>V.id===t);Ve>=te&&j(Ve+1),I(De),yt[t]=De,rs(se,g)}catch{x("error")}})(),()=>{clearTimeout(_)}};z(H,[t,p]),z(()=>{var _,E;if(!v.length)return;const T=wt[t];if(T)P.current.scrollTop=T;else if(N.current){const X={offsetTop:(_=M.current)==null?void 0:_.offsetTop,scrollTop:(E=P.current)==null?void 0:E.scrollTop},de=X.offsetTop-N.current.offsetTop+X.scrollTop;P.current.scrollTop=de}else v.length===1&&(P.current.scrollTop=0);N.current=null},[v]),z(()=>{y.reloadStatusPage<=0||(async()=>{try{const{instanceURL:T}=nt(),_=`https://${T}/api/v1/statuses/${t}/context`;return await(await caches.open("api")).delete(_,{ignoreVary:!0}),H({reloadHero:!0})}catch{}})()},[y.reloadStatusPage]),z(()=>()=>{wt={},k.reloadStatusPage=0,yt={},zt={},Bt.clear()},[]);const A=y.statuses[L]||y.statuses[t],ie=be(()=>{if(!A)return"";const{account:T}=A,_=document.createElement("div");return _.innerHTML=T.displayName,_.innerText.trim()},[A]),ce=be(()=>{if(!A)return"";let T=Cn(A);return T.length>64&&(T=T.slice(0,64)+"…"),T},[A]);xe(ie&&ce?`${ie}: "${ce}"`:"Status","/:instance?/s/:id");const Le=be(()=>{if(!A)return;const{url:T}=A;if(T)return new URL(T).hostname},[A]),K=be(()=>{if(Le)return Le===g},[Le,g]),[te,j]=C(mt),D=be(()=>v.length-te,[v.length,te]),G=v.some(T=>T.descendant),Q=v.filter(T=>T.ancestor),[ue,ke]=C(!0),Re=kt(ke,100),ae=be(()=>{if(!M.current||ue)return null;const{top:T}=M.current.getBoundingClientRect();return T>0?"down":"up"},[ue]);$e("esc",()=>{location.hash=n},{enabled:!l,ignoreEventWhen:T=>!!document.querySelector("#modal-container > *")}),$e("backspace",()=>{location.hash=n}),$e("j",()=>{const T=document.activeElement.closest(".status-link, .status-focus"),_=T==null?void 0:T.getBoundingClientRect(),E=Array.from(P.current.querySelectorAll(".status-link:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *), .status-focus:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *)"));if(T&&_.top<P.current.clientHeight&&_.bottom>0){const X=E.indexOf(T);let de=E[X+1];de&&(de.focus(),de.scrollIntoView(gt))}else{const X=E.find(de=>{const re=de.getBoundingClientRect();return re.top>=44&&re.left>=0});X&&(X.focus(),X.scrollIntoView(gt))}}),$e("k",()=>{const T=document.activeElement.closest(".status-link, .status-focus"),_=T==null?void 0:T.getBoundingClientRect(),E=Array.from(P.current.querySelectorAll(".status-link:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *), .status-focus:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *)"));if(T&&_.top<P.current.clientHeight&&_.bottom>0){const X=E.indexOf(T);let de=E[X-1];de&&(de.focus(),de.scrollIntoView(gt))}else{const X=E.find(de=>{const re=de.getBoundingClientRect();return re.top>=44&&re.left>=0});X&&(X.focus(),X.scrollIntoView(gt))}}),$e("x",()=>{const T=document.activeElement.closest(".status-link, .status-focus");if(T){const _=T.nextElementSibling;_&&_.tagName.toLowerCase()==="details"&&(_.open=!_.open)}});const{nearReachStart:q}=xt({scrollableRef:P,distanceFromStartPx:16}),Y=R(l?"media+status":"status"),J=We((T,_,E,X)=>{T.preventDefault(),T.stopPropagation(),s({media:_+1,mediaStatusID:X.id})},[t]),oe=We((T,_)=>{Ft(_.id)},[]),ne=T=>{const{id:_,ancestor:E,isThread:X,descendant:de,thread:re,replies:se,repliesCount:Te,weight:Me}=T,Se=_===t;return e("li",{ref:Se?M:null,class:`${E?"ancestor":""} ${de?"descendant":""} ${re?"thread":""} ${Se?"hero":""}`,children:[Se?e($,{children:[e(ot,{threshold:.1,onChange:Re,class:"status-focus",tabIndex:0,children:e(Ce,{statusID:_,instance:g,withinContext:!0,size:"l",enableTranslate:!0,forceTranslate:f})}),S!=="loading"&&!h?e("div",{class:"post-status-banner",children:[e("p",{children:"You're not logged in. Interactions (reply, boost, etc) are not possible."}),e(W,{to:"/login",class:"button",children:"Log in"})]}):!b&&e("div",{class:"post-status-banner",children:[e("p",{children:["This post is from another instance (",e("b",{children:g}),"). Interactions (reply, boost, etc) are not possible."]}),e("button",{type:"button",disabled:S==="loading",onClick:()=>{x("loading"),(async()=>{try{const U=await a.v2.search.fetch({q:A.url,type:"statuses",resolve:!0,limit:1});if(U.statuses.length){const le=U.statuses[0];location.hash=m?`/${m}/s/${le.id}`:`/s/${le.id}`}else throw new Error("No results")}catch(U){x("default"),alert("Error: "+U)}})()},children:[e(w,{icon:"transfer"})," Switch to my instance to enable interactions"]})]})]}):e(W,{class:"status-link",to:g?`/${g}/s/${_}`:`/s/${_}`,onClick:()=>{Ft(_)},children:[e(Ce,{statusID:_,instance:g,withinContext:!0,size:re||E?"m":"s",enableTranslate:!0,onMediaClick:J,onStatusLinkClick:oe}),E&&X&&Te>1&&e("div",{class:"replies-link",children:[e(w,{icon:"comment"})," ",e("span",{title:Te,children:Pe(Te)})]})," "]}),de&&(se==null?void 0:se.length)>0&&e(Zn,{instance:g,replies:se,hasParentThread:re,level:1,accWeight:Me,openAll:F.current<co}),S==="loading"&&Se&&!!(A!=null&&A.repliesCount)&&!G&&e("div",{class:"status-loading",children:e(ve,{})}),S==="error"&&Se&&!!(A!=null&&A.repliesCount)&&!G&&e("div",{class:"status-error",children:["Unable to load replies.",e("br",{}),e("button",{type:"button",class:"plain",onClick:()=>{k.reloadStatusPage++},children:"Try again"})]})]},_)};return e("div",{tabIndex:"-1",ref:P,class:`status-deck deck contained ${v.length>1?"padded-bottom":""} ${Y.current==="status"&&!r.current?"slide-in":""} ${u?`deck-view-${u}`:""}`,onAnimationEnd:T=>{Y.current==="status"&&(Y.current=null)},children:[e("header",{class:`${ue?"inview":""} ${S==="loading"?"loading":""}`,onDblClick:T=>{k.reloadStatusPage++},children:e("div",{class:"header-grid header-grid-2",children:[e("h1",{children:[!!/\/s\//i.test((O=y.prevLocation)==null?void 0:O.pathname)&&e("button",{type:"button",class:"plain deck-back",onClick:()=>{history.back()},children:e(w,{icon:"chevron-left",size:"xl"})}),!ue&&A&&S!=="loading"?e($,{children:[e("span",{class:"hero-heading",children:[e(vt,{account:A.account,instance:g,showAvatar:!0,short:!0})," ",e("span",{class:"insignificant",children:["•"," ",e(Tt,{datetime:A.createdAt,format:"micro"})]})]})," ",e("button",{type:"button",class:"ancestors-indicator light small",onClick:T=>{T.preventDefault(),T.stopPropagation(),M.current.scrollIntoView({behavior:"smooth",block:"start"})},title:"Go to main post",children:e(w,{icon:ae==="down"?"arrow-down":"arrow-up"})})]}):e($,{children:["Post"," ",e("button",{type:"button",class:"ancestors-indicator light small",onClick:T=>{T.preventDefault(),T.stopPropagation(),P.current.scrollTo({top:0,behavior:"smooth"})},hidden:!Q.length||q,title:`${Q.length} posts above ‒ Go to top`,children:[e(w,{icon:"arrow-up"}),Q.filter((T,_,E)=>E.findIndex(X=>X.accountID===T.accountID)===_).slice(0,3).map(T=>e(Ge,{url:T.account.avatar,alt:T.account.displayName},T.account.id)),Q.length>3&&e($,{children:[" ",e("span",{class:"insignificant",children:Pe(Q.length)})]})]})]})]}),e("div",{class:"header-side",children:[e("button",{type:"button",class:"plain4",style:{display:u==="full"?"":"none"},onClick:()=>{d(null),i.delete("media"),i.delete("media-only"),i.delete("view"),s(i)},title:"Switch to Side Peek view",children:e(w,{icon:"layout4",size:"l"})}),e(Ke,{align:"end",portal:{target:P.current},menuButton:e("button",{type:"button",class:"button plain4",children:e(w,{icon:"more",alt:"Actions",size:"xl"})}),children:[e(ee,{disabled:S==="loading",onClick:()=>{k.reloadStatusPage++},children:[e(w,{icon:"refresh"}),e("span",{children:"Refresh"})]}),e(ee,{className:"menu-switch-view",onClick:()=>{d(u==="full"?null:"full"),i.delete("media"),i.delete("media-only"),u==="full"?i.delete("view"):i.set("view","full"),s(i)},children:[e(w,{icon:{"":"layout5",full:"layout4"}[u||""]}),e("span",{children:["Switch to ",u==="full"?"Side Peek":"Full"," view"]})]}),e(ee,{onClick:()=>{Array.from(P.current.querySelectorAll("button.spoiler:not(.spoiling)")).forEach(_=>{_.click()})},children:[e(w,{icon:"eye-open"})," ",e("span",{children:"Show all sensitive content"})]}),e(Ee,{}),e(ws,{className:"plain",children:"Experimental"}),e(ee,{disabled:K,onClick:()=>{const T=Xn(A.url);T?location.hash=T:alert("Unable to switch")},children:[e(w,{icon:"transfer"}),e("small",{class:"menu-double-lines",children:["Switch to post's instance (",e("b",{children:Le}),")"]})]})]}),e(W,{class:"button plain deck-close",to:n,children:e(w,{icon:"x",size:"xl"})})]})]})}),v.length&&A?e("ul",{class:`timeline flat contextual grow ${S==="loading"?"loading":""}`,children:[v.slice(0,te).map(ne),D>0&&e("li",{children:e("button",{type:"button",class:"plain block show-more",disabled:S==="loading",onClick:()=>j(T=>T+mt),style:{marginBlockEnd:"6em"},children:[e("div",{class:"ib avatars-bunch",children:v.slice(te,te+5).map(T=>e(Ge,{url:T.account.avatarStatic},T.id))})," ",e("div",{class:"ib",children:["Show more…"," ",e("span",{class:"tag",children:D>mt?`${mt}+`:D})]})]})})]}):e($,{children:[S==="loading"&&e("ul",{class:"timeline flat contextual grow loading",children:e("li",{children:e(Ce,{skeleton:!0,size:"l"})})}),S==="error"&&e("p",{class:"ui-state",children:["Unable to load post",e("br",{}),e("br",{}),e("button",{type:"button",onClick:()=>{k.reloadStatusPage++},children:"Try again"})]})]})]})}function Zn({replies:t,instance:n,hasParentThread:c,level:i,accWeight:s,openAll:o}){const[l,r]=Be(),u=y=>y.reduce((v,I)=>{const{repliesCount:S,replies:x}=I,M=(x==null?void 0:x.length)||S;return v+M+u(x||[])},0),d=t.length+u(t),f=t.length===d,p=t.map(y=>y.account).filter((y,v,I)=>I.findIndex(S=>S.id===y.id)===v).slice(0,3),g=be(()=>t==null?void 0:t.reduce((y,v)=>y+(v==null?void 0:v.weight),s),[s,t==null?void 0:t.length]);let a=!1;(o||g<=ao||!c&&d===1&&at(t[0])<2)&&(a=!0);const m=zt[t[0].id],h=We((y,v,I,S)=>{y.preventDefault(),y.stopPropagation(),r({media:v+1,mediaStatusID:S.id})},[]),b=R();return ze(()=>{var v;function y(I){I.target.dataset.scrollLeft=I.target.scrollLeft}return(v=b.current)==null||v.addEventListener("scroll",y,{passive:!0}),()=>{var I;(I=b.current)==null||I.removeEventListener("scroll",y)}},[]),e("details",{ref:b,class:"replies",open:m||a,onToggle:y=>{const{open:v}=y.target;zt[t[0].id]=v},style:{"--comments-level":i},"data-comments-level":i,"data-comments-level-overflow":i>4,children:[e("summary",{class:"replies-summary",hidden:a,children:[e("span",{class:"avatars",children:p.map(y=>e(Ge,{url:y.avatarStatic,title:`${y.displayName} @${y.username}`,squircle:y==null?void 0:y.bot},y.id))}),e("span",{children:[e("span",{title:t.length,children:Pe(t.length)})," ","repl",t.length===1?"y":"ies"]}),!f&&d>1&&e($,{children:[" ","·"," ",e("span",{children:[e("span",{title:d,children:Pe(d)})," ","comment",d===1?"":"s"]})]})]}),e("ul",{children:t.map(y=>{var v,I;return e("li",{children:[e(W,{class:"status-link",to:n?`/${n}/s/${y.id}`:`/s/${y.id}`,onClick:()=>{Ft(y.id)},children:[e(Ce,{statusID:y.id,instance:n,withinContext:!0,size:"s",enableTranslate:!0,onMediaClick:h}),!((v=y.replies)!=null&&v.length)&&y.repliesCount>0&&e("div",{class:"replies-link",children:[e(w,{icon:"comment"})," ",e("span",{title:y.repliesCount,children:Pe(y.repliesCount)})]})]}),((I=y.replies)==null?void 0:I.length)&&e(Zn,{instance:n,replies:y.replies,level:i+1,accWeight:a?g:y.weight,openAll:o})]},y.id)})})]})}const ho=140,uo=35,fo=70,po=140,Bt=new Map;function at(t){var a,m;const n=Bt.get(t.id);if(n)return n;const{spoilerText:c,content:i,mediaAttachments:s,poll:o,card:l}=t,r=ls(c+i),u=s!=null&&s.length?ho:0,d=(((a=o==null?void 0:o.options)==null?void 0:a.length)||0)*uo,f=l&&(s!=null&&s.length||(m=o==null?void 0:o.options)!=null&&m.length)?0:fo,g=(r+u+d+f)/po;return Bt.set(t.id,g),g}const mo=Fe(ro);function go(){const t=Ye(),{id:n,instance:c}=t;return e(mo,{id:n,instance:c})}const bo=""+new URL("boosts-carousel-c271525c.jpg",import.meta.url).href,yo=""+new URL("grouped-notifications-3dcc5ef2.jpg",import.meta.url).href,wo=""+new URL("multi-column-962e6b3c.jpg",import.meta.url).href,vo=""+new URL("multi-hashtag-timeline-24789e5e.jpg",import.meta.url).href,ko=""+new URL("nested-comments-thread-38ddecea.jpg",import.meta.url).href,So=""+new URL("logo-text-810e685b.svg",import.meta.url).href;function gn(){return xe(null,["/","/welcome"]),e("main",{id:"welcome",children:[e("div",{class:"hero-container",children:[e("h1",{children:[e("img",{src:En,alt:"",width:"200",height:"200",style:{aspectRatio:"1/1",marginBlockEnd:-16}}),e("img",{src:So,alt:"Phanpy",width:"250"})]}),e("p",{children:e("big",{children:e("b",{children:e(W,{to:"/login",class:"button",children:"Log in"})})})}),e("p",{class:"desc",children:"A minimalistic opinionated Mastodon web client."})]}),e("div",{id:"why-container",children:e("div",{class:"sections",children:[e("section",{children:[e("img",{src:bo,alt:"Screenshot of Boosts Carousel",loading:"lazy"}),e("h4",{children:"Boosts Carousel"}),e("p",{children:"Visually separate original posts and re-shared posts (boosted posts)."})]}),e("section",{children:[e("img",{src:ko,alt:"Screenshot of nested comments thread",loading:"lazy"}),e("h4",{children:"Nested comments thread"}),e("p",{children:"Effortlessly follow conversations. Semi-collapsible replies."})]}),e("section",{children:[e("img",{src:yo,alt:"Screenshot of grouped notifications",loading:"lazy"}),e("h4",{children:"Grouped notifications"}),e("p",{children:"Similar notifications are grouped and collapsed to reduce clutter."})]}),e("section",{children:[e("img",{src:wo,alt:"Screenshot of multi-column UI",loading:"lazy"}),e("h4",{children:"Single or multi-column"}),e("p",{children:"By default, single column for zen-mode seekers. Configurable multi-column for power users."})]}),e("section",{children:[e("img",{src:vo,alt:"Screenshot of multi-hashtag timeline with a form to add more hashtags",loading:"lazy"}),e("h4",{children:"Multi-hashtag timeline"}),e("p",{children:"Up to 5 hashtags combined into a single timeline."})]})]})}),e("hr",{}),e("p",{children:[e("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",children:"Built"})," ","by"," ",e("a",{href:"https://mastodon.social/@cheeaun",target:"_blank",onClick:t=>{t.preventDefault(),k.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"}),"."," ",e("a",{href:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",target:"_blank",children:"Privacy Policy"}),"."]})]})}const Io=window.alert;window.__nativeAlert||(window.__nativeAlert=Io);window.alert=function(t){t instanceof Error&&(t!=null&&t.message)&&(t=t.message),typeof t!="string"&&(t=JSON.stringify(t));const n=vs({text:t,className:"alert",gravity:"top",position:"center",duration:1e4,offset:{y:48},onClick:()=>{n.hideToast()}});n.showToast()};window.__STATES__=k;setTimeout(()=>{var t,n,c,i;for(const s in ut)Array.isArray(ut[s])?(n=(t=ut[s])[0])==null||n.call(t):(i=(c=ut)[s])==null||i.call(c)},5e3);(()=>{window.__IDLE__=!1;const t=["mousemove","mousedown","resize","keydown","touchstart","pointerdown","pointermove","wheel"],c=Dn(()=>{window.__IDLE__=!0},5e3),i=()=>{window.__IDLE__=!1,c()};t.forEach(s=>{window.addEventListener(s,i,{passive:!0,capture:!0})})})();An(k,t=>{var n;for(const[c,i,s,o]of t){if(i.join(".")==="settings.shortcutsViewMode"){const l=document.getElementById("app");l&&(l.dataset.shortcutsViewMode=(n=k.shortcuts)!=null&&n.length?s:"")}i.join(".")==="settings.cloakMode"&&document.body.classList.toggle("cloak",s)}});function To(){const[t,n]=C(!1),[c,i]=C("loading");ze(()=>{const o=Z.local.get("theme");o&&(document.documentElement.classList.add(`is-${o}`),document.querySelector('meta[name="color-scheme"]').setAttribute("content",o==="auto"?"dark light":o));const l=Z.local.get("textSize");l&&document.documentElement.style.setProperty("--text-size",`${l}px`)},[]),z(()=>{const o=Z.local.get("instanceURL"),l=decodeURIComponent((window.location.search.match(/code=([^&]+)/)||[,""])[1]);if(l){window.history.replaceState({},document.title,s.pathname||"/");const r=Z.session.get("clientID"),u=Z.session.get("clientSecret"),d=Z.session.get("vapidKey");(async()=>{i("loading");const{access_token:f}=await so({instanceURL:o,client_id:r,client_secret:u,code:l}),p=ds({instance:o,accessToken:f});await Promise.allSettled([Zt(p,o),hs(p,o,f,d)]),Qt(),en(p),n(!0),i("default")})()}else{window.__IGNORE_GET_ACCOUNT_ERROR__=!0;const r=nt();if(r){Z.session.set("currentAccount",r.info.id);const{client:u}=B({account:r}),{instance:d}=u;Qt(),en(u),i("loading"),(async()=>{try{await Zt(u,d)}catch{}finally{n(!0),i("default")}})()}else i("default")}},[]);let s=it();return k.currentLocation=s.pathname,z(_t,[s,t]),/\/https?:/.test(s.pathname)?e(Ji,{}):e($,{children:[e(Co,{isLoggedIn:t,loading:c==="loading"}),e($o,{isLoggedIn:t}),c==="default"&&e(qt,{children:e(ye,{path:"/:instance?/s/:id",element:e(go,{})})}),t&&e(Ts,{}),t&&e(li,{}),e(ii,{}),t&&e(ci,{}),e(Is,{isLoggedIn:t}),c!=="loading"&&e(ai,{onClose:_t}),e(Cs,{})]})}function Co({isLoggedIn:t,loading:n}){const c=it(),i=be(()=>{const{pathname:s}=c;return!/^\/(login|welcome)/.test(s)},[c]);return e(qt,{location:i||c,children:[e(ye,{path:"/",element:t?e(Wi,{}):n?e(ve,{id:"loader-root"}):e(gn,{})}),e(ye,{path:"/login",element:e(io,{})}),e(ye,{path:"/welcome",element:e(gn,{})})]})}function bn(){return k.prevLocation||null}function $o({isLoggedIn:t}){const n=it(),c=R(bn());return be(()=>rt("/:instance/s/:id",n.pathname)||rt("/s/:id",n.pathname),[n.pathname,rt])?c.current||(c.current=bn()):c.current=null,e(qt,{location:c.current||n,children:[t&&e($,{children:[e(ye,{path:"/notifications",element:e(Yn,{})}),e(ye,{path:"/mentions",element:e(Wn,{})}),e(ye,{path:"/following",element:e(Wt,{})}),e(ye,{path:"/b",element:e(Hn,{})}),e(ye,{path:"/f",element:e(Vn,{})}),e(ye,{path:"/l",children:[e(ye,{index:!0,element:e(Xi,{})}),e(ye,{path:":id",element:e(Gn,{})})]}),e(ye,{path:"/ft",element:e(Ii,{})})]}),e(ye,{path:"/:instance?/t/:hashtag",element:e(jn,{})}),e(ye,{path:"/:instance?/a/:id",element:e(yi,{})}),e(ye,{path:"/:instance?/p",children:[e(ye,{index:!0,element:e(Ut,{})}),e(ye,{path:"l",element:e(Ut,{local:!0})})]}),e(ye,{path:"/:instance?/trending",element:e(Jn,{})}),e(ye,{path:"/:instance?/search",element:e(oo,{})})]})}"AbortSignal"in window&&(AbortSignal.timeout=AbortSignal.timeout||(t=>{const n=new AbortController;return setTimeout(()=>n.abort(),t),n.signal}));ks(e(Ss,{children:e(To,{})}),document.getElementById("app"));setTimeout(()=>{try{Object.keys(localStorage).forEach(t=>{t.startsWith("iconify")&&localStorage.removeItem(t)}),Object.keys(sessionStorage).forEach(t=>{t.startsWith("iconify")&&sessionStorage.removeItem(t)}),localStorage.removeItem("settings:boostsCarousel")}catch{}},5e3);window.__CLOAK__=()=>{document.body.classList.toggle("cloak")};
//# sourceMappingURL=main-6d259b05.js.map
