function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./catchup-vF-NJ_db.js","./db-_BHtpnAi.js","./intl-segmenter-polyfill-XHDQHdV5.js","./db-uX-9b679.css","./index-_Y-Lyw2n.js","./catchup-HBTLInPQ.css","./modals-ExCBEKHZ.js","./compose--6D-xgTP.js","./compose-HEGNIWHD.css","./modals-HMWK6usR.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
import{F as O,_ as V,p as A,s as $,a as H,b as Ct,u as es,c as ut,d as St,w as zt,o as Hs,I,e as t,f as It,M as Ht,g as M,L as At,h as bt,N as Je,i as Ft,R as dn,A as fe,S as xt,j as Vs,k as et,l as js,m as pe,n as Xt,q as Gt,T as Ws,r as Ys,t as se,v as gt,x as oe,y as Gs,z as Jt,B as Et,C as Ks,D as Wt,E as te,G as ns,H as Qe,J as ss,K as ie,O as Zs,P as at,Q as _t,U as is,V as Cn,W as Xs,X as os,Y as Js,Z as Qs,$ as Yt,a0 as ti,a1 as rs,a2 as ei,a3 as tn,a4 as cs,a5 as ni,a6 as si,a7 as as,a8 as ii,a9 as we,aa as ls,ab as ce,ac as Rt,ad as ds,ae as us,af as oi,ag as ri,ah as ci,ai,aj as hs,ak as li,al as di,am as He,an as Te,ao as $n,ap as ui,aq as hi,ar as fi,as as fs,at as ps,au as Ae,av as pi,aw as mi,ax as xn,ay as gi,az as An,aA as Mn,aB as un,aC as yt,aD as ms,aE as bi,aF as vi}from"./db-_BHtpnAi.js";import{g as pc}from"./intl-segmenter-polyfill-XHDQHdV5.js";var gs=wi;function wi(e,n,s){var i=null,o=null,r=function(){i&&(clearTimeout(i),o=null,i=null)},h=function(){var c=o;r(),c&&c()},a=function(){if(!n)return e.apply(this,arguments);var c=this,l=arguments,u=s&&!i;if(r(),o=function(){e.apply(c,l)},i=setTimeout(function(){if(i=null,!u){var d=o;return o=null,d()}},n),u)return o()};return a.cancel=r,a.flush=h,a}/*!
 * swiped-events.js - v@version@
 * Pure JavaScript swipe events
 * https://github.com/john-doherty/swiped-events
 * @inspiration https://stackoverflow.com/questions/16348031/disable-scrolling-when-touch-moving-certain-element
 * @author John Doherty <www.johndoherty.info>
 * @license MIT
 */(function(e,n){"use strict";typeof e.CustomEvent!="function"&&(e.CustomEvent=function(p,g){g=g||{bubbles:!1,cancelable:!1,detail:void 0};var m=n.createEvent("CustomEvent");return m.initCustomEvent(p,g.bubbles,g.cancelable,g.detail),m},e.CustomEvent.prototype=e.Event.prototype),n.addEventListener("touchstart",u,!1),n.addEventListener("touchmove",d,!1),n.addEventListener("touchend",l,!1);var s=null,i=null,o=null,r=null,h=null,a=null,c=0;function l(p){if(a===p.target){var g=parseInt(f(a,"data-swipe-threshold","20"),10),m=f(a,"data-swipe-unit","px"),y=parseInt(f(a,"data-swipe-timeout","500"),10),v=Date.now()-h,b="",S=p.changedTouches||p.touches||[];if(m==="vh"&&(g=Math.round(g/100*n.documentElement.clientHeight)),m==="vw"&&(g=Math.round(g/100*n.documentElement.clientWidth)),Math.abs(o)>Math.abs(r)?Math.abs(o)>g&&v<y&&(o>0?b="swiped-left":b="swiped-right"):Math.abs(r)>g&&v<y&&(r>0?b="swiped-up":b="swiped-down"),b!==""){var w={dir:b.replace(/swiped-/,""),touchType:(S[0]||{}).touchType||"direct",fingers:c,xStart:parseInt(s,10),xEnd:parseInt((S[0]||{}).clientX||-1,10),yStart:parseInt(i,10),yEnd:parseInt((S[0]||{}).clientY||-1,10)};a.dispatchEvent(new CustomEvent("swiped",{bubbles:!0,cancelable:!0,detail:w})),a.dispatchEvent(new CustomEvent(b,{bubbles:!0,cancelable:!0,detail:w}))}s=null,i=null,h=null}}function u(p){p.target.getAttribute("data-swipe-ignore")!=="true"&&(a=p.target,h=Date.now(),s=p.touches[0].clientX,i=p.touches[0].clientY,o=0,r=0,c=p.touches.length)}function d(p){if(!(!s||!i)){var g=p.touches[0].clientX,m=p.touches[0].clientY;o=s-g,r=i-m}}function f(p,g,m){for(;p&&p!==n.documentElement;){var y=p.getAttribute(g);if(y)return y;p=p.parentNode}return m}})(window,document);function me(e=()=>{},n=[]){const s=O(e);V(()=>{s.current=e},[n]),V(()=>{const i=()=>{const o=document.hidden||document.visibilityState==="hidden";s.current(!o)};return document.addEventListener("visibilitychange",i),()=>document.removeEventListener("visibilitychange",i)},[])}const yi=1e3*3,Si=15e3,ki=zt(function({isLoggedIn:n}){const[s,i]=A(!0);me(i);const o=async(a,c,l)=>{var u;if($.notificationsLast){const d=a.v1.notifications.list({limit:1,sinceId:$.notificationsLast.id}),{value:f}=await d.next();if(f!=null&&f.length)if(l)$.notificationsShowNew=!0;else{let p;try{const g=await a.v1.markers.fetch({timeline:"notifications"});p=(u=g==null?void 0:g.notifications)==null?void 0:u.lastReadId}catch{}p?$.notificationsShowNew=f[0].id!==p:$.notificationsShowNew=!0}}};V(()=>{let a,c;if(n&&s){const{masto:l,streaming:u,instance:d}=H();(async()=>{await o(l,d);let f=!1;u&&(c=setTimeout(()=>{(async()=>{try{f=!0,a=u.user.notification.subscribe();for await(const p of a){if(!a||!s)break;p.event==="notification"&&Ct(p.payload,d,{skipThreading:!0}),$.notificationsShowNew=!0}}catch{f=!1}f||(c=setInterval(()=>{o(l,d,!0)},Si))})()},yi))})()}return()=>{var l;(l=a==null?void 0:a.unsubscribe)==null||l.call(a),a=null,clearTimeout(c),clearInterval(c)}},[s,n]);const r=O(),h=()=>{r.current=Date.now(),fetch("./version.json").then(a=>a.json()).then(a=>{a&&($.appVersion=a)}).catch(a=>{})};return es(h,s&&1e3*60*30),me(a=>{a&&(r.current?Date.now()-r.current>1e3*60*60&&h():h())}),St("shift+alt+k",()=>{const a=$.settings.cloakMode;$.settings.cloakMode=!a,ut({text:`Cloak mode ${a?"disabled":"enabled"}`})}),null});function Ii(){function e(n){n.shiftKey?Hs()||($.showCompose=!0):$.showCompose=!0}return St("c, shift+c",e,{ignoreEventWhen:n=>!!document.querySelector("#modal-container > *")}),t("button",{type:"button",id:"compose-button",onClick:e,children:t(I,{icon:"quill",size:"xl",alt:"Compose"})})}const Ti=zt(function(){const n=It($);function s(){$.showKeyboardShortcutsHelp=!1}return St("?, shift+?, shift+slash",i=>{$.showKeyboardShortcutsHelp=!0},{ignoreEventWhen:i=>!!document.querySelector("#modal-container > *")}),!!n.showKeyboardShortcutsHelp&&t(Ht,{onClose:s,children:t("div",{id:"keyboard-shortcuts-help-container",class:"sheet",tabindex:"-1",children:[t("button",{type:"button",class:"sheet-close",onClick:s,children:t(I,{icon:"x"})}),t("header",{children:t("h2",{children:"Keyboard shortcuts"})}),t("main",{children:t("table",{children:[{action:"Keyboard shortcuts help",keys:t("kbd",{children:"?"})},{action:"Next post",keys:t("kbd",{children:"j"})},{action:"Previous post",keys:t("kbd",{children:"k"})},{action:"Skip carousel to next post",keys:t(M,{children:[t("kbd",{children:"Shift"})," + ",t("kbd",{children:"j"})]})},{action:"Skip carousel to previous post",keys:t(M,{children:[t("kbd",{children:"Shift"})," + ",t("kbd",{children:"k"})]})},{action:"Load new posts",keys:t("kbd",{children:"."})},{action:"Open post details",keys:t(M,{children:[t("kbd",{children:"Enter"})," or ",t("kbd",{children:"o"})]})},{action:t(M,{children:["Expand content warning or",t("br",{}),"toggle expanded/collapsed thread"]}),keys:t("kbd",{children:"x"})},{action:"Close post or dialogs",keys:t(M,{children:[t("kbd",{children:"Esc"})," or ",t("kbd",{children:"Backspace"})]})},{action:"Focus column in multi-column mode",keys:t(M,{children:[t("kbd",{children:"1"})," to ",t("kbd",{children:"9"})]})},{action:"Compose new post",keys:t("kbd",{children:"c"})},{action:"Compose new post (new window)",className:"insignificant",keys:t(M,{children:[t("kbd",{children:"Shift"})," + ",t("kbd",{children:"c"})]})},{action:"Send post",keys:t(M,{children:[t("kbd",{children:"Ctrl"})," + ",t("kbd",{children:"Enter"})," or ",t("kbd",{children:"⌘"})," +"," ",t("kbd",{children:"Enter"})]})},{action:"Search",keys:t("kbd",{children:"/"})},{action:"Reply",keys:t("kbd",{children:"r"})},{action:"Reply (new window)",className:"insignificant",keys:t(M,{children:[t("kbd",{children:"Shift"})," + ",t("kbd",{children:"r"})]})},{action:"Like (favourite)",keys:t(M,{children:[t("kbd",{children:"l"})," or ",t("kbd",{children:"f"})]})},{action:"Boost",keys:t(M,{children:[t("kbd",{children:"Shift"})," + ",t("kbd",{children:"b"})]})},{action:"Bookmark",keys:t("kbd",{children:"d"})},{action:"Toggle Cloak mode",keys:t(M,{children:[t("kbd",{children:"Shift"})," + ",t("kbd",{children:"Alt"})," + ",t("kbd",{children:"k"})]})}].map(({action:i,className:o,keys:r})=>t("tr",{children:[t("th",{class:o,children:i}),t("td",{children:r})]},i))})})]})})});function en({accountID:e,onChange:n}){const{masto:s}=H(),[i,o]=A("default"),[r,h]=A(null),[a,c]=A(null),l=a!==null;return t("p",{class:"follow-request-buttons",children:[t("button",{type:"button",disabled:i==="loading"||l,onClick:()=>{o("loading"),h("accept"),(async()=>{try{const u=await s.v1.followRequests.$select(e).authorize();if(!(u!=null&&u.followedBy))throw new Error("Follow request not accepted");c(u),n()}catch{}o("default")})()},children:"Accept"})," ",t("button",{type:"button",disabled:i==="loading"||l,class:"light danger",onClick:()=>{o("loading"),h("reject"),(async()=>{try{const u=await s.v1.followRequests.$select(e).reject();if(u!=null&&u.followedBy)throw new Error("Follow request not rejected");c(u),n()}catch{o("default")}})()},children:"Reject"}),t("span",{class:"follow-request-states",children:l&&r?r==="accept"?t(I,{icon:"check-circle",alt:"Accepted",class:"follow-accepted"}):t(I,{icon:"x-circle",alt:"Rejected",class:"follow-rejected"}):t(At,{hidden:i!=="loading"})})]})}const En={mention:"comment",status:"notification",reblog:"rocket",follow:"follow",follow_request:"follow-add",favourite:"heart",poll:"poll",update:"pencil","admin.signup":"account-edit","admin.report":"account-warning"},de={mention:"mentioned you in their post.",status:"published a post.",reblog:"boosted your post.","reblog+account":e=>`boosted ${e} of your posts.`,reblog_reply:"boosted your reply.",follow:"followed you.",follow_request:"requested to follow you.",favourite:"liked your post.","favourite+account":e=>`liked ${e} of your posts.`,favourite_reply:"liked your reply.",poll:"A poll you have voted in or created has ended.","poll-self":"A poll you have created has ended.","poll-voted":"A poll you have voted in has ended.",update:"A post you interacted with has been edited.","favourite+reblog":"boosted & liked your post.","favourite+reblog+account":e=>`boosted & liked ${e} of your posts.`,"favourite+reblog_reply":"boosted & liked your reply.","admin.sign_up":"signed up.","admin.report":e=>t(M,{children:["reported ",e]})},We=50;function Ci({notification:e,instance:n,isStatic:s,disableContextMenu:i}){var C,F,x,P;const{id:o,status:r,account:h,report:a,_accounts:c,_statuses:l}=e;let{type:u}=e;const d=(r==null?void 0:r.reblog)||r,f=d==null?void 0:d.id,p=bt.session.get("currentAccount"),g=p===(h==null?void 0:h.id),m=(C=r==null?void 0:r.poll)==null?void 0:C.voted,y=!!(r!=null&&r.inReplyToAccountId)&&(r==null?void 0:r.inReplyToAccountId)!==p&&((F=r==null?void 0:r.account)==null?void 0:F.id)===p;let v=0,b=0;if(u==="favourite+reblog"){for(const B of c)(x=B._types)!=null&&x.includes("favourite")&&v++,(P=B._types)!=null&&P.includes("reblog")&&b++;!b&&v&&(u="favourite"),!v&&b&&(u="reblog")}let S;if(u==="poll"?S=de[g?"poll-self":m?"poll-voted":"poll"]:u==="reblog"||u==="favourite"||u==="favourite+reblog"?(l==null?void 0:l.length)>1?S=de[`${u}+account`]:y?S=de[`${u}_reply`]:S=de[u]:de[u]?S=de[u]:S=`[Unknown notification type: ${u}]`,typeof S=="function"){const B=(l==null?void 0:l.length)||(c==null?void 0:c.length);if(B)S=S(B);else if(u==="admin.report"){const L=a==null?void 0:a.targetAccount;L&&(S=S(t(Je,{account:L,showAvatar:!0})))}}if(u==="mention"&&!r)return null;const w=e.createdAt&&new Date(e.createdAt).toLocaleString(),T={"favourite+reblog":"Boosted/Liked by…",favourite:"Liked by…",reblog:"Boosted by…",follow:"Followed by…"}[u]||"Accounts",k=()=>{$.showGenericAccounts={heading:T,accounts:c,showReactions:u==="favourite+reblog",excludeRelationshipAttrs:u==="follow"?["followedBy"]:[]}};return t("div",{class:`notification notification-${u}`,"data-notification-id":o,tabIndex:"0",children:[t("div",{class:`notification-type notification-${u}`,title:w,children:u==="favourite+reblog"?t(M,{children:[t(I,{icon:"rocket",size:"xl",alt:u,class:"reblog-icon"}),t(I,{icon:"heart",size:"xl",alt:u,class:"favourite-icon"})]}):t(I,{icon:En[u]||"notification",size:"xl",alt:u})}),t("div",{class:"notification-content",children:[u!=="mention"&&t(M,{children:[t("p",{children:[!/poll|update/i.test(u)&&t(M,{children:(c==null?void 0:c.length)>1?t(M,{children:[t("b",{tabIndex:"0",onClick:k,children:[t("span",{title:c.length,children:Ft(c.length)})," ","people"]})," "]}):t(M,{children:[t(Je,{account:h,showAvatar:!0})," "]})}),S,u==="mention"&&t("span",{class:"insignificant",children:[" ","•"," ",t(dn,{datetime:e.createdAt,format:"micro"})]})]}),u==="follow_request"&&t(en,{accountID:h.id})]}),(c==null?void 0:c.length)>1&&t("p",{class:"avatars-stack",children:[c.slice(0,We).map(B=>t(M,{children:[t("a",{href:B.url,rel:"noopener noreferrer",class:"account-avatar-stack",onClick:L=>{L.preventDefault(),$.showAccount=B},children:[t(fe,{url:B.avatarStatic,size:c.length<=10?"xxl":c.length<20?"xl":c.length<30?"l":c.length<40?"m":"s",alt:`${B.displayName} @${B.acct}`,squircle:B==null?void 0:B.bot},B.id),u==="favourite+reblog"&&t("div",{class:"account-sub-icons",children:B._types.map(L=>t(I,{icon:En[L],size:"s",class:`${L}-icon`}))})]},B.id)," "]},B.id)),t("button",{type:"button",class:"small plain",onClick:k,children:[c.length>We&&`+${c.length-We}`,t(I,{icon:"chevron-down"})]})]}),(l==null?void 0:l.length)>1&&t("ul",{class:"notification-group-statuses",children:l.map(B=>t("li",{children:t(Rn,{class:`status-link status-type-${u}`,to:n?`/${n}/s/${B.id}`:`/s/${B.id}`,children:t(xt,{status:B,size:"s",previewMode:!0,allowContextMenu:!0})})},B.id))}),r&&(!(l!=null&&l.length)||(l==null?void 0:l.length)<=1)&&t(Rn,{class:`status-link status-type-${u}`,to:n?`/${n}/s/${f}`:`/s/${f}`,onContextMenu:i?void 0:B=>{const L=B.target.querySelector(".status");if(L){if(B.metaKey)return;B.preventDefault(),L.dispatchEvent(new MouseEvent("contextmenu",{clientX:B.clientX,clientY:B.clientY}))}},children:s?t(xt,{status:d,size:"s",readOnly:!0,allowContextMenu:!0}):t(xt,{statusID:f,size:"s",readOnly:!0,allowContextMenu:!0})})]})]})}function Rn(e){const n=Vs();return t(et,{...e,"data-read-more":"Read more →",ref:n})}const hn=zt(Ci,(e,n)=>{var s,i;return((s=e.notification)==null?void 0:s.id)===((i=n.notification)==null?void 0:i.id)});"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",e=>{const{type:n,id:s,accessToken:i}=(e==null?void 0:e.data)||{};n==="notification"&&($.routeNotification={id:s,accessToken:i})});const $i=zt(function(){if(!("serviceWorker"in navigator))return null;const n=It($),{routeNotification:s}=n,{id:i,accessToken:o}=s||{},[r,h]=A(!1);Xt(()=>{if(!i||!o)return;const{instance:c}=H(),{masto:l,instance:u}=H({accessToken:o}),d=c===u,f=o?js(o):pe();(async()=>{const p=await l.v1.notifications.$select(i).fetch();if(p&&f){const g=f.instanceURL,{type:m,status:y,account:v}=p,b=!!document.querySelector("#modal-container > *"),S=m==="follow"&&!!(v!=null&&v.id),w=!!(v!=null&&v.id),T=!!(y!=null&&y.id);S&&d?$.showAccount={account:v,instance:g}:b||!d||w&&T?h({id:i,account:f,notification:p,sameInstance:d}):T?location.hash=`/${c}/s/${y.id}`:S?location.hash=`/${c}/a/${v.id}`:location.hash="/notifications"}})()},[i,o]),Xt(()=>{navigator!=null&&navigator.clearAppBadge&&navigator.clearAppBadge()},[]),me(c=>{c&&(navigator!=null&&navigator.clearAppBadge)&&navigator.clearAppBadge()});const a=()=>{h(!1),$.routeNotification=null,/\/notifications\?id=/i.test(location.hash)&&(location.hash="/notifications")};if(r){const{id:c,account:l,notification:u,sameInstance:d}=r;return t(Ht,{onClick:f=>{f.target===f.currentTarget&&a()},children:t("div",{class:"sheet",tabIndex:"-1",children:[t("button",{type:"button",class:"sheet-close",onClick:a,children:t(I,{icon:"x"})}),t("header",{children:t("b",{children:"Notification"})}),t("main",{children:[!d&&t("p",{children:"This notification is from your other account."}),t("div",{class:"notification-peek",onClick:f=>{const{target:p}=f;(f.target.tagName==="BUTTON"||f.target.tagName==="A")&&a()},children:t(hn,{instance:l.instanceURL,notification:u,isStatic:!0})}),t("div",{style:{textAlign:"end"},children:t(et,{to:"/notifications",class:"button light",onClick:a,children:[t("span",{children:"View all notifications"})," ",t(I,{icon:"arrow-right"})]})})]})]})})}return null}),bs=Ys((e,n)=>{const{instance:s}=H(),[i,o]=Gt(),[r,h]=A(!1),[a,c]=A(i.get("q")||""),l=i.get("type"),u=O(null),d=O(null);return Ws(n,()=>({setValue:f=>{c(f)},focus:()=>{d.current.focus()},select:()=>{d.current.select()},blur:()=>{d.current.blur()}})),t("form",{ref:u,class:"search-popover-container",onSubmit:f=>{var g;if(f.preventDefault(),/\/search/.test(location.hash))if(a){const m={q:a};l&&(m.type=l),o(m)}else o({});else a?location.hash=`/search?q=${encodeURIComponent(a)}${l?`&type=${l}`:""}`:location.hash="/search";(g=e==null?void 0:e.onSubmit)==null||g.call(e,f)},children:[t("input",{ref:d,value:a,name:"q",type:"search",placeholder:"Search",dir:"auto",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellCheck:"false",onSearch:f=>{f.target.value||o({})},onInput:f=>{c(f.target.value),h(!0)},onFocus:()=>{var f,p;h(!0),(p=(f=u.current)==null?void 0:f.querySelector(".search-popover-item"))==null||p.classList.add("focus")},onBlur:()=>{var f,p;setTimeout(()=>{h(!1)},100),(p=(f=u.current)==null?void 0:f.querySelector(".search-popover-item.focus"))==null||p.classList.remove("focus")},onKeyDown:f=>{var g;const{key:p}=f;switch(p){case"Escape":h(!1);break;case"Down":case"ArrowDown":if(f.preventDefault(),r){const m=u.current.querySelector(".search-popover-item.focus");if(m){let y=m.nextElementSibling;for(;y&&y.hidden;)y=y.nextElementSibling;y&&(y.classList.add("focus"),Array.from(y.parentElement.children).filter(b=>b!==y).forEach(b=>{b.classList.remove("focus")}))}else{const y=u.current.querySelector(".search-popover-item");y&&y.classList.add("focus")}}break;case"Up":case"ArrowUp":if(f.preventDefault(),r){const m=document.querySelector(".search-popover-item.focus");if(m){let y=m.previousElementSibling;for(;y&&y.hidden;)y=y.previousElementSibling;y&&(y.classList.add("focus"),Array.from(y.parentElement.children).filter(b=>b!==y).forEach(b=>{b.classList.remove("focus")}))}else{const y=document.querySelector(".search-popover-item:last-child");y&&y.classList.add("focus")}}break;case"Enter":if(r){const m=document.querySelector(".search-popover-item.focus");m&&(f.preventDefault(),m.click()),h(!1),(g=e==null?void 0:e.onSubmit)==null||g.call(e,f)}break}}}),t("div",{class:"search-popover",hidden:!r||!a,children:!!a&&[{label:t(M,{children:[a," ",t("small",{class:"insignificant",children:"‒ accounts, hashtags & posts"})]}),to:`/search?q=${encodeURIComponent(a)}`,top:!l&&!/\s/.test(a),hidden:!!l},{label:t(M,{children:["Posts with ",t("q",{children:a})]}),to:`/search?q=${encodeURIComponent(a)}&type=statuses`,hidden:/^https?:/.test(a),top:/\s/.test(a),icon:"document",queryType:"statuses"},{label:t(M,{children:["Posts tagged with ",t("mark",{children:["#",a.replace(/^#/,"")]})]}),to:`/${s}/t/${a.replace(/^#/,"")}`,hidden:/^@/.test(a)||/^https?:/.test(a)||/\s/.test(a),top:/^#/.test(a),type:"link",icon:"hashtag",queryType:"hashtags"},{label:t(M,{children:["Look up ",t("mark",{children:a})]}),to:`/${a}`,hidden:!/^https?:/.test(a),top:/^https?:/.test(a),type:"link"},{label:t(M,{children:["Accounts with ",t("q",{children:a})]}),to:`/search?q=${encodeURIComponent(a)}&type=accounts`,icon:"group",queryType:"accounts"}].sort((f,p)=>{if(l){if(f.queryType===l)return-1;if(p.queryType===l)return 1}return f.top&&!p.top?-1:!f.top&&p.top?1:0}).filter(({hidden:f})=>!f).map(({label:f,to:p,icon:g,type:m},y)=>t(et,{to:p,class:`search-popover-item ${y===0?"focus":""}`,onClick:v=>{var b;(b=e==null?void 0:e.onSubmit)==null||b.call(e,v)},children:[t(I,{icon:g||(m==="link"?"arrow-right":"search"),class:"more-insignificant"}),t("span",{children:f})," "]}))})]})}),xi=zt(function({onClose:n=()=>{}}){const[s,i]=A(!1),o=O(null);St(["Slash","/"],h=>{i(!0),setTimeout(()=>{var a,c,l,u;(c=(a=o.current)==null?void 0:a.focus)==null||c.call(a),(u=(l=o.current)==null?void 0:l.select)==null||u.call(l)},0)},{preventDefault:!0,ignoreEventWhen:h=>{const a=/\/search/.test(location.hash),c=!!document.querySelector("#modal-container > *");return a||c}});const r=()=>{i(!1),n()};return St("esc",h=>{var a,c;(c=(a=o.current)==null?void 0:a.blur)==null||c.call(a),r()},{enabled:s,enableOnFormTags:!0,preventDefault:!0}),t("div",{id:"search-command-container",hidden:!s,onClick:h=>{h.target===h.currentTarget&&r()},children:t(bs,{ref:o,onSubmit:()=>{r()}})})}),vs=new Set,Nt=new WeakMap,ge=new WeakMap,re=new WeakMap,nn=new WeakMap,Ai=new WeakMap,be=new WeakMap,Be=new WeakMap,ke=new WeakSet;let ee,fn=0,pn=0;const Kt="__aa_tgt",Ce="__aa_del",Fe="__aa_new",Mi=e=>{const n=Ni(e);n&&n.forEach(s=>Di(s))},Ei=e=>{e.forEach(n=>{n.target===ee&&Li(),Nt.has(n.target)&&ae(n.target)})};function Ri(e){const n=nn.get(e);n==null||n.disconnect();let s=Nt.get(e),i=0;const o=5;s||(s=ve(e),Nt.set(e,s));const{offsetWidth:r,offsetHeight:h}=ee,c=[s.top-o,r-(s.left+o+s.width),h-(s.top+o+s.height),s.left-o].map(u=>`${-1*Math.floor(u)}px`).join(" "),l=new IntersectionObserver(()=>{++i>1&&ae(e)},{root:ee,threshold:1,rootMargin:c});l.observe(e),nn.set(e,l)}function ae(e){clearTimeout(Be.get(e));const n=Ve(e),s=$e(n)?500:n.duration;Be.set(e,setTimeout(async()=>{const i=re.get(e);try{await(i==null?void 0:i.finished),Nt.set(e,ve(e)),Ri(e)}catch{}},s))}function Li(){clearTimeout(Be.get(ee)),Be.set(ee,setTimeout(()=>{vs.forEach(e=>ks(e,n=>ws(()=>ae(n))))},100))}function _i(e){setTimeout(()=>{Ai.set(e,setInterval(()=>ws(ae.bind(null,e)),2e3))},Math.round(2e3*Math.random()))}function ws(e){typeof requestIdleCallback=="function"?requestIdleCallback(()=>e()):requestAnimationFrame(()=>e())}let sn,he;typeof window<"u"&&(ee=document.documentElement,sn=new MutationObserver(Mi),he=new ResizeObserver(Ei),window.addEventListener("scroll",()=>{pn=window.scrollY,fn=window.scrollX}),he.observe(ee));function Ni(e){return e.reduce((i,o)=>[...i,...Array.from(o.addedNodes),...Array.from(o.removedNodes)],[]).every(i=>i.nodeName==="#comment")?!1:e.reduce((i,o)=>{if(i===!1)return!1;if(o.target instanceof Element){if(Ye(o.target),!i.has(o.target)){i.add(o.target);for(let r=0;r<o.target.children.length;r++){const h=o.target.children.item(r);if(h){if(Ce in h)return!1;Ye(o.target,h),i.add(h)}}}if(o.removedNodes.length)for(let r=0;r<o.removedNodes.length;r++){const h=o.removedNodes[r];if(Ce in h)return!1;h instanceof Element&&(i.add(h),Ye(o.target,h),ge.set(h,[o.previousSibling,o.nextSibling]))}}return i},new Set)}function Ye(e,n){!n&&!(Kt in e)?Object.defineProperty(e,Kt,{value:e}):n&&!(Kt in n)&&Object.defineProperty(n,Kt,{value:e})}function Di(e){var n;const s=e.isConnected,i=Nt.has(e);s&&ge.has(e)&&ge.delete(e),re.has(e)&&((n=re.get(e))===null||n===void 0||n.cancel()),Fe in e?Ln(e):i&&s?Ui(e):i&&!s?Oi(e):Ln(e)}function jt(e){return Number(e.replace(/[^0-9.\-]/g,""))}function Pi(e){let n=e.parentElement;for(;n;){if(n.scrollLeft||n.scrollTop)return{x:n.scrollLeft,y:n.scrollTop};n=n.parentElement}return{x:0,y:0}}function ve(e){const n=e.getBoundingClientRect(),{x:s,y:i}=Pi(e);return{top:n.top+i,left:n.left+s,width:n.width,height:n.height}}function ys(e,n,s){let i=n.width,o=n.height,r=s.width,h=s.height;const a=getComputedStyle(e);if(a.getPropertyValue("box-sizing")==="content-box"){const l=jt(a.paddingTop)+jt(a.paddingBottom)+jt(a.borderTopWidth)+jt(a.borderBottomWidth),u=jt(a.paddingLeft)+jt(a.paddingRight)+jt(a.borderRightWidth)+jt(a.borderLeftWidth);i-=u,r-=u,o-=l,h-=l}return[i,r,o,h].map(Math.round)}function Ve(e){return Kt in e&&be.has(e[Kt])?be.get(e[Kt]):{duration:250,easing:"ease-in-out"}}function Ss(e){if(Kt in e)return e[Kt]}function mn(e){const n=Ss(e);return n?ke.has(n):!1}function ks(e,...n){n.forEach(s=>s(e,be.has(e)));for(let s=0;s<e.children.length;s++){const i=e.children.item(s);i&&n.forEach(o=>o(i,be.has(i)))}}function gn(e){return Array.isArray(e)?e:[e]}function $e(e){return typeof e=="function"}function Ui(e){const n=Nt.get(e),s=ve(e);if(!mn(e))return Nt.set(e,s);let i;if(!n)return;const o=Ve(e);if(typeof o!="function"){const r=n.left-s.left,h=n.top-s.top,[a,c,l,u]=ys(e,n,s),d={transform:`translate(${r}px, ${h}px)`},f={transform:"translate(0, 0)"};a!==c&&(d.width=`${a}px`,f.width=`${c}px`),l!==u&&(d.height=`${l}px`,f.height=`${u}px`),i=e.animate([d,f],{duration:o.duration,easing:o.easing})}else{const[r]=gn(o(e,"remain",n,s));i=new Animation(r),i.play()}re.set(e,i),Nt.set(e,s),i.addEventListener("finish",ae.bind(null,e))}function Ln(e){Fe in e&&delete e[Fe];const n=ve(e);Nt.set(e,n);const s=Ve(e);if(!mn(e))return;let i;if(typeof s!="function")i=e.animate([{transform:"scale(.98)",opacity:0},{transform:"scale(0.98)",opacity:0,offset:.5},{transform:"scale(1)",opacity:1}],{duration:s.duration*1.5,easing:"ease-in"});else{const[o]=gn(s(e,"add",n));i=new Animation(o),i.play()}re.set(e,i),i.addEventListener("finish",ae.bind(null,e))}function _n(e,n){var s;e.remove(),Nt.delete(e),ge.delete(e),re.delete(e),(s=nn.get(e))===null||s===void 0||s.disconnect(),setTimeout(()=>{if(Ce in e&&delete e[Ce],Object.defineProperty(e,Fe,{value:!0,configurable:!0}),n&&e instanceof HTMLElement)for(const i in n)e.style[i]=""},0)}function Oi(e){var n;if(!ge.has(e)||!Nt.has(e))return;const[s,i]=ge.get(e);Object.defineProperty(e,Ce,{value:!0,configurable:!0});const o=window.scrollX,r=window.scrollY;if(i&&i.parentNode&&i.parentNode instanceof Element?i.parentNode.insertBefore(e,i):s&&s.parentNode?s.parentNode.appendChild(e):(n=Ss(e))===null||n===void 0||n.appendChild(e),!mn(e))return _n(e);const[h,a,c,l]=Fi(e),u=Ve(e),d=Nt.get(e);(o!==fn||r!==pn)&&Bi(e,o,r,u);let f,p={position:"absolute",top:`${h}px`,left:`${a}px`,width:`${c}px`,height:`${l}px`,margin:"0",pointerEvents:"none",transformOrigin:"center",zIndex:"100"};if(!$e(u))Object.assign(e.style,p),f=e.animate([{transform:"scale(1)",opacity:1},{transform:"scale(.98)",opacity:0}],{duration:u.duration,easing:"ease-out"});else{const[g,m]=gn(u(e,"remove",d));(m==null?void 0:m.styleReset)!==!1&&(p=(m==null?void 0:m.styleReset)||p,Object.assign(e.style,p)),f=new Animation(g),f.play()}re.set(e,f),f.addEventListener("finish",_n.bind(null,e,p))}function Bi(e,n,s,i){const o=fn-n,r=pn-s,h=document.documentElement.style.scrollBehavior;if(getComputedStyle(ee).scrollBehavior==="smooth"&&(document.documentElement.style.scrollBehavior="auto"),window.scrollTo(window.scrollX+o,window.scrollY+r),!e.parentElement)return;const c=e.parentElement;let l=c.clientHeight,u=c.clientWidth;const d=performance.now();function f(){requestAnimationFrame(()=>{if(!$e(i)){const p=l-c.clientHeight,g=u-c.clientWidth;d+i.duration>performance.now()?(window.scrollTo({left:window.scrollX-g,top:window.scrollY-p}),l=c.clientHeight,u=c.clientWidth,f()):document.documentElement.style.scrollBehavior=h}})}f()}function Fi(e){const n=Nt.get(e),[s,,i]=ys(e,n,ve(e));let o=e.parentElement;for(;o&&(getComputedStyle(o).position==="static"||o instanceof HTMLBodyElement);)o=o.parentElement;o||(o=document.body);const r=getComputedStyle(o),h=Nt.get(o)||ve(o),a=Math.round(n.top-h.top)-jt(r.borderTopWidth),c=Math.round(n.left-h.left)-jt(r.borderLeftWidth);return[a,c,s,i]}function zi(e,n={}){return sn&&he&&(window.matchMedia("(prefers-reduced-motion: reduce)").matches&&!$e(n)&&!n.disrespectUserMotionPreference||(ke.add(e),getComputedStyle(e).position==="static"&&Object.assign(e.style,{position:"relative"}),ks(e,ae,_i,o=>he==null?void 0:he.observe(o)),$e(n)?be.set(e,n):be.set(e,{duration:250,easing:"ease-in-out",...n}),sn.observe(e,{childList:!0}),vs.add(e))),Object.freeze({parent:e,enable:()=>{ke.add(e)},disable:()=>{ke.delete(e)},isEnabled:()=>ke.has(e)})}function Is(e){const n=O(null),[s,i]=A(),o=r=>{s&&(r?s.enable():s.disable())};return V(()=>{n.current instanceof HTMLElement&&i(zi(n.current,e||{}))},[]),[n,o]}var bn={exports:{}},mc=bn.exports;(function(e){var n=function(){var s=String.fromCharCode,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",r={};function h(c,l){if(!r[c]){r[c]={};for(var u=0;u<c.length;u++)r[c][c.charAt(u)]=u}return r[c][l]}var a={compressToBase64:function(c){if(c==null)return"";var l=a._compress(c,6,function(u){return i.charAt(u)});switch(l.length%4){default:case 0:return l;case 1:return l+"===";case 2:return l+"==";case 3:return l+"="}},decompressFromBase64:function(c){return c==null?"":c==""?null:a._decompress(c.length,32,function(l){return h(i,c.charAt(l))})},compressToUTF16:function(c){return c==null?"":a._compress(c,15,function(l){return s(l+32)})+" "},decompressFromUTF16:function(c){return c==null?"":c==""?null:a._decompress(c.length,16384,function(l){return c.charCodeAt(l)-32})},compressToUint8Array:function(c){for(var l=a.compress(c),u=new Uint8Array(l.length*2),d=0,f=l.length;d<f;d++){var p=l.charCodeAt(d);u[d*2]=p>>>8,u[d*2+1]=p%256}return u},decompressFromUint8Array:function(c){if(c==null)return a.decompress(c);for(var l=new Array(c.length/2),u=0,d=l.length;u<d;u++)l[u]=c[u*2]*256+c[u*2+1];var f=[];return l.forEach(function(p){f.push(s(p))}),a.decompress(f.join(""))},compressToEncodedURIComponent:function(c){return c==null?"":a._compress(c,6,function(l){return o.charAt(l)})},decompressFromEncodedURIComponent:function(c){return c==null?"":c==""?null:(c=c.replace(/ /g,"+"),a._decompress(c.length,32,function(l){return h(o,c.charAt(l))}))},compress:function(c){return a._compress(c,16,function(l){return s(l)})},_compress:function(c,l,u){if(c==null)return"";var d,f,p={},g={},m="",y="",v="",b=2,S=3,w=2,T=[],k=0,C=0,F;for(F=0;F<c.length;F+=1)if(m=c.charAt(F),Object.prototype.hasOwnProperty.call(p,m)||(p[m]=S++,g[m]=!0),y=v+m,Object.prototype.hasOwnProperty.call(p,y))v=y;else{if(Object.prototype.hasOwnProperty.call(g,v)){if(v.charCodeAt(0)<256){for(d=0;d<w;d++)k=k<<1,C==l-1?(C=0,T.push(u(k)),k=0):C++;for(f=v.charCodeAt(0),d=0;d<8;d++)k=k<<1|f&1,C==l-1?(C=0,T.push(u(k)),k=0):C++,f=f>>1}else{for(f=1,d=0;d<w;d++)k=k<<1|f,C==l-1?(C=0,T.push(u(k)),k=0):C++,f=0;for(f=v.charCodeAt(0),d=0;d<16;d++)k=k<<1|f&1,C==l-1?(C=0,T.push(u(k)),k=0):C++,f=f>>1}b--,b==0&&(b=Math.pow(2,w),w++),delete g[v]}else for(f=p[v],d=0;d<w;d++)k=k<<1|f&1,C==l-1?(C=0,T.push(u(k)),k=0):C++,f=f>>1;b--,b==0&&(b=Math.pow(2,w),w++),p[y]=S++,v=String(m)}if(v!==""){if(Object.prototype.hasOwnProperty.call(g,v)){if(v.charCodeAt(0)<256){for(d=0;d<w;d++)k=k<<1,C==l-1?(C=0,T.push(u(k)),k=0):C++;for(f=v.charCodeAt(0),d=0;d<8;d++)k=k<<1|f&1,C==l-1?(C=0,T.push(u(k)),k=0):C++,f=f>>1}else{for(f=1,d=0;d<w;d++)k=k<<1|f,C==l-1?(C=0,T.push(u(k)),k=0):C++,f=0;for(f=v.charCodeAt(0),d=0;d<16;d++)k=k<<1|f&1,C==l-1?(C=0,T.push(u(k)),k=0):C++,f=f>>1}b--,b==0&&(b=Math.pow(2,w),w++),delete g[v]}else for(f=p[v],d=0;d<w;d++)k=k<<1|f&1,C==l-1?(C=0,T.push(u(k)),k=0):C++,f=f>>1;b--,b==0&&(b=Math.pow(2,w),w++)}for(f=2,d=0;d<w;d++)k=k<<1|f&1,C==l-1?(C=0,T.push(u(k)),k=0):C++,f=f>>1;for(;;)if(k=k<<1,C==l-1){T.push(u(k));break}else C++;return T.join("")},decompress:function(c){return c==null?"":c==""?null:a._decompress(c.length,32768,function(l){return c.charCodeAt(l)})},_decompress:function(c,l,u){var d=[],f,p=4,g=4,m=3,y="",v=[],b,S,w,T,k,C,F,x={val:u(0),position:l,index:1};for(b=0;b<3;b+=1)d[b]=b;for(w=0,k=Math.pow(2,2),C=1;C!=k;)T=x.val&x.position,x.position>>=1,x.position==0&&(x.position=l,x.val=u(x.index++)),w|=(T>0?1:0)*C,C<<=1;switch(f=w){case 0:for(w=0,k=Math.pow(2,8),C=1;C!=k;)T=x.val&x.position,x.position>>=1,x.position==0&&(x.position=l,x.val=u(x.index++)),w|=(T>0?1:0)*C,C<<=1;F=s(w);break;case 1:for(w=0,k=Math.pow(2,16),C=1;C!=k;)T=x.val&x.position,x.position>>=1,x.position==0&&(x.position=l,x.val=u(x.index++)),w|=(T>0?1:0)*C,C<<=1;F=s(w);break;case 2:return""}for(d[3]=F,S=F,v.push(F);;){if(x.index>c)return"";for(w=0,k=Math.pow(2,m),C=1;C!=k;)T=x.val&x.position,x.position>>=1,x.position==0&&(x.position=l,x.val=u(x.index++)),w|=(T>0?1:0)*C,C<<=1;switch(F=w){case 0:for(w=0,k=Math.pow(2,8),C=1;C!=k;)T=x.val&x.position,x.position>>=1,x.position==0&&(x.position=l,x.val=u(x.index++)),w|=(T>0?1:0)*C,C<<=1;d[g++]=s(w),F=g-1,p--;break;case 1:for(w=0,k=Math.pow(2,16),C=1;C!=k;)T=x.val&x.position,x.position>>=1,x.position==0&&(x.position=l,x.val=u(x.index++)),w|=(T>0?1:0)*C,C<<=1;d[g++]=s(w),F=g-1,p--;break;case 2:return v.join("")}if(p==0&&(p=Math.pow(2,m),m++),d[F])y=d[F];else if(F===g)y=S+S.charAt(0);else return null;v.push(y),d[g++]=S+y.charAt(0),p--,S=y,p==0&&(p=Math.pow(2,m),m++)}}};return a}();e!=null?e.exports=n:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return n})})(bn);var Nn=bn.exports;const qi="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2084%2062'%3e%3crect%20width='64'%20height='48'%20x='18'%20y='2'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3crect%20width='32'%20height='48'%20x='2'%20y='12'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%234169E1'%20d='M14%2052a4%204%200%201%201-8%200%204%204%200%200%201%208%200Zm64-42a4%204%200%201%201-8%200%204%204%200%200%201%208%200Z'/%3e%3c/svg%3e",Hi="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2082%2062'%3e%3crect%20width='78'%20height='58'%20x='2'%20y='2'%20fill='%23999'%20fill-opacity='.3'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3crect%20width='18'%20height='46'%20x='8'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3crect%20width='18'%20height='46'%20x='32'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3crect%20width='18'%20height='46'%20x='56'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3c/svg%3e",Vi="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2084%2062'%3e%3crect%20width='64'%20height='48'%20x='18'%20y='2'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%23999'%20fill-opacity='.3'%20d='M19%203h62v10H19z'/%3e%3cpath%20stroke='%234169E1'%20stroke-width='2'%20d='M43%208a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3cpath%20stroke='%23999'%20stroke-width='2'%20d='M52%208a2%202%200%201%201-4%200%202%202%200%200%201%204%200Zm9%200a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3crect%20width='32'%20height='48'%20x='2'%20y='12'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%23999'%20fill-opacity='.3'%20d='M3%2049h30v10H3z'/%3e%3cpath%20stroke='%234169E1'%20stroke-width='2'%20d='M11%2054a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3cpath%20stroke='%23999'%20stroke-width='2'%20d='M20%2054a2%202%200%201%201-4%200%202%202%200%200%201%204%200Zm9%200a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3c/svg%3e",ji=200,Wi=10;async function ze(){const{masto:e}=H(),n=e.v1.followedTags.list({limit:ji}),s=[];let i=0;do{const{value:o,done:r}=await n.next();if(r||(o==null?void 0:o.length)===0)break;s.push(...o),i++}while(i<Wi);return s.sort((o,r)=>o.name.localeCompare(r.name)),s.length&&setTimeout(()=>{bt.account.set("followedTags",{tags:s,updatedAt:Date.now()})},1),s}const Yi=24*60*60*1e3;async function Gi(){try{const{tags:e,updatedAt:n}=bt.account.get("followedTags")||{};return e!=null&&e.length?(Date.now()-n>Yi&&ze(),e):await ze()}catch{return[]}}const Dn=document.createElement("div"),Ki=e=>{if(!e)return[];if(e.indexOf("#")===-1)return[];Dn.innerHTML=e;const n=Dn.querySelectorAll("a.hashtag");return n.length?Array.from(n).map(s=>s.innerText.trim().replace(/^[^#]*#+/,"")):[]};function on({children:e}){if(typeof e=="string")return e;const[n,s]=A("");return V(()=>{Promise.resolve(e).then(s)},[e]),n}const Zt=9,Zi=["following","mentions","notifications","list","public","trending","search","hashtag","bookmarks","favourites"],Ts={following:"Home / Following",notifications:"Notifications",list:"List",public:"Public (Local / Federated)",search:"Search","account-statuses":"Account",bookmarks:"Bookmarks",favourites:"Likes",hashtag:"Hashtag",trending:"Trending",mentions:"Mentions"},De={list:[{text:"List ID",name:"id"}],public:[{text:"Local only",name:"local",type:"checkbox"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],trending:[{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],search:[{text:"Search term",name:"query",type:"text",placeholder:"Optional, unless for multi-column mode",notRequired:!0}],"account-statuses":[{text:"@",name:"id",type:"text",placeholder:"cheeaun@mastodon.social"}],hashtag:[{text:"#",name:"hashtag",type:"text",placeholder:"e.g. PixelArt (Max 5, space-separated)",pattern:"[^#]+"},{text:"Media only",name:"media",type:"checkbox"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}]},Xi=se(async({id:e})=>(await H().masto.v1.lists.$select(e).fetch()).title),Ji=se(async({id:e})=>{const n=await H().masto.v1.accounts.$select(e).fetch();return n.username||n.acct||n.displayName}),qe={following:{id:"home",title:(e,n)=>n===0?"Home":"Following",path:"/",icon:"home"},mentions:{id:"mentions",title:"Mentions",path:"/mentions",icon:"at"},notifications:{id:"notifications",title:"Notifications",path:"/notifications",icon:"notification"},list:{id:"list",title:Xi,path:({id:e})=>`/l/${e}`,icon:"list"},public:{id:"public",title:({local:e})=>e?"Local":"Federated",subtitle:({instance:e})=>e||H().instance,path:({local:e,instance:n})=>`/${n}/p${e?"/l":""}`,icon:({local:e})=>e?"building":"earth"},trending:{id:"trending",title:"Trending",subtitle:({instance:e})=>e||H().instance,path:({instance:e})=>`/${e}/trending`,icon:"chart"},search:{id:"search",title:({query:e})=>e?`“${e}”`:"Search",path:({query:e})=>e?`/search?q=${encodeURIComponent(e)}&type=statuses`:"/search",icon:"search",excludeViewMode:({query:e})=>e?[]:["multi-column"]},"account-statuses":{id:"account-statuses",title:Ji,path:({id:e})=>`/a/${e}`,icon:"user"},bookmarks:{id:"bookmarks",title:"Bookmarks",path:"/b",icon:"bookmark"},favourites:{id:"favourites",title:"Likes",path:"/f",icon:"heart"},hashtag:{id:"hashtag",title:({hashtag:e})=>e,subtitle:({instance:e})=>e||H().instance,path:({hashtag:e,instance:n,media:s})=>`${n?`/${n}`:""}/t/${e.split(/\s+/).join("+")}${s?"?media=1":""}`,icon:"hashtag"}};function gc({onClose:e}){const n=It($),{shortcuts:s}=n,[i,o]=A(!1),[r,h]=A(!1),[a]=Is();return t("div",{id:"shortcuts-settings-container",class:"sheet",tabindex:"-1",children:[!!e&&t("button",{type:"button",class:"sheet-close",onClick:e,children:t(I,{icon:"x"})}),t("header",{children:t("h2",{children:[t(I,{icon:"shortcut"})," Shortcuts"," ",t("sup",{style:{fontSize:12,opacity:.5,textTransform:"uppercase"},children:"beta"})]})}),t("main",{children:[t("p",{children:"Specify a list of shortcuts that'll appear as:"}),t("div",{class:"shortcuts-view-mode",children:[{value:"float-button",label:"Floating button",imgURL:qi},{value:"tab-menu-bar",label:"Tab/Menu bar",imgURL:Vi},{value:"multi-column",label:"Multi-column",imgURL:Hi}].map(({value:c,label:l,imgURL:u})=>{const d=n.settings.shortcutsViewMode===c||c==="float-button"&&!n.settings.shortcutsViewMode;return t("label",{class:d?"checked":"",children:[t("input",{type:"radio",name:"shortcuts-view-mode",value:c,checked:d,onChange:f=>{$.settings.shortcutsViewMode=f.target.value}})," ",t("img",{src:u,alt:"",width:"80",height:"58"})," ",t("span",{children:l})]},c)})}),s.length>0?t(M,{children:[t("ol",{class:"shortcuts-list",ref:a,children:s.filter(Boolean).map((c,l)=>{const u=Object.values(c).join("-"),{type:d}=c;if(!qe[d])return null;let{icon:f,title:p,subtitle:g,excludeViewMode:m}=qe[d];typeof p=="function"&&(p=p(c,l)),typeof g=="function"&&(g=g(c,l)),typeof f=="function"&&(f=f(c,l)),typeof m=="function"&&(m=m(c,l));const y=m==null?void 0:m.includes(n.settings.shortcutsViewMode);return t("li",{children:[t(I,{icon:f}),t("span",{class:"shortcut-text",children:[t(on,{children:p}),g&&t(M,{children:[" ",t("small",{class:"ib insignificant",children:g})]}),y&&t("span",{class:"tag",children:"Not available in current view mode"})]}),t("span",{class:"shortcut-actions",children:[t("button",{type:"button",class:"plain small",disabled:l===0,onClick:()=>{const v=Array.from($.shortcuts);if(l>0){const b=$.shortcuts[l-1];v[l-1]=c,v[l]=b,$.shortcuts=v}},children:t(I,{icon:"arrow-up",alt:"Move up"})}),t("button",{type:"button",class:"plain small",disabled:l===s.length-1,onClick:()=>{const v=Array.from($.shortcuts);if(l<$.shortcuts.length-1){const b=$.shortcuts[l+1];v[l+1]=c,v[l]=b,$.shortcuts=v}},children:t(I,{icon:"arrow-down",alt:"Move down"})}),t("button",{type:"button",class:"plain small",onClick:()=>{o({shortcut:c,shortcutIndex:l})},children:t(I,{icon:"pencil",alt:"Edit"})})]})]},u)})}),s.length===1&&n.settings.shortcutsViewMode!=="float-button"&&t("div",{class:"ui-state insignificant",children:[t(I,{icon:"info"})," ",t("small",{children:"Add more than one shortcut/column to make this work."})]})]}):t("div",{class:"ui-state insignificant",children:[t("p",{children:n.settings.shortcutsViewMode==="multi-column"?"No columns yet. Tap on the Add column button.":"No shortcuts yet. Tap on the Add shortcut button."}),t("p",{children:["Not sure what to add?",t("br",{}),"Try adding"," ",t("a",{href:"#",onClick:c=>{c.preventDefault(),$.shortcuts=[{type:"following"},{type:"notifications"}]},children:"Home / Following and Notifications"})," ","first."]})]}),t("p",{class:"insignificant",children:s.length>=Zt&&(n.settings.shortcutsViewMode==="multi-column"?`Max ${Zt} columns`:`Max ${Zt} shortcuts`)}),t("p",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t("button",{type:"button",class:"light",onClick:()=>h(!0),children:"Import/export"}),t("button",{type:"button",disabled:s.length>=Zt,onClick:()=>o(!0),children:[t(I,{icon:"plus"})," ",t("span",{children:n.settings.shortcutsViewMode==="multi-column"?"Add column…":"Add shortcut…"})]})]})]}),i&&t(Ht,{onClick:c=>{c.target===c.currentTarget&&o(!1)},children:t(eo,{shortcut:i.shortcut,shortcutIndex:i.shortcutIndex,onSubmit:({result:c,mode:l})=>{l==="edit"?$.shortcuts[i.shortcutIndex]=c:$.shortcuts.push(c)},onClose:()=>o(!1)})}),r&&t(Ht,{onClick:c=>{c.target===c.currentTarget&&h(!1)},children:t(no,{shortcuts:s,onClose:()=>h(!1)})})]})}const Qi=1e3*60,to=se(()=>{const{masto:e}=H();return e.v1.lists.list()},{maxAge:Qi}),Pn={search:"For multi-column mode, search term is required, else the column will not be shown.",hashtag:"Multiple hashtags are supported. Space-separated."};function eo({onSubmit:e,disabled:n,shortcut:s,shortcutIndex:i,onClose:o}){var y,v;const r=!!s,[h,a]=A((s==null?void 0:s.type)||null),{masto:c}=H(),[l,u]=A("default"),[d,f]=A([]),[p,g]=A([]);V(()=>{(async()=>{if(h==="list")try{u("loading");const b=await to();b.sort((S,w)=>S.title.localeCompare(w.title)),f(b),u("default")}catch{u("error")}})(),(async()=>{if(h==="hashtag")try{const b=await ze();g(b)}catch{}})()},[h]);const m=O();return V(()=>{if(r&&h&&De[h]){const b=m.current;De[h].forEach(({name:S,type:w})=>{const T=b.querySelector(`[name="${S}"]`);T&&s[S]&&(w==="checkbox"?T.checked=s[S]==="on":T.value=s[S])})}},[r,h]),t("div",{id:"shortcut-settings-form",class:"sheet",children:[!!o&&t("button",{type:"button",class:"sheet-close",onClick:o,children:t(I,{icon:"x"})}),t("header",{children:t("h2",{children:[r?"Edit":"Add"," shortcut"]})}),t("main",{tabindex:"-1",children:t("form",{ref:m,onSubmit:b=>{b.preventDefault();const S=new FormData(b.target),w={};S.forEach((T,k)=>{w[k]=T==null?void 0:T.trim(),k==="instance"&&(w[k]=w[k].replace(/^https?:\/\//,"").replace(/\/+$/,""),w[k]=w[k].replace(/^@?[^@]+@/,""))}),w.type&&(e({result:w,mode:r?"edit":"add"}),b.target.reset(),a(null),o==null||o())},children:[t("p",{children:t("label",{children:[t("span",{children:"Timeline"}),t("select",{required:!0,disabled:n,onChange:b=>{a(b.target.value)},defaultValue:r?s.type:void 0,name:"type",children:[t("option",{}),Zi.map(b=>t("option",{value:b,children:Ts[b]}))]})]})}),(v=(y=De[h])==null?void 0:y.map)==null?void 0:v.call(y,({text:b,name:S,type:w,placeholder:T,pattern:k,notRequired:C})=>h==="list"?t("p",{children:t("label",{children:[t("span",{children:"List"}),t("select",{name:"id",required:!C,disabled:n||l==="loading",defaultValue:r?s.id:void 0,children:d.map(F=>t("option",{value:F.id,children:F.title}))})]})}):t("p",{children:t("label",{children:[t("span",{children:b})," ",t("input",{type:w,switch:w==="checkbox"||void 0,name:S,placeholder:T,required:w==="text"&&!C,disabled:n,list:h==="hashtag"?"followed-hashtags-datalist":null,autocorrect:"off",autocapitalize:"off",spellCheck:!1,pattern:k}),h==="hashtag"&&p.length>0&&t("datalist",{id:"followed-hashtags-datalist",children:p.map(F=>t("option",{value:F.name}))})]})})),!!Pn[h]&&t("p",{class:"form-note insignificant",children:[t(I,{icon:"info"}),Pn[h]]}),t("footer",{children:[t("button",{type:"submit",class:"block",disabled:n||l==="loading",children:r?"Save":"Add"}),r&&t("button",{type:"button",class:"light danger",onClick:()=>{$.shortcuts.splice(i,1),o==null||o()},children:"Remove"})]})]})})]})}function no({shortcuts:e,onClose:n}){var d;const{masto:s}=H(),i=gt(()=>!e||!e.filter(Boolean).length?"":Nn.compressToEncodedURIComponent(JSON.stringify(e.filter(Boolean))),[e]),[o,r]=A(""),[h,a]=A("default"),c=gt(()=>{if(!o)return a("default"),null;try{const f=JSON.parse(Nn.decompressFromEncodedURIComponent(o));if(!Array.isArray(f))throw new Error("Not an array");return a("default"),f}catch{try{const p=JSON.parse(o);if(!Array.isArray(p))throw new Error("Not an array");return a("default"),p}catch{return a("error"),null}}},[o]),l=$.shortcuts.length>0,u=O();return t("div",{id:"import-export-container",class:"sheet",children:[!!n&&t("button",{type:"button",class:"sheet-close",onClick:n,children:t(I,{icon:"x"})}),t("header",{children:t("h2",{children:["Import/Export ",t("small",{class:"ib insignificant",children:"Shortcuts"})]})}),t("main",{tabindex:"-1",children:[t("section",{children:[t("h3",{children:[t(I,{icon:"arrow-down-circle",size:"l",class:"insignificant"})," ",t("span",{children:"Import"})]}),t("p",{class:"field-button",children:[t("input",{ref:u,type:"text",name:"import",placeholder:"Paste shortcuts here",class:"block",onInput:f=>{r(f.target.value)}}),$.settings.shortcutSettingsCloudImportExport&&t("button",{type:"button",class:"plain2 small",disabled:h==="cloud-downloading",onClick:async()=>{a("cloud-downloading");const f=bt.session.get("currentAccount");ut("Downloading saved shortcuts from instance server…");try{const g=(await s.v1.accounts.relationships.fetch({id:[f]}))[0];if(g){const{note:m=""}=g;if(/<phanpy-shortcuts-settings>(.*)<\/phanpy-shortcuts-settings>/.test(m)){const y=m.match(/<phanpy-shortcuts-settings>(.*)<\/phanpy-shortcuts-settings>/)[1],{v,dt:b,data:S}=JSON.parse(y);u.current.value=S,u.current.dispatchEvent(new Event("input"))}}a("default")}catch{a("error"),ut("Unable to download shortcuts")}},title:"Download shortcuts from instance server",children:[t(I,{icon:"cloud"}),t(I,{icon:"arrow-down"})]})]}),!!c&&Array.isArray(c)&&t(M,{children:[t("p",{children:[t("b",{children:c.length})," shortcut",c.length>1?"s":""," ",t("small",{class:"insignificant",children:["(",o.length," characters)"]})]}),t("ol",{class:"import-settings-list",children:c.map(f=>{var p,g;return t("li",{children:[t("span",{style:{opacity:e.some(m=>Object.keys(m).every(y=>m[y]===f[y]))?1:0},children:"*"}),t("span",{children:[Ts[f.type],f.type==="list"&&" ⚠️"," ",(g=(p=De[f.type])==null?void 0:p.map)==null?void 0:g.call(p,({text:m,name:y,type:v})=>f[y]?t(M,{children:[t("span",{class:"tag collapsed insignificant",children:[m,":"," ",v==="checkbox"?f[y]==="on"?"✅":"❌":f[y]]})," "]}):null)]})]})})}),t("p",{children:[t("small",{children:"* Exists in current shortcuts"}),t("br",{}),t("small",{children:"⚠️ List may not work if it's from a different account."})]})]}),h==="error"&&t("p",{class:"error",children:t("small",{children:"⚠️ Invalid settings format"})}),t("p",{children:[l&&t(M,{children:[t(oe,{confirmLabel:"Append to current shortcuts?",menuFooter:t("div",{class:"footer",children:"Only shortcuts that don’t exist in current shortcuts will be appended."}),onClick:()=>{const f=c.filter(m=>!$.shortcuts.some(y=>Object.keys(y).every(v=>y[v]===m[v])));if(!f.length){ut("No new shortcuts to import");return}let p=[...$.shortcuts,...f];const g=p.length>Zt;g&&(p=p.slice(0,Zt)),$.shortcuts=p,ut(g?`Shortcuts imported. Exceeded max ${Zt}, so the rest are not imported.`:"Shortcuts imported"),n==null||n()},children:t("button",{type:"button",class:"plain2",disabled:!c,children:"Import & append…"})})," "]}),t(oe,{confirmLabel:l?"Override current shortcuts?":"Import shortcuts?",menuItemClassName:l?"danger":void 0,onClick:()=>{$.shortcuts=c,ut("Shortcuts imported"),n==null||n()},children:t("button",{type:"button",class:"plain2",disabled:!c,children:l?"or override…":"Import…"})})]})]}),t("section",{children:[t("h3",{children:[t(I,{icon:"arrow-up-circle",size:"l",class:"insignificant"})," ",t("span",{children:"Export"})]}),t("p",{children:t("input",{style:{width:"100%"},type:"text",value:i,readOnly:!0,onClick:f=>{if(f.target.value){f.target.select();try{navigator.clipboard.writeText(f.target.value),ut("Shortcuts copied")}catch{ut("Unable to copy shortcuts")}}}})}),t("p",{children:[t("button",{type:"button",class:"plain2",disabled:!i,onClick:()=>{try{navigator.clipboard.writeText(i),ut("Shortcut settings copied")}catch{ut("Unable to copy shortcut settings")}},children:[t(I,{icon:"clipboard"})," ",t("span",{children:"Copy"})]})," ",(navigator==null?void 0:navigator.share)&&((d=navigator==null?void 0:navigator.canShare)==null?void 0:d.call(navigator,{text:i}))&&t("button",{type:"button",class:"plain2",disabled:!i,onClick:()=>{try{navigator.share({text:i})}catch{alert("Sharing doesn't seem to work.")}},children:[t(I,{icon:"share"})," ",t("span",{children:"Share"})]})," ",$.settings.shortcutSettingsCloudImportExport&&t("button",{type:"button",class:"plain2",disabled:h==="cloud-uploading",onClick:async()=>{a("cloud-uploading");const f=bt.session.get("currentAccount");try{const g=(await s.v1.accounts.relationships.fetch({id:[f]}))[0];if(g){const{note:m=""}=g;let y="";if(/<phanpy-shortcuts-settings>(.*)<\/phanpy-shortcuts-settings>/.test(m)){const v=JSON.stringify({v:"1",dt:Date.now(),data:i});y=m.replace(/<phanpy-shortcuts-settings>(.*)<\/phanpy-shortcuts-settings>/,`<phanpy-shortcuts-settings>${v}</phanpy-shortcuts-settings>`)}else y=`${m}


<phanpy-shortcuts-settings>${settingsJSON}</phanpy-shortcuts-settings>`;ut("Saving shortcuts to instance server…"),await s.v1.accounts.$select(f).note.create({comment:y}),a("default"),ut("Shortcuts saved")}}catch{a("error"),ut("Unable to save shortcuts")}},title:"Sync to instance server",children:[t(I,{icon:"cloud"}),t(I,{icon:"arrow-up"})]})," ",i.length>0&&t("small",{class:"insignificant ib",children:[i.length," characters"]})]}),!!i&&t("details",{children:[t("summary",{class:"insignificant",children:t("small",{children:"Raw Shortcuts JSON"})}),t("textarea",{style:{width:"100%"},rows:10,readOnly:!0,children:JSON.stringify(e.filter(Boolean),null,2)})]})]}),$.settings.shortcutSettingsCloudImportExport&&t("footer",{children:t("p",{children:[t(I,{icon:"cloud"})," Import/export settings from/to instance server (Very experimental)"]})})]})]})}function so(){const{instance:e}=H(),n=It($),{shortcuts:s,settings:i}=n;if(!s.length||i.shortcutsViewMode==="multi-column"||!i.shortcutsViewMode&&i.shortcutsColumnsMode)return null;const o=O(),r=gt(()=>s.map((a,c)=>{const{type:l,...u}=a;if(!qe[l])return null;let{id:d,path:f,title:p,subtitle:g,icon:m}=qe[l];return typeof d=="function"&&(d=d(u,c)),typeof f=="function"&&(f=f({...u,instance:u.instance||e},c)),typeof p=="function"&&(p=p(u,c)),typeof g=="function"&&(g=g(u,c)),typeof m=="function"&&(m=m(u,c)),{id:d,path:f,title:p,subtitle:g,icon:m}}).filter(Boolean),[s]),h=Gs();return St(["1","2","3","4","5","6","7","8","9"],(a,c)=>{var u,d;const l=parseInt(c.keys[0],10)-1;if(l<r.length){const{path:f}=r[l];f&&(h(f),(d=(u=o.current)==null?void 0:u.closeMenu)==null||d.call(u))}}),t("div",{id:"shortcuts",children:n.settings.shortcutsViewMode==="tab-menu-bar"?t("nav",{class:"tab-bar",onContextMenu:a=>{a.preventDefault(),$.showShortcutsSettings=!0},children:t("ul",{children:r.map(({id:a,path:c,title:l,subtitle:u,icon:d},f)=>t("li",{children:t(et,{class:u?"has-subtitle":"",to:c,onClick:p=>{if(p.target.classList.contains("is-active")){p.preventDefault();const g=document.getElementById(`${a}-page`);if(g){g.scrollTop=0;const m=g.querySelector(".updates-button");m&&m.click()}}},children:[t(I,{icon:d,size:"xl",alt:l}),t("span",{children:[t(on,{children:l}),u&&t(M,{children:[t("br",{}),t("small",{children:u})]})]})]})},`${f}-${a}-${l}-${u}-${c}`))})}):t(Jt,{instanceRef:o,overflow:"auto",viewScroll:"close",menuClassName:"glass-menu shortcuts-menu",gap:8,position:"anchor",menuButton:t("button",{type:"button",id:"shortcuts-button",class:"plain",onContextMenu:a=>{a.preventDefault(),$.showShortcutsSettings=!0},onTransitionStart:a=>{var c,l;try{const{target:u}=a;getComputedStyle(u).pointerEvents==="none"&&((l=(c=o.current)==null?void 0:c.closeMenu)==null||l.call(c))}catch{}},children:t(I,{icon:"shortcut",size:"xl",alt:"Shortcuts"})}),children:r.map(({id:a,path:c,title:l,subtitle:u,icon:d},f)=>t(Et,{to:c,class:"glass-menu-item",children:[t(I,{icon:d,size:"l"})," ",t("span",{class:"menu-grow",children:[t("span",{children:t(on,{children:l})}),u&&t(M,{children:[" ",t("small",{class:"more-insignificant",children:u})]})]}),t("span",{class:"menu-shortcut hide-until-focus-visible",children:f+1})]},`${f}-${a}-${l}-${u}-${c}`))})})}const io=zt(so);function vn({list:e,onClose:n}){const{masto:s}=H(),[i,o]=A("default"),r=!!e,h=O(),a=O(),c=O();V(()=>{r&&(h.current.value=e.title,a.current.value=e.repliesPolicy,c.current&&(c.current.checked=e.exclusive))},[r]);const l=Ks("@mastodon/list-exclusive");return t("div",{class:"sheet",children:[!!n&&t("button",{type:"button",class:"sheet-close",onClick:n,children:t(I,{icon:"x"})})," ",t("header",{children:t("h2",{children:r?"Edit list":"New list"})}),t("main",{children:t("form",{class:"list-form",onSubmit:u=>{u.preventDefault();const d=new FormData(u.target),f=d.get("title"),p=d.get("replies_policy"),g=d.get("exclusive")==="on";o("loading"),(async()=>{try{let m;r?m=await s.v1.lists.$select(e.id).update({title:f,replies_policy:p,exclusive:g}):m=await s.v1.lists.create({title:f,replies_policy:p,exclusive:g}),o("default"),n==null||n({state:"success",list:m})}catch{o("error"),alert(r?"Unable to edit list.":"Unable to create list.")}})()},children:[t("div",{class:"list-form-row",children:t("label",{for:"list-title",children:["Name"," ",t("input",{ref:h,type:"text",id:"list-title",name:"title",required:!0,disabled:i==="loading",dir:"auto"})]})}),t("div",{class:"list-form-row",children:t("select",{ref:a,name:"replies_policy",required:!0,disabled:i==="loading",children:[t("option",{value:"list",children:"Show replies to list members"}),t("option",{value:"followed",children:"Show replies to people I follow"}),t("option",{value:"none",children:"Don't show replies"})]})}),l&&t("div",{class:"list-form-row",children:t("label",{class:"label-block",children:[t("input",{ref:c,type:"checkbox",name:"exclusive",disabled:i==="loading"})," ","Hide posts on this list from Home/Following"]})}),t("div",{class:"list-form-footer",children:[t("button",{type:"submit",disabled:i==="loading",children:r?"Save":"Create"}),r&&t(oe,{disabled:i==="loading",align:"end",menuItemClassName:"danger",confirmLabel:"Delete this list?",onClick:()=>{o("loading"),(async()=>{try{await s.v1.lists.$select(e.id).remove(),o("default"),n==null||n({state:"deleted"})}catch{o("error"),alert("Unable to delete list.")}})()},children:t("button",{type:"button",class:"light danger",disabled:i==="loading",children:"Delete…"})})]})]})})]})}const oo=[60*5,60*30,60*60,60*60*6,60*60*24,60*60*24*3,60*60*24*7,0],Un={0:"Forever",300:"5 minutes",1800:"30 minutes",3600:"1 hour",21600:"6 hours",86400:"1 day",259200:"3 days",604800:"1 week"},On=80,Cs=1e3*60*10;function ro(e,n){return n.v1.accounts.familiarFollowers.fetch({id:[e]})}const co=se(ro,{maxAge:Cs});async function ao(e,n){const s=n.v1.accounts.$select(e).statuses.list({limit:20}).next(),{value:i}=await s,o={total:i.length,originals:0,replies:0,boosts:0};return i.forEach(r=>{r.reblog?o.boosts++:r.inReplyToId&&r.inReplyToAccountId!==r.account.id?o.replies++:o.originals++}),i.length&&(o.daysSinceLastPost=Math.ceil((Date.now()-new Date(i[i.length-1].createdAt))/864e5)),o}const lo=se(ao,{maxAge:Cs});function uo({account:e,fetchAccount:n=()=>{},standalone:s,instance:i,authenticated:o}){const{masto:r}=H({instance:i}),{masto:h,instance:a}=H(),[c,l]=A("default"),u=typeof e=="string",[d,f]=A(u?null:e),p=gt(()=>i===a,[i,a]);V(()=>{if(!u){f(e);return}l("loading"),(async()=>{try{const D=await n();$.accounts[`${D.id}@${i}`]=D,f(D),l("default")}catch{f(null),l("error")}})()},[u,e,n]);const{acct:g,avatar:m,avatarStatic:y,bot:v,createdAt:b,displayName:S,emojis:w,fields:T,followersCount:k,followingCount:C,group:F,id:x,lastStatusAt:P,locked:B,note:L,statusesCount:N,url:E,username:K,memorial:q,moved:tt,roles:Q}=d||{};let vt=!1,{header:Z,headerStatic:lt}=d||{};(!Z||/missing\.png$/.test(Z))&&m&&!/missing\.png$/.test(m)&&(Z=m,vt=!0,y&&!/missing\.png$/.test(y)&&(lt=y));const ot=gt(()=>x===bt.session.get("currentAccount"),[x]);V(()=>{const D=!!(d!=null&&d.id&&(d!=null&&d.username)&&(d!=null&&d.acct)&&(d!=null&&d.avatar)&&(d!=null&&d.avatarStatic)&&(d!=null&&d.displayName)&&(d!=null&&d.url));if(ot&&i&&D){const it=bt.local.getJSON("accounts");let pt=!1;it.forEach(rt=>{rt.info.id===d.id&&rt.instanceURL===i&&(rt.info=d,pt=!0)}),pt&&bt.local.setJSON("accounts",it)}},[ot,d,i]);const ft=gt(()=>E?new URL(E).hostname:null,[E]),[mt,$t]=A([]),_=O(),G=O([]);async function nt(D){(D||!_.current)&&(_.current=r.v1.accounts.$select(x).followers.list({limit:On}));const it=await _.current.next();if(ot||!p)return it;const{value:pt}=it;let rt=[];if(D){const Pt=await r.v1.accounts.familiarFollowers.fetch({id:[x]});G.current=Pt[0].accounts,rt=[...G.current,...pt.filter(Ut=>!G.current.some(Tt=>Tt.id===Ut.id))]}else pt!=null&&pt.length&&(rt=pt.filter(Pt=>!G.current.some(Ut=>Ut.id===Pt.id)));return{...it,value:rt}}const X=O();async function z(D){return(D||!X.current)&&(X.current=r.v1.accounts.$select(x).following.list({limit:On})),await X.current.next()}const W=s?"div":et,U=i?`/${i}/a/${x}`:`/a/${x}`,[ct,ht]=A([]),[j,dt]=A(),[wt,Lt]=A("default"),Dt=!!(j!=null&&j.total),R=async D=>{try{const it=await co(D,h);ht(it[0].accounts.slice(0,ho))}catch{}},Y=async()=>{if(x){Lt("loading");try{const D=await lo(x,r);dt(D),Lt("default")}catch{Lt("error")}}},J=Wt(({relationship:D,currentID:it})=>{D.following||(R(it),!s&&N>0&&Y())},[s,x,N]);return t("div",{tabIndex:"-1",class:`account-container ${c==="loading"?"skeleton":""}`,style:{"--header-color-1":mt[0],"--header-color-2":mt[1],"--header-color-3":mt[2],"--header-color-4":mt[3]},children:[c==="error"&&t("div",{class:"ui-state",children:[t("p",{children:"Unable to load account."}),t("p",{children:t("a",{href:u?e:E,target:"_blank",rel:"noopener noreferrer",children:["Go to account page ",t(I,{icon:"external"})]})})]}),c==="loading"?t(M,{children:[t("header",{children:t(te,{avatarSize:"xxxl",skeleton:!0})}),t("main",{children:[t("div",{class:"note",children:[t("p",{children:"███████ ████ ████"}),t("p",{children:"████ ████████ ██████ █████████ ████ ██"})]}),t("div",{class:"account-metadata-box",children:[t("div",{class:"profile-metadata",children:[t("div",{class:"profile-field",children:[t("b",{class:"more-insignificant",children:"███"}),t("p",{children:"██████"})]}),t("div",{class:"profile-field",children:[t("b",{class:"more-insignificant",children:"████"}),t("p",{children:"███████████"})]})]}),t("div",{class:"stats",children:[t("div",{children:[t("span",{children:"██"})," Followers"]}),t("div",{children:[t("span",{children:"██"})," Following"]}),t("div",{children:[t("span",{children:"██"})," Posts"]})]})]}),t("div",{class:"actions",children:[t("span",{}),t("span",{class:"buttons",children:t("button",{type:"button",title:"More",class:"plain",disabled:!0,children:t(I,{icon:"more",size:"l",alt:"More"})})})]})]})]}):d&&t(M,{children:[!!tt&&t("div",{class:"account-moved",children:[t("p",{children:[t("b",{children:S})," has indicated that their new account is now:"]}),t(te,{account:tt,instance:i,onClick:D=>{D.stopPropagation(),$.showAccount=tt}})]}),!!Z&&!/missing\.png$/.test(Z)&&t("img",{src:Z,alt:"",class:`header-banner ${vt?"header-is-avatar":""}`,onError:D=>{D.target.crossOrigin?D.target.src!==lt?D.target.src=lt:(D.target.removeAttribute("crossorigin"),D.target.src=Z):D.target.src!==lt?D.target.src=lt:D.target.remove()},crossOrigin:"anonymous",onLoad:D=>{D.target.classList.add("loaded");try{const it=window.OffscreenCanvas?new OffscreenCanvas(1,1):document.createElement("canvas"),pt=it.getContext("2d",{willReadFrequently:!0});it.width=D.target.width,it.height=D.target.height,pt.imageSmoothingEnabled=!1,pt.drawImage(D.target,0,0);const rt=10,Ut=[pt.getImageData(0,0,rt,rt).data,pt.getImageData(D.target.width-rt,0,rt,rt).data,pt.getImageData(0,D.target.height-rt,rt,rt).data,pt.getImageData(D.target.width-rt,D.target.height-rt,rt,rt).data].map(Tt=>{let Ot=0,Vt=0,kt=0,qt=0;for(let Bt=0;Bt<Tt.length;Bt+=4)Ot+=Tt[Bt],Vt+=Tt[Bt+1],kt+=Tt[Bt+2],qt+=Tt[Bt+3];const le=Tt.length/4;return[Ot/le,Vt/le,kt/le,qt/le]}).map(Tt=>{const[Ot,Vt,kt,qt]=po(Tt);return`rgba(${Ot}, ${Vt}, ${kt}, ${qt})`});$t(Ut)}catch{}}}),t("header",{children:t(te,{account:d,instance:i,avatarSize:"xxxl",external:s,internal:!s})}),t("div",{class:"faux-header-bg","aria-hidden":"true"}),t("main",{children:[!!q&&t("span",{class:"tag",children:"In Memoriam"}),!!v&&t("span",{class:"tag",children:[t(I,{icon:"bot"})," Automated"]}),!!F&&t("span",{class:"tag",children:[t(I,{icon:"group"})," Group"]}),Q==null?void 0:Q.map(D=>t("span",{class:"tag",children:[D.name,!!ft&&t(M,{children:[" ",t("span",{class:"more-insignificant",children:ft})]})]})),t("div",{class:"note",dir:"auto",onClick:ns({instance:a}),dangerouslySetInnerHTML:{__html:Qe(L,{emojis:w})}}),t("div",{class:"account-metadata-box",children:[(T==null?void 0:T.length)>0&&t("div",{class:"profile-metadata",children:T.map(({name:D,value:it,verifiedAt:pt},rt)=>t("div",{class:`profile-field ${pt?"profile-verified":""}`,dir:"auto",children:[t("b",{children:[t(ss,{text:D,emojis:w})," ",!!pt&&t(I,{icon:"check-circle",size:"s"})]}),t("p",{dangerouslySetInnerHTML:{__html:Qe(it,{emojis:w})}})]},D+rt))}),t("div",{class:"stats",children:[t(W,{tabIndex:0,to:U,onClick:()=>{setTimeout(()=>{$.showGenericAccounts={heading:"Followers",fetchAccounts:nt,instance:i,excludeRelationshipAttrs:ot?["followedBy"]:[]}},0)},children:[!!ct.length&&t("span",{class:"shazam-container-horizontal",children:t("span",{class:"shazam-container-inner stats-avatars-bunch",children:ct.map(D=>t(fe,{url:D.avatarStatic,size:"s",alt:`${D.displayName} @${D.acct}`,squircle:D==null?void 0:D.bot}))})}),t("span",{title:k,children:Ft(k)})," ","Followers"]}),t(W,{class:"insignificant",tabIndex:0,to:U,onClick:()=>{setTimeout(()=>{$.showGenericAccounts={heading:"Following",fetchAccounts:z,instance:i,excludeRelationshipAttrs:ot?["following"]:[]}},0)},children:[t("span",{title:C,children:Ft(C)})," ","Following",t("br",{})]}),t(W,{class:"insignificant",to:U,children:[t("span",{title:N,children:Ft(N)})," ","Posts"]}),!!b&&t("div",{class:"insignificant",children:["Joined"," ",t("time",{datetime:b,children:ie(b,{hideTime:!0})})]})]})]}),!!j&&t(W,{to:U,class:"account-metadata-box",children:t("div",{class:"shazam-container",children:t("div",{class:"shazam-container-inner",children:Dt?t("div",{class:"posting-stats",title:`${Math.round(j.originals/j.total*100)}% original posts, ${Math.round(j.replies/j.total*100)}% replies, ${Math.round(j.boosts/j.total*100)}% boosts`,children:[t("div",{children:j.daysSinceLastPost<365?`Last ${j.total} post${j.total>1?"s":""} in the past 
                      ${j.daysSinceLastPost} day${j.daysSinceLastPost>1?"s":""}`:`
                      Last ${j.total} posts in the past year(s)
                      `}),t("div",{class:"posting-stats-bar",style:{"--originals-percentage":`${j.originals/j.total*100}%`,"--replies-percentage":`${(j.originals+j.replies)/j.total*100}%`}}),t("div",{class:"posting-stats-legends",children:[t("span",{class:"ib",children:[t("span",{class:"posting-stats-legend-item posting-stats-legend-item-originals"})," ","Original"]})," ",t("span",{class:"ib",children:[t("span",{class:"posting-stats-legend-item posting-stats-legend-item-replies"})," ","Replies"]})," ",t("span",{class:"ib",children:[t("span",{class:"posting-stats-legend-item posting-stats-legend-item-boosts"})," ","Boosts"]})]})]}):t("div",{class:"posting-stats",children:"Post stats unavailable."})})})}),t("div",{class:"account-metadata-box",children:t("div",{class:"shazam-container no-animation",hidden:!!j,children:t("div",{class:"shazam-container-inner",children:t("button",{type:"button",class:"posting-stats-button",disabled:wt==="loading",onClick:()=>{Y()},children:[t("div",{class:`posting-stats-bar posting-stats-icon ${wt==="loading"?"loading":""}`,style:{"--originals-percentage":"33%","--replies-percentage":"66%"}}),"View post stats"," "]})})})})]}),t("footer",{children:t(fo,{info:d,instance:i,authenticated:o,onRelationshipChange:J})})]})]})}const ho=3;function fo({info:e,instance:n,authenticated:s,onRelationshipChange:i=()=>{}}){var W;if(!e)return null;const{masto:o,instance:r,authenticated:h}=H(),a=n===r,[c,l]=A("default"),[u,d]=A(null),{id:f,acct:p,url:g,username:m,locked:y,lastStatusAt:v,note:b,fields:S,moved:w}=e,T=O(f),{following:k,showingReblogs:C,notifying:F,followedBy:x,blocking:P,blockedBy:B,muting:L,mutingNotifications:N,requested:E,domainBlocking:K,endorsed:q,note:tt}=u||{},[Q,vt]=A(null),[Z,lt]=A(!1);V(()=>{if(e){const U=bt.session.get("currentAccount");let ct;(async()=>{if(a&&s)ct=f;else if(!a&&h){const j=e.acct.includes("@");try{const dt=await o.v2.search.fetch({q:j?e.acct:`${e.username}@${n}`,type:"accounts",limit:1,resolve:!0});dt.accounts.length&&(ct=dt.accounts[0].id,vt(dt.accounts[0]))}catch{}}if(!ct)return;if(U===ct){lt(!0);return}if(T.current=ct,w)return;l("loading");const ht=o.v1.accounts.relationships.fetch({id:[ct]});try{const j=await ht;if(l("default"),j.length){const dt=j[0];d(dt),i({relationship:dt,currentID:ct})}}catch{l("error")}})()}},[e,s]),V(()=>{e&&Z&&Zs(e)},[e,Z]);const ot=c==="loading",[ft,mt]=A(!1),[$t,_]=A(!1),[G,nt]=A(!1),[X,z]=A([]);return t(M,{children:[t("div",{class:"actions",children:[t("span",{children:[x?t("span",{class:"tag",children:"Follows you"}):v?t("small",{class:"insignificant",children:["Last post:"," ",t("span",{class:"ib",children:ie(v,{hideTime:!0})})]}):t("span",{}),L&&t("span",{class:"tag danger",children:"Muted"}),P&&t("span",{class:"tag danger",children:"Blocked"})]})," ",t("span",{class:"buttons",children:[!!tt&&t("button",{type:"button",class:"private-note-tag",title:"Private note",onClick:()=>{nt(!0)},dir:"auto",children:t("span",{children:tt})}),t(Jt,{portal:{target:document.body},containerProps:{style:{zIndex:1001}},align:"center",position:"anchor",overflow:"auto",menuButton:t("button",{type:"button",title:"More",class:"plain",disabled:ot,children:t(I,{icon:"more",size:"l",alt:"More"})}),onMenuChange:U=>{k&&U.open&&(async()=>{try{const ct=await o.v1.accounts.$select(T.current).lists.list();z(ct)}catch{}})()},children:[h&&!Z&&t(M,{children:[t(at,{onClick:()=>{$.showCompose={draftStatus:{status:`@${(Q==null?void 0:Q.acct)||p} `}}},children:[t(I,{icon:"at"}),t("span",{children:["Mention @",m]})]}),t(at,{onClick:()=>{mt(!0)},children:[t(I,{icon:"translate"}),t("span",{children:"Translate bio"})]}),t(at,{onClick:()=>{nt(!0)},children:[t(I,{icon:"pencil"}),t("span",{children:tt?"Edit private note":"Add private note"})]}),k&&t(at,{onClick:()=>{_(!0)},children:[t(I,{icon:"list"}),X.length?t(M,{children:[t("small",{class:"menu-grow",children:["Add/Remove from Lists",t("br",{}),t("span",{class:"more-insignificant",children:X.map(U=>U.title).join(", ")})]}),t("small",{class:"more-insignificant",children:X.length})]}):t("span",{children:"Add/Remove from Lists"})]}),t(_t,{})]}),t(at,{onClick:()=>{const U=`@${(Q==null?void 0:Q.acct)||p}`;try{navigator.clipboard.writeText(U),ut("Handle copied")}catch{ut("Unable to copy handle")}},children:[t(I,{icon:"copy"}),t("small",{children:["Copy handle",t("br",{}),t("span",{class:"more-insignificant",children:["@",(Q==null?void 0:Q.acct)||p]})]})]}),t(at,{href:g,target:"_blank",children:[t(I,{icon:"external"}),t("small",{class:"menu-double-lines",children:mo(g)})]}),t("div",{class:"menu-horizontal",children:[t(at,{onClick:()=>{try{navigator.clipboard.writeText(g),ut("Link copied")}catch{ut("Unable to copy link")}},children:[t(I,{icon:"link"}),t("span",{children:"Copy"})]}),(navigator==null?void 0:navigator.share)&&((W=navigator==null?void 0:navigator.canShare)==null?void 0:W.call(navigator,{url:g}))&&t(at,{onClick:()=>{try{navigator.share({url:g})}catch{alert("Sharing doesn't seem to work.")}},children:[t(I,{icon:"share"}),t("span",{children:"Share…"})]})]}),!!u&&t(M,{children:[t(_t,{}),L?t(at,{onClick:()=>{l("loading"),(async()=>{try{const U=await o.v1.accounts.$select((Q==null?void 0:Q.id)||f).unmute();d(U),l("default"),ut(`Unmuted @${m}`),$.reloadGenericAccounts.id="mute",$.reloadGenericAccounts.counter++}catch{l("error")}})()},children:[t(I,{icon:"unmute"}),t("span",{children:["Unmute @",m]})]}):t(is,{menuClassName:"menu-blur",openTrigger:"clickOnly",direction:"bottom",overflow:"auto",shift:16,label:t(M,{children:[t(I,{icon:"mute"}),t("span",{class:"menu-grow",children:["Mute @",m,"…"]}),t("span",{style:{textOverflow:"clip"},children:[t(I,{icon:"time"}),t(I,{icon:"chevron-right"})]})]}),children:t("div",{class:"menu-wrap",children:oo.map(U=>t(at,{onClick:()=>{l("loading"),(async()=>{try{const ct=await o.v1.accounts.$select((Q==null?void 0:Q.id)||f).mute({duration:U});d(ct),l("default"),ut(`Muted @${m} for ${Un[U]}`),$.reloadGenericAccounts.id="mute",$.reloadGenericAccounts.counter++}catch{l("error"),ut(`Unable to mute @${m}`)}})()},children:Un[U]}))})}),t(oe,{subMenu:!0,confirm:!P,confirmLabel:t(M,{children:[t(I,{icon:"block"}),t("span",{children:["Block @",m,"?"]})]}),menuItemClassName:"danger",onClick:()=>{l("loading"),(async()=>{try{if(P){const U=await o.v1.accounts.$select((Q==null?void 0:Q.id)||f).unblock();d(U),l("default"),ut(`Unblocked @${m}`)}else{const U=await o.v1.accounts.$select((Q==null?void 0:Q.id)||f).block();d(U),l("default"),ut(`Blocked @${m}`)}$.reloadGenericAccounts.id="block",$.reloadGenericAccounts.counter++}catch{l("error"),P?ut(`Unable to unblock @${m}`):ut(`Unable to block @${m}`)}})()},children:P?t(M,{children:[t(I,{icon:"unblock"}),t("span",{children:["Unblock @",m]})]}):t(M,{children:[t(I,{icon:"block"}),t("span",{children:["Block @",m,"…"]})]})}),t(at,{className:"danger",onClick:()=>{$.showReportModal={account:Q||e}},children:[t(I,{icon:"flag"}),t("span",{children:["Report @",m,"…"]})]})]}),!1]}),!u&&c==="loading"&&t(At,{abrupt:!0}),!!u&&t(oe,{confirm:k||E,confirmLabel:t("span",{children:E?"Withdraw follow request?":`Unfollow @${e.acct||e.username}?`}),menuItemClassName:"danger",align:"end",disabled:ot,onClick:()=>{l("loading"),(async()=>{try{let U;k||E?U=await o.v1.accounts.$select(T.current).unfollow():U=await o.v1.accounts.$select(T.current).follow(),U&&d(U),l("default")}catch(U){alert(U),l("error")}})()},children:t("button",{type:"button",class:`${k||E?"light swap":""}`,"data-swap-state":k||E?"danger":"",disabled:ot,children:k?t(M,{children:[t("span",{children:"Following"}),t("span",{children:"Unfollow…"})]}):E?t(M,{children:[t("span",{children:"Requested"}),t("span",{children:"Withdraw…"})]}):y?t(M,{children:[t(I,{icon:"lock"})," ",t("span",{children:"Follow"})]}):"Follow"})})]})]}),!!ft&&t(Ht,{onClose:()=>{mt(!1)},children:t(go,{note:b,fields:S,onClose:()=>mt(!1)})}),!!$t&&t(Ht,{onClose:()=>{_(!1)},children:t(bo,{accountID:T.current,onClose:()=>_(!1)})}),!!G&&t(Ht,{onClose:()=>{nt(!1)},children:t(vo,{account:e,note:tt,onRelationshipChange:U=>{d(U)},onClose:()=>nt(!1)})})]})}function po([e,n,s]){const i=.2126*e+.7152*n+.0722*s;let o;return i>=220?o=1:i<=50?o=.1:o=i/255,o=Math.min(1,o),[e,n,s,o]}function mo(e){if(!e)return;const n=new URL(e),{host:s,pathname:i}=n,o=i.replace(/\/$/,"").replace(/^\//,"");return t(M,{children:[t("span",{class:"more-insignificant",children:[s,"/"]}),t("wbr",{}),t("span",{children:o})]})}function go({note:e,fields:n,onClose:s}){const i=(n==null?void 0:n.map(({name:r,value:h})=>`${r}
${Cn(h)}`).join(`

`))||"",o=Cn(e)+(i?`

${i}`:"");return t("div",{class:"sheet",children:[!!s&&t("button",{type:"button",class:"sheet-close",onClick:s,children:t(I,{icon:"x"})}),t("header",{children:t("h2",{children:"Translated Bio"})}),t("main",{children:[t("p",{style:{whiteSpace:"pre-wrap"},children:o}),t(Xs,{forceTranslate:!0,text:o})]})]})}function bo({accountID:e,onClose:n}){const{masto:s}=H(),[i,o]=A("default"),[r,h]=A([]),[a,c]=A([]),[l,u]=os(p=>p+1,0);V(()=>{o("loading"),(async()=>{try{const p=await s.v1.lists.list();p.sort((m,y)=>m.title.localeCompare(y.title));const g=await s.v1.accounts.$select(e).lists.list();h(p),c(g),o("default")}catch{o("error")}})()},[l]);const[d,f]=A(!1);return t("div",{class:"sheet",id:"list-add-remove-container",children:[!!n&&t("button",{type:"button",class:"sheet-close",onClick:n,children:t(I,{icon:"x"})}),t("header",{children:t("h2",{children:"Add/Remove from Lists"})}),t("main",{children:[r.length>0?t("ul",{class:"list-add-remove",children:r.map(p=>{const g=a.some(m=>m.id===p.id);return t("li",{children:t("button",{type:"button",class:`light ${g?"checked":""}`,disabled:i==="loading",onClick:()=>{o("loading"),(async()=>{try{g?await s.v1.lists.$select(p.id).accounts.remove({accountIds:[e]}):await s.v1.lists.$select(p.id).accounts.create({accountIds:[e]}),u()}catch{o("error"),alert(g?"Unable to remove from list.":"Unable to add to list.")}})()},children:[t(I,{icon:"check-circle"}),t("span",{children:p.title})]})})})}):i==="loading"?t("p",{class:"ui-state",children:t(At,{abrupt:!0})}):i==="error"?t("p",{class:"ui-state",children:"Unable to load lists."}):t("p",{class:"ui-state",children:"No lists."}),t("button",{type:"button",class:"plain2",onClick:()=>f(!0),disabled:i!=="default",children:[t(I,{icon:"plus",size:"l"})," ",t("span",{children:"New list"})]})]}),d&&t(Ht,{onClick:p=>{p.target===p.currentTarget&&f(!1)},children:t(vn,{list:d==null?void 0:d.list,onClose:p=>{p.state==="success"&&u(),f(!1)}})})]})}function vo({account:e,note:n,onRelationshipChange:s=()=>{},onClose:i=()=>{}}){const{masto:o}=H(),[r,h]=A("default"),a=O(null);return V(()=>{let c;return a.current&&!n&&(c=setTimeout(()=>{var l,u;(u=(l=a.current).focus)==null||u.call(l)},100)),()=>{clearTimeout(c)}},[]),t("div",{class:"sheet",id:"private-note-container",children:[!!i&&t("button",{type:"button",class:"sheet-close",onClick:i,children:t(I,{icon:"x"})}),t("header",{children:t("b",{children:["Private note about @",(e==null?void 0:e.username)||(e==null?void 0:e.acct)]})}),t("main",{children:t("form",{onSubmit:c=>{c.preventDefault();const u=new FormData(c.target).get("note");(u==null?void 0:u.trim())!==(n==null?void 0:n.trim())&&(h("loading"),(async()=>{try{const d=await o.v1.accounts.$select(e==null?void 0:e.id).note.create({comment:u});h("default"),s(d),i()}catch(d){h("error"),alert((d==null?void 0:d.message)||"Unable to update private note.")}})())},children:[t("textarea",{ref:a,name:"note",disabled:r==="loading",children:n}),t("footer",{children:[t("button",{type:"button",class:"light",disabled:r==="loading",onClick:()=>{i==null||i()},children:"Cancel"}),t("span",{children:[t(At,{abrupt:!0,hidden:r!=="loading"}),t("button",{disabled:r==="loading",type:"submit",children:"Save & close"})]})]})]})})]})}var wo=Object.defineProperty,yo=(e,n,s)=>n in e?wo(e,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[n]=s,Me=(e,n,s)=>(yo(e,typeof n!="symbol"?n+"":n,s),s),rn=new Map,Ee=new WeakMap,Bn=0,So=void 0;function ko(e){return e?(Ee.has(e)||(Bn+=1,Ee.set(e,Bn.toString())),Ee.get(e)):"0"}function Io(e){return Object.keys(e).sort().filter(n=>e[n]!==void 0).map(n=>`${n}_${n==="root"?ko(e.root):e[n]}`).toString()}function To(e){const n=Io(e);let s=rn.get(n);if(!s){const i=new Map;let o;const r=new IntersectionObserver(h=>{h.forEach(a=>{var c;const l=a.isIntersecting&&o.some(u=>a.intersectionRatio>=u);e.trackVisibility&&typeof a.isVisible>"u"&&(a.isVisible=l),(c=i.get(a.target))==null||c.forEach(u=>{u(l,a)})})},e);o=r.thresholds||(Array.isArray(e.threshold)?e.threshold:[e.threshold||0]),s={id:n,observer:r,elements:i},rn.set(n,s)}return s}function Co(e,n,s={},i=So){if(typeof window.IntersectionObserver>"u"&&i!==void 0){const c=e.getBoundingClientRect();return n(i,{isIntersecting:i,target:e,intersectionRatio:typeof s.threshold=="number"?s.threshold:0,time:0,boundingClientRect:c,intersectionRect:c,rootBounds:c}),()=>{}}const{id:o,observer:r,elements:h}=To(s),a=h.get(e)||[];return h.has(e)||h.set(e,a),a.push(n),r.observe(e),function(){a.splice(a.indexOf(n),1),a.length===0&&(h.delete(e),r.unobserve(e)),h.size===0&&(r.disconnect(),rn.delete(o))}}function $o(e){return typeof e.children!="function"}var ne=class extends Js{constructor(e){super(e),Me(this,"node",null),Me(this,"_unobserveCb",null),Me(this,"handleNode",n=>{this.node&&(this.unobserve(),!n&&!this.props.triggerOnce&&!this.props.skip&&this.setState({inView:!!this.props.initialInView,entry:void 0})),this.node=n||null,this.observeNode()}),Me(this,"handleChange",(n,s)=>{n&&this.props.triggerOnce&&this.unobserve(),$o(this.props)||this.setState({inView:n,entry:s}),this.props.onChange&&this.props.onChange(n,s)}),this.state={inView:!!e.initialInView,entry:void 0}}componentDidMount(){this.unobserve(),this.observeNode()}componentDidUpdate(e){(e.rootMargin!==this.props.rootMargin||e.root!==this.props.root||e.threshold!==this.props.threshold||e.skip!==this.props.skip||e.trackVisibility!==this.props.trackVisibility||e.delay!==this.props.delay)&&(this.unobserve(),this.observeNode())}componentWillUnmount(){this.unobserve()}observeNode(){if(!this.node||this.props.skip)return;const{threshold:e,root:n,rootMargin:s,trackVisibility:i,delay:o,fallbackInView:r}=this.props;this._unobserveCb=Co(this.node,this.handleChange,{threshold:e,root:n,rootMargin:s,trackVisibility:i,delay:o},r)}unobserve(){this._unobserveCb&&(this._unobserveCb(),this._unobserveCb=null)}render(){const{children:e}=this.props;if(typeof e=="function"){const{inView:p,entry:g}=this.state;return e({inView:p,entry:g,ref:this.handleNode})}const{as:n,triggerOnce:s,threshold:i,root:o,rootMargin:r,onChange:h,skip:a,trackVisibility:c,delay:l,initialInView:u,fallbackInView:d,...f}=this.props;return Qs(n||"div",{ref:this.handleNode,...f},e)}};async function $s(e,n={}){if(!(e!=null&&e.length))return;const{masto:s}=H(),i=bt.session.get("currentAccount"),o=e.reduce((r,h)=>(!r.includes(h.id)&&!n[h.id]&&h.id!==i&&r.push(h.id),r),[]);if(!o.length)return null;try{return(await s.v1.accounts.relationships.fetch({id:o})).reduce((a,c)=>(a[c.id]=c,a),{})}catch{return null}}function xo(e){var o;let n=[],s=[],i=0;for(let r=0;r<e.length;r++){const h=e[r];h.reblog&&!((o=h.account)!=null&&o.group)?(s.push(h),i++):(n.push(h),i<3&&(i=0))}if(e.length>10&&(s.length>e.length/4||i>=3)){const r=s.map(h=>h.id);if(s.length>e.length*3/4)n=[...n,{id:r,items:s,type:"boosts"}];else{const h=Math.floor(n.length/2);n=[...n.slice(0,h),{id:r,items:s,type:"boosts"},...n.slice(h)]}return n}else return e}function Fn(e,n){const s=bt.account.get("boostedStatusIDs")||{},i=e.filter(r=>{if(!r.reblog)return!0;const h=`${n}-${r.reblog.id}`,a=s[h];return a&&a!==r.id?!1:(s[h]=r.id,!0)}),o=Object.keys(s);return o.length>50&&o.slice(0,o.length-50).forEach(r=>{delete s[r]}),bt.account.set("boostedStatusIDs",s),i}function Ao(e,n){const s=[];let i=0;e.forEach(h=>{for(let c=0;c<s.length;c++){if(s[c].find(l=>l.id===h.id))return;if(s[c].find(l=>l.id===h.inReplyToId)||s[c].find(l=>l.inReplyToId===h.id)){s[c].push(h);return}}const a=e.find(c=>c.id===h.inReplyToId);a&&(s[i++]=[h,a])});for(let h=0;h<s.length;h++)for(let a=h+1;a<s.length;a++)s[h].find(l=>s[a].includes(l))&&(s[h]=[...s[h],...s[a]],s[h]=s[h].filter((l,u,d)=>d.findIndex(f=>f.id===l.id)===u),s.splice(a,1),a--);s.forEach(h=>{h.sort((a,c)=>!a.inReplyToId&&!c.inReplyToId?new Date(a.createdAt)-new Date(c.createdAt):a.inReplyToId===c.id?1:c.inReplyToId===a.id||!a.inReplyToId?-1:c.inReplyToId?new Date(a.createdAt)-new Date(c.createdAt):1)}),s.forEach(h=>{const a=h[0].account.id;h.forEach(c=>{c.account.id!==a&&(c._differentAuthor=!0)})}),s.length;const o=[],r=[];return e.forEach(h=>{if(h.reblog){o.push(h);return}for(let a=0;a<s.length;a++)if(s[a].find(c=>c.id===h.id)){if(r.includes(a))return;const c=s[a];c.sort((u,d)=>{const f=new Date(u.createdAt),p=new Date(d.createdAt);return f-p});const l=c[0].account.id;o.push({id:c.map(u=>u.id),items:c,type:c.every(u=>u.account.id===l)?"thread":"conversation"}),r.push(a);return}if(h.inReplyToId&&h.inReplyToAccountId!==h.account.id){const a=Yt(h.id,n);$.statusReply[a]||queueMicrotask(async()=>{try{const{masto:c}=H({instance:n}),l=await Mo(h.inReplyToId,c);Ct(l,n,{skipThreading:!0,skipUnfurling:!0}),$.statusReply[a]={id:l.id,instance:n}}catch{}})}o.push(h)}),o}const Mo=se((e,n)=>n.v1.statuses.$select(e).fetch());async function Eo(e,n){const s=await Gi();if(!s.length)return;const{statusFollowedTags:i}=$,o=[];if(e.forEach(r=>{var f;if(r.reblog)return;const{id:h,content:a,tags:c=[]}=r,l=Yt(h,n);if((f=i[l])!=null&&f.length)return;const u=Ki(a);if(!u.length&&!c.length)return;const d=s.reduce((p,g)=>((u.some(m=>m.toLowerCase()===g.name.toLowerCase())||c.some(m=>m.name.toLowerCase()===g.name.toLowerCase()))&&p.push(g.name),p),[]);d.length&&o.push({item:r,sKey:l,followedTags:d})}),o.length){const r=o.map(a=>a.item.account),h=await $s(r);if(!h)return;o.forEach(a=>{const{item:c,sKey:l,followedTags:u}=a,d=h[c.account.id];d&&!d.following&&(i[l]=u)})}}function Ro(){$.statusFollowedTags={}}function Lo({scrollableRef:e,distanceFromStart:n=1,distanceFromEnd:s=1,scrollThresholdStart:i=10,scrollThresholdEnd:o=10,direction:r="vertical",distanceFromStartPx:h,distanceFromEndPx:a}={}){const[c,l]=A(null),[u,d]=A(!1),[f,p]=A(!1),[g,m]=A(!1),[y,v]=A(!1),b=r==="vertical";return Xt(()=>{const S=e.current;if(!S)return{};let w=b?S.scrollTop:S.scrollLeft;function T(){const{scrollTop:k,scrollLeft:C,scrollHeight:F,scrollWidth:x,clientHeight:P,clientWidth:B}=S,L=b?k:C,N=b?F:x,E=b?P:B,K=Math.abs(L-w),q=h||Math.min(E*n,N,L),tt=a||Math.min(E*s,N,N-L-E);K>=(w<L?o:i)&&(l(w<L?"end":"start"),w=L),d(L<=0),p(L+E>=N),m(L<=q),v(L+E>=N-tt)}return S.addEventListener("scroll",T,{passive:!0}),()=>S.removeEventListener("scroll",T)},[n,s,i,o]),{scrollDirection:c,reachStart:u,reachEnd:f,nearReachStart:g,nearReachEnd:y,init:()=>{e.current&&e.current.dispatchEvent(new Event("scroll"))}}}function _o({scrollableRef:e,distanceFromStart:n=1,distanceFromEnd:s=1,scrollThresholdStart:i=10,scrollThresholdEnd:o=10,direction:r="vertical",distanceFromStartPx:h,distanceFromEndPx:a,init:c}={},l,u){if(!l)return;const d=r==="vertical",f=O(null),p=O(null),g=ti(()=>{let m=!1,y=!1,v=!1,b=!1;const S=e.current,{scrollTop:w,scrollLeft:T,scrollHeight:k,scrollWidth:C,clientHeight:F,clientWidth:x}=S,P=d?w:T,B=d?k:C,L=d?F:x,N=Math.abs(P-f.current),E=h||Math.min(L*n,B,P),K=a||Math.min(L*s,B,B-P-L);N>=(f.current<P?o:i)&&(p.current=f.current<P?"end":"start",f.current=P),m=P<=0,y=P+L>=B,v=P<=E,b=P+L>=B-K,l({scrollDirection:p.current,reachStart:m,reachEnd:y,nearReachStart:v,nearReachEnd:b})},500);Xt(()=>{const m=e.current;return m?(f.current=m[d?"scrollTop":"scrollLeft"],m.addEventListener("scroll",g,{passive:!0}),()=>m.removeEventListener("scroll",g)):{}},[n,s,i,o,...u]),V(()=>{c&&e.current&&queueMicrotask(()=>{e.current.dispatchEvent(new Event("scroll"))})},[c])}function No({class:e,statusID:n,status:s,instance:i,parent:o,onMediaClick:r}){let h=Yt(n,i);const a=It($);if(s||(s=a.statuses[h]||a.statuses[n],h=Yt(s==null?void 0:s.id,i)),!s)return null;const{account:{acct:c,avatar:l,avatarStatic:u,id:d,url:f,displayName:p,username:g,emojis:m,bot:y,group:v},id:b,repliesCount:S,reblogged:w,reblogsCount:T,favourited:k,favouritesCount:C,bookmarked:F,poll:x,muted:P,sensitive:B,spoilerText:L,visibility:N,language:E,editedAt:K,filtered:q,card:tt,createdAt:Q,inReplyToId:vt,inReplyToAccountId:Z,content:lt,mentions:ot,mediaAttachments:ft,reblog:mt,uri:$t,url:_,emojis:G,_deleted:nt,_pinned:X}=s;if(!(ft!=null&&ft.length))return null;const z=Dt=>{Dt.shiftKey},W=gt(()=>bt.session.get("currentAccount"),[]),U=gt(()=>W&&W===d,[d,W]),ct=ei(rs),ht=!U&&tn(q,ct);if((ht==null?void 0:ht.action)==="hide")return null;const j=B,wt=gt(()=>(bt.account.get("preferences")||{})["reading:expand:media"]||"default",[])==="show_all",Lt=o||"div";return ft.map((Dt,R)=>{const Y=`${h}-${Dt.id}`,J=ht==null?void 0:ht.titlesStr;return t(Lt,{"data-state-post-id":h,onMouseEnter:z,"data-spoiler-text":L||(B?"Sensitive media":void 0),"data-filtered-text":ht?`Filtered${J?`: ${J}`:""}`:void 0,class:`
          media-post
          ${ht?"filtered":""}
          ${j?"has-spoiler":""}
          ${wt?"show-media":""}
        `,children:t(cs,{class:e,media:Dt,lang:E,to:`/${i}/s/${b}?media-only=${R+1}`,onClick:r?D=>r(D,R,Dt,s):void 0})},Y)})}const zn=zt(No);function Do(e){var w,T,k,C,F;const n=It($),{masto:s,instance:i,authenticated:o}=H(),[r,h]=A(),[a,c]=A(!1);V(()=>{const x=bt.local.getJSON("accounts")||[],P=x.find(B=>B.info.id===bt.session.get("currentAccount"));P&&h(P),c(x.length>1)},[]);const l=(n.settings.shortcutsViewMode==="multi-column"||!n.settings.shortcutsViewMode&&n.settings.shortcutsColumnsMode)&&!n.shortcuts.find(x=>x.type==="following"),u=ni(()=>{$.showAccounts=!0},{threshold:600,detect:"touch",cancelOnMovement:!0}),d=O(),[f,p]=A(void 0),g=si([0,0,n.settings.shortcutsViewMode==="tab-menu-bar"?50:0,0]),m=O();async function y(x){return(x||!m.current)&&(m.current=s.v1.mutes.list({limit:80})),await m.current.next()}const v=O();async function b(x){return(x||!v.current)&&(v.current=s.v1.blocks.list({limit:80})),await v.current.next()}const S=O();return t(M,{children:[t("button",{ref:d,type:"button",class:`button plain nav-menu-button ${a?"with-avatar":""} ${open?"active":""}`,style:{position:"relative"},onClick:()=>{S.current=Date.now(),p(x=>x?void 0:"open")},onContextMenu:x=>{x.preventDefault(),$.showAccounts=!0},...u(),children:[a&&t(fe,{url:((w=r==null?void 0:r.info)==null?void 0:w.avatar)||((T=r==null?void 0:r.info)==null?void 0:T.avatarStatic),size:"l",squircle:(k=r==null?void 0:r.info)==null?void 0:k.bot}),t(I,{icon:"menu",size:a?"s":"l"})]}),t(as,{menuClassName:"nav-menu",state:f,anchorRef:d,onClose:()=>{p(void 0)},containerProps:{style:{zIndex:10},onClick:()=>{Date.now()-S.current<300}},portal:{target:document.body},...e,overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:g,unmountOnClose:!0,children:[!!((C=n.appVersion)!=null&&C.commitHash)&&n.appVersion.commitHash!=="9a5704e"&&t("div",{class:"top-menu",children:[t(at,{onClick:()=>{confirm("Reload page now to update?")&&(async()=>{try{location.reload()}catch{}})()},children:[t(I,{icon:"sparkles",class:"sparkle-icon",size:"l"})," ",t("span",{children:"New update available…"})]}),t(_t,{})]}),t("section",{children:[t(Et,{to:"/",children:[t(I,{icon:"home",size:"l"})," ",t("span",{children:"Home"})]}),o?t(M,{children:[l&&t(Et,{to:"/following",children:[t(I,{icon:"following",size:"l"})," ",t("span",{children:"Following"})]}),t(Et,{to:"/catchup",children:[t(I,{icon:"history2",size:"l"}),t("span",{children:"Catch-up"})]}),t(Et,{to:"/mentions",children:[t(I,{icon:"at",size:"l"})," ",t("span",{children:"Mentions"})]}),t(Et,{to:"/notifications",children:[t(I,{icon:"notification",size:"l"})," ",t("span",{children:"Notifications"}),n.notificationsShowNew&&t("sup",{title:"New",style:{opacity:.5},children:[" ","•"]})]}),t(_t,{}),((F=r==null?void 0:r.info)==null?void 0:F.id)&&t(Et,{to:`/${i}/a/${r.info.id}`,children:[t(I,{icon:"user",size:"l"})," ",t("span",{children:"Profile"})]}),t(Et,{to:"/l",children:[t(I,{icon:"list",size:"l"})," ",t("span",{children:"Lists"})]}),t(Et,{to:"/b",children:[t(I,{icon:"bookmark",size:"l"})," ",t("span",{children:"Bookmarks"})]}),t(is,{overflow:"auto",gap:-8,label:t(M,{children:[t(I,{icon:"more",size:"l"}),t("span",{class:"menu-grow",children:"More…"}),t(I,{icon:"chevron-right"})]}),children:[t(Et,{to:"/f",children:[t(I,{icon:"heart",size:"l"})," ",t("span",{children:"Likes"})]}),t(Et,{to:"/ft",children:[t(I,{icon:"hashtag",size:"l"})," ",t("span",{children:"Followed Hashtags"})]}),t(_t,{}),t(at,{onClick:()=>{$.showGenericAccounts={id:"mute",heading:"Muted users",fetchAccounts:y,excludeRelationshipAttrs:["muting"]}},children:[t(I,{icon:"mute",size:"l"})," Muted users…"]}),t(at,{onClick:()=>{$.showGenericAccounts={id:"block",heading:"Blocked users",fetchAccounts:b,excludeRelationshipAttrs:["blocking"]}},children:[t(I,{icon:"block",size:"l"}),"Blocked users…"]})," "]}),t(_t,{}),t(at,{onClick:()=>{$.showAccounts=!0},children:[t(I,{icon:"group",size:"l"})," ",t("span",{children:"Accounts…"})]})]}):t(M,{children:[t(_t,{}),t(Et,{to:"/login",children:[t(I,{icon:"user",size:"l"})," ",t("span",{children:"Log in"})]})]})]}),t("section",{children:[t(_t,{}),t(Et,{to:"/search",children:[t(I,{icon:"search",size:"l"})," ",t("span",{children:"Search"})]}),t(Et,{to:`/${i}/trending`,children:[t(I,{icon:"chart",size:"l"})," ",t("span",{children:"Trending"})]}),t(Et,{to:`/${i}/p/l`,children:[t(I,{icon:"building",size:"l"})," ",t("span",{children:"Local"})]}),t(Et,{to:`/${i}/p`,children:[t(I,{icon:"earth",size:"l"})," ",t("span",{children:"Federated"})]}),o?t(M,{children:[t(_t,{className:"divider-grow"}),t(at,{onClick:()=>{$.showKeyboardShortcutsHelp=!0},children:[t(I,{icon:"keyboard",size:"l"})," ",t("span",{children:"Keyboard shortcuts"})]}),t(at,{onClick:()=>{$.showShortcutsSettings=!0},children:[t(I,{icon:"shortcut",size:"l"})," ",t("span",{children:"Shortcuts / Columns…"})]}),t(at,{onClick:()=>{$.showSettings=!0},children:[t(I,{icon:"gear",size:"l"})," ",t("span",{children:"Settings…"})]})]}):t(M,{children:[t(_t,{}),t(at,{onClick:()=>{$.showSettings=!0},children:[t(I,{icon:"gear",size:"l"})," ",t("span",{children:"Settings…"})]})]})]})]})]})}const xe=zt(Do),Re={block:"nearest",inline:"center",behavior:"smooth"};function Qt({title:e,titleComponent:n,id:s,instance:i,emptyText:o,errorText:r,useItemID:h,boostsCarousel:a,fetchItems:c=()=>{},checkForUpdates:l=()=>{},checkForUpdatesInterval:u=15e3,headerStart:d,headerEnd:f,timelineStart:p,refresh:g,view:m,filterContext:y,showFollowedTags:v,showReplyParent:b}){const S=It($),[w,T]=A([]),[k,C]=A("default"),[F,x]=A(!1),[P,B]=A(!1),[L,N]=A(!0),E=O(),K=m!=="media",q=ii(z=>{B(!1),k!=="loading"&&(C("loading"),(async()=>{try{let{done:W,value:U}=await c(z);if(Array.isArray(U)){const[ct,ht]=U.reduce((j,dt)=>(dt._pinned?j[0].push(dt):j[1].push(dt),j),[[],[]]);U=ht,K&&(a&&(U=xo(U)),U=Ao(U,i)),ct.length&&(U=ct.concat(U)),T(z?U:j=>[...j,...U]),U.length||(W=!0),x(!W)}else x(!1);C("default")}catch{C("error")}finally{q.cancel()}})())},1500,{leading:!0,trailing:!1}),tt=".timeline-item, .timeline-item-alt",Q=St("j, shift+j",(z,W)=>{const U=document.activeElement.closest(tt),ct=U==null?void 0:U.getBoundingClientRect(),ht=Array.from(E.current.querySelectorAll(tt));if(U&&ct.top<E.current.clientHeight&&ct.bottom>0){const j=ht.indexOf(U);let dt=ht[j+1];W.shift&&(dt=ht.find((wt,Lt)=>Lt>j&&!wt.classList.contains("timeline-item-alt"))),dt&&(dt.focus(),dt.scrollIntoView(Re))}else{const j=ht.find(dt=>{const wt=dt.getBoundingClientRect();return wt.top>=44&&wt.left>=0});j&&(j.focus(),j.scrollIntoView(Re))}}),vt=St("k, shift+k",(z,W)=>{const U=document.activeElement.closest(tt),ct=U==null?void 0:U.getBoundingClientRect(),ht=Array.from(E.current.querySelectorAll(tt));if(U&&ct.top<E.current.clientHeight&&ct.bottom>0){const j=ht.indexOf(U);let dt=ht[j-1];W.shift&&(dt=ht.findLast((wt,Lt)=>Lt<j&&!wt.classList.contains("timeline-item-alt"))),dt&&(dt.focus(),dt.scrollIntoView(Re))}else{const j=ht.find(dt=>{const wt=dt.getBoundingClientRect();return wt.top>=44&&wt.left>=0});j&&(j.focus(),j.scrollIntoView(Re))}}),Z=St(["enter","o"],()=>{const z=document.activeElement.closest(tt);z&&z.click()}),lt=w.length>0&&k!=="loading"&&P,ot=Wt(()=>{var z;q(!0),(z=E.current)==null||z.scrollTo({top:0,behavior:"smooth"})},[q]),ft=St(".",()=>{lt&&ot()}),mt=O(),[$t,_]=A(!1);_o({scrollableRef:E,distanceFromEnd:2,scrollThresholdStart:44},({scrollDirection:z,nearReachStart:W,reachStart:U})=>{if(mt.current){const ct=z==="end"&&!W;mt.current.hidden=ct}_(W),U&&q(!0)},[]),V(()=>{var z;(z=E.current)==null||z.scrollTo({top:0}),q(!0)},[]),V(()=>{q(!0)},[g]);const G=O(m);V(()=>{G.current!==m&&(G.current=m,T([]))},[m]);const nt=Wt(async({disableIdleCheck:z=!1}={})=>{const W=E.current?getComputedStyle(E.current).pointerEvents==="none":!1;S.settings.autoRefresh&&E.current.scrollTop<16&&(z||window.__IDLE__)&&!Bo()&&!W?q(!0):await l()&&B(!0)},[s,q,l,S.settings.autoRefresh]),X=O();return me(z=>{if(z){const W=Date.now()-X.current;(!X.current||W>1e3*3)&&nt({disableIdleCheck:!0})}else X.current=Date.now();N(z)},[l,nt,S.settings.autoRefresh]),es(nt,L&&!P?u*($t?1:2):null),t(rs.Provider,{value:y,children:t("div",{id:`${s}-page`,class:"deck-container",ref:z=>{E.current=z,Q.current=z,vt.current=z,Z.current=z},tabIndex:"-1",children:t("div",{class:"timeline-deck deck",children:[t("header",{ref:mt,onClick:z=>{var W;z.target.closest("a, button")||(W=E.current)==null||W.scrollTo({top:0,behavior:"smooth"})},onDblClick:z=>{z.target.closest("a, button")||q(!0)},class:k==="loading"?"loading":"",children:[t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:[t(xe,{}),d??t(et,{to:"/",class:"button plain home-button",children:t(I,{icon:"home",size:"l"})})]}),e&&(n||t("h1",{children:e})),t("div",{class:"header-side",children:!!f&&f})]}),lt&&t("button",{class:"updates-button shiny-pill",type:"button",onClick:ot,children:[t(I,{icon:"arrow-up"})," New posts"]})]}),!!p&&t("div",{class:`timeline-start ${k==="loading"?"loading":""}`,children:p}),w.length?t(M,{children:[t("ul",{class:`timeline ${m?`timeline-${m}`:""}`,children:[w.map(z=>t(Po,{status:z,instance:i,useItemID:h,filterContext:y,view:m,showFollowedTags:v,showReplyParent:b},z.id+(z==null?void 0:z._pinned)+m)),F&&k==="loading"&&(m==="media"?null:t(M,{children:[t("li",{style:{height:"20vh"},children:t(xt,{skeleton:!0})}),t("li",{style:{height:"25vh"},children:t(xt,{skeleton:!0})})]}))]}),k==="default"&&(F?t(ne,{root:E.current,rootMargin:`0px 0px ${screen.height*1.5}px 0px`,onChange:z=>{z&&q()},children:t("button",{type:"button",class:"plain block",onClick:()=>q(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):t("p",{class:"ui-state insignificant",children:"The end."}))]}):k==="loading"?t("ul",{class:"timeline",children:Array.from({length:5}).map((z,W)=>m==="media"?t("div",{style:{height:"50vh"}}):t("li",{children:t(xt,{skeleton:!0})},W))}):k!=="error"&&t("p",{class:"ui-state",children:o}),k==="error"&&t("p",{class:"ui-state",children:[r,t("br",{}),t("br",{}),t("button",{type:"button",onClick:()=>q(!w.length),children:"Try again"})]})]})})})}const Po=zt(({status:e,instance:n,useItemID:s,filterContext:i,view:o,showFollowedTags:r,showReplyParent:h})=>{const{id:a,reblog:c,items:l,type:u,_pinned:d}=e;d&&(s=!1);const f=(c==null?void 0:c.id)||a,p=n?`/${n}/s/${f}`:`/s/${f}`;if(l){const m=we(l,i);let y="";if(u==="boosts"?y=`${m.length} Boosts`:u==="pinned"&&(y="Pinned posts"),u==="boosts"||u==="pinned")return m.sort((S,w)=>{const T=tn(S.filtered,i),k=tn(w.filtered,i);return T&&!k?1:!T&&k?-1:0}),t("li",{class:"timeline-item-carousel",children:t(Uo,{title:y,class:`${u}-carousel`,children:m.map(S=>{const{id:w,reblog:T,_pinned:k}=S,C=(T==null?void 0:T.id)||w,F=n?`/${n}/s/${C}`:`/s/${C}`;return k&&(s=!1),t("li",{children:t(et,{class:"status-carousel-link timeline-item-alt",to:F,children:s?t(xt,{statusID:w,instance:n,size:"s",contentTextWeight:!0,enableCommentHint:!0}):t(xt,{status:S,instance:n,size:"s",contentTextWeight:!0,enableCommentHint:!0})})},w)})})},`timeline-${a}`);const b=m.length>3;return m.map((S,w)=>{const{id:T,_differentAuthor:k}=S,C=n?`/${n}/s/${T}`:`/s/${T}`,F=w>0&&w<m.length-1,x=S.sensitive&&!!S.spoilerText,P=!k&&x&&w>0||b&&F&&(u==="thread"||u==="conversation"&&!k&&!m[w-1]._differentAuthor&&!m[w+1]._differentAuthor),B=w===0,L=w===m.length-1;return t("li",{class:`timeline-item-container timeline-item-container-type-${u} timeline-item-container-${B?"start":L?"end":"middle"} ${k?"timeline-item-diff-author":""}`,children:t(et,{class:"status-link timeline-item",to:C,children:P?t(Oo,{status:S,instance:n}):s?t(xt,{statusID:T,instance:n,enableCommentHint:L,showFollowedTags:r}):t(xt,{status:S,instance:n,enableCommentHint:L,showFollowedTags:r})})},`timeline-${T}`)})}const g=`timeline-${a+d}`;return o==="media"?s?t(zn,{class:"timeline-item",parent:"li",statusID:a,instance:n},g):t(zn,{class:"timeline-item",parent:"li",status:e,instance:n},g):t("li",{children:t(et,{class:"status-link timeline-item",to:p,children:s?t(xt,{statusID:a,instance:n,enableCommentHint:!0,showFollowedTags:r,showReplyParent:h}):t(xt,{status:e,instance:n,enableCommentHint:!0,showFollowedTags:r,showReplyParent:h})})},g)},(e,n)=>{var o,r;const s=(((o=e.status)==null?void 0:o.id)||"").toString(),i=(((r=n.status)==null?void 0:r.id)||"").toString();return s===i&&e.instance===n.instance&&e.view===n.view});function Uo({title:e,class:n,children:s}){const i=O(),o=O(),r=O(),[h,a]=A(!1);return V(()=>{setTimeout(()=>{a(!0)},1)},[]),t("div",{class:`status-carousel ${n}`,children:[t("header",{children:[t("h3",{children:e}),t("span",{children:[t("button",{ref:o,type:"button",class:"small plain2",onClick:()=>{var c,l;(l=i.current)==null||l.scrollBy({left:-Math.min(320,(c=i.current)==null?void 0:c.offsetWidth),behavior:"smooth"})},children:t(I,{icon:"chevron-left"})})," ",t("button",{ref:r,type:"button",class:"small plain2",onClick:()=>{var c,l;(l=i.current)==null||l.scrollBy({left:Math.min(320,(c=i.current)==null?void 0:c.offsetWidth),behavior:"smooth"})},children:t(I,{icon:"chevron-right"})})]})]}),t("ul",{ref:i,children:[t(ne,{class:"status-carousel-beacon",onChange:c=>{o.current&&(o.current.disabled=c)}}),s[0],h&&s.slice(1),t(ne,{class:"status-carousel-beacon",onChange:c=>{r.current&&(r.current.disabled=c)}})]})]})}function Oo({status:e,instance:n}){const s=It($),{id:i,visibility:o,language:r}=e,h=ls(e),a=Yt(i,n);return t("article",{class:`status compact-thread ${o==="direct"?"visibility-direct":""}`,tabindex:"-1",children:[s.statusThreadNumber[a]?t("div",{class:"status-thread-badge",children:[t(I,{icon:"thread",size:"s"}),s.statusThreadNumber[a]?` ${s.statusThreadNumber[a]}/X`:""]}):t("div",{class:"status-thread-badge",children:t(I,{icon:"thread",size:"s"})}),t("div",{class:"content-compact",title:h,lang:r,dir:"auto",children:[h,e.sensitive&&e.spoilerText&&t(M,{children:[" ",t("span",{class:"spoiler-badge",children:t(I,{icon:"eye-close",size:"s"})})]})]})]})}function Bo(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}const ue=20,wn=1983,qn=`${wn}-01`,Fo=(()=>{try{const e=document.createElement("input");return e.setAttribute("type","month"),e.type==="month"}catch{return!1}})();async function zo(e){var i;const{masto:n}=H({instance:e}),s=await n.v2.search.fetch({q:"from:me",type:"statuses",limit:1});return!!((i=s==null?void 0:s.statuses)!=null&&i.length)}const qo=se(zo);function Ho(){const e=It($),{id:n,...s}=ce(),[i,o]=Gt(),r=i.get("month"),h=!i.get("replies"),a=!!i.get("boosts"),c=i.get("tagged"),l=!!i.get("media"),{masto:u,instance:d,authenticated:f}=H({instance:s.instance}),{masto:p,instance:g}=H(),m=O(),y=[r,h,a,c,l],[v,b]=A(),S=O(0);V(()=>{S.current=0},y);const w=gt(()=>d===g,[d,g]),[T,k]=A(!1);V(()=>{w&&v!=null&&v.acct&&(async()=>{const Z=await qo(d);k(Z)})()},[d,w,v==null?void 0:v.acct]);async function C(Z){var _,G,nt;const lt=/^\d{4}-[01]\d$/.test(r),ot=((G=(_=r==null?void 0:r.split)==null?void 0:_.call(r,"-"))==null?void 0:G[0])>=wn;if(lt&&ot){if(!v)return{value:[],done:!0};const[X,z]=r.split("-"),W=parseInt(z,10)-1,U=new Date(X,W,0),ct=`${U.getFullYear()}-${(U.getMonth()+1).toString().padStart(2,"0")}-${U.getDate().toString().padStart(2,"0")}`,ht=new Date(X,W+1,1),j=`${ht.getFullYear()}-${(ht.getMonth()+1).toString().padStart(2,"0")}-${ht.getDate().toString().padStart(2,"0")}`;let dt;Z?(dt=ue+1,S.current=0):(dt=ue+S.current+1,S.current+=ue);const wt=await u.v2.search.fetch({q:`from:${v.acct} after:${ct} before:${j}`,type:"statuses",limit:dt,offset:S.current});if((nt=wt==null?void 0:wt.statuses)!=null&&nt.length){const Lt=wt.statuses.slice(0,ue);Lt.forEach(R=>{Ct(R,d)});const Dt=wt.statuses.length<=ue;return{value:Lt,done:Dt}}else return{value:[],done:!0}}const ft=[];if(Z){const{value:X}=await u.v1.accounts.$select(n).statuses.list({pinned:!0}).next();if(X!=null&&X.length&&!c&&!l){const z=X.map(W=>(Ct(W,d),{...W,_pinned:!0}));if(z.length>=3){const W=z.map(U=>U.id);ft.push({id:W,items:z,type:"pinned"})}else ft.push(...z)}}(Z||!m.current)&&(m.current=u.v1.accounts.$select(n).statuses.list({limit:ue,exclude_replies:h,exclude_reblogs:a,only_media:l,tagged:c}));const{value:mt,done:$t}=await m.current.next();return mt!=null&&mt.length&&(ft.push(...mt),mt.forEach(X=>{Ct(X,d)})),{value:ft,done:$t}}const[F,x]=A([]);Rt(v!=null&&v.acct?`${v!=null&&v.displayName?v.displayName+" ":""}@${v.acct}${h?a?" (- Boosts)":c?` (#${c})`:l?" (Media)":r?` (${new Date(r).toLocaleString("default",{month:"long",year:"numeric"})})`:"":" (+ Replies)"}`:"Account posts","/:instance?/a/:id");const P=O(),B=Wt(()=>{const Z=P.current||u.v1.accounts.$select(n).fetch();return P.current=Z,Z},[n,u]);V(()=>{(async()=>{try{const Z=await B();b(Z)}catch{}try{const Z=await u.v1.accounts.$select(n).featuredTags.list();x(Z)}catch{}})()},[n]);const{displayName:L,acct:N,emojis:E}=v||{},K=O(),q=gt(()=>{const Z=!h||a||c||l||!!r,lt=e.accounts[`${n}@${d}`];return t(M,{children:[t(uo,{instance:d,account:lt||n,fetchAccount:B,authenticated:f,standalone:!0}),t("div",{class:"filter-bar",ref:K,style:{position:"relative"},children:[Z?t(et,{to:`/${d}/a/${n}`,class:"insignificant filter-clear",title:"Clear filters",children:t(I,{icon:"x",size:"l"})},"clear-filters"):t(I,{icon:"filter",class:"insignificant",size:"l"}),t(et,{to:`/${d}/a/${n}${h?"?replies=1":""}`,onClick:()=>{h&&ut("Showing post with replies")},class:h?"":"is-active",children:"+ Replies"}),t(et,{to:`/${d}/a/${n}${a?"":"?boosts=0"}`,onClick:()=>{a||ut("Showing posts without boosts")},class:a?"is-active":"",children:"- Boosts"}),t(et,{to:`/${d}/a/${n}${l?"":"?media=1"}`,onClick:()=>{l||ut("Showing posts with media")},class:l?"is-active":"",children:"Media"}),F.map(ot=>t(et,{to:`/${d}/a/${n}${c===ot.name?"":`?tagged=${encodeURIComponent(ot.name)}`}`,onClick:()=>{c!==ot.name&&ut(`Showing posts tagged with #${ot.name}`)},class:c===ot.name?"is-active":"",children:t("span",{children:[t("span",{class:"more-insignificant",children:"#"}),ot.name]})},ot.id)),T&&(Fo?t("label",{class:`filter-field ${r?"is-active":""}`,children:[t(I,{icon:"month",size:"l"}),t("input",{type:"month",disabled:!(v!=null&&v.acct),value:r||"",min:qn,max:new Date().toISOString().slice(0,7),onInput:ot=>{const{value:ft,validity:mt}=ot.currentTarget;if(!mt.valid)return;o(ft?{month:ft}:{});const[$t,_]=ft.split("-"),G=parseInt(_,10)-1,nt=new Date($t,G);ut(`Showing posts in ${nt.toLocaleString("default",{month:"long",year:"numeric"})}`)}})]}):t(Vo,{class:`filter-field ${r?"is-active":""}`,disabled:!(v!=null&&v.acct),value:r||"",min:qn,max:new Date().toISOString().slice(0,7),onInput:ot=>{const{value:ft,validity:mt}=ot;mt.valid&&o(ft?{month:ft}:{})}}))]})]})},[n,d,f,F,B,T,...y]);V(()=>{var lt;const Z=(lt=K.current)==null?void 0:lt.querySelector(".is-active");Z&&K.current.scrollTo({behavior:"smooth",left:Z.offsetLeft-(K.current.offsetWidth-Z.offsetWidth)/2})},[F,T,...y]);const tt=gt(()=>v!=null&&v.url?new URL(v.url).hostname:null,[v]),vt=!!v&&!(d===tt);return t(Qt,{title:`${v!=null&&v.acct?"@"+v.acct:"Posts"}`,titleComponent:t("h1",{class:"header-double-lines header-account",children:[t("b",{children:t(ss,{text:L,emojis:E})}),t("div",{children:t("span",{children:["@",N]})})]}),id:"account-statuses",instance:d,emptyText:"Nothing to see here yet.",errorText:"Unable to load posts",fetchItems:C,useItemID:!0,view:l?"media":void 0,boostsCarousel:e.settings.boostsCarousel,timelineStart:q,refresh:[h,a,c,l,r+(v==null?void 0:v.acct)].toString(),headerEnd:t(Jt,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(I,{icon:"more",size:"l"})}),children:[t(at,{disabled:!vt,onClick:()=>{(async()=>{try{const{masto:Z}=H({instance:tt}),lt=await Z.v1.accounts.lookup({acct:v.acct}),{id:ot}=lt;location.hash=`/${tt}/a/${ot}`}catch{alert("Unable to fetch account info")}})()},children:[t(I,{icon:"transfer"})," ",t("small",{class:"menu-double-lines",children:["Switch to account's instance (",t("b",{children:tt}),")"]})]}),!w&&t(at,{onClick:()=>{(async()=>{try{const Z=await p.v1.accounts.lookup({acct:v.acct+"@"+d}),{id:lt}=Z;location.hash=`/${g}/a/${lt}`}catch{alert("Unable to fetch account info")}})()},children:[t(I,{icon:"transfer"})," ",t("small",{class:"menu-double-lines",children:["Switch to my instance (",t("b",{children:g}),")"]})]})]})},n)}function Vo(e){const{class:n,disabled:s,value:i,min:o,max:r,onInput:h=()=>{}}=e,[a,c]=(i==null?void 0:i.split("-"))||[],l=O(),u=O(),d=(f,p)=>{const[g,m]=(o==null?void 0:o.split("-"))||[],[y,v]=(r==null?void 0:r.split("-"))||[];return!(p<g||p>y||p===g&&f<m||p===y&&f>v)};return t("div",{class:n,children:[t(I,{icon:"month",size:"l"}),t("select",{ref:l,disabled:s,value:c||"",onInput:f=>{const{value:p}=f.currentTarget,g=u.current.value;if(!d(p,g))return{value:"",validity:{valid:!1}};h({value:p?`${g}-${p}`:"",validity:{valid:!0}})},children:[t("option",{value:"",children:"Month"}),t("option",{disabled:!0,children:"-----"}),Array.from({length:12},(f,p)=>t("option",{value:(p+1).toString().padStart(2,"0"),children:new Date(0,p).toLocaleString("default",{month:"long"})},p))]})," ",t("input",{ref:u,type:"number",disabled:s,value:a||new Date().getFullYear(),min:(o==null?void 0:o.slice(0,4))||wn,max:(r==null?void 0:r.slice(0,4))||new Date().getFullYear(),onInput:f=>{const{value:p,validity:g}=f.currentTarget,m=l.current.value;if(!g.valid||!d(m,p))return{value:"",validity:{valid:!1}};h({value:p?`${p}-${m}`:"",validity:{valid:!0}})},style:{width:"4.5em"}})]})}const jo=20;function xs(){Rt("Bookmarks","/b");const{masto:e,instance:n}=H(),s=O();async function i(o){return(o||!s.current)&&(s.current=e.v1.bookmarks.list({limit:jo})),await s.current.next()}return t(Qt,{title:"Bookmarks",id:"bookmarks",emptyText:"No bookmarks yet. Go bookmark something!",errorText:"Unable to load bookmarks",instance:n,fetchItems:i})}const Wo=20;function As(){Rt("Likes","/f");const{masto:e,instance:n}=H(),s=O();async function i(o){return(o||!s.current)&&(s.current=e.v1.favourites.list({limit:Wo})),await s.current.next()}return t(Qt,{title:"Likes",id:"favourites",emptyText:"No likes yet. Go like something!",errorText:"Unable to load likes",instance:n,fetchItems:i})}function Yo(){const{masto:e,instance:n}=H();Rt("Followed Hashtags","/ft");const[s,i]=A("default"),[o,r]=A([]);return V(()=>{i("loading"),(async()=>{try{const h=await ze();r(h),i("default")}catch{i("error")}})()},[]),t("div",{id:"followed-hashtags-page",class:"deck-container",tabIndex:"-1",children:t("div",{class:"timeline-deck deck",children:[t("header",{children:t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:[t(xe,{}),t(et,{to:"/",class:"button plain",children:t(I,{icon:"home",size:"l"})})]}),t("h1",{children:"Followed Hashtags"}),t("div",{class:"header-side"})]})}),t("main",{children:o.length>0?t(M,{children:[t("ul",{class:"link-list",children:o.map(h=>t("li",{children:t(et,{to:n?`/${n}/t/${h.name}`:`/t/${h.name}`,children:[t(I,{icon:"hashtag"})," ",t("span",{children:h.name})]})}))}),o.length>1&&t("footer",{class:"ui-state",children:t("small",{class:"insignificant",children:[o.length," hashtag",o.length===1?"":"s"]})})]}):s==="loading"?t("p",{class:"ui-state",children:t(At,{abrupt:!0})}):s==="error"?t("p",{class:"ui-state",children:"Unable to load followed hashtags."}):t("p",{class:"ui-state",children:"No hashtags followed yet."})})]})})}const Go=20;function yn({title:e,path:n,id:s,...i}){Rt(e||"Following",n||"/following");const{masto:o,streaming:r,instance:h}=H(),a=It($),c=O(),l=O();async function u(f){(f||!c.current)&&(c.current=o.v1.timelines.home.list({limit:Go}));const p=await c.current.next();let{value:g}=p;if(g!=null&&g.length){let m=!1;f&&(g[0].id!==l.current&&(m=!0),l.current=g[0].id),g.forEach(y=>{Ct(y,h)}),g=Fn(g,h),f&&m&&Ro(),Eo(g,h),g.sort((y,v)=>{const b=new Date(y.createdAt);return new Date(v.createdAt)-b})}return{...p,value:g}}async function d(){try{const f=await o.v1.timelines.home.list({limit:5,since_id:l.current}).next();let{value:p}=f;return!!(p!=null&&p.length&&(l.current=p[0].id,p=Fn(p,h),p=we(p,"home"),p.some(g=>!g.reblog)))}catch{return!1}}return V(()=>{let f;return(async()=>{if(r){f=r.user.subscribe();for await(const p of f){if(!f)break;if(p.event==="status.update"){const g=p.payload;Ct(g,h)}else if(p.event==="delete"){const g=p.payload,m=ds(g,h);m&&(m._deleted=!0)}}}})(),()=>{var p;(p=f==null?void 0:f.unsubscribe)==null||p.call(f),f=null}},[r]),t(Qt,{title:e||"Following",id:s||"following",emptyText:"Nothing to see here.",errorText:"Unable to load posts.",instance:h,fetchItems:u,checkForUpdates:d,useItemID:!0,boostsCarousel:a.settings.boostsCarousel,...i,filterContext:"home",showFollowedTags:!0,showReplyParent:!0})}const Ko=20,Zo=4,Hn=Zo+1;function Ms({media:e,columnMode:n,...s}){let{hashtag:i,...o}=n?{}:ce();s.hashtag&&(i=s.hashtag);let r=i.trim().split(/[\s+]+/);r.sort(),i=r[0];const[h,a]=Gt(),c=e||!!h.get("media"),l=c?"?media=1":"",{masto:u,instance:d,authenticated:f}=H({instance:(s==null?void 0:s.instance)||o.instance}),{masto:p,instance:g,authenticated:m}=H(),y=r.map(L=>`#${L}`).join(" "),v=c?" (Media only)":"",b=d?`${y}${v} on ${d}`:`${y}${v}`;Rt(b,"/:instance?/t/:hashtag");const S=O(),w=O(void 0);async function T(L){const N=await u.v1.timelines.tag.$select(i).list({limit:Ko,any:r.slice(1),maxId:L?void 0:w.current,onlyMedia:c}).next();let{value:E}=N;return E!=null&&E.length&&(L&&(S.current=E[0].id),E.forEach(K=>{Ct(K,d,{skipThreading:c})}),w.current=E[E.length-1].id),{...N,value:E}}async function k(){try{const L=await u.v1.timelines.tag.$select(i).list({limit:1,any:r.slice(1),since_id:S.current,onlyMedia:c}).next();let{value:N}=L;return N=we(N,"public"),!!(N!=null&&N.length)}catch{return!1}}const[C,F]=A("default"),[x,P]=A();V(()=>{(async()=>{try{const L=await u.v1.tags.$select(i).fetch();P(L)}catch{}})()},[i]);const B=r.length>=Hn;return t(Qt,{title:b,titleComponent:!!d&&t("h1",{class:"header-double-lines",children:[t("b",{children:y}),t("div",{children:d})]}),id:"hashtag",instance:d,emptyText:"No one has posted anything with this tag yet.",errorText:"Unable to load posts with this tag",fetchItems:T,checkForUpdates:k,useItemID:!0,view:c?"media":void 0,refresh:c,filterContext:"public",headerEnd:t(Jt,{portal:!0,setDownOverflow:!0,overflow:"auto",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(I,{icon:"more",size:"l"})}),children:[!!x&&r.length===1&&t(M,{children:[t(oe,{subMenu:!0,confirm:x.following,confirmLabel:`Unfollow #${i}?`,disabled:C==="loading"||!f,onClick:()=>{F("loading"),x.following?u.v1.tags.$select(i).unfollow().then(()=>{P({...x,following:!1}),ut(`Unfollowed #${i}`)}).catch(L=>{alert(L)}).finally(()=>{F("default")}):u.v1.tags.$select(i).follow().then(()=>{P({...x,following:!0}),ut(`Followed #${i}`)}).catch(L=>{alert(L)}).finally(()=>{F("default")})},children:x.following?t(M,{children:[t(I,{icon:"check-circle"})," ",t("span",{children:"Following…"})]}):t(M,{children:[t(I,{icon:"plus"})," ",t("span",{children:"Follow"})]})}),t(_t,{})]}),t(us,{className:"plain",children:"Filters"}),t(at,{type:"checkbox",checked:!!c,onClick:()=>{c?h.delete("media"):h.set("media","1"),a(h)},children:[t(I,{icon:"check-circle"})," ",t("span",{class:"menu-grow",children:"Media only"})]}),t(_t,{}),t(oi,{className:"menu-field",disabled:B,children:({ref:L})=>t("form",{onSubmit:N=>{var K,q;N.preventDefault();const E=(q=(K=N.target[0].value)==null?void 0:K.trim)==null?void 0:q.call(K);E&&!r.some(tt=>tt.toLowerCase()===E.toLowerCase())&&(r.push(E),r.sort(),location.hash=d?`/${d}/t/${r.join("+")}`:`/t/${r.join("+")}${l}`)},children:[t(I,{icon:"hashtag"}),t("input",{ref:L,type:"text",placeholder:B?`Max ${Hn} tags`:"Add hashtag",required:!0,autocorrect:"off",autocapitalize:"off",spellCheck:!1,pattern:"[^#][^\\s#]+[^#]",disabled:B})]})}),t(ri,{takeOverflow:!0,children:r.map((L,N)=>t(at,{disabled:r.length===1,onClick:E=>{r.splice(N,1),r.sort(),location.hash=d?`/${d}/t/${r.join("+")}${l}`:`/t/${r.join("+")}${l}`},children:[t(I,{icon:"x",alt:"Remove hashtag",class:"danger-icon"}),t("span",{children:[t("span",{class:"more-insignificant",children:"#"}),L]})]},L))}),t(_t,{}),t(at,{disabled:!m,onClick:()=>{if($.shortcuts.length>=Zt){alert(`Max ${Zt} shortcuts reached. Unable to add shortcut.`);return}const L={type:"hashtag",hashtag:r.join(" "),instance:d,media:c?"on":void 0};$.shortcuts.some(E=>E.type===L.type&&E.hashtag.split(/[\s+]+/).sort().join(" ")===L.hashtag.split(/[\s+]+/).sort().join(" ")&&(E.instance?E.instance===L.instance:!0)&&(E.media?!!E.media==!!L.media:!0))?alert("This shortcut already exists"):($.shortcuts.push(L),ut("Hashtag shortcut added"))},children:[t(I,{icon:"shortcut"})," ",t("span",{children:"Add to Shorcuts"})]}),t(at,{onClick:()=>{let L=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(L)){L&&alert("Invalid instance");return}L&&(L=L.toLowerCase().trim(),location.hash=`/${L}/t/${r.join("+")}${l}`)},children:[t(I,{icon:"bus"})," ",t("span",{children:"Go to another instance…"})]}),g!==d&&t(at,{onClick:()=>{location.hash=`/${g}/t/${r.join("+")}${l}`},children:[t(I,{icon:"bus"})," ",t("small",{class:"menu-double-lines",children:["Go to my instance (",t("b",{children:g}),")"]})]})]})},d+y)}const Xo=20;function Es(e){var m;const n=It($),{masto:s,instance:i}=H(),o=(e==null?void 0:e.id)||((m=ce())==null?void 0:m.id),r=O(),h=O();async function a(y){(y||!h.current)&&(h.current=s.v1.timelines.list.$select(o).list({limit:Xo}));const v=await h.current.next();let{value:b}=v;return b!=null&&b.length&&(y&&(r.current=b[0].id),b.forEach(S=>{Ct(S,i)})),{...v,value:b}}async function c(){try{const y=await s.v1.timelines.list.$select(o).list({limit:1,since_id:r.current});let{value:v}=y;return v=we(v,"home"),!!(v!=null&&v.length)}catch{return!1}}const[l,u]=A({title:"List"});Rt(l.title,"/l/:id"),V(()=>{(async()=>{try{const y=await s.v1.lists.$select(o).fetch();u(y)}catch{}})()},[o]);const[d,f]=A(!1),[p,g]=A(!1);return t(M,{children:[t(Qt,{title:l.title,id:"list",emptyText:"Nothing yet.",errorText:"Unable to load posts.",instance:i,fetchItems:a,checkForUpdates:c,useItemID:!0,boostsCarousel:n.settings.boostsCarousel,filterContext:"home",showReplyParent:!0,headerStart:t(et,{to:"/l",class:"button plain",children:t(I,{icon:"list",size:"l"})}),headerEnd:t(Jt,{portal:!0,setDownOverflow:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(I,{icon:"more",size:"l"})}),children:[t(at,{onClick:()=>f({list:l}),children:[t(I,{icon:"pencil",size:"l"}),t("span",{children:"Edit"})]}),t(at,{onClick:()=>g(!0),children:[t(I,{icon:"group",size:"l"}),t("span",{children:"Manage members"})]})]})},o),d&&t(Ht,{onClick:y=>{y.target===y.currentTarget&&f(!1)},children:t(vn,{list:d==null?void 0:d.list,onClose:y=>{y.state==="success"&&y.list?u(y.list):y.state==="deleted"&&(location.hash="/l"),f(!1)}})}),p&&t(Ht,{onClick:y=>{y.target===y.currentTarget&&g(!1)},children:t(Qo,{listID:o,onClose:()=>g(!1)})})]})}const Jo=40;function Qo({listID:e,onClose:n}){const{masto:s,instance:i}=H(),[o,r]=A([]),[h,a]=A("default"),[c,l]=A(!1),u=O();async function d(f){l(!1),a("loading"),(async()=>{try{(f||!u.current)&&(u.current=s.v1.lists.$select(e).accounts.list({limit:Jo}));const p=await u.current.next();let{done:g,value:m}=p;m!=null&&m.length?(r(f?m:o.concat(m)),l(!g)):l(!1),a("default")}catch{a("error")}})()}return V(()=>{d(!0)},[]),t("div",{class:"sheet",id:"list-manage-members-container",children:[!!n&&t("button",{type:"button",class:"sheet-close",onClick:n,children:t(I,{icon:"x"})}),t("header",{children:t("h2",{children:"Manage members"})}),t("main",{children:t("ul",{children:[o.map(f=>t("li",{children:[t(te,{account:f,instance:i}),t(tr,{account:f,listID:e})]},f.id)),c&&h==="default"&&t(ne,{as:"li",onChange:f=>f&&d(),children:t("button",{type:"button",class:"light block",onClick:d,children:"Show more…"})})]})})]})}function tr({account:e,listID:n}){const{masto:s}=H(),[i,o]=A("default"),[r,h]=A(!1);return t(oe,{confirm:!r,confirmLabel:t("span",{children:["Remove @",e.username," from list?"]}),align:"end",menuItemClassName:"danger",onClick:()=>{r?(o("loading"),(async()=>{try{await s.v1.lists.$select(n).accounts.create({accountIds:[e.id]}),o("default"),h(!1)}catch{o("error")}})()):(o("loading"),(async()=>{try{await s.v1.lists.$select(n).accounts.remove({accountIds:[e.id]}),o("default"),h(!0)}catch{o("error")}})())},children:t("button",{type:"button",class:`light ${r?"":"danger"}`,disabled:i==="loading",children:r?"Add":"Remove…"})})}const Vn=20,er=new URLSearchParams;function Rs({columnMode:e,...n}){const{masto:s,instance:i}=H(),[o]=e?[er]:Gt(),[r,h]=A(null),a=(n==null?void 0:n.type)||o.get("type")||r;Rt(`Mentions${a==="private"?" (Private)":""}`,"/mentions");const c=O(),l=O();async function u(v){(v||!c.current)&&(c.current=s.v1.notifications.list({limit:Vn,types:["mention"]}));const b=await c.current.next();let{value:S}=b;return S!=null&&S.length&&(v&&(l.current=S[0].id),S.forEach(({status:w})=>{Ct(w,i)})),{...b,value:S==null?void 0:S.map(w=>w.status)}}const d=O(),f=O();async function p(v){(v||!d.current)&&(d.current=s.v1.conversations.list({limit:Vn}));const b=await d.current.next();let{value:S}=b;return S=S==null?void 0:S.filter(w=>w.lastStatus),S!=null&&S.length&&(v&&(f.current=S[0].lastStatus.id),S.forEach(({lastStatus:w})=>{Ct(w,i)})),{...b,value:S==null?void 0:S.map(w=>w.lastStatus)}}function g(...v){return a==="private"?p(...v):u(...v)}async function m(){if(a==="private")try{const v=await s.v1.conversations.list({limit:1,since_id:f.current}).next();let{value:b}=v;return b!=null&&b.length?(f.current=b[0].lastStatus.id,!0):!1}catch{return!1}else try{const v=await s.v1.notifications.list({limit:1,types:["mention"],since_id:l.current}).next();let{value:b}=v;return b!=null&&b.length?(l.current=b[0].id,!0):!1}catch{return!1}}const y=gt(()=>t("div",{class:"filter-bar centered",children:[t(et,{to:"/mentions",class:a?"":"is-active",onClick:v=>{e&&(v.preventDefault(),h(null))},children:"All"}),t(et,{to:"/mentions?type=private",class:a==="private"?"is-active":"",onClick:v=>{e&&(v.preventDefault(),h("private"))},children:"Private"})]}),[a]);return t(Qt,{title:"Mentions",id:"mentions",emptyText:"No one mentioned you :(",errorText:"Unable to load mentions.",instance:i,fetchItems:g,checkForUpdates:m,useItemID:!0,timelineStart:y,refresh:a})}const nr={mention:["account","status"],status:["account","status"],reblog:["account","status"],follow:["account"],follow_request:["account"],favourite:["account","status"],poll:["status"],update:["status"]};function sr(e){return e.filter(n=>{const{type:s,id:i,createdAt:o}=n;if(!s)return!1;const r=nr[s];return r!=null&&r.length?r.every(h=>!!n[h]):!0})}function Ls(e){e=sr(e);const n={},s=[];for(let r=0,h=0;r<e.length;r++){const a=e[r],{id:c,status:l,account:u,type:d,createdAt:f}=a,p=f?new Date(f).toLocaleDateString():"";let g=d;(d==="favourite"||d==="reblog")&&(g="favourite+reblog");const m=`${l==null?void 0:l.id}-${g}-${p}`,y=n[m];if(g==="follow_request")s[h++]=a;else if(y!=null&&y.account){const v=y._accounts.find(b=>b.id===u.id);v?(v._types.push(d),v._types.sort().reverse(),y.id+=`-${c}`):(u._types=[d],y._accounts.push(u),y.id+=`-${c}`)}else{u._types=[d];let v=n[m]={...a,type:g,_accounts:[u]};s[h++]=v}}const i={},o=[];for(let r=0,h=0;r<s.length;r++){const a=s[r],{id:c,account:l,_accounts:u,type:d,createdAt:f}=a,p=f?new Date(f).toLocaleDateString():"";if(d==="favourite+reblog"&&l&&u.length===1){const g=`${l==null?void 0:l.id}-${d}-${p}`,m=i[g];if(m)m._statuses.push(a.status),m.id+=`-${c}`;else{let y=i[g]={...a,type:d,_statuses:[a.status]};o[h++]=y}}else o[h++]=a}return o}function jn(e){const{masto:n}=H();return n.v1.push.subscription.create(e)}function ir(){const{masto:e}=H();return e.v1.push.subscription.fetch()}function or(e){const{masto:n}=H();return n.v1.push.subscription.update(e)}function rr(){const{masto:e}=H();return e.v1.push.subscription.remove()}function Sn(){return"serviceWorker"in navigator&&"PushManager"in window}function cr(){return navigator.serviceWorker.getRegistration()}async function kn(){const e=await cr(),n=e?await e.pushManager.getSubscription():void 0;return{registration:e,subscription:n}}function _s(e){const n="=".repeat((4-e.length%4)%4),s=`${e}${n}`.replace(/-/g,"+").replace(/_/g,"/"),i=window.atob(s),o=new Uint8Array(i.length);for(let r=0;r<i.length;++r)o[r]=i.charCodeAt(r);return o}async function bc(){if(!Sn())return;const{subscription:e}=await kn();let n=null;try{n=await ir()}catch(s){if(!/(not found|unknown)/i.test(s.message))throw s}if(n&&e){const s=n.endpoint===e.endpoint,{vapidKey:i}=pe(),o=n.serverKey===i;if(!s)throw new Error("Backend subscription endpoint changed");if(!o)throw new Error("Backend subscription key and vapid key changed")}if(e&&!n){const{vapidKey:s}=pe(),{applicationServerKey:i}=e.options,o=_s(s).toString(),r=new Uint8Array(i).toString();if(!(o===r))throw await e.unsubscribe(),new Error("Subscription key and vapid key changed")}return{subscription:e,backendSubscription:n}}async function vc({data:e,policy:n}){if(!Sn())return;let{registration:s,subscription:i}=await kn(),o=null;if(i)try{o=await or({data:e,policy:n})}catch{o=await jn({subscription:i,data:e,policy:n})}else{const{vapidKey:r}=pe();if(!r)throw new Error("No server key found");i=await s.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:_s(r)}),o=await jn({subscription:i,data:e,policy:n})}return{subscription:i,backendSubscription:o}}async function wc(){if(!Sn())return;const{subscription:e}=await kn();e&&(await rr(),await e.unsubscribe())}const ar=30,lr=new URLSearchParams,Le={block:"center",inline:"center",behavior:"smooth"};function dr({columnMode:e}){Rt("Notifications","/notifications");const{masto:n,instance:s}=H(),i=It($),[o,r]=A("default"),[h]=e?[lr]:Gt(),a=h.get("id"),c=h.get("access_token"),[l,u]=A(!1),[d,f]=A(!1),p=O(),{nearReachEnd:g,scrollDirection:m,reachStart:y,nearReachStart:v}=Lo({scrollableRef:p}),b=m==="end"&&!v,[S,w]=A([]),[T,k]=A([]),C=O();async function F(_){(_||!C.current)&&(C.current=n.v1.notifications.list({limit:ar,excludeTypes:["follow_request"]}));const G=await C.current.next(),nt=G.value;if(nt!=null&&nt.length){nt.forEach(z=>{Ct(z.status,s,{skipThreading:!0})});const X=Ls(nt);_?($.notificationsLast=nt[0],$.notifications=X,n.v1.markers.create({notifications:{lastReadId:nt[0].id}}).catch(()=>{})):$.notifications.push(...X)}return $.notificationsShowNew=!1,$.notificationsLastFetchTime=Date.now(),G}async function x(){try{return await n.v1.followRequests.list({limit:80})}catch{return[]}}const P=()=>{r("loading"),(async()=>{try{const _=await x();w(_),r("default")}catch{r("error")}})()};async function B(){try{return await n.v1.announcements.list()}catch{return[]}}const L=_=>{E(!1),r("loading"),(async()=>{try{const G=F(_);_&&(B().then(X=>{X.sort((z,W)=>{const U=new Date(z.updatedAt||z.createdAt);return new Date(W.updatedAt||W.createdAt)-U}),k(X)}).catch(()=>{}),x().then(X=>{w(X)}).catch(()=>{}));const{done:nt}=await G;u(!nt),r("default")}catch{r("error")}})()};V(()=>{L(!0)},[]),V(()=>{y&&L(!0)},[y]);const[N,E]=A(!1),K=Wt(({disableIdleCheck:_=!1}={})=>{var G;o!=="loading"&&i.settings.autoRefresh&&((G=p.current)==null?void 0:G.scrollTop)<16&&(_||window.__IDLE__)&&!ur()&&L(!0)},[i.notificationsShowNew,i.settings.autoRefresh,o]),q=O();me(_=>{let G;if(_){const nt=Date.now()-q.current;!q.current||nt>1e3*3?K({disableIdleCheck:!0}):q.current=Date.now(),G=ci($,"notificationsShowNew",X=>{o!=="loading"&&(X&&K(),E(X))})}return()=>{G==null||G()}});const tt=new Date,Q=new Date(tt-24*60*60*1e3);let vt=new Date;const Z=!i.notifications.some(_=>new Date(_.createdAt).toDateString()===tt.toDateString()),lt=O();V(()=>{a&&($.routeNotification={id:a,accessToken:atob(c)})},[a,c]);const ot=".notification",ft=St("j",()=>{const _=document.activeElement.closest(ot),G=_==null?void 0:_.getBoundingClientRect(),nt=Array.from(p.current.querySelectorAll(ot));if(_&&G.top<p.current.clientHeight&&G.bottom>0){const X=nt.indexOf(_);let z=nt[X+1];z&&(z.focus(),z.scrollIntoView(Le))}else{const X=nt.find(z=>{const W=z.getBoundingClientRect();return W.top>=44&&W.left>=0});X&&(X.focus(),X.scrollIntoView(Le))}}),mt=St("k",()=>{const _=document.activeElement.closest(ot),G=_==null?void 0:_.getBoundingClientRect(),nt=Array.from(p.current.querySelectorAll(ot));if(_&&G.top<p.current.clientHeight&&G.bottom>0){const X=nt.indexOf(_);let z=nt[X-1];z&&(z.focus(),z.scrollIntoView(Le))}else{const X=nt.find(z=>{const W=z.getBoundingClientRect();return W.top>=44&&W.left>=0});X&&(X.focus(),X.scrollIntoView(Le))}}),$t=St(["enter","o"],()=>{const _=document.activeElement.closest(ot),G=_==null?void 0:_.querySelector(".status-link");G&&G.click()});return t("div",{id:"notifications-page",class:"deck-container",ref:_=>{p.current=_,ft.current=_,mt.current=_,$t.current=_},tabIndex:"-1",children:t("div",{class:`timeline-deck deck ${d?"only-mentions":""}`,children:[t("header",{hidden:b,onClick:_=>{var G;_.target.closest("a, button")||(G=p.current)==null||G.scrollTo({top:0,behavior:"smooth"})},onDblClick:_=>{_.target.closest("a, button")||L(!0)},class:o==="loading"?"loading":"",children:[t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:[t(xe,{}),t(et,{to:"/",class:"button plain",children:t(I,{icon:"home",size:"l",alt:"Home"})})]}),t("h1",{children:"Notifications"}),t("div",{class:"header-side"})]}),N&&o!=="loading"&&t("button",{class:"updates-button shiny-pill",type:"button",onClick:()=>{var _;L(!0),(_=p.current)==null||_.scrollTo({top:0,behavior:"smooth"})},children:[t(I,{icon:"arrow-up"})," New notifications"]})]}),T.length>0&&t("div",{class:"shazam-container",children:t("div",{class:"shazam-container-inner",children:t("details",{class:"announcements",children:[t("summary",{children:[t("span",{children:[t(I,{icon:"announce",class:"announcement-icon",size:"l"})," ",t("b",{children:["Announcement",T.length>1?"s":""]})," ",t("small",{class:"insignificant",children:s})]}),T.length>1&&t("span",{class:"announcements-nav-buttons",children:T.map((_,G)=>t("button",{type:"button",class:"plain2 small",onClick:()=>{var nt;(nt=lt.current)==null||nt.children[G].scrollIntoView({behavior:"smooth",block:"nearest"})},children:G+1}))})]}),t("ul",{class:`announcements-list-${T.length>1?"multiple":"single"}`,ref:lt,children:T.map(_=>t("li",{children:t(hr,{announcement:_})}))})]})})}),S.length>0&&t("div",{class:"follow-requests",children:[t("h2",{class:"timeline-header",children:"Follow requests"}),S.length>5?t("details",{children:[t("summary",{children:[S.length," follow requests"]}),t("ul",{children:S.map(_=>t("li",{children:[t(te,{account:_}),t(en,{accountID:_.id,onChange:()=>{}})]},_.id))})]}):t("ul",{children:S.map(_=>t("li",{children:[t(te,{account:_}),t(en,{accountID:_.id,onChange:()=>{}})]},_.id))})]}),t("div",{id:"mentions-option",children:t("label",{children:[t("input",{type:"checkbox",checked:d,onChange:_=>{f(_.target.checked)}})," ","Only mentions"]})}),t("h2",{class:"timeline-header",children:"Today"}),Z&&!!i.notifications.length&&t("p",{class:"ui-state insignificant",children:o==="default"?"You're all caught up.":t(M,{children:"…"})}),i.notifications.length?t(M,{children:i.notifications.filter(_=>_.type!=="follow_request").map(_=>{if(d&&_.type!=="mention")return null;const G=new Date(_.createdAt),nt=G.toDateString()!==vt.toDateString();nt&&(vt=G);const X=G.toDateString()===Q.toDateString()?"Yesterday":ie(vt,{hideTime:!0});return t(M,{children:[nt&&t("h2",{class:"timeline-header",children:X}),t(hn,{instance:s,notification:_},_.id)]},_.id)})}):t(M,{children:[o==="loading"&&t(M,{children:t("ul",{class:"timeline flat",children:Array.from({length:5}).map((_,G)=>t("li",{class:"notification skeleton",children:[t("div",{class:"notification-type",children:t(I,{icon:"notification",size:"xl"})}),t("div",{class:"notification-content",children:t("p",{children:"███████████ ████"})})]}))})}),o==="error"&&t("p",{class:"ui-state",children:["Unable to load notifications",t("br",{}),t("br",{}),t("button",{type:"button",onClick:()=>L(!0),children:"Try again"})]})]}),l&&t(ne,{onChange:_=>{_&&L()},children:t("button",{type:"button",class:"plain block",disabled:o==="loading",onClick:()=>L(),style:{marginBlockEnd:"6em"},children:o==="loading"?t(At,{abrupt:!0}):t(M,{children:"Show more…"})})})]})})}function ur(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}function hr({announcement:e}){const{instance:n}=H(),{contact:s}=ai(),i=s==null?void 0:s.account,{id:o,content:r,startsAt:h,endsAt:a,published:c,allDay:l,publishedAt:u,updatedAt:d,read:f,mentions:p,statuses:g,tags:m,emojis:y,reactions:v}=e,b=new Date(u),S=ie(b),w=new Date(d),T=ie(w);return t("div",{class:"announcement-block",children:[t(te,{account:i}),t("div",{class:"announcement-content",onClick:ns({mentions:p,instance:n}),dangerouslySetInnerHTML:{__html:Qe(r,{emojis:y})}}),t("p",{class:"insignificant",children:[t("time",{datetime:b.toISOString(),children:ie(b)}),d&&T!==S&&t(M,{children:[" ","•"," ",t("span",{class:"ib",children:["Updated"," ",t("time",{datetime:w.toISOString(),children:ie(w)})]})]})]}),t("div",{class:"announcement-reactions",hidden:!0,children:v.map(k=>{const{name:C,count:F,me:x,staticUrl:P,url:B}=k;return t("button",{type:"button",class:`plain4 small ${x?"reacted":""}`,children:[B||P?t("img",{src:B||P,alt:C,width:"16",height:"16"}):t("span",{children:C})," ",t("span",{class:"count",children:Ft(F)})]})})})]})}const Ns=zt(dr),fr=20;function cn({local:e,columnMode:n,...s}){const i=It($),o=!!e,r=n?{}:ce(),{masto:h,instance:a}=H({instance:(s==null?void 0:s.instance)||r.instance}),{masto:c,instance:l}=H(),u=`${o?"Local":"Federated"} timeline (${a})`;Rt(u,o?"/:instance?/p/l":"/:instance?/p");const d=O(),f=O();async function p(m){(m||!f.current)&&(f.current=h.v1.timelines.public.list({limit:fr,local:o}));const y=await f.current.next();let{value:v}=y;return v!=null&&v.length&&(m&&(d.current=v[0].id),v.forEach(b=>{Ct(b,a)})),{...y,value:v}}async function g(){try{const m=await h.v1.timelines.public.list({limit:1,local:o,since_id:d.current}).next();let{value:y}=m;return y=we(y,"public"),!!(y!=null&&y.length)}catch{return!1}}return t(Qt,{title:u,titleComponent:t("h1",{class:"header-double-lines",children:[t("b",{children:o?"Local timeline":"Federated timeline"}),t("div",{children:a})]}),id:"public",instance:a,emptyText:"No one has posted anything yet.",errorText:"Unable to load posts",fetchItems:p,checkForUpdates:g,useItemID:!0,headerStart:t(M,{}),boostsCarousel:i.settings.boostsCarousel,filterContext:"public",headerEnd:t(Jt,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(I,{icon:"more",size:"l"})}),children:[t(at,{href:o?`/#/${a}/p`:`/#/${a}/p/l`,children:o?t(M,{children:[t(I,{icon:"transfer"})," ",t("span",{children:"Switch to Federated"})]}):t(M,{children:[t(I,{icon:"transfer"})," ",t("span",{children:"Switch to Local"})]})}),t(_t,{}),t(at,{onClick:()=>{let m=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(m)){m&&alert("Invalid instance");return}m&&(m=m.toLowerCase().trim(),location.hash=o?`/${m}/p/l`:`/${m}/p`)},children:[t(I,{icon:"bus"})," ",t("span",{children:"Go to another instance…"})]}),l!==a&&t(at,{onClick:()=>{location.hash=o?`/${l}/p/l`:`/${l}/p`},children:[t(I,{icon:"bus"})," ",t("small",{class:"menu-double-lines",children:["Go to my instance (",t("b",{children:l}),")"]})]})]})},a+o)}const _e=5,Ge=40,pr=new URLSearchParams;function Ds({columnMode:e,...n}){const s=e?{}:ce(),{masto:i,instance:o,authenticated:r}=H({instance:s.instance}),[h,a]=A("default"),[c]=e?[pr]:Gt(),l=O(),u=(n==null?void 0:n.query)||c.get("q"),d=e?"statuses":(n==null?void 0:n.type)||c.get("type");Rt(u?`Search: ${u}${d?` (${{statuses:"Posts",accounts:"Accounts",hashtags:"Hashtags"}[d]})`:""}`:"Search","/search");const[f,p]=A(!1),g=O(0);V(()=>{g.current=0},[u,d]);const m=O();Xt(()=>{var N,E;(E=(N=m.current)==null?void 0:N.scrollTo)==null||E.call(N,0,0)},[u,d]);const[y,v]=A([]),[b,S]=A([]),[w,T]=A([]);V(()=>{v([]),S([]),T([])},[u]);const k={statuses:v,accounts:S,hashtags:T},[C,F]=A({}),x=async N=>{if(!(N!=null&&N.length))return;const E=await $s(N,C);E&&F({...C,...E})};function P(N){N&&(g.current=0),!(!N&&!r)&&(a("loading"),N&&!d&&(v(y.slice(0,_e)),S(b.slice(0,_e)),T(w.slice(0,_e))),(async()=>{var K,q;const E={q:u,resolve:r,limit:_e};d&&(E.limit=Ge,E.type=d,r&&(E.offset=g.current));try{const tt=await i.v2.search.fetch(E);if(d)if(N){k[d](tt[d]);const Q=(K=tt[d])==null?void 0:K.length;g.current=Ge,p(!!Q)}else{k[d](vt=>[...vt,...tt[d]]);const Q=(q=tt[d])==null?void 0:q.length;g.current=g.current+Ge,p(!!Q)}else v(tt.statuses||[]),S(tt.accounts||[]),T(tt.hashtags||[]),g.current=0,p(!1);x(tt.accounts),a("default")}catch{a("error")}})())}const B=O();me(N=>{var K;const E=((K=m.current)==null?void 0:K.scrollTop)===0;if(N&&E){const q=Date.now()-B.current;!B.current||q>1e3*3?P(!0):B.current=Date.now()}}),V(()=>{var N,E,K,q;(E=(N=l.current)==null?void 0:N.setValue)==null||E.call(N,u||""),u?P(!0):(q=(K=l.current)==null?void 0:K.focus)==null||q.call(K)},[u,d,o]),St(["/","Slash"],N=>{var E,K;(K=(E=l.current)==null?void 0:E.focus)==null||K.call(E)},{preventDefault:!0});const[L]=Is();return t("div",{id:"search-page",class:"deck-container",ref:m,children:t("div",{class:"timeline-deck deck",children:[t("header",{class:h==="loading"?"loading":"",children:t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:t(xe,{})}),t(bs,{ref:l}),t("div",{class:"header-side",children:t("button",{type:"button",class:"plain",onClick:()=>{P(!0)},disabled:h==="loading",children:t(I,{icon:"search",size:"l"})})})]})}),t("main",{children:[!!u&&!e&&t("div",{ref:L,class:`filter-bar ${h==="loading"?"loading":""}`,children:[!!d&&t(et,{to:`/search${u?`?q=${encodeURIComponent(u)}`:""}`,children:"‹ All"}),[{label:"Accounts",type:"accounts",to:`/search?q=${encodeURIComponent(u)}&type=accounts`},{label:"Hashtags",type:"hashtags",to:`/search?q=${encodeURIComponent(u)}&type=hashtags`},{label:"Posts",type:"statuses",to:`/search?q=${encodeURIComponent(u)}&type=statuses`}].sort((N,E)=>N.type===d?-1:E.type===d?1:0).map(N=>t(et,{to:N.to,children:N.label},N.type))]}),u?t(M,{children:[(!d||d==="accounts")&&t(M,{children:[d!=="accounts"&&t("h2",{class:"timeline-header",children:["Accounts"," ",t(et,{to:`/search?q=${encodeURIComponent(u)}&type=accounts`,children:t(I,{icon:"arrow-right",size:"l"})})]}),b.length>0?t(M,{children:[t("ul",{class:"timeline flat accounts-list",children:b.map(N=>t("li",{children:t(te,{account:N,instance:o,showStats:!0,relationship:C[N.id]})},N.id))}),d!=="accounts"&&t("div",{class:"ui-state",children:t(et,{class:"plain button",to:`/search?q=${encodeURIComponent(u)}&type=accounts`,children:["See more accounts ",t(I,{icon:"arrow-right"})]})})]}):!d&&(h==="loading"?t("p",{class:"ui-state",children:t(At,{abrupt:!0})}):t("p",{class:"ui-state",children:"No accounts found."}))]}),(!d||d==="hashtags")&&t(M,{children:[d!=="hashtags"&&t("h2",{class:"timeline-header",children:["Hashtags"," ",t(et,{to:`/search?q=${encodeURIComponent(u)}&type=hashtags`,children:t(I,{icon:"arrow-right",size:"l"})})]}),w.length>0?t(M,{children:[t("ul",{class:"link-list hashtag-list",children:w.map(N=>{var tt;const{name:E,history:K}=N,q=(tt=K==null?void 0:K.reduce)==null?void 0:tt.call(K,(Q,vt)=>Q+ +vt.uses,0);return t("li",{children:t(et,{to:o?`/${o}/t/${E}`:`/t/${E}`,children:[t(I,{icon:"hashtag"}),t("span",{children:E}),!!q&&t("span",{class:"count",children:Ft(q)})]})},`${E}-${q}`)})}),d!=="hashtags"&&t("div",{class:"ui-state",children:t(et,{class:"plain button",to:`/search?q=${encodeURIComponent(u)}&type=hashtags`,children:["See more hashtags ",t(I,{icon:"arrow-right"})]})})]}):!d&&(h==="loading"?t("p",{class:"ui-state",children:t(At,{abrupt:!0})}):t("p",{class:"ui-state",children:"No hashtags found."}))]}),(!d||d==="statuses")&&t(M,{children:[d!=="statuses"&&t("h2",{class:"timeline-header",children:["Posts"," ",t(et,{to:`/search?q=${encodeURIComponent(u)}&type=statuses`,children:t(I,{icon:"arrow-right",size:"l"})})]}),y.length>0?t(M,{children:[t("ul",{class:"timeline",children:y.map(N=>t("li",{children:t(et,{class:"status-link",to:o?`/${o}/s/${N.id}`:`/s/${N.id}`,children:t(xt,{status:N})})},N.id))}),d!=="statuses"&&t("div",{class:"ui-state",children:t(et,{class:"plain button",to:`/search?q=${encodeURIComponent(u)}&type=statuses`,children:["See more posts ",t(I,{icon:"arrow-right"})]})})]}):!d&&(h==="loading"?t("p",{class:"ui-state",children:t(At,{abrupt:!0})}):t("p",{class:"ui-state",children:"No posts found."}))]}),!!d&&(h==="default"?f?t(ne,{onChange:N=>{N&&P()},children:t("button",{type:"button",class:"plain block",onClick:()=>P(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):t("p",{class:"ui-state insignificant",children:"The end."}):h==="loading"&&t("p",{class:"ui-state",children:t(At,{abrupt:!0})}))]}):h==="loading"?t("p",{class:"ui-state",children:t(At,{abrupt:!0})}):t("p",{class:"ui-state",children:"Enter your search term or paste a URL above to get started."})]})]})})}function Ke(e,n,s){return Math.max(Math.min(e,s),n)}const Ze=e=>e>=.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,Xe=e=>e>=.0031308?1.055*Math.pow(e,1/2.4)-.055:12.92*e;function Ps([e,n,s]){e=Ze(e/255),n=Ze(n/255),s=Ze(s/255);var i=.4122214708*e+.5363325363*n+.0514459929*s,o=.2119034982*e+.6806995451*n+.1073969566*s,r=.0883024619*e+.2817188376*n+.6299787005*s;return i=Math.cbrt(i),o=Math.cbrt(o),r=Math.cbrt(r),[i*.2104542553+o*.793617785+r*-.0040720468,i*1.9779984951+o*-2.428592205+r*.4505937099,i*.0259040371+o*.7827717662+r*-.808675766]}function Us([e,n,c]){var i=e+n*.3963377774+c*.2158037573,o=e+n*-.1055613458+c*-.0638541728,r=e+n*-.0894841775+c*-1.291485548;i=i**3,o=o**3,r=r**3;var h=i*4.0767416621+o*-3.3077115913+r*.2309699292,a=i*-1.2684380046+o*2.6097574011+r*-.3413193965,c=i*-.0041960863+o*-.7034186147+r*1.707614701;return h=255*Xe(h),a=255*Xe(a),c=255*Xe(c),h=Ke(h,0,255),a=Ke(a,0,255),c=Ke(c,0,255),h=Math.round(h),a=Math.round(a),c=Math.round(c),[h,a,c]}const mr=20,gr=se(e=>e.v1.trends.links.list().next(),{maxAge:10*60*1e3});function Os({columnMode:e,...n}){const s=It($),i=e?{}:ce(),{masto:o,instance:r}=H({instance:(n==null?void 0:n.instance)||i.instance}),{masto:h,instance:a}=H(),c=`Trending (${r})`;Rt(c,"/:instance?/trending");const l=O(),[u,d]=A([]),[f,p]=A([]),g=O();async function m(b){var T;if(b||!g.current){g.current=o.v1.trends.statuses.list({limit:mr});try{const k=o.v1.trends.tags.list(),{value:C}=await k.next();C!=null&&C.length&&d(C)}catch{}try{const{value:k}=await gr(o,r),C=(T=k==null?void 0:k.filter)==null?void 0:T.call(k,F=>F.type==="link");C!=null&&C.length&&p(C)}catch{}}const S=await g.current.next();let{value:w}=S;return w!=null&&w.length&&(b&&(l.current=w[0].id),w.forEach(k=>{Ct(k,r)})),{...S,value:w}}async function y(){try{const b=await o.v1.trends.statuses.list({limit:1}).next();let{value:S}=b;return S=we(S,"public"),S!=null&&S.length&&S[0].id!==l.current?(l.current=S[0].id,!0):!1}catch{return!1}}const v=gt(()=>t(M,{children:[!!u.length&&t("div",{class:"filter-bar expandable",children:[t(I,{icon:"chart",class:"insignificant",size:"l"}),u.map((b,S)=>{const{name:w,history:T}=b,k=T.reduce((C,F)=>C+ +F.uses,0);return t(et,{to:`/${r}/t/${w}`,children:[t("span",{children:[t("span",{class:"more-insignificant",children:"#"}),w]}),t("span",{class:"filter-count",children:Ft(k)})]},w)})]}),!!f.length&&t("div",{class:"links-bar",children:[t("header",{children:t("h3",{children:"Trending News"})}),f.map(b=>{const{authorName:S,authorUrl:w,blurhash:T,description:k,height:C,image:F,imageDescription:x,language:P,providerName:B,providerUrl:L,publishedAt:N,title:E,url:K,width:q}=b,tt=new URL(K).hostname.replace(/^www\./,"").replace(/\/$/,"");let Q;if(T){const vt=hs(T),Z=Ps(vt);Q=Us([.6,Z[1],Z[2]])}return t("a",{href:K,target:"_blank",rel:"noopener noreferrer",style:Q?{"--accent-color":`rgb(${Q.join(",")})`,"--accent-alpha-color":`rgba(${Q.join(",")}, 0.4)`}:{},children:t("article",{children:[t("figure",{children:t("img",{src:F,alt:x,width:q,height:C,loading:"lazy"})}),t("div",{class:"article-body",children:[t("header",{children:[t("div",{class:"article-meta",children:[t("span",{class:"domain",children:tt})," ",!!N&&t(M,{children:"· "}),!!N&&t(M,{children:t(dn,{datetime:N,format:"micro"})})]}),!!E&&t("h1",{class:"title",lang:P,dir:"auto",children:E})]}),!!k&&t("p",{class:"description",lang:P,dir:"auto",children:k})]})]})},K)})]})]}),[u,f]);return t(Qt,{title:c,titleComponent:t("h1",{class:"header-double-lines",children:[t("b",{children:"Trending"}),t("div",{children:r})]}),id:"trending",instance:r,emptyText:"No trending posts.",errorText:"Unable to load posts",fetchItems:m,checkForUpdates:y,checkForUpdatesInterval:5*60*1e3,useItemID:!0,headerStart:t(M,{}),boostsCarousel:s.settings.boostsCarousel,filterContext:"public",timelineStart:v,headerEnd:t(Jt,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(I,{icon:"more",size:"l"})}),children:[t(at,{onClick:()=>{let b=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(b)){b&&alert("Invalid instance");return}b&&(b=b.toLowerCase().trim(),location.hash=`/${b}/trending`)},children:[t(I,{icon:"bus"})," ",t("span",{children:"Go to another instance…"})]}),a!==r&&t(at,{onClick:()=>{location.hash=`/${a}/trending`},children:[t(I,{icon:"bus"})," ",t("small",{class:"menu-double-lines",children:["Go to my instance (",t("b",{children:a}),")"]})]})]})},r)}function br(){Rt("Home","/");const e=It($),{shortcuts:n}=e,s=n.map(i=>{if(!i)return null;const{type:o,...r}=i,h={following:yn,notifications:Ns,list:Es,public:cn,bookmarks:xs,favourites:As,hashtag:Ms,mentions:Rs,trending:Os,search:Ds}[o];return!h||o==="search"&&!r.query?null:t(h,{...r,columnMode:!0},o+JSON.stringify(r))});return St(["1","2","3","4","5","6","7","8","9"],(i,o)=>{try{const r=parseInt(o.keys[0],10)-1;document.querySelectorAll("#columns > *")[r].focus()}catch{}}),t("div",{id:"columns",onContextMenu:i=>{i.target.closest(".deck > header")&&!i.target.closest("a")&&!i.target.closest("button")&&(i.preventDefault(),$.showShortcutsSettings=!0)},children:s})}function vr(){var n;const e=It($);return V(()=>{(async()=>{const s=await li.drafts.keys();if(s.length){const i=di();s.filter(r=>r.startsWith(i)).length&&($.showDrafts=!0)}})()},[]),t(M,{children:(e.settings.shortcutsViewMode==="multi-column"||!e.settings.shortcutsViewMode&&e.settings.shortcutsColumnsMode)&&((n=e.shortcuts)!=null&&n.length)?t(br,{}):t(yn,{title:"Home",path:"/",id:"home",headerStart:!1,headerEnd:t(wr,{})})})}function wr(){const e=It($),n=O(),[s,i]=A(void 0);return t(M,{children:[t(et,{ref:n,to:"/notifications",class:`button plain notifications-button ${e.notificationsShowNew?"has-badge":""} ${s||""}`,onClick:o=>{o.stopPropagation(),window.matchMedia("(min-width: calc(40em))").matches&&(o.preventDefault(),i(r=>r?void 0:"open"))},children:t(I,{icon:"notification",size:"l",alt:"Notifications"})}),t(kr,{state:s,anchorRef:n,onClose:()=>i(void 0)})]})}const yr=30,Sr=5;function kr({anchorRef:e,state:n,onClose:s}){const{masto:i,instance:o}=H(),r=It($),[h,a]=A("default"),c=i.v1.notifications.list({limit:yr});async function l(){const g=await c.next(),m=g.value;if(m!=null&&m.length){m.forEach(v=>{Ct(v.status,o,{skipThreading:!0})});const y=Ls(m);$.notificationsLast=m[0],$.notifications=y,i.v1.markers.create({notifications:{lastReadId:m[0].id}}).catch(()=>{})}return $.notificationsShowNew=!1,$.notificationsLastFetchTime=Date.now(),g}const[u,d]=A(!1);function f(){return i.v1.followRequests.list({limit:1})}function p(){a("loading"),(async()=>{try{await l();const g=await f();d(!!(g!=null&&g.length)),a("default")}catch{a("error")}})()}return V(()=>{n==="open"&&p()},[n]),t(as,{menuClassName:"notifications-menu",state:n,anchorRef:e,onClose:s,portal:{target:document.body},overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:"8 8 8 8",children:[t("header",{children:t("h2",{children:"Notifications"})}),t("main",{children:r.notifications.length?t(M,{children:r.notifications.slice(0,Sr).map(g=>t(hn,{instance:o,notification:g,disableContextMenu:!0},g.id))}):h==="loading"?t("div",{class:"ui-state",children:t(At,{abrupt:!0})}):h==="error"&&t("div",{class:"ui-state",children:[t("p",{children:"Unable to fetch notifications."}),t("p",{children:t("button",{type:"button",onClick:p,children:"Try again"})})]})}),t("footer",{children:[t(et,{to:"/mentions",class:"button plain",children:[t(I,{icon:"at"})," ",t("span",{children:"Mentions"})]}),t(et,{to:"/notifications",class:"button plain2",children:[u?t(M,{children:[t("span",{class:"tag collapsed",children:"New"})," ",t("span",{children:"Follow Requests"})]}):t("b",{children:"See all"})," ",t(I,{icon:"arrow-right"})]})]})]})}const Ir=zt(vr),Tr=[/^\/@[^@\/]+\/(?:statuses|posts)\/([^\/]+)/i,/\/notes\/([^\/]+)/i,/^\/(?:notice|objects)\/([a-z0-9-]+)/i,/\/@[^@\/]+@?[^\/]+?\/([^\/]+)/i];function Bs(e){const{hostname:n,pathname:s}=new URL(e);for(const i of Tr){const[,o]=s.match(i)||[];if(o)return{instance:n,id:o}}return{}}function Cr(e){const{instance:n,id:s}=Bs(e);return n&&s?`/${n}/s/${s}`:null}function $r(){const n=He().pathname.replace(/^\//,""),s=Bs(n),i=s!=null&&s.instance?`/${s.instance}/s/${s.id}`:null,[o,r]=A("loading");return Xt(()=>{r("loading"),(async()=>{try{const{instance:h,id:a}=s,{masto:c}=H({instance:h});if(await c.v1.statuses.$select(a).fetch()){window.location.hash=i+"?view=full";return}}catch{}{const{masto:h,instance:a}=H(),c=await h.v2.search.fetch({q:n,limit:1,resolve:!0});if(c.statuses.length){const l=c.statuses[0];window.location.hash=`/${a}/s/${l.id}?view=full`}else if(c.accounts.length){const l=c.accounts[0];window.location.hash=`/${a}/a/${l.id}`}else i?window.location.hash=i+"?view=full":r("error")}})()},[i]),t("div",{class:"ui-state",tabIndex:"-1",children:[o==="loading"?t(M,{children:[t(At,{abrupt:!0}),t("h2",{children:"Resolving…"}),t("p",{children:t("a",{href:n,target:"_blank",rel:"noopener noreferrer",children:n})})]}):t(M,{children:[t("h2",{children:"Unable to resolve URL"}),t("p",{children:t("a",{href:n,target:"_blank",rel:"noopener noreferrer",children:n})})]}),t("hr",{}),t("p",{children:t(et,{to:"/",children:"Go home"})})]})}function xr(){const{masto:e}=H();Rt("Lists","/l");const[n,s]=A("default"),[i,o]=os(l=>l+1,0),[r,h]=A([]);V(()=>{s("loading"),(async()=>{try{const l=await e.v1.lists.list();l.sort((u,d)=>u.title.localeCompare(d.title)),h(l),s("default")}catch{s("error")}})()},[i]);const[a,c]=A(!1);return t("div",{id:"lists-page",class:"deck-container",tabIndex:"-1",children:[t("div",{class:"timeline-deck deck",children:[t("header",{children:t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:[t(xe,{}),t(et,{to:"/",class:"button plain",children:t(I,{icon:"home",size:"l"})})]}),t("h1",{children:"Lists"}),t("div",{class:"header-side",children:t("button",{type:"button",class:"plain",onClick:()=>c(!0),children:t(I,{icon:"plus",size:"l",alt:"New list"})})})]})}),t("main",{children:r.length>0?t(M,{children:[t("ul",{class:"link-list",children:r.map(l=>t("li",{children:t(et,{to:`/l/${l.id}`,children:t("span",{children:[t(I,{icon:"list"})," ",t("span",{children:l.title})]})})}))}),r.length>1&&t("footer",{class:"ui-state",children:t("small",{class:"insignificant",children:[r.length," list",r.length===1?"":"s"]})})]}):n==="loading"?t("p",{class:"ui-state",children:t(At,{})}):n==="error"?t("p",{class:"ui-state",children:"Unable to load lists."}):t("p",{class:"ui-state",children:"No lists yet."})})]}),a&&t(Ht,{onClick:l=>{l.target===l.currentTarget&&c(!1)},children:t(vn,{list:a==null?void 0:a.list,onClose:l=>{l.state==="success"&&o(),c(!1)}})})]})}const Fs="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20fill-rule='evenodd'%20stroke-linejoin='round'%20stroke-miterlimit='2'%20clip-rule='evenodd'%20viewBox='0%200%2064%2064'%3e%3cpath%20fill='none'%20d='M0%200h63.994v63.994H0z'/%3e%3cpath%20fill='%23a4bff7'%20d='M37.774%2011.471c14.639%203.752%2019.034%2016.557%2015.889%2031.304-.696%203.261-2.563%206.661-6.356%208.693-3.204%201.717-8.07%202.537-15.338.55l-9.634-2.404C11.651%2046.992%208.378%2038.733%2010.027%2031.823c3.627-15.201%2015.543-23.48%2027.747-20.352Z'/%3e%3cpath%20fill='%23d8e7fe'%20d='M36.76%2015.429c12.289%203.15%2015.547%2014.114%2012.907%2026.493-.947%204.44-4.937%209.365-16.664%206.143l-9.684-2.417c-7.854-1.923-10.53-7.8-9.318-12.877%203.016-12.639%2012.611-19.943%2022.759-17.342Z'/%3e%3cpath%20fill='%236081e6'%20d='M27.471%2024.991c-1.457-.698-7.229%203.213-7.663%208.926-.182%202.39%204.55%203.237%205.071-.169.725-4.743%203.715-8.218%202.592-8.757Zm10.746%202.005c-2.083.327-.382%205.901-.595%2010.727-.123%202.8%204.388%203.464%204.703%202.011%201.098-5.073-2.066-13.058-4.108-12.738Z'/%3e%3c/svg%3e",Ar=""+new URL("instances-HYmncdJc.json",import.meta.url).href;var Mr={PHANPY_CLIENT_NAME:"IMSB",PHANPY_WEBSITE:"https://app.imsb.app",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",VITE_APP_ENV:"production",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{PHANPY_CLIENT_NAME:Er,PHANPY_WEBSITE:Rr}=Mr,In="read write follow push";async function Lr({instanceURL:e}){const n=new URLSearchParams({client_name:Er,redirect_uris:location.origin+location.pathname,scopes:In,website:Rr});return await(await fetch(`https://${e}/api/v1/apps`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n.toString()})).json()}async function _r({instanceURL:e,client_id:n}){const s=new URLSearchParams({client_id:n,scope:In,redirect_uri:location.origin+location.pathname,response_type:"code"});return`https://${e}/oauth/authorize?${s.toString()}`}async function Nr({instanceURL:e,client_id:n,client_secret:s,code:i}){const o=new URLSearchParams({client_id:n,client_secret:s,redirect_uri:location.origin+location.pathname,grant_type:"authorization_code",code:i,scope:In});return await(await fetch(`https://${e}/oauth/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o.toString()})).json()}var Dr={PHANPY_CLIENT_NAME:"IMSB",PHANPY_WEBSITE:"https://app.imsb.app",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",VITE_APP_ENV:"production",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{PHANPY_DEFAULT_INSTANCE:Pr}=Dr;function Ur(){Rt("Log in");const e=O(),n=bt.local.get("instanceURL"),[s,i]=A("default"),[o]=Gt(),r=o.get("instance"),h=o.get("submit"),[a,c]=A(r||(n==null?void 0:n.toLowerCase())||""),[l,u]=A([]);V(()=>{(async()=>{try{const b=await(await fetch(Ar)).json();u(b)}catch{}})()},[]);const d=v=>{v&&(bt.local.set("instanceURL",v),(async()=>{i("loading");try{const{client_id:b,client_secret:S,vapid_key:w}=await Lr({instanceURL:v});b&&S?(bt.session.set("clientID",b),bt.session.set("clientSecret",S),bt.session.set("vapidKey",w),location.href=await _r({instanceURL:v,client_id:b})):alert("Failed to register application"),i("default")}catch{i("error")}})())},f=a?a.replace(/^https?:\/\//,"").replace(/\/+$/,"").replace(/^@?[^@]+@/,"").trim():null,p=/[^\s\r\n\t\/\\]+\.[^\s\r\n\t\/\\]+/.test(f)&&!/[\s\/\\@]/.test(f),g=f?l.filter(v=>v.includes(a)).sort((v,b)=>{const S=v.toLowerCase().startsWith(a.toLowerCase()),w=b.toLowerCase().startsWith(a.toLowerCase());return S&&!w?-1:!S&&w?1:0}).slice(0,10):[],m=p?f:g!=null&&g.length?g[0]:a?l.find(v=>v.includes(a)):null,y=v=>{v.preventDefault(),d(m)};return h&&V(()=>{d(r||m)},[]),t("main",{id:"login",style:{textAlign:"center"},children:t("form",{onSubmit:y,children:[t("h1",{children:[t("img",{src:Fs,alt:"",width:"80",height:"80"}),t("br",{}),"Log in"]}),t("label",{children:[t("p",{children:"Instance"}),t("input",{value:a,required:!0,type:"text",class:"large",id:"instanceURL",ref:e,disabled:s==="loading",autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellCheck:!1,placeholder:"instance domain",onInput:v=>{c(v.target.value)}}),(g==null?void 0:g.length)>0?t("ul",{id:"instances-suggestions",children:g.map((v,b)=>t("li",{children:t("button",{type:"button",class:"plain5",onClick:()=>{d(v)},children:v})}))}):t("div",{id:"instances-eg",children:"e.g. “mastodon.social”"})]}),s==="error"&&t("p",{class:"error",children:"Failed to log in. Please try again or another instance."}),t("div",{children:[t("button",{disabled:s==="loading"||!a||!m,children:m?`Continue with ${m}`:"Continue"})," "]}),t(At,{hidden:s!=="loading"}),t("hr",{}),!Pr&&t("p",{children:t("a",{href:"https://joinmastodon.org/servers",target:"_blank",children:"Don't have an account? Create one!"})}),t("p",{children:t(et,{to:"/",children:"Go home"})})]})})}var Or={PHANPY_CLIENT_NAME:"IMSB",PHANPY_WEBSITE:"https://app.imsb.app",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",VITE_APP_ENV:"production",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{PHANPY_IMG_ALT_API_URL:yc}=Or;function Br({mediaAttachments:e,statusID:n,instance:s,lang:i,index:o=0,onClose:r=()=>{}}){var b,S;const[h,a]=A("default"),c=O(null),[l,u]=A(o),d=O(null);Xt(()=>{var w;(w=d.current)==null||w.scrollIntoView()},[]);const f=O(n);V(()=>{const w=o*c.current.clientWidth,T=f.current!==n;T&&(f.current=n),c.current.scrollTo({left:w,behavior:T?"auto":"smooth"}),c.current.focus()},[o,n]);const[p,g]=A(!0);V(()=>{let w=()=>{r()};return c.current&&c.current.addEventListener("swiped-down",w),()=>{c.current&&c.current.removeEventListener("swiped-down",w)}},[]),St("esc",r,{ignoreEventWhen:w=>!!document.querySelector("#modal-container > *")},[r]),V(()=>{let w=()=>{const{clientWidth:T,scrollLeft:k}=c.current,C=Math.round(k/T);u(C)};return c.current&&c.current.addEventListener("scroll",w,{passive:!0}),()=>{c.current&&c.current.removeEventListener("scroll",w)}},[]),V(()=>{let w=setTimeout(()=>{var T,k;(k=(T=c.current)==null?void 0:T.focus)==null||k.call(T)},100);return()=>clearTimeout(w)},[]);const m=gt(()=>e==null?void 0:e.map(w=>{const{blurhash:T}=w;if(T){const k=hs(T),C=Ps(k);return Us([.6,C[1],C[2]])}return null}),[e]),y=gt(()=>{var k;const T=100/m.length;return((k=m==null?void 0:m.map((C,F)=>{const x=F*T+5,P=(F+1)*T-5;return C?`
            rgba(${C==null?void 0:C.join(",")}, 0.4) ${x}%,
            rgba(${C==null?void 0:C.join(",")}, 0.4) ${P}%
          `:`
            transparent ${x}%,
            transparent ${P}%
          `}))==null?void 0:k.join(", "))||"transparent"},[m]);let v=O(null);return V(()=>()=>{var w,T;(T=(w=v.current)==null?void 0:w.hideToast)==null||T.call(w)},[]),t("div",{class:`media-modal-container media-modal-count-${e==null?void 0:e.length}`,children:[t("div",{ref:c,tabIndex:"0","data-swipe-threshold":"44",class:"carousel",onClick:w=>{(w.target.classList.contains("carousel-item")||w.target.classList.contains("media")||w.target.classList.contains("media-zoom"))&&r()},style:e.length>1?{backgroundAttachment:"local",backgroundImage:`linear-gradient(
            to right, ${y})`}:{},children:e==null?void 0:e.map((w,T)=>{const k=e.length===1?m[T]:null;return t("div",{class:"carousel-item",style:k?{"--accent-color":`rgb(${k==null?void 0:k.join(",")})`,"--accent-alpha-color":`rgba(${k==null?void 0:k.join(",")}, 0.4)`}:{},tabindex:"0",ref:T===l?d:null,onClick:C=>{C.target.classList.contains("media")||g(!p)},children:[!!w.description&&t("button",{type:"button",class:"media-alt",hidden:!p,onClick:()=>{$.showMediaAlt={alt:w.description,lang:i}},children:[t("span",{class:"alt-badge",children:"ALT"}),t("span",{class:"media-alt-desc",lang:i,dir:"auto",children:w.description})]}),t(cs,{media:w,showOriginal:!0,lang:i})]},w.id)})}),t("div",{class:"carousel-top-controls",hidden:!p,children:[t("span",{children:t("button",{type:"button",class:"carousel-button",onClick:()=>r(),children:t(I,{icon:"x"})})}),(e==null?void 0:e.length)>1?t("span",{class:"carousel-dots",children:e==null?void 0:e.map((w,T)=>t("button",{type:"button",disabled:T===l,class:`carousel-dot ${T===l?"active":""}`,onClick:k=>{k.preventDefault(),k.stopPropagation(),c.current.scrollTo({left:c.current.clientWidth*T,behavior:"smooth"}),c.current.focus()},children:t(I,{icon:"round",size:"s"})},w.id))}):t("span",{}),t("span",{children:[t(Jt,{overflow:"auto",align:"end",position:"anchor",gap:4,menuClassName:"glass-menu",menuButton:t("button",{type:"button",class:"carousel-button",children:t(I,{icon:"more",alt:"More"})}),children:[t(Et,{href:((b=e[l])==null?void 0:b.remoteUrl)||((S=e[l])==null?void 0:S.url),class:"carousel-button",target:"_blank",title:"Open original media in new window",children:[t(I,{icon:"popout"}),t("span",{children:"Open original media"})]}),!1]})," ",t(et,{to:`${s?`/${s}`:""}/s/${n}${window.matchMedia("(min-width: calc(40em + 350px))").matches?`?media=${l+1}`:""}`,class:"button carousel-button media-post-link",children:[t("span",{class:"button-label",children:"View post "}),"»"]})]})]}),(e==null?void 0:e.length)>1&&t("div",{class:"carousel-controls",hidden:!p,children:[t("button",{type:"button",class:"carousel-button",hidden:l===0,onClick:w=>{w.preventDefault(),w.stopPropagation(),c.current.focus(),c.current.scrollTo({left:c.current.clientWidth*(l-1),behavior:"smooth"})},children:t(I,{icon:"arrow-left"})}),t("button",{type:"button",class:"carousel-button",hidden:l===e.length-1,onClick:w=>{w.preventDefault(),w.stopPropagation(),c.current.focus(),c.current.scrollTo({left:c.current.clientWidth*(l+1),behavior:"smooth"})},children:t(I,{icon:"arrow-right"})})]})]})}const Ne=40,Fr=10,zr=5;let an={},Pe={},Ue={};function Oe(e){delete Pe[e],delete Ue[e]}const ye={block:"nearest",inline:"center",behavior:"smooth"},Wn=".status-link:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *), .status-focus:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *)",Yn=/\/s\//i;function qr(e){const{id:n}=e,{masto:s,instance:i}=H({instance:e.instance}),o=It($),[r,h]=Gt(),a=r.get("media"),c=r.get("media-only"),l=parseInt(a||c,10);let u=l>0;const d=r.get("mediaStatusID"),f=ds(d,i);d&&!f&&(u=!1);const p=u&&!!c,g=Yt(n,i),[m,y]=A($.statuses[g]);V(()=>{$.statuses[g]&&y($.statuses[g])},[g]);const v=gt(()=>{const{prevLocation:w}=$,T=((w==null?void 0:w.pathname)||"")+((w==null?void 0:w.search)||""),k=Te("/:instance/s/:id",T)||Te("/s/:id",T);return!T||k?"/":T},[]);V(()=>{!m&&u&&(async()=>{try{const w=await s.v1.statuses.$select(n).fetch();Ct(w,i),y(w)}catch{alert("Unable to load post."),location.hash=v}})()},[u]);const b=d?f==null?void 0:f.mediaAttachments:m==null?void 0:m.mediaAttachments,S=Wt(()=>{!window.matchMedia("(min-width: calc(40em + 350px))").matches&&o.prevLocation?history.back():p?location.hash=v:(r.delete("media"),r.delete("mediaStatusID"),h(r))},[p,v,o.prevLocation]);return V(()=>{let w=setTimeout(()=>{const T=document.querySelector(".carousel");T&&T.focus()},100);return()=>clearTimeout(w)},[p]),t("div",{class:"deck-backdrop",children:[u?b!=null&&b.length?t(Br,{mediaAttachments:b,statusID:d||n,instance:i,lang:m==null?void 0:m.language,index:l-1,onClose:S}):t("div",{class:"media-modal-container loading",children:t(At,{abrupt:!0})}):t(et,{to:v}),!p&&t(Vr,{id:n,instance:e.instance,closeLink:v})]})}function Hr(e){const{linkable:n,to:s,onClick:i,...o}=e;return n?t(et,{class:"status-link",to:s,onClick:i,...o}):t("div",{class:"status-focus",tabIndex:0,...o})}function Vr({id:e,closeLink:n="/",instance:s}){var Lt,Dt;const[i,o]=Gt(),r=i.get("media"),h=i.get("mediaStatusID"),a=parseInt(r,10)>0,c=O(!$.prevLocation&&(history.length===1||"navigation"in window&&((Dt=(Lt=navigation==null?void 0:navigation.entries)==null?void 0:Lt.call(navigation))==null?void 0:Dt.length)===1)),[l,u]=A(i.get("view")||c.current?"full":null),d=!!parseInt(i.get("translate")),{masto:f,instance:p}=H({instance:s}),{masto:g,instance:m,authenticated:y}=H(),v=p===m,b=It($),[S,w]=A([]),[T,k]=A("default"),C=O(),F=Yt(e,p),x=O(0),P=O();V(()=>{var R;(R=P.current)==null||R.focus()},[]),V(()=>{var Y;const R=gs(()=>{if(!P.current)return;const{scrollTop:J}=P.current;T!=="loading"&&(Ue[e]=J)},50);return(Y=P.current)==null||Y.addEventListener("scroll",R,{passive:!0}),R(),()=>{var J;R.cancel(),(J=P.current)==null||J.removeEventListener("scroll",R)}},[e,T!=="loading"]);const B=O(),L=O(),N=({reloadHero:R}={})=>{k("loading");let Y;const J=Pe[e];if(J){const D=J.filter(it=>$.statuses[F]);w(D)}else w([{id:e}]);return(async()=>{var Pt,Ut;const D=()=>$n(()=>f.v1.statuses.$select(e).fetch(),{retries:4}),it=$n(()=>f.v1.statuses.$select(e).context.fetch(),{retries:8}),pt=!!b.statuses[F];let rt=b.statuses[F];if(!(pt&&!R))try{rt=await D(),Ct(rt,p),await new Promise(Tt=>{setTimeout(Tt,100)})}catch{k("error");return}try{let Tt=function(st){return st==null?void 0:st.map(Mt=>({id:Mt.id,account:Mt.account,repliesCount:Mt.repliesCount,content:Mt.content,weight:Ie(Mt),replies:Tt(Mt.__replies)}))};const Ot=await it,{ancestors:Vt,descendants:kt}=Ot;x.current=(kt==null?void 0:kt.length)||0;const qt=new Set;Vt.forEach(st=>{Ct(st,p,{skipThreading:!0}),st.inReplyToId&&!Vt.find(Mt=>Mt.id===st.inReplyToId)&&qt.add(st.inReplyToId)});const le=Vt.every(st=>st.account.id===rt.account.id),Bt=[];kt.forEach(st=>{if(Ct(st,p,{skipThreading:!0}),st.inReplyToId&&!kt.find(Mt=>Mt.id===st.inReplyToId)&&st.inReplyToId!==rt.id&&qt.add(st.inReplyToId),st.inReplyToAccountId===st.account.id)Bt.push(st);else if(st.inReplyToId===rt.id)Bt.push(st);else if(!st.inReplyToAccountId&&Bt.find(Mt=>Mt.id===st.inReplyToId)&&st.account.id===rt.account.id)Bt.push(st);else{const Mt=kt.find(qs=>qs.id===st.inReplyToId);Mt&&(Mt.__replies||(Mt.__replies=[]),Mt.__replies.push(st))}}),qt.size;const je=[...Vt.map(st=>({id:st.id,ancestor:!0,isThread:le,accountID:st.account.id,account:st.account,repliesCount:st.repliesCount,weight:Ie(st)})),{id:e,accountID:rt.account.id,weight:Ie(rt)},...Bt.map(st=>({id:st.id,account:st.account,accountID:st.account.id,descendant:!0,thread:st.account.id===rt.account.id,weight:Ie(st),replies:Tt(st.__replies)}))];k("default"),B.current={offsetTop:(Pt=C.current)==null?void 0:Pt.offsetTop,scrollTop:(Ut=P.current)==null?void 0:Ut.scrollTop};const Tn=je.findIndex(st=>st.id===e);Tn>=lt&&ot(Tn+1),w(je),Pe[e]=je,ui(rt,p)}catch{k("error")}})(),L.current=Date.now(),()=>{clearTimeout(Y)}};V(N,[e,f]);const[E,K]=A(!1);V(()=>{let R=setInterval(()=>{const Y=Date.now();L.current&&Y-L.current>=6e4&&K(!0)},6e4);return()=>{clearInterval(R)}},[]),Xt(()=>{var Y,J;if(!S.length)return;const R=Ue[e];if(R)P.current.scrollTop=R;else if(B.current){const D={offsetTop:(Y=C.current)==null?void 0:Y.offsetTop,scrollTop:(J=P.current)==null?void 0:J.scrollTop},it=D.offsetTop-B.current.offsetTop+D.scrollTop;P.current.scrollTop=it}else S.length===1&&(P.current.scrollTop=0);B.current=null},[S]),V(()=>{b.reloadStatusPage<=0||(async()=>{try{const{instanceURL:R}=pe(),Y=`https://${R}/api/v1/statuses/${e}/context`;return await(await caches.open("api")).delete(Y,{ignoreVary:!0}),N({reloadHero:!0})}catch{}})()},[b.reloadStatusPage]),V(()=>()=>{Ue={},$.reloadStatusPage=0,Pe={},an={},ln.clear()},[]);const q=b.statuses[F]||b.statuses[e],tt=gt(()=>{if(!q)return"";const{account:R}=q,Y=document.createElement("div");return Y.innerHTML=R.displayName,Y.innerText.trim()},[q]),Q=gt(()=>{if(!q)return"";let R=ls(q);return R.length>64&&(R=R.slice(0,64)+"…"),R},[q]);Rt(tt&&Q?`${tt}: "${Q}"`:"Status","/:instance?/s/:id");const vt=gt(()=>{if(!q)return;const{url:R}=q;if(R)return new URL(R).hostname},[q]),Z=gt(()=>{if(vt)return vt===p},[vt,p]),[lt,ot]=A(Ne),ft=gt(()=>S.length-lt,[S.length,lt]),mt=S.some(R=>R.descendant),$t=S.filter(R=>R.ancestor),[_,G]=A(!0),nt=gt(()=>{if(!C.current||_)return null;const{top:R}=C.current.getBoundingClientRect();return R>0?"down":"up"},[_]);St("esc",()=>{location.hash=n},{enabled:!a,ignoreEventWhen:R=>!!document.querySelector("#modal-container > *")}),St("backspace",()=>{location.hash=n}),St("j",()=>{const R=document.activeElement.closest(".status-link, .status-focus"),Y=R==null?void 0:R.getBoundingClientRect(),J=Array.from(P.current.querySelectorAll(Wn));if(R&&Y.top<P.current.clientHeight&&Y.bottom>0){const D=J.indexOf(R);let it=J[D+1];it&&(it.focus(),it.scrollIntoView(ye))}else{const D=J.find(it=>{const pt=it.getBoundingClientRect();return pt.top>=44&&pt.left>=0});D&&(D.focus(),D.scrollIntoView(ye))}}),St("k",()=>{const R=document.activeElement.closest(".status-link, .status-focus"),Y=R==null?void 0:R.getBoundingClientRect(),J=Array.from(P.current.querySelectorAll(Wn));if(R&&Y.top<P.current.clientHeight&&Y.bottom>0){const D=J.indexOf(R);let it=J[D-1];it&&(it.focus(),it.scrollIntoView(ye))}else{const D=J.find(it=>{const pt=it.getBoundingClientRect();return pt.top>=44&&pt.left>=0});D&&(D.focus(),D.scrollIntoView(ye))}}),St("x",()=>{const R=document.activeElement.closest(".status-link, .status-focus");if(R){const Y=R.nextElementSibling;Y&&Y.tagName.toLowerCase()==="details"&&(Y.open=!Y.open)}});const[X,z]=A(!1),W=O(a?"media+status":"status"),U=Wt((R,Y,J,D)=>{R.preventDefault(),R.stopPropagation(),o({media:Y+1,mediaStatusID:D.id})},[e]),ct=Wt((R,Y)=>{Oe(Y.id)},[]);V(()=>{let R;return h&&a&&(R=setTimeout(()=>{var J;const Y=(J=P.current)==null?void 0:J.querySelector(`.status-link[href*="/${h}"]`);Y&&Y.scrollIntoView(ye)},400)),()=>{clearTimeout(R)}},[h,a]);const ht=Wt((R,Y)=>{const{id:J,ancestor:D,isThread:it,descendant:pt,thread:rt,replies:Pt,repliesCount:Ut,weight:Tt}=R,Ot=J===e;return t("li",{ref:Ot?C:null,class:`${D?"ancestor":""} ${pt?"descendant":""} ${rt?"thread":""} ${Ot?"hero":""}`,children:[Ot?t(M,{children:[t(ne,{threshold:.1,onChange:kt=>{queueMicrotask(()=>{requestAnimationFrame(()=>{G(kt)})})},class:"status-focus",tabIndex:0,children:t(xt,{statusID:J,instance:p,withinContext:!0,size:"l",enableTranslate:!0,forceTranslate:d})}),T!=="loading"&&!y?t("div",{class:"post-status-banner",children:[t("p",{children:"You're not logged in. Interactions (reply, boost, etc) are not possible."}),t(et,{to:"/login",class:"button",children:"Log in"})]}):!v&&t("div",{class:"post-status-banner",children:[t("p",{children:["This post is from another instance (",t("b",{children:p}),"). Interactions (reply, boost, etc) are not possible."]}),t("button",{type:"button",disabled:T==="loading",onClick:()=>{k("loading"),(async()=>{try{const kt=await g.v2.search.fetch({q:q.url,type:"statuses",resolve:!0,limit:1});if(kt.statuses.length){const qt=kt.statuses[0];location.hash=m?`/${m}/s/${qt.id}`:`/s/${qt.id}`}else throw new Error("No results")}catch(kt){k("default"),alert("Error: "+kt)}})()},children:[t(I,{icon:"transfer"})," Switch to my instance to enable interactions"]})]})]}):t(Hr,{linkable:it||D,to:p?`/${p}/s/${J}`:`/s/${J}`,onClick:()=>{Oe(J)},children:[Y===0&&D?t(ne,{threshold:.5,onChange:kt=>{queueMicrotask(()=>{requestAnimationFrame(()=>{z(kt)})})},children:t(xt,{statusID:J,instance:p,withinContext:!0,size:rt||D?"m":"s",enableTranslate:!0,onMediaClick:U,onStatusLinkClick:ct})}):t(xt,{statusID:J,instance:p,withinContext:!0,size:rt||D?"m":"s",enableTranslate:!0,onMediaClick:U,onStatusLinkClick:ct,showActionsBar:!!pt}),D&&Ut>1&&t("div",{class:"replies-link",children:[t(I,{icon:"comment2"})," ",t("span",{title:Ut,children:Ft(Ut)})]})," "]}),pt&&(Pt==null?void 0:Pt.length)>0&&t(zs,{instance:p,replies:Pt,hasParentThread:rt,level:1,accWeight:Tt,openAll:x.current<Fr,parentLink:{to:p?`/${p}/s/${J}`:`/s/${J}`,onClick:()=>Oe(J)}}),T==="loading"&&Ot&&!!(q!=null&&q.repliesCount)&&!mt&&t("div",{class:"status-loading",children:t(At,{abrupt:q.repliesCount>=3})}),T==="error"&&Ot&&!!(q!=null&&q.repliesCount)&&!mt&&t("div",{class:"status-error",children:["Unable to load replies.",t("br",{}),t("button",{type:"button",class:"plain",onClick:()=>{$.reloadStatusPage++},children:"Try again"})]})]},J)},[e,p,T,y,v,d,U,ct,mt]),j=gt(()=>{var R;if("navigation"in window&&(navigation!=null&&navigation.entries)){const Y=navigation.entries()[navigation.currentEntry.index-1];if(Y!=null&&Y.url)return Yn.test(Y.url)}return Yn.test((R=$.prevLocation)==null?void 0:R.pathname)},[F]),dt=gt(()=>{if(!ft)return[];const R=[];function Y(J){R.push(J.id),J.replies&&J.replies.forEach(Y)}return S.slice(lt).forEach(Y),R.map(J=>Yt(J,p))},[ft,S,lt,p]),wt=gt(()=>S.slice(0,lt).map(ht),[S,lt,ht]);return t("div",{tabIndex:"-1",ref:P,class:`status-deck deck contained ${S.length>1?"padded-bottom":""} ${W.current==="status"&&!c.current?"slide-in":""} ${l?`deck-view-${l}`:""}`,onAnimationEnd:R=>{W.current==="status"&&(W.current=null)},children:[t("header",{class:`${T==="loading"?"loading":""}`,onDblClick:R=>{$.reloadStatusPage++},children:t("div",{class:"header-grid header-grid-2",children:[t("h1",{children:[j&&t("button",{type:"button",class:"plain deck-back",onClick:()=>{history.back()},children:t(I,{icon:"chevron-left",size:"xl"})}),!_&&q&&T!=="loading"?t(M,{children:[t("span",{class:"hero-heading",children:[t(Je,{account:q.account,instance:p,showAvatar:!0,short:!0})," ",t("span",{class:"insignificant",children:["•"," ",t(dn,{datetime:q.createdAt,format:"micro"})]})]})," ",t("button",{type:"button",class:"ancestors-indicator light small",onClick:R=>{R.preventDefault(),R.stopPropagation(),C.current.scrollIntoView({behavior:"smooth",block:"start"})},title:"Go to main post",children:t(I,{icon:nt==="down"?"arrow-down":"arrow-up"})})]}):t(M,{children:["Post"," ",t("button",{type:"button",class:"ancestors-indicator light small",onClick:R=>{R.preventDefault(),R.stopPropagation(),P.current.scrollTo({top:0,behavior:"smooth"})},hidden:!$t.length||X,title:`${$t.length} posts above ‒ Go to top`,children:[t(I,{icon:"arrow-up"}),$t.filter((R,Y,J)=>J.findIndex(D=>D.accountID===R.accountID)===Y).slice(0,3).map(R=>t(fe,{url:R.account.avatar,alt:R.account.displayName},R.account.id)),$t.length>3&&t(M,{children:[" ",t("span",{class:"insignificant",children:Ft($t.length)})]})]})]})]}),t("div",{class:"header-side",children:[t("button",{type:"button",class:"plain4 button-switch-view",style:{display:l==="full"?"":"none"},onClick:()=>{u(null),i.delete("media"),i.delete("media-only"),i.delete("view"),o(i)},title:"Switch to Side Peek view",children:t(I,{icon:"layout4",size:"l"})}),E&&t("button",{type:"button",class:"plain button-refresh",onClick:()=>{$.reloadStatusPage++,K(!1)},children:t(I,{icon:"refresh",size:"l"})}),t(Jt,{align:"end",portal:{target:P.current},menuButton:t("button",{type:"button",class:"button plain4",children:t(I,{icon:"more",alt:"Actions",size:"xl"})}),children:[t(at,{disabled:T==="loading",onClick:()=>{$.reloadStatusPage++},children:[t(I,{icon:"refresh"}),t("span",{children:"Refresh"})]}),t(at,{className:"menu-switch-view",onClick:()=>{u(l==="full"?null:"full"),i.delete("media"),i.delete("media-only"),l==="full"?i.delete("view"):i.set("view","full"),o(i)},children:[t(I,{icon:{"":"layout5",full:"layout4"}[l||""]}),t("span",{children:["Switch to ",l==="full"?"Side Peek":"Full"," view"]})]}),t(at,{onClick:()=>{Array.from(P.current.querySelectorAll(".spoiler-button:not(.spoiling), .spoiler-media-button:not(.spoiling)")).forEach(Y=>{Y.click()})},children:[t(I,{icon:"eye-open"})," ",t("span",{children:"Show all sensitive content"})]}),t(_t,{}),t(us,{className:"plain",children:"Experimental"}),t(at,{disabled:!vt||Z,onClick:()=>{const R=Cr(q.url);R?location.hash=R:alert("Unable to switch")},children:[t(I,{icon:"transfer"}),t("small",{class:"menu-double-lines",children:["Switch to post's instance",vt?t(M,{children:[" ","(",t("b",{children:vt}),")"]}):""]})]})]}),t(et,{class:"button plain deck-close",to:n,children:t(I,{icon:"x",size:"xl"})})]})]})}),S.length&&q?t("ul",{class:`timeline flat contextual grow ${T==="loading"?"loading":""}`,children:[wt,ft>0&&t("li",{children:t("button",{type:"button",class:"plain block show-more",disabled:T==="loading",onClick:()=>ot(R=>R+Ne),style:{marginBlockEnd:"6em"},"data-state-post-ids":dt.join(" "),children:[t("div",{class:"ib avatars-bunch",children:S.slice(lt,lt+5).map(R=>t(fe,{url:R.account.avatarStatic},R.id))})," ",t("div",{class:"ib",children:["Show more…"," ",t("span",{class:"tag",children:ft>Ne?`${Ne}+`:ft})]})]})})]}):t(M,{children:[T==="loading"&&t("ul",{class:"timeline flat contextual grow loading",children:t("li",{children:t(xt,{skeleton:!0,size:"l"})})}),T==="error"&&t("p",{class:"ui-state",children:["Unable to load post",t("br",{}),t("br",{}),t("button",{type:"button",onClick:()=>{$.reloadStatusPage++},children:"Try again"})]})]})]})}function zs({replies:e,instance:n,hasParentThread:s,level:i,accWeight:o,openAll:r,parentLink:h}){const[a,c]=Gt(),l=b=>b.reduce((S,w)=>{const{repliesCount:T,replies:k}=w,C=(k==null?void 0:k.length)||T;return S+C+l(k||[])},0),u=e.length+l(e),d=e.length===u,f=e.map(b=>b.account).filter((b,S,w)=>w.findIndex(T=>T.id===b.id)===S).slice(0,3),p=gt(()=>e==null?void 0:e.reduce((b,S)=>b+(S==null?void 0:S.weight),o),[o,e==null?void 0:e.length]);let g=!1;(r||p<=zr||!s&&u===1&&Ie(e[0])<2)&&(g=!0);const m=an[e[0].id],y=Wt((b,S,w,T)=>{b.preventDefault(),b.stopPropagation(),c({media:S+1,mediaStatusID:T.id})},[]),v=O();return Xt(()=>{var S;function b(w){w.target.dataset.scrollLeft=w.target.scrollLeft}return(S=v.current)==null||S.addEventListener("scroll",b,{passive:!0}),()=>{var w;(w=v.current)==null||w.removeEventListener("scroll",b)}},[]),t("details",{ref:v,class:"replies",open:m||g,onToggle:b=>{const{open:S}=b.target;an[e[0].id]=S},style:{"--comments-level":i},"data-comments-level":i,"data-comments-level-overflow":i>4,children:[t("summary",{class:"replies-summary",hidden:g,children:[t("span",{class:"avatars",children:f.map(b=>t(fe,{url:b.avatarStatic,title:`${b.displayName} @${b.username}`,squircle:b==null?void 0:b.bot},b.id))}),t("span",{class:"replies-counts",children:[t("b",{children:[t("span",{title:e.length,children:Ft(e.length)})," ","repl",e.length===1?"y":"ies"]}),!d&&u>1&&t(M,{children:[" ","·"," ",t("span",{children:[t("span",{title:u,children:Ft(u)})," ","comment",u===1?"":"s"]})]})]}),t(I,{icon:"chevron-down",class:"replies-summary-chevron"}),!!h&&t(et,{class:"replies-parent-link",to:h.to,onClick:h.onClick,title:"View post with its replies",children:"»"})]}),t("ul",{children:e.map(b=>{var S,w;return t("li",{children:[t("div",{class:"status-focus",tabIndex:0,children:[t(xt,{statusID:b.id,instance:n,withinContext:!0,size:"s",enableTranslate:!0,onMediaClick:y,showActionsBar:!0}),!((S=b.replies)!=null&&S.length)&&b.repliesCount>0&&t("div",{class:"replies-link",children:[t(I,{icon:"comment2"})," ",t("span",{title:b.repliesCount,children:Ft(b.repliesCount)})]})]}),((w=b.replies)==null?void 0:w.length)&&t(zs,{instance:n,replies:b.replies,level:i+1,accWeight:g?p:b.weight,openAll:r,parentLink:{to:n?`/${n}/s/${b.id}`:`/s/${b.id}`,onClick:()=>{Oe(b.id)}}})]},b.id)})})]})}const jr=140,Wr=35,Yr=70,Gr=140,ln=new Map;function Ie(e){var p,g;const n=ln.get(e.id);if(n)return n;const{spoilerText:s,content:i,mediaAttachments:o,poll:r,card:h}=e,a=hi(s+i),c=o!=null&&o.length?jr:0,l=(((p=r==null?void 0:r.options)==null?void 0:p.length)||0)*Wr,u=h&&(o!=null&&o.length||(g=r==null?void 0:r.options)!=null&&g.length)?0:Yr,f=(a+c+l+u)/Gr;return ln.set(e.id,f),f}const Kr=zt(qr);function Zr(){const e=ce(),{id:n,instance:s}=e;return t(Kr,{id:n,instance:s})}const Xr=""+new URL("boosts-carousel-YjmjXTE6.jpg",import.meta.url).href,Jr=""+new URL("grouped-notifications-xYMFVY91.jpg",import.meta.url).href,Qr=""+new URL("multi-column-ETnJNDVb.jpg",import.meta.url).href,tc=""+new URL("multi-hashtag-timeline-x-SDVR4g.jpg",import.meta.url).href,ec=""+new URL("nested-comments-thread-Ib-fZGS3.jpg",import.meta.url).href,nc="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20fill-rule='evenodd'%20stroke-linejoin='round'%20stroke-miterlimit='2'%20clip-rule='evenodd'%20viewBox='0%200%20102%2028'%3e%3cpath%20fill='none'%20d='M0%200h101.5v27.5H0z'/%3e%3cg%20fill-rule='nonzero'%3e%3cpath%20fill='url(%23a)'%20d='M2.32%2021.85c1.4%200%202.21-.85%202.21-2.3v-4.64H8.5c4.45%200%207.54-2.9%207.54-7.24%200-4.35-2.98-7.24-7.32-7.24h-6.4C.93.43.11%201.28.11%202.73v16.82c0%201.45.82%202.3%202.21%202.3Zm2.21-10.4V3.94h3c2.54%200%204%201.34%204%203.75s-1.47%203.76-4%203.76h-3Z'/%3e%3cpath%20fill='url(%23b)'%20d='M20.52%2021.88c1.25%200%202.13-.76%202.13-2.23v-7.04c0-2.07%201.2-3.49%203.21-3.49%201.95%200%202.95%201.23%202.95%203.25v7.28c0%201.47.89%202.23%202.13%202.23%201.26%200%202.14-.76%202.14-2.23v-8.18c0-3.64-1.99-5.9-5.48-5.9-2.38%200-4.1%201.12-4.93%203.1h-.09V2.3c0-1.38-.78-2.2-2.1-2.2-1.31%200-2.1.82-2.1%202.2v17.34c0%201.47.9%202.23%202.14%202.23Z'/%3e%3cpath%20fill='url(%23c)'%20d='M40.45%2021.82c1.96%200%203.93-.98%204.8-2.65h.1v.8c.08%201.27.89%201.91%202.05%201.91%201.21%200%202.08-.73%202.08-2.15v-8.95c0-3.17-2.63-5.25-6.65-5.25-3.26%200-5.78%201.16-6.5%203.04-.15.32-.23.63-.23.96%200%20.97.75%201.64%201.79%201.64.69%200%201.23-.26%201.7-.79.95-1.23%201.74-1.65%203.04-1.65%201.62%200%202.64.85%202.64%202.31v1.04l-3.95.24c-3.93.23-6.13%201.88-6.13%204.74%200%202.83%202.27%204.76%205.26%204.76Zm1.4-3.09c-1.43%200-2.4-.73-2.4-1.9%200-1.12.91-1.83%202.51-1.95l3.31-.2v1.14c0%201.7-1.54%202.91-3.41%202.91Z'/%3e%3cpath%20fill='url(%23d)'%20d='M54.37%2021.88c1.26%200%202.14-.76%202.14-2.23v-7.09c0-2.03%201.21-3.44%203.13-3.44s2.89%201.17%202.89%203.22v7.31c0%201.47.88%202.23%202.14%202.23%201.24%200%202.13-.76%202.13-2.23v-8.2c0-3.68-1.96-5.87-5.45-5.87-2.41%200-4%201.07-4.83%203.01h-.09v-.87c0-1.35-.85-2.17-2.14-2.17-1.28%200-2.06.82-2.06%202.15v11.95c0%201.47.9%202.23%202.14%202.23Z'/%3e%3cpath%20fill='url(%23e)'%20d='M71.65%2027.17c1.26%200%202.14-.76%202.14-2.23v-6h.09a5.15%205.15%200%200%200%204.88%202.88c3.92%200%206.35-3.05%206.35-8.1%200-5.07-2.44-8.1-6.43-8.1a5.12%205.12%200%200%200-4.86%202.99h-.09v-.85c0-1.45-.88-2.21-2.1-2.21-1.24%200-2.11.76-2.11%202.2v17.2c0%201.46.89%202.22%202.13%202.22Zm5.6-8.8c-2.1%200-3.47-1.8-3.47-4.65%200-2.81%201.37-4.67%203.47-4.67%202.14%200%203.49%201.83%203.49%204.67%200%202.86-1.35%204.66-3.5%204.66Z'/%3e%3cpath%20fill='url(%23f)'%20d='M89.61%2027.39c3.44%200%205.26-1.5%206.73-5.55l4.81-13.1a4%204%200%200%200%20.24-1.26c0-1.13-.85-1.93-2.08-1.93-1.1%200-1.71.51-2.07%201.7l-3.4%2010.9h-.08L90.35%207.28c-.36-1.25-.94-1.73-2.07-1.73-1.26%200-2.21.83-2.21%201.99%200%20.35.09.82.25%201.26l5%2013.21-.21.56c-.52%201.1-1.32%201.42-2.07%201.42l-.75-.01c-.96%200-1.56.54-1.56%201.4%200%201.29%201%202%202.88%202Z'/%3e%3c/g%3e%3cdefs%3e%3cradialGradient%20id='a'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='b'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='c'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='d'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='e'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='f'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3c/defs%3e%3c/svg%3e";var sc={PHANPY_CLIENT_NAME:"IMSB",PHANPY_WEBSITE:"https://app.imsb.app",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",VITE_APP_ENV:"production",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{PHANPY_DEFAULT_INSTANCE:Se,PHANPY_WEBSITE:Gn,PHANPY_PRIVACY_POLICY_URL:ic,PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:Kn}=sc,Zn=Gn?Gn.replace(/https?:\/\//g,"").replace(/\/$/,""):null,Xn=`${"2024-03-18T03:03:50.452Z".slice(0,10).replace(/-/g,".")}.9a5704e`;function Jn(){return Rt(null,["/","/welcome"]),t("main",{id:"welcome",children:[t("div",{class:"hero-container",children:[t("div",{class:"hero-content",children:[t("h1",{children:[t("img",{src:Fs,alt:"",width:"160",height:"160",style:{aspectRatio:"1/1",marginBlockEnd:-16}}),t("img",{src:nc,alt:"Phanpy",width:"200"})]}),t("p",{class:"desc",children:"A minimalistic opinionated Mastodon web client."}),t("p",{children:t(et,{to:Se?`/login?instance=${Se}&submit=1`:"/login",class:"button",children:Se?"Log in":"Log in with Mastodon"})}),Se&&Kn&&t("p",{children:t("a",{href:Kn,class:"button plain5",children:"Sign up"})}),!Se&&t("p",{class:"insignificant",children:t("small",{children:["Connect your existing Mastodon/Fediverse account.",t("br",{}),"Your credentials are not stored on this server."]})})]}),(Zn||Xn)&&t("p",{class:"app-site-version",children:t("small",{children:[Zn," ",Xn]})}),t("p",{children:[t("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",children:"Built"})," ","by"," ",t("a",{href:"https://mastodon.social/@cheeaun",target:"_blank",onClick:e=>{e.preventDefault(),$.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"}),"."," ",t("a",{href:ic,target:"_blank",children:"Privacy Policy"}),"."]})]}),t("div",{id:"why-container",children:t("div",{class:"sections",children:[t("section",{children:[t("img",{src:Xr,alt:"Screenshot of Boosts Carousel",loading:"lazy"}),t("h4",{children:"Boosts Carousel"}),t("p",{children:"Visually separate original posts and re-shared posts (boosted posts)."})]}),t("section",{children:[t("img",{src:ec,alt:"Screenshot of nested comments thread",loading:"lazy"}),t("h4",{children:"Nested comments thread"}),t("p",{children:"Effortlessly follow conversations. Semi-collapsible replies."})]}),t("section",{children:[t("img",{src:Jr,alt:"Screenshot of grouped notifications",loading:"lazy"}),t("h4",{children:"Grouped notifications"}),t("p",{children:"Similar notifications are grouped and collapsed to reduce clutter."})]}),t("section",{children:[t("img",{src:Qr,alt:"Screenshot of multi-column UI",loading:"lazy"}),t("h4",{children:"Single or multi-column"}),t("p",{children:"By default, single column for zen-mode seekers. Configurable multi-column for power users."})]}),t("section",{children:[t("img",{src:tc,alt:"Screenshot of multi-hashtag timeline with a form to add more hashtags",loading:"lazy"}),t("h4",{children:"Multi-hashtag timeline"}),t("p",{children:"Up to 5 hashtags combined into a single timeline."})]})]})})]})}const Qn=()=>{let e=setTimeout(()=>{if(!document.getElementById("columns")){const s=document.querySelectorAll("#modal-container > *");if(s!=null&&s.length){const h=s[s.length-1],a=h.querySelector('[tabindex="-1"]')||h;if(a){a.focus();return}}if(document.querySelector(".deck-backdrop"))return;const o=document.querySelectorAll(".deck-container"),r=o[o.length-1];r&&r.tabIndex===-1&&r.focus()}},100);return()=>clearTimeout(e)},oc=window.alert;window.__nativeAlert||(window.__nativeAlert=oc);window.alert=function(e){e instanceof Error&&(e!=null&&e.message)&&(e=e.message),typeof e!="string"&&(e=JSON.stringify(e));const n=fi({text:e,className:"alert",gravity:"top",position:"center",duration:1e4,offset:{y:48},onClick:()=>{n.hideToast()}});n.showToast()};const rc=ps(()=>fs(()=>import("./catchup-vF-NJ_db.js"),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url)),cc=ps(()=>fs(()=>import("./modals-ExCBEKHZ.js"),__vite__mapDeps([6,1,2,3,7,4,8,9]),import.meta.url));window.__STATES__=$;window.__STATES_STATS__=()=>{const e=["statuses","accounts","spoilers","unfurledLinks","statusQuotes"],n={};e.forEach(o=>{n[o]=Object.keys($[o]).length});const{statuses:s}=$,i=[];for(const o in s)document.querySelector(`[data-state-post-id~="${o}"], [data-state-post-ids~="${o}"]`)||i.push(o)};setInterval(()=>{if(!window.__IDLE__)return;const{statuses:e,unfurledLinks:n,notifications:s}=$;let i=0;const{instance:o}=H();for(const r in e){if(!window.__IDLE__)break;try{const h=document.querySelector(`[data-state-post-id~="${r}"], [data-state-post-ids~="${r}"]`),a=s.some(c=>{var l;return r===Yt((l=c.status)==null?void 0:l.id,o)});if(!h&&!a){delete $.statuses[r],delete $.statusQuotes[r];for(const c in n){const l=n[c];if(Yt(l.id,l.instance)===r){delete $.unfurledLinks[c];break}}i++}}catch{}}},15*60*1e3);setTimeout(()=>{for(const e in Ae)queueMicrotask(()=>{var n,s,i,o;Array.isArray(Ae[e])?(s=(n=Ae[e])[0])==null||s.call(n):(o=(i=Ae)[e])==null||o.call(i)})},5e3);(()=>{window.__IDLE__=!0;const e=["mousemove","mousedown","resize","keydown","touchstart","pointerdown","pointermove","wheel"],n=()=>{window.__IDLE__=!0},i=gs(n,3e3),o=()=>{window.__IDLE__=!1,i()};e.forEach(r=>{window.addEventListener(r,o,{passive:!0,capture:!0})}),window.addEventListener("blur",n,{passive:!0}),document.documentElement.addEventListener("mouseleave",r=>{!r.relatedTarget&&!r.toElement&&n()},{passive:!0})})();const ac=/iPad|iPhone|iPod/.test(navigator.userAgent);ac&&document.addEventListener("visibilitychange",()=>{if(document.visibilityState==="visible"){const e=bt.local.get("theme");let n;if(e){if(n=document.querySelector('meta[name="theme-color"][data-theme-setting="manual"]'),n){const s=n.content,i=e==="light"?n.dataset.themeLightColorTemp:n.dataset.themeDarkColorTemp;n.content=i||"",setTimeout(()=>{n.content=s},10)}}else{const s=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";if(n=document.querySelector(`meta[name="theme-color"][media*="${s}"]`),n){const i=n.dataset.content,o=n.dataset.contentTemp;n.content=o||"",setTimeout(()=>{n.content=i},10)}}}});{const e=bt.local.get("theme");if(e){document.documentElement.classList.add(`is-${e}`),document.querySelector('meta[name="color-scheme"]').setAttribute("content",e||"dark light");const s=document.querySelector('meta[data-theme-setting="manual"]');s&&(s.name="theme-color",s.content=e==="light"?s.dataset.themeLightColor:s.dataset.themeDarkColor),document.querySelectorAll('meta[data-theme-setting="auto"]').forEach(o=>{o.name=""})}const n=bt.local.get("textSize");n&&document.documentElement.style.setProperty("--text-size",`${n}px`)}pi($,e=>{var n;for(const[s,i,o,r]of e){if(i.join(".")==="settings.shortcutsViewMode"){const h=document.getElementById("app");h&&(h.dataset.shortcutsViewMode=(n=$.shortcuts)!=null&&n.length?o:"")}i.join(".")==="settings.cloakMode"&&document.body.classList.toggle("cloak",o)}});function lc(){const[e,n]=A(!1),[s,i]=A("loading");V(()=>{const r=bt.local.get("instanceURL"),h=decodeURIComponent((window.location.search.match(/code=([^&]+)/)||[,""])[1]);if(h){window.history.replaceState({},document.title,window.location.pathname||"/");const a=bt.session.get("clientID"),c=bt.session.get("clientSecret"),l=bt.session.get("vapidKey");(async()=>{i("loading");const{access_token:u}=await Nr({instanceURL:r,client_id:a,client_secret:c,code:h}),d=mi({instance:r,accessToken:u});await Promise.allSettled([xn(d,r),gi(d,r,u,l)]),An(),Mn(d),n(!0),i("default")})()}else{window.__IGNORE_GET_ACCOUNT_ERROR__=!0;const a=pe();if(a){bt.session.set("currentAccount",a.info.id);const{client:c}=H({account:a}),{instance:l}=c;An(),Mn(c),i("loading"),(async()=>{try{await xn(c,l)}catch{}finally{n(!0),i("default")}})()}else i("default")}},[]);let o=He();return $.currentLocation=o.pathname,V(Qn,[o,e]),/\/https?:/.test(o.pathname)?t($r,{}):t(M,{children:[t(dc,{isLoggedIn:e,loading:s==="loading"}),t(uc,{isLoggedIn:e}),s==="default"&&t(un,{children:t(yt,{path:"/:instance?/s/:id",element:t(Zr,{})})}),e&&t(Ii,{}),e&&t(io,{}),t(ms,{children:t(cc,{})}),e&&t($i,{}),t(ki,{isLoggedIn:e}),s!=="loading"&&t(xi,{onClose:Qn}),t(Ti,{})]})}function dc({isLoggedIn:e,loading:n}){const s=He(),i=gt(()=>{const{pathname:o}=s;return!/^\/(login|welcome)/i.test(o)},[s]);return t(un,{location:i||s,children:[t(yt,{path:"/",element:e?t(Ir,{}):n?t(At,{id:"loader-root"}):t(Jn,{})}),t(yt,{path:"/login",element:t(Ur,{})}),t(yt,{path:"/welcome",element:t(Jn,{})})]})}function ts(){return $.prevLocation||null}function uc({isLoggedIn:e}){const n=He(),s=O(ts());return gt(()=>Te("/:instance/s/:id",n.pathname)||Te("/s/:id",n.pathname),[n.pathname,Te])?s.current||(s.current=ts()):s.current=null,t(un,{location:s.current||n,children:[e&&t(M,{children:[t(yt,{path:"/notifications",element:t(Ns,{})}),t(yt,{path:"/mentions",element:t(Rs,{})}),t(yt,{path:"/following",element:t(yn,{})}),t(yt,{path:"/b",element:t(xs,{})}),t(yt,{path:"/f",element:t(As,{})}),t(yt,{path:"/l",children:[t(yt,{index:!0,element:t(xr,{})}),t(yt,{path:":id",element:t(Es,{})})]}),t(yt,{path:"/ft",element:t(Yo,{})}),t(yt,{path:"/catchup",element:t(ms,{children:t(rc,{})})})]}),t(yt,{path:"/:instance?/t/:hashtag",element:t(Ms,{})}),t(yt,{path:"/:instance?/a/:id",element:t(Ho,{})}),t(yt,{path:"/:instance?/p",children:[t(yt,{index:!0,element:t(cn,{})}),t(yt,{path:"l",element:t(cn,{local:!0})})]}),t(yt,{path:"/:instance?/trending",element:t(Os,{})}),t(yt,{path:"/:instance?/search",element:t(Ds,{})})]})}"AbortSignal"in window&&(AbortSignal.timeout=AbortSignal.timeout||(e=>{const n=new AbortController;return setTimeout(()=>n.abort(),e),n.signal}));vi(t(bi,{children:t(lc,{})}),document.getElementById("app"));setTimeout(()=>{try{Object.keys(localStorage).forEach(e=>{e.startsWith("iconify")&&localStorage.removeItem(e)}),Object.keys(sessionStorage).forEach(e=>{e.startsWith("iconify")&&sessionStorage.removeItem(e)}),localStorage.removeItem("settings:boostsCarousel")}catch{}},5e3);window.__CLOAK__=()=>{document.body.classList.toggle("cloak")};export{uo as A,ne as I,Br as M,xe as N,gc as S,Eo as a,zi as b,bc as c,vc as d,wc as e,$s as f,Qn as g,Sn as i,Fs as l,Us as o,Ps as r,Is as u};
//# sourceMappingURL=main-Vzj9HD3z.js.map
