import{a as z,s as v,b as Se,u as dn,o as Hn,I as w,M as ue,c as K,A as je,N as bt,d as _e,L as j,g as et,e as un,l as Vn,t as Ht,R as _t,f as jn,p as yt,h as Fe,i as hn,j as Rt,E as fn,k as Ne,n as qe,m as Gn,q as ce,r as be,v as Vt,T as pn,w as tt,x as mn,y as jt,z as Wn,B as Ce,C as Kn,S as ve,D as Jn,F as Yn,G as gn,H as bn,J as Ut,K as Ie,O as yn,P as Xn,Q as Zn,U as Qn,V as rt,W as es,X as Gt,Y as ts,Z as Wt,_ as Kt}from"./useTitle-b0a63e54.js";import{_ as P,p as _,x as We,h as C,u as ke,o as e,a as ae,k as x,s as kt,M as Ke,b as J,c as De,d as St,F as he,T as Ge,S as ns,I as it,y as ze,g as ss,l as Jt,e as is,f as wn,i as os,j as Be,A as cs,m as as,J as ls,C as vn,n as kn,q as Sn,r as Je,t as rs,v as ds,w as st,z as us,B as Yt,D as hs,E as fs,R as Ct,G as ge,H as ps,K as ms}from"./vendor-208a469f.js";function wt(t=()=>{},n=[]){const r=P(t);_(()=>{r.current=t},[n]),_(()=>{const o=()=>{const i=document.hidden||document.visibilityState==="hidden";r.current(!i)};return document.addEventListener("visibilitychange",o),()=>document.removeEventListener("visibilitychange",o)},[])}const gs=We(function({isLoggedIn:n}){const[r,o]=C(!0);wt(o),_(()=>{let l;if(n&&r){const{masto:d,streaming:p,instance:u}=z();(async()=>{var c;if(v.notificationsLast){const f=d.v1.notifications.list({limit:1,since_id:v.notificationsLast.id}),{value:m}=await f.next();if(m!=null&&m.length){let a;try{const h=await d.v1.markers.fetch({timeline:"notifications"});a=(c=h==null?void 0:h.notifications)==null?void 0:c.lastReadId}catch{}a?m[0].id!==a&&(v.notificationsShowNew=!0):v.notificationsShowNew=!0}}if(p){l=p.user.notification.subscribe();for await(const f of l){if(!l)break;f.event==="notification"&&Se(f.payload,u,{skipThreading:!0}),v.notificationsShowNew=!0}}})()}return()=>{var d;(d=l==null?void 0:l.unsubscribe)==null||d.call(l),l=null}},[r,n]);const i=P(),s=()=>{i.current=Date.now(),fetch("./version.json").then(l=>l.json()).then(l=>{l&&(v.appVersion=l)}).catch(l=>{})};return dn(s,r&&1e3*60*30),wt(l=>{l&&(i.current?Date.now()-i.current>1e3*60*60&&s():s())}),null});function bs(){function t(n){n.shiftKey?Hn()||(alert("Looks like your browser is blocking popups."),v.showCompose=!0):v.showCompose=!0}return ke("c, shift+c",t,{ignoreEventWhen:n=>!!document.querySelector("#modal-container > *")}),e("button",{type:"button",id:"compose-button",onClick:t,children:e(w,{icon:"quill",size:"xl",alt:"Compose"})})}const ys=We(function(){const n=ae(v);function r(){v.showKeyboardShortcutsHelp=!1}ke("?, shift+?",i=>{v.showKeyboardShortcutsHelp=!0},{ignoreEventWhen:i=>!!document.querySelector("#modal-container > *")});const o=ke("esc",r,[]);return!!n.showKeyboardShortcutsHelp&&e(ue,{class:"light",onClick:i=>{i.target===i.currentTarget&&r()},children:e("div",{id:"keyboard-shortcuts-help-container",class:"sheet",tabindex:"-1",ref:o,children:[e("button",{type:"button",class:"sheet-close",onClick:r,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Keyboard shortcuts"})}),e("main",{children:e("table",{children:[{action:"Keyboard shortcuts help",keys:e("kbd",{children:"?"})},{action:"Next post",keys:e("kbd",{children:"j"})},{action:"Previous post",keys:e("kbd",{children:"k"})},{action:"Skip carousel to next post",keys:e(x,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"j"})]})},{action:"Skip carousel to previous post",keys:e(x,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"k"})]})},{action:"Open post details",keys:e(x,{children:[e("kbd",{children:"Enter"})," or ",e("kbd",{children:"o"})]})},{action:"Toggle expanded/collapsed thread",keys:e("kbd",{children:"x"})},{action:"Close post or dialogs",keys:e(x,{children:[e("kbd",{children:"Esc"})," or ",e("kbd",{children:"Backspace"})]})},{action:"Focus column in multi-column mode",keys:e(x,{children:[e("kbd",{children:"1"})," to ",e("kbd",{children:"9"})]})},{action:"Compose new post",keys:e("kbd",{children:"c"})},{action:"Send post",keys:e(x,{children:[e("kbd",{children:"Ctrl"})," + ",e("kbd",{children:"Enter"})," or ",e("kbd",{children:"⌘"})," +"," ",e("kbd",{children:"Enter"})]})},{action:"Search",keys:e("kbd",{children:"/"})},{action:"Reply",keys:e("kbd",{children:"r"})},{action:"Favourite",keys:e("kbd",{children:"f"})},{action:"Boost",keys:e(x,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"b"})]})},{action:"Bookmark",keys:e("kbd",{children:"d"})}].map(({action:i,keys:s})=>e("tr",{children:[e("th",{children:i}),e("td",{children:s})]},i))})})]})})});function ws({onClose:t}){const{masto:n}=z(),r=K.local.getJSON("accounts"),o=K.session.get("currentAccount"),i=r.length>1,[s,l]=C(0),[d,p]=kt(u=>u+1,0);return e("div",{id:"accounts-container",class:"sheet",tabIndex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{class:"header-grid",children:e("h2",{children:"Accounts"})}),e("main",{children:e("section",{children:[e("ul",{class:"accounts-list",children:r.map((u,c)=>{const f=u.info.id===o,m=c===(s||0);return e("li",{children:[e("div",{children:[i&&e("span",{class:`current ${f?"is-current":""}`,children:e(w,{icon:"check-circle",alt:"Current"})}),e(je,{url:u.info.avatarStatic,size:"xxl",onDblClick:async()=>{if(f)try{const a=await n.v1.accounts.$select(u.info.id).fetch();u.info=a,K.local.setJSON("accounts",r),p()}catch{}}}),e(bt,{account:i?{...u.info,acct:/@/.test(u.info.acct)?u.info.acct:`${u.info.acct}@${u.instanceURL}`}:u.info,showAcct:!0,onClick:()=>{f?v.showAccount=`${u.info.username}@${u.instanceURL}`:(K.session.set("currentAccount",u.info.id),location.reload())}})]}),e("div",{class:"actions",children:[m&&i&&e(x,{children:[e("span",{class:"tag",children:"Default"})," "]}),e(Ke,{align:"end",menuButton:e("button",{type:"button",title:"More",class:"plain more-button",children:e(w,{icon:"more",size:"l",alt:"More"})}),children:[e(J,{onClick:()=>{v.showAccount=`${u.info.username}@${u.instanceURL}`},children:[e(w,{icon:"user"}),e("span",{children:"View profile…"})]}),e(De,{}),i&&e(J,{disabled:m,onClick:()=>{r.splice(c,1),r.unshift(u),K.local.setJSON("accounts",r),l(c)},children:[e(w,{icon:"check-circle"}),e("span",{children:"Set as default"})]}),e(_e,{subMenu:!0,confirmLabel:e(x,{children:[e(w,{icon:"exit"}),e("span",{children:["Log out @",u.info.acct,"?"]})]}),disabled:!f,menuItemClassName:"danger",onClick:()=>{r.splice(c,1),K.local.setJSON("accounts",r),location.href=location.pathname||"/"},children:[e(w,{icon:"exit"}),e("span",{children:"Log out…"})]})]})]})]},c+u.id)})}),e("p",{children:e(j,{to:"/login",class:"button plain2",onClick:t,children:[e(w,{icon:"plus"})," ",e("span",{children:"Add an existing account"})]})}),i&&e("p",{children:e("small",{children:["Note: ",e("i",{children:"Default"})," account will always be used for first load. Switched accounts will persist during the session."]})})]})})]})}const In=""+new URL("logo-f0531a6b.svg",import.meta.url).href;function Xt(t){const{masto:n}=z();return n.v1.push.subscription.create(t)}function vs(){const{masto:t}=z();return t.v1.push.subscription.fetch()}function ks(t){const{masto:n}=z();return n.v1.push.subscription.update(t)}function Ss(){const{masto:t}=z();return t.v1.push.subscription.remove()}function It(){return"serviceWorker"in navigator&&"PushManager"in window}function Tn(){return navigator.serviceWorker.getRegistration()}async function Ft(){const t=await Tn(),n=t?await t.pushManager.getSubscription():void 0;return{registration:t,subscription:n}}function Cn(t){const n="=".repeat((4-t.length%4)%4),r=`${t}${n}`.replace(/-/g,"+").replace(/_/g,"/"),o=window.atob(r),i=new Uint8Array(o.length);for(let s=0;s<o.length;++s)i[s]=o.charCodeAt(s);return i}async function Is(){if(!It())return;const{subscription:t}=await Ft();let n=null;try{n=await vs()}catch(r){if(!/(not found|unknown)/i.test(r.message))throw r}if(n&&t){const r=n.endpoint===t.endpoint,{vapidKey:o}=et(),i=n.serverKey===o;if(!r)throw new Error("Backend subscription endpoint changed");if(!i)throw new Error("Backend subscription key and vapid key changed")}if(t&&!n){const{vapidKey:r}=et(),{applicationServerKey:o}=t.options,i=Cn(r).toString(),s=new Uint8Array(o).toString();if(!(i===s))throw await t.unsubscribe(),new Error("Subscription key and vapid key changed")}return{subscription:t,backendSubscription:n}}async function Zt({data:t,policy:n}){if(!It())return;let{registration:r,subscription:o}=await Ft(),i=null;if(o)try{i=await ks({data:t,policy:n})}catch{i=await Xt({subscription:o,data:t,policy:n})}else{const{vapidKey:s}=et();if(!s)throw new Error("No server key found");o=await r.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:Cn(s)}),i=await Xt({subscription:o,data:t,policy:n})}return{subscription:o,backendSubscription:i}}async function Qt(){if(!It())return;const{subscription:t}=await Ft();t&&(await Ss(),await t.unsubscribe())}const en=16,Ve=[16,17,18,19,20];function Ts({onClose:t}){const n=ae(v),r=K.local.get("theme")||"auto",o=P(),i=n.settings.contentTranslationTargetLanguage||null,s=un(),l=Vn(s),d=K.local.get("textSize")||en,[p,u]=C(K.account.get("preferences")||{}),{masto:c,authenticated:f,instance:m}=z();return e("div",{id:"settings-container",class:"sheet",tabIndex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Settings"})}),e("main",{children:[e("section",{children:e("ul",{children:[e("li",{children:[e("div",{children:e("label",{children:"Appearance"})}),e("div",{children:e("form",{ref:o,onInput:a=>{a.preventDefault();const g=new FormData(o.current).get("theme"),y=document.documentElement;g==="auto"?y.classList.remove("is-light","is-dark"):(y.classList.toggle("is-light",g==="light"),y.classList.toggle("is-dark",g==="dark")),document.querySelector('meta[name="color-scheme"]').setAttribute("content",g==="auto"?"dark light":g),g==="auto"?K.local.del("theme"):K.local.set("theme",g)},children:e("div",{class:"radio-group",children:[e("label",{children:[e("input",{type:"radio",name:"theme",value:"light",defaultChecked:r==="light"}),e("span",{children:"Light"})]}),e("label",{children:[e("input",{type:"radio",name:"theme",value:"dark",defaultChecked:r==="dark"}),e("span",{children:"Dark"})]}),e("label",{children:[e("input",{type:"radio",name:"theme",value:"auto",defaultChecked:r!=="light"&&r!=="dark"}),e("span",{children:"Auto"})]})]})})})]}),e("li",{children:[e("div",{children:e("label",{children:"Text size"})}),e("div",{class:"range-group",children:[e("span",{style:{fontSize:Ve[0]},children:"A"})," ",e("input",{type:"range",min:Ve[0],max:Ve[Ve.length-1],step:"1",value:d,list:"sizes",onChange:a=>{const h=parseInt(a.target.value,10);document.documentElement.style.setProperty("--text-size",`${h}px`),h===en?K.local.del("textSize"):K.local.set("textSize",a.target.value)}})," ",e("span",{style:{fontSize:Ve[Ve.length-1]},children:"A"}),e("datalist",{id:"sizes",children:Ve.map(a=>e("option",{value:a}))})]})]})]})}),f&&e(x,{children:[e("h3",{children:"Posting"}),e("section",{children:e("ul",{children:e("li",{children:[e("div",{children:e("label",{for:"posting-privacy-field",children:["Default visibility"," ",e(w,{icon:"cloud",alt:"Synced",class:"synced-icon"})]})}),e("div",{children:e("select",{id:"posting-privacy-field",value:p["posting:default:visibility"]||"public",onChange:a=>{const{value:h}=a.target;(async()=>{try{await c.v1.accounts.updateCredentials({source:{privacy:h}}),u({...p,"posting:default:visibility":h}),K.account.set("preferences",{...p,"posting:default:visibility":h})}catch{alert("Failed to update posting privacy")}})()},children:[e("option",{value:"public",children:"Public"}),e("option",{value:"unlisted",children:"Unlisted"}),e("option",{value:"private",children:"Followers only"})]})})]})})}),e("p",{class:"section-postnote",children:[e(w,{icon:"cloud",alt:"Synced",class:"synced-icon"})," ",e("small",{children:["Synced to your instance server's settings."," ",e("a",{href:`https://${m}/`,target:"_blank",rel:"noopener noreferrer",children:["Go to your instance (",m,") for more settings."]})]})]})]}),e("h3",{children:"Experiments"}),e("section",{children:e("ul",{children:[e("li",{children:e("label",{children:[e("input",{type:"checkbox",checked:n.settings.autoRefresh,onChange:a=>{v.settings.autoRefresh=a.target.checked}})," ","Auto refresh timeline posts"]})}),e("li",{children:e("label",{children:[e("input",{type:"checkbox",checked:n.settings.boostsCarousel,onChange:a=>{v.settings.boostsCarousel=a.target.checked}})," ","Boosts carousel"]})}),e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslation,onChange:a=>{const{checked:h}=a.target;v.settings.contentTranslation=h,h||(v.settings.contentTranslationTargetLanguage=null)}})," ","Post translation"]}),e("div",{class:`sub-section ${n.settings.contentTranslation?"":"more-insignificant"}`,children:[e("div",{children:e("label",{children:["Translate to"," ",e("select",{value:i||"",disabled:!n.settings.contentTranslation,onChange:a=>{v.settings.contentTranslationTargetLanguage=a.target.value||null},children:[e("option",{value:"",children:["System language (",l,")"]}),e("option",{disabled:!0,children:"──────────"}),Ht.map(a=>e("option",{value:a.code,children:a.name}))]})]})}),e("hr",{}),e("p",{class:"checkbox-fieldset",children:['Hide "Translate" button for',n.settings.contentTranslationHideLanguages.length>0&&e(x,{children:[" ","(",n.settings.contentTranslationHideLanguages.length,")"]}),":",e("div",{class:"checkbox-fields",children:Ht.map(a=>e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslationHideLanguages.includes(a.code),onChange:h=>{const{checked:g}=h.target;g?v.settings.contentTranslationHideLanguages.push(a.code):v.settings.contentTranslationHideLanguages=n.settings.contentTranslationHideLanguages.filter(y=>y!==a.code)}})," ",a.name]}))})]}),e("p",{class:"insignificant",children:e("small",{children:["Note: This feature uses an external API to translate, powered by"," ",e("a",{href:"https://github.com/thedaviddelta/lingva-translate",target:"_blank",rel:"noopener noreferrer",children:"Lingva Translate"}),"."]})}),e("hr",{}),e("div",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslationAutoInline,disabled:!n.settings.contentTranslation,onChange:a=>{v.settings.contentTranslationAutoInline=a.target.checked}})," ","Auto inline translation"]}),e("p",{class:"insignificant",children:e("small",{children:["Automatically show translation for posts in timeline. Only works for ",e("b",{children:"short"})," posts without content warning, media and poll."]})})]})]})]}),e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.cloakMode,onChange:a=>{v.settings.cloakMode=a.target.checked}})," ","Cloak mode"," ",e("span",{class:"insignificant",children:["(",e("samp",{children:"Text"})," → ",e("samp",{children:"████"}),")"]})]}),e("div",{class:"sub-section insignificant",children:e("small",{children:"Replace text as blocks, useful when taking screenshots, for privacy reasons."})})]}),f&&e("li",{children:e("button",{type:"button",class:"light",onClick:()=>{v.showDrafts=!0,v.showSettings=!1},children:"Unsent drafts"})})]})}),f&&e(Cs,{onClose:t}),e("h3",{children:"About"}),e("section",{children:[e("div",{style:{display:"flex",gap:8,lineHeight:1.25,alignItems:"center",marginTop:8},children:[e("img",{src:In,alt:"",width:"64",height:"64",style:{aspectRatio:"1/1",verticalAlign:"middle",background:"#b7cdf9",borderRadius:12}}),e("div",{children:[e("b",{children:"Phanpy"})," ",e("a",{href:"https://hachyderm.io/@phanpy",rel:"noopener noreferrer",onClick:a=>{a.preventDefault(),v.showAccount="phanpy@hachyderm.io"},children:"@phanpy"}),e("br",{}),e("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",rel:"noopener noreferrer",children:"Built"})," ","by"," ",e("a",{href:"https://mastodon.social/@cheeaun",rel:"noopener noreferrer",onClick:a=>{a.preventDefault(),v.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"})]})]}),e("p",{children:[e("a",{href:"https://github.com/sponsors/cheeaun",target:"_blank",rel:"noopener noreferrer",children:"Sponsor"})," ","·"," ",e("a",{href:"https://www.buymeacoffee.com/cheeaun",target:"_blank",rel:"noopener noreferrer",children:"Donate"})," ","·"," ",e("a",{href:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",target:"_blank",rel:"noopener noreferrer",children:"Privacy Policy"})]}),e("p",{children:[e("span",{class:"insignificant",children:"Last build:"})," ",e(_t,{datetime:new Date("2023-10-20T02:34:50.564Z")})," ",e(x,{children:["(",e("a",{href:"https://github.com/cheeaun/phanpy/commit/12d0e6a",target:"_blank",rel:"noopener noreferrer",children:e("code",{children:"12d0e6a"})}),")"]})]})]})]})]})}function Cs({onClose:t}){if(!It())return null;const{instance:n}=z(),[r,o]=C("default"),i=P(),[s,l]=C(!1),[d,p]=C(!1),u=P();_(()=>{(async()=>{o("loading");try{const{subscription:f,backendSubscription:m}=await Is();if(m!=null&&m.policy&&m.policy!=="none"){l(!0);const{alerts:a,policy:h}=m;u.current=h;const{elements:g}=i.current,y=g.namedItem(h);y&&(y.value=h),Object.keys(a).forEach(b=>{const S=g.namedItem(b);(S==null?void 0:S.type)==="checkbox"&&(S.checked=!0)})}o("default")}catch(f){/outside.*authorized/i.test(f.message)?p(!0):alert((f==null?void 0:f.message)||f),o("error")}})()},[]);const c=r==="loading";return e("form",{ref:i,onChange:()=>{const f=Object.fromEntries(new FormData(i.current)),m=!!f["policy-allow"],a={policy:f.policy,data:{alerts:{mention:!!f.mention,favourite:!!f.favourite,reblog:!!f.reblog,follow:!!f.follow,follow_request:!!f.followRequest,poll:!!f.poll,update:!!f.update,status:!!f.status}}};let h=0;Object.keys(a.data.alerts).forEach(y=>{a.data.alerts[y]?h++:delete a.data.alerts[y]});const g=u.current!==a.policy;m&&h>0?g?Qt().then(()=>{Zt(a)}).catch(y=>{alert("Failed to update subscription. Please try again.")}):Zt(a).catch(y=>{alert("Failed to update subscription. Please try again.")}):Qt().catch(y=>{alert("Failed to remove subscription. Please try again.")})},children:[e("h3",{children:"Push Notifications (beta)"}),e("section",{children:e("ul",{children:e("li",{children:[e("label",{children:[e("input",{type:"checkbox",disabled:c||d,name:"policy-allow",checked:s,onChange:async f=>{const{checked:m}=f.target;if(m){const a=await Notification.requestPermission();a==="granted"?l(!0):(l(!1),a==="denied"&&alert("Push notifications are blocked. Please enable them in your browser settings."))}else l(!1)}})," ","Allow from"," ",e("select",{name:"policy",disabled:c||d||!s,children:[{value:"all",label:"anyone"},{value:"followed",label:"people I follow"},{value:"follower",label:"followers"}].map(f=>e("option",{value:f.value,children:f.label}))})]}),e("div",{class:"shazam-container no-animation",style:{width:"100%"},hidden:!s,children:e("div",{class:"shazam-container-inner",children:e("div",{class:"sub-section",children:e("ul",{children:[{value:"mention",label:"Mentions"},{value:"favourite",label:"Favourites"},{value:"reblog",label:"Boosts"},{value:"follow",label:"Follows"},{value:"followRequest",label:"Follow requests"},{value:"poll",label:"Polls"},{value:"update",label:"Post edits"},{value:"status",label:"New posts"}].map(f=>e("li",{children:e("label",{children:[e("input",{type:"checkbox",name:f.value})," ",f.label]})}))})})})}),d&&e("div",{class:"sub-section",children:e("p",{children:["Push permission was not granted since your last login. You'll need to"," ",e(j,{to:`/login?instance=${n}`,onClick:t,children:[e("b",{children:"log in"})," again to grant push permission"]}),"."]})})]})})}),e("p",{class:"section-postnote",children:e("small",{children:["NOTE: Push notifications only work for ",e("b",{children:"one account"}),"."]})})]})}const Lt=()=>{let t=setTimeout(()=>{if(!document.getElementById("columns")){const r=document.querySelectorAll("#modal-container > *");if(r!=null&&r.length){const l=r[r.length-1],d=l.querySelector('[tabindex="-1"]')||l;if(d){d.focus();return}}if(document.querySelector(".deck-backdrop"))return;const i=document.querySelectorAll(".deck-container"),s=i[i.length-1];s&&s.tabIndex===-1&&s.focus()}},100);return()=>clearTimeout(t)};function xn(t){if(!t)return;const n=St(),r=P(n.pathname);_(()=>{r.current&&n.pathname!==r.current&&(t==null||t())},[n.pathname,t])}function zt({list:t,onClose:n}){const{masto:r}=z(),[o,i]=C("default"),s=!!t,l=P(),d=P(),p=P();_(()=>{s&&(l.current.value=t.title,d.current.value=t.repliesPolicy,p.current&&(p.current.checked=t.exclusive))},[s]);const u=jn("@mastodon/list-exclusive");return e("div",{class:"sheet",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})})," ",e("header",{children:e("h2",{children:s?"Edit list":"New list"})}),e("main",{children:e("form",{class:"list-form",onSubmit:c=>{c.preventDefault();const f=new FormData(c.target),m=f.get("title"),a=f.get("replies_policy"),h=f.get("exclusive")==="on";i("loading"),(async()=>{try{let g;s?g=await r.v1.lists.$select(t.id).update({title:m,replies_policy:a,exclusive:h}):g=await r.v1.lists.create({title:m,replies_policy:a,exclusive:h}),i("default"),n==null||n({state:"success",list:g})}catch{i("error"),alert(s?"Unable to edit list.":"Unable to create list.")}})()},children:[e("div",{class:"list-form-row",children:e("label",{for:"list-title",children:["Name"," ",e("input",{ref:l,type:"text",id:"list-title",name:"title",required:!0,disabled:o==="loading",dir:"auto"})]})}),e("div",{class:"list-form-row",children:e("select",{ref:d,name:"replies_policy",required:!0,disabled:o==="loading",children:[e("option",{value:"list",children:"Show replies to list members"}),e("option",{value:"followed",children:"Show replies to people I follow"}),e("option",{value:"none",children:"Don't show replies"})]})}),u&&e("div",{class:"list-form-row",children:e("label",{class:"label-block",children:[e("input",{ref:p,type:"checkbox",name:"exclusive",disabled:o==="loading"})," ","Hide posts on this list from Home/Following"]})}),e("div",{class:"list-form-footer",children:[e("button",{type:"submit",disabled:o==="loading",children:s?"Save":"Create"}),s&&e(_e,{disabled:o==="loading",align:"end",menuItemClassName:"danger",confirmLabel:"Delete this list?",onClick:()=>{i("loading"),(async()=>{try{await r.v1.lists.$select(t.id).remove(),i("default"),n==null||n({state:"deleted"})}catch{i("error"),alert("Unable to delete list.")}})()},children:e("button",{type:"button",class:"light danger",disabled:o==="loading",children:"Delete…"})})]})]})})]})}const xs=[1e3*60*5,1e3*60*30,1e3*60*60,1e3*60*60*6,1e3*60*60*24,1e3*60*60*24*3,1e3*60*60*24*7,0],tn={0:"Forever",3e5:"5 minutes",18e5:"30 minutes",36e5:"1 hour",216e5:"6 hours",864e5:"1 day",2592e5:"3 days",6048e5:"1 week"},nn=80,$n=1e3*60*10;function $s(t,n){return n.v1.accounts.familiarFollowers.fetch({id:[t]})}const Rs=yt($s,{maxAge:$n});async function Ls(t,n){const r=n.v1.accounts.$select(t).statuses.list({limit:20}).next(),{value:o}=await r,i={total:o.length,originals:0,replies:0,boosts:0};return o.forEach(s=>{s.reblog?i.boosts++:s.inReplyToId&&s.inReplyToAccountId!==s.account.id?i.replies++:i.originals++}),o.length&&(i.daysSinceLastPost=Math.ceil((Date.now()-new Date(o[o.length-1].createdAt))/864e5)),i}const As=yt(Ls,{maxAge:$n});function Rn({account:t,fetchAccount:n=()=>{},standalone:r,instance:o,authenticated:i}){const{masto:s}=z({instance:o}),{masto:l}=z(),[d,p]=C("default"),u=typeof t=="string",[c,f]=C(u?null:t),m=he(()=>t.id===K.session.get("currentAccount"),[t==null?void 0:t.id]),a=he(()=>o===z().instance,[o]);_(()=>{if(!u){f(t);return}p("loading"),(async()=>{try{const U=await n();v.accounts[`${U.id}@${o}`]=U,f(U),p("default")}catch{f(null),p("error")}})()},[u,t,n]);const{acct:h,avatar:g,avatarStatic:y,bot:b,createdAt:S,displayName:k,emojis:T,fields:R,followersCount:F,followingCount:A,group:M,id:B,lastStatusAt:O,locked:$,note:E,statusesCount:ee,url:G,username:xe,memorial:we,moved:ye,roles:se}=c||{};let Le=!1,{header:D,headerStatic:Y}=c||{};(!D||/missing\.png$/.test(D))&&g&&!/missing\.png$/.test(g)&&(D=g,Le=!0,y&&!/missing\.png$/.test(y)&&(Y=y));const ie=he(()=>G?new URL(G).hostname:null,[G]),[fe,Ae]=C([]),$e=P(),H=P([]);async function X(U){(U||!$e.current)&&($e.current=s.v1.accounts.$select(B).followers.list({limit:nn}));const oe=await $e.current.next();if(m||!a)return oe;const{value:pe}=oe;let me=[];if(U){const Pe=await s.v1.accounts.familiarFollowers.fetch({id:[B]});H.current=Pe[0].accounts,me=[...H.current,...pe.filter(Ue=>!H.current.some(Me=>Me.id===Ue.id))]}else pe!=null&&pe.length&&(me=pe.filter(Pe=>!H.current.some(Ue=>Ue.id===Pe.id)));return{...oe,value:me}}const W=P();async function ne(U){return(U||!W.current)&&(W.current=s.v1.accounts.$select(B).following.list({limit:nn})),await W.current.next()}const te=r?"div":j,I=o?`/${o}/a/${B}`:`/a/${B}`,[L,V]=C([]),[N,Z]=C(),[Te,Q]=C("default"),le=!!(N!=null&&N.total),Re=async U=>{try{const oe=await Rs(U,l);V(oe[0].accounts.slice(0,Ms))}catch{}},re=async()=>{if(B){Q("loading");try{const U=await As(B,s);Z(U),Q("default")}catch{Q("error")}}},Ee=Ge(({relationship:U,currentID:oe})=>{U.following||(Re(oe),r||re())},[r,B]);return e("div",{class:`account-container  ${d==="loading"?"skeleton":""}`,style:{"--header-color-1":fe[0],"--header-color-2":fe[1],"--header-color-3":fe[2],"--header-color-4":fe[3]},children:[d==="error"&&e("div",{class:"ui-state",children:[e("p",{children:"Unable to load account."}),e("p",{children:e("a",{href:u?t:G,target:"_blank",rel:"noopener noreferrer",children:["Go to account page ",e(w,{icon:"external"})]})})]}),d==="loading"?e(x,{children:[e("header",{children:e(Fe,{avatarSize:"xxxl",skeleton:!0})}),e("main",{children:[e("div",{class:"note",children:[e("p",{children:"████████ ███████"}),e("p",{children:"███████████████ ███████████████"})]}),e("div",{class:"stats",children:[e("div",{children:[e("span",{children:"██"})," Followers"]}),e("div",{children:[e("span",{children:"██"})," Following"]}),e("div",{children:[e("span",{children:"██"})," Posts"]}),e("div",{children:"Joined ██"})]})]})]}):c&&e(x,{children:[!!ye&&e("div",{class:"account-moved",children:[e("p",{children:[e("b",{children:k})," has indicated that their new account is now:"]}),e(Fe,{account:ye,instance:o,onClick:U=>{U.stopPropagation(),v.showAccount=ye}})]}),D&&!/missing\.png$/.test(D)&&e("img",{src:D,alt:"",class:`header-banner ${Le?"header-is-avatar":""}`,onError:U=>{U.target.crossOrigin?U.target.src!==Y?U.target.src=Y:(U.target.removeAttribute("crossorigin"),U.target.src=D):U.target.src!==Y?U.target.src=Y:U.target.remove()},crossOrigin:"anonymous",onLoad:U=>{U.target.classList.add("loaded");try{const oe=document.createElement("canvas"),pe=oe.getContext("2d",{willReadFrequently:!0});oe.width=U.target.width,oe.height=U.target.height,pe.drawImage(U.target,0,0);const me=10,Ue=[pe.getImageData(0,0,me,me).data,pe.getImageData(U.target.width-me,0,me,me).data,pe.getImageData(0,U.target.height-me,me,me).data,pe.getImageData(U.target.width-me,U.target.height-me,me,me).data].map(Me=>{let q=0,de=0,Ye=0,at=0;for(let Xe=0;Xe<Me.length;Xe+=4)q+=Me[Xe],de+=Me[Xe+1],Ye+=Me[Xe+2],at+=Me[Xe+3];const lt=Me.length/4;return[q/lt,de/lt,Ye/lt,at/lt]}).map(Me=>{const[q,de,Ye,at]=Es(Me);return`rgba(${q}, ${de}, ${Ye}, ${at})`});Ae(Ue)}catch{}}}),e("header",{children:e(Fe,{account:c,instance:o,avatarSize:"xxxl",external:r,internal:!r})}),e("main",{tabIndex:"-1",children:[!!we&&e("span",{class:"tag",children:"In Memoriam"}),!!b&&e("span",{class:"tag",children:[e(w,{icon:"bot"})," Automated"]}),!!M&&e("span",{class:"tag",children:[e(w,{icon:"group"})," Group"]}),se==null?void 0:se.map(U=>e("span",{class:"tag",children:[U.name,!!ie&&e(x,{children:[" ",e("span",{class:"more-insignificant",children:ie})]})]})),e("div",{class:"note",dir:"auto",onClick:hn({instance:o}),dangerouslySetInnerHTML:{__html:Rt(E,{emojis:T})}}),e("div",{class:"account-metadata-box",children:[(R==null?void 0:R.length)>0&&e("div",{class:"profile-metadata",children:R.map(({name:U,value:oe,verifiedAt:pe},me)=>e("div",{class:`profile-field ${pe?"profile-verified":""}`,dir:"auto",children:[e("b",{children:[e(fn,{text:U,emojis:T})," ",!!pe&&e(w,{icon:"check-circle",size:"s"})]}),e("p",{dangerouslySetInnerHTML:{__html:Rt(oe,{emojis:T})}})]},U+me))}),e("div",{class:"stats",children:[e(te,{tabIndex:0,to:I,onClick:()=>{setTimeout(()=>{v.showGenericAccounts={heading:"Followers",fetchAccounts:X}},0)},children:[!!L.length&&e("span",{class:"shazam-container-horizontal",children:e("span",{class:"shazam-container-inner stats-avatars-bunch",children:L.map(U=>e(je,{url:U.avatarStatic,size:"s",alt:`${U.displayName} @${U.acct}`,squircle:U==null?void 0:U.bot}))})}),e("span",{title:F,children:Ne(F)})," ","Followers"]}),e(te,{class:"insignificant",tabIndex:0,to:I,onClick:()=>{setTimeout(()=>{v.showGenericAccounts={heading:"Following",fetchAccounts:ne}},0)},children:[e("span",{title:A,children:Ne(A)})," ","Following",e("br",{})]}),e(te,{class:"insignificant",to:I,children:[e("span",{title:ee,children:Ne(ee)})," ","Posts"]}),!!S&&e("div",{class:"insignificant",children:["Joined"," ",e("time",{datetime:S,children:qe(S,{hideTime:!0})})]})]})]}),!!N&&e(te,{to:I,class:"account-metadata-box",children:e("div",{class:"shazam-container",children:e("div",{class:"shazam-container-inner",children:le?e("div",{class:"posting-stats",title:`${Math.round(N.originals/N.total*100)}% original posts, ${Math.round(N.replies/N.total*100)}% replies, ${Math.round(N.boosts/N.total*100)}% boosts`,children:[e("div",{children:N.daysSinceLastPost<365?`Last ${N.total} post${N.total>1?"s":""} in the past 
                      ${N.daysSinceLastPost} day${N.daysSinceLastPost>1?"s":""}`:`
                      Last ${N.total} posts in the past year(s)
                      `}),e("div",{class:"posting-stats-bar",style:{"--originals-percentage":`${N.originals/N.total*100}%`,"--replies-percentage":`${(N.originals+N.replies)/N.total*100}%`}}),e("div",{class:"posting-stats-legends",children:[e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-originals"})," ","Original"]})," ",e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-replies"})," ","Replies"]})," ",e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-boosts"})," ","Boosts"]})]})]}):e("div",{class:"posting-stats",children:"Post stats unavailable."})})})}),e("div",{class:"account-metadata-box",children:e("div",{class:"shazam-container no-animation",hidden:!!N,children:e("div",{class:"shazam-container-inner",children:e("button",{type:"button",class:"posting-stats-button",disabled:Te==="loading",onClick:()=>{re()},children:[e("div",{class:`posting-stats-bar posting-stats-icon ${Te==="loading"?"loading":""}`,style:{"--originals-percentage":"33%","--replies-percentage":"66%"}}),"View post stats"," "]})})})}),e(Ds,{info:c,instance:o,authenticated:i,onRelationshipChange:Ee})]})]})]})}const Ms=3;function Ds({info:t,instance:n,authenticated:r,onRelationshipChange:o=()=>{}}){var te;if(!t)return null;const{masto:i,instance:s,authenticated:l}=z(),d=n===s,[p,u]=C("default"),[c,f]=C(null),{id:m,acct:a,url:h,username:g,locked:y,lastStatusAt:b,note:S,fields:k,moved:T}=t,R=P(m),{following:F,showingReblogs:A,notifying:M,followedBy:B,blocking:O,blockedBy:$,muting:E,mutingNotifications:ee,requested:G,domainBlocking:xe,endorsed:we,note:ye}=c||{},[se,Le]=C(null),[D,Y]=C(!1);_(()=>{if(t){const I=K.session.get("currentAccount");let L;(async()=>{if(d&&r)L=m;else if(!d&&l){const N=t.acct.includes("@");try{const Z=await i.v2.search.fetch({q:N?t.acct:`${t.username}@${n}`,type:"accounts",limit:1,resolve:!0});Z.accounts.length&&(L=Z.accounts[0].id,Le(Z.accounts[0]))}catch{}}if(!L)return;if(I===L){Y(!0);return}if(R.current=L,T)return;u("loading");const V=i.v1.accounts.relationships.fetch({id:[L]});try{const N=await V;if(u("default"),N.length){const Z=N[0];f(Z),o({relationship:Z,currentID:L})}}catch{u("error")}})()}},[t,r]),_(()=>{t&&D&&Gn(t)},[t,D]);const ie=p==="loading",fe=P(null),[Ae,$e]=C(!1),[H,X]=C(!1),[W,ne]=C(!1);return e(x,{children:[e("div",{class:"actions",children:[e("span",{children:[B?e("span",{class:"tag",children:"Following you"}):b?e("small",{class:"insignificant",children:["Last post:"," ",e("span",{class:"ib",children:qe(b,{hideTime:!0})})]}):e("span",{}),E&&e("span",{class:"tag danger",children:"Muted"}),O&&e("span",{class:"tag danger",children:"Blocked"})]})," ",e("span",{class:"buttons",children:[!!ye&&e("button",{type:"button",class:"private-note-tag",title:"Private note",onClick:()=>{ne(!0)},dir:"auto",children:e("span",{children:ye})}),e(Ke,{instanceRef:fe,portal:{target:document.body},containerProps:{style:{zIndex:1001},onClick:I=>{var L,V;I.target===I.currentTarget&&((V=(L=fe.current)==null?void 0:L.closeMenu)==null||V.call(L))}},align:"center",position:"anchor",overflow:"auto",boundingBoxPadding:"8 8 8 8",menuButton:e("button",{type:"button",title:"More",class:"plain",disabled:ie,children:e(w,{icon:"more",size:"l",alt:"More"})}),children:[l&&!D&&e(x,{children:[e(J,{onClick:()=>{v.showCompose={draftStatus:{status:`@${(se==null?void 0:se.acct)||a} `}}},children:[e(w,{icon:"at"}),e("span",{children:["Mention @",g]})]}),e(J,{onClick:()=>{$e(!0)},children:[e(w,{icon:"translate"}),e("span",{children:"Translate bio"})]}),e(J,{onClick:()=>{ne(!0)},children:[e(w,{icon:"pencil"}),e("span",{children:ye?"Edit private note":"Add private note"})]}),F&&e(J,{onClick:()=>{X(!0)},children:[e(w,{icon:"list"}),e("span",{children:"Add/remove from Lists"})]}),e(De,{})]}),e(J,{href:h,target:"_blank",children:[e(w,{icon:"external"}),e("small",{class:"menu-double-lines",children:Ps(h)})]}),e("div",{class:"menu-horizontal",children:[e(J,{onClick:()=>{try{navigator.clipboard.writeText(h),ce("Link copied")}catch{ce("Unable to copy link")}},children:[e(w,{icon:"link"}),e("span",{children:"Copy"})]}),(navigator==null?void 0:navigator.share)&&((te=navigator==null?void 0:navigator.canShare)==null?void 0:te.call(navigator,{url:h}))&&e(J,{onClick:()=>{try{navigator.share({url:h})}catch{alert("Sharing doesn't seem to work.")}},children:[e(w,{icon:"share"}),e("span",{children:"Share…"})]})]}),!!c&&e(x,{children:[e(De,{}),E?e(J,{onClick:()=>{u("loading"),(async()=>{try{const I=await i.v1.accounts.$select((se==null?void 0:se.id)||m).unmute();f(I),u("default"),ce(`Unmuted @${g}`),v.reloadGenericAccounts.id="mute",v.reloadGenericAccounts.counter++}catch{u("error")}})()},children:[e(w,{icon:"unmute"}),e("span",{children:["Unmute @",g]})]}):e(ns,{openTrigger:"clickOnly",direction:"bottom",overflow:"auto",shift:16,label:e(x,{children:[e(w,{icon:"mute"}),e("span",{class:"menu-grow",children:["Mute @",g,"…"]}),e("span",{style:{textOverflow:"clip"},children:[e(w,{icon:"time"}),e(w,{icon:"chevron-right"})]})]}),children:e("div",{class:"menu-wrap",children:xs.map(I=>e(J,{onClick:()=>{u("loading"),(async()=>{try{const L=await i.v1.accounts.$select((se==null?void 0:se.id)||m).mute({duration:I});f(L),u("default"),ce(`Muted @${g} for ${tn[I]}`),v.reloadGenericAccounts.id="mute",v.reloadGenericAccounts.counter++}catch{u("error"),ce(`Unable to mute @${g}`)}})()},children:tn[I]}))})}),e(_e,{subMenu:!0,confirm:!O,confirmLabel:e(x,{children:[e(w,{icon:"block"}),e("span",{children:["Block @",g,"?"]})]}),menuItemClassName:"danger",onClick:()=>{u("loading"),(async()=>{try{if(O){const I=await i.v1.accounts.$select((se==null?void 0:se.id)||m).unblock();f(I),u("default"),ce(`Unblocked @${g}`)}else{const I=await i.v1.accounts.$select((se==null?void 0:se.id)||m).block();f(I),u("default"),ce(`Blocked @${g}`)}v.reloadGenericAccounts.id="block",v.reloadGenericAccounts.counter++}catch{u("error"),O?ce(`Unable to unblock @${g}`):ce(`Unable to block @${g}`)}})()},children:O?e(x,{children:[e(w,{icon:"unblock"}),e("span",{children:["Unblock @",g]})]}):e(x,{children:[e(w,{icon:"block"}),e("span",{children:["Block @",g,"…"]})]})})]})]}),!c&&p==="loading"&&e(be,{abrupt:!0}),!!c&&e(_e,{confirm:F||G,confirmLabel:e("span",{children:G?"Withdraw follow request?":`Unfollow @${t.acct||t.username}?`}),menuItemClassName:"danger",align:"end",disabled:ie,onClick:()=>{u("loading"),(async()=>{try{let I;F||G?I=await i.v1.accounts.$select(R.current).unfollow():I=await i.v1.accounts.$select(R.current).follow(),I&&f(I),u("default")}catch(I){alert(I),u("error")}})()},children:e("button",{type:"button",class:`${F||G?"light swap":""}`,"data-swap-state":F||G?"danger":"",disabled:ie,children:F?e(x,{children:[e("span",{children:"Following"}),e("span",{children:"Unfollow…"})]}):G?e(x,{children:[e("span",{children:"Requested"}),e("span",{children:"Withdraw…"})]}):y?e(x,{children:[e(w,{icon:"lock"})," ",e("span",{children:"Follow"})]}):"Follow"})})]})]}),!!Ae&&e(ue,{class:"light",onClose:()=>{$e(!1)},children:e(Ns,{note:S,fields:k,onClose:()=>$e(!1)})}),!!H&&e(ue,{class:"light",onClose:()=>{X(!1)},children:e(_s,{accountID:R.current,onClose:()=>X(!1)})}),!!W&&e(ue,{class:"light",onClose:()=>{ne(!1)},children:e(Us,{account:t,note:ye,onRelationshipChange:I=>{f(I)},onClose:()=>ne(!1)})})]})}function Es([t,n,r]){const o=.2126*t+.7152*n+.0722*r;let i;return o>=220?i=1:o<=50?i=.1:i=o/255,i=Math.min(1,i),[t,n,r,i]}function Ps(t){if(!t)return;const n=new URL(t),{host:r,pathname:o}=n,i=o.replace(/\/$/,"").replace(/^\//,"");return e(x,{children:[e("span",{class:"more-insignificant",children:[r,"/"]}),e("wbr",{}),e("span",{children:i})]})}function Ns({note:t,fields:n,onClose:r}){const o=(n==null?void 0:n.map(({name:s,value:l})=>`${s}
${Vt(l)}`).join(`

`))||"",i=Vt(t)+(o?`

${o}`:"");return e("div",{class:"sheet",children:[!!r&&e("button",{type:"button",class:"sheet-close",onClick:r,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Translated Bio"})}),e("main",{children:[e("p",{style:{whiteSpace:"pre-wrap"},children:i}),e(pn,{forceTranslate:!0,text:i})]})]})}function _s({accountID:t,onClose:n}){const{masto:r}=z(),[o,i]=C("default"),[s,l]=C([]),[d,p]=C([]),[u,c]=kt(a=>a+1,0);_(()=>{i("loading"),(async()=>{try{const a=await r.v1.lists.list(),h=await r.v1.accounts.$select(t).lists.list();l(a),p(h),i("default")}catch{i("error")}})()},[u]);const[f,m]=C(!1);return e("div",{class:"sheet",id:"list-add-remove-container",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Add/Remove from Lists"})}),e("main",{children:[s.length>0?e("ul",{class:"list-add-remove",children:s.map(a=>{const h=d.some(g=>g.id===a.id);return e("li",{children:e("button",{type:"button",class:`light ${h?"checked":""}`,disabled:o==="loading",onClick:()=>{i("loading"),(async()=>{try{h?await r.v1.lists.$select(a.id).accounts.remove({accountIds:[t]}):await r.v1.lists.$select(a.id).accounts.create({accountIds:[t]}),c()}catch{i("error"),alert(h?"Unable to remove from list.":"Unable to add to list.")}})()},children:[e(w,{icon:"check-circle"}),e("span",{children:a.title})]})})})}):o==="loading"?e("p",{class:"ui-state",children:e(be,{abrupt:!0})}):o==="error"?e("p",{class:"ui-state",children:"Unable to load lists."}):e("p",{class:"ui-state",children:"No lists."}),e("button",{type:"button",class:"plain2",onClick:()=>m(!0),disabled:o!=="default",children:[e(w,{icon:"plus",size:"l"})," ",e("span",{children:"New list"})]})]}),f&&e(ue,{class:"light",onClick:a=>{a.target===a.currentTarget&&m(!1)},children:e(zt,{list:f==null?void 0:f.list,onClose:a=>{a.state==="success"&&c(),m(!1)}})})]})}function Us({account:t,note:n,onRelationshipChange:r=()=>{},onClose:o=()=>{}}){const{masto:i}=z(),[s,l]=C("default"),d=P(null);return _(()=>{let p;return d.current&&!n&&(p=setTimeout(()=>{var u,c;(c=(u=d.current).focus)==null||c.call(u)},100)),()=>{clearTimeout(p)}},[]),e("div",{class:"sheet",id:"private-note-container",children:[!!o&&e("button",{type:"button",class:"sheet-close",onClick:o,children:e(w,{icon:"x"})}),e("header",{children:e("b",{children:["Private note about @",(t==null?void 0:t.username)||(t==null?void 0:t.acct)]})}),e("main",{children:e("form",{onSubmit:p=>{p.preventDefault();const c=new FormData(p.target).get("note");(c==null?void 0:c.trim())!==(n==null?void 0:n.trim())&&(l("loading"),(async()=>{try{const f=await i.v1.accounts.$select(t==null?void 0:t.id).note.create({comment:c});l("default"),r(f),o()}catch(f){l("error"),alert((f==null?void 0:f.message)||"Unable to update private note.")}})())},children:[e("textarea",{ref:d,name:"note",disabled:s==="loading",children:n}),e("footer",{children:[e("button",{type:"button",class:"light",disabled:s==="loading",onClick:()=>{o==null||o()},children:"Cancel"}),e("span",{children:[e(be,{abrupt:!0,hidden:s!=="loading"}),e("button",{disabled:s==="loading",type:"submit",children:"Save & close"})]})]})]})})]})}function Fs({account:t,instance:n,onClose:r}){const{masto:o,instance:i,authenticated:s}=z({instance:n}),l=typeof t=="string";return _(()=>{l||(v.accounts[`${t.id}@${i}`]=t)},[t]),xn(r),e("div",{class:"sheet",children:[!!r&&e("button",{type:"button",class:"sheet-close outer",onClick:r,children:e(w,{icon:"x"})}),e(Rn,{instance:i,authenticated:s,account:t,fetchAccount:async()=>{if(l)try{return await o.v1.accounts.lookup({acct:t,skip_webfinger:!1})}catch{const p=await o.v2.search.fetch({q:t,type:"accounts",limit:1,resolve:s});if(p.accounts.length)return p.accounts[0];if(/https?:\/\/[^/]+\/@/.test(t)){const c=new URL(t).pathname.replace(/^\//,""),f=await o.v2.search.fetch({q:c,type:"accounts",limit:1,resolve:s});if(f.accounts.length)return f.accounts[0]}}else return t}})]})}function zs({onClose:t}){const{masto:n}=z(),[r,o]=C("default"),[i,s]=C([]),[l,d]=kt(u=>u+1,0);_(()=>{o("loading"),(async()=>{try{const u=await tt.drafts.keys();if(u.length){const c=mn(),f=u.filter(m=>m.startsWith(c));if(f.length){const m=await tt.drafts.getMany(f);m.sort((a,h)=>new Date(h.updatedAt).getTime()-new Date(a.updatedAt).getTime()),s(m)}else s([])}else s([]);o("default")}catch{o("error")}})()},[l]);const p=(i==null?void 0:i.length)>0;return e("div",{class:"sheet",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:[e("h2",{children:["Unsent drafts ",e(be,{abrupt:!0,hidden:r!=="loading"})]}),p&&e("div",{class:"insignificant",children:"Looks like you have unsent drafts. Let's continue where you left off."})]}),e("main",{children:p?e(x,{children:[e("ul",{class:"drafts-list",children:i.map(u=>{const{updatedAt:c,key:f,draftStatus:m,replyTo:a}=u,h=new Date(c);return e("li",{children:[e("div",{class:"mini-draft-meta",children:[e("b",{children:[e(w,{icon:a?"reply":"quill",size:"s"})," ",e("time",{children:[!!a&&e(x,{children:["@",a.account.acct,e("br",{})]}),qe(h)]})]}),e(_e,{confirmLabel:e("span",{children:"Delete this draft?"}),menuItemClassName:"danger",align:"end",disabled:r==="loading",onClick:()=>{(async()=>{try{await tt.drafts.del(f),d()}catch{alert("Error deleting draft! Please try again.")}})()},children:e("button",{type:"button",class:"small light",disabled:r==="loading",children:"Delete…"})})]}),e("button",{type:"button",disabled:r==="loading",class:"draft-item",onClick:async()=>{let g;if(a){o("loading");try{g=await n.v1.statuses.$select(a.id).fetch()}catch{alert("Error fetching reply-to status!"),o("default");return}o("default")}window.__COMPOSE__={draftStatus:m,replyToStatus:g},v.showCompose=!0,v.showDrafts=!1},children:e(Bs,{draft:u})})]},c)})}),i.length>1&&e("p",{children:e(_e,{confirmLabel:e("span",{children:"Delete all drafts?"}),menuItemClassName:"danger",disabled:r==="loading",onClick:()=>{(async()=>{o("loading");try{await tt.drafts.delMany(i.map(u=>u.key)),o("default"),d()}catch{alert("Error deleting drafts! Please try again."),o("error")}})()},children:e("button",{type:"button",class:"light danger",disabled:r==="loading",children:"Delete all…"})})})]}):e("p",{children:"No drafts found."})})]})}function Bs({draft:t}){var f;const{draftStatus:n,replyTo:r}=t,{status:o,spoilerText:i,poll:s,mediaAttachments:l}=n,d=((f=s==null?void 0:s.options)==null?void 0:f.length)>0,p=(l==null?void 0:l.length)>0,u=d||p,c=he(()=>{if(!p)return;const m=l.find(g=>/image/.test(g.type));if(!m)return;const{file:a}=m;return URL.createObjectURL(a)},[p,l]);return e(x,{children:e("div",{class:"mini-draft",children:[u&&e("div",{class:`mini-draft-aside ${c?"has-image":""}`,style:c?{"--bg-image":`url(${c})`}:{},children:[d&&e(w,{icon:"poll"}),p&&e("span",{children:[e(w,{icon:"attachment"})," ",e("small",{children:l==null?void 0:l.length})]})]}),e("div",{class:"mini-draft-main",children:[!!i&&e("div",{class:"mini-draft-spoiler",children:i}),!!o&&e("div",{class:"mini-draft-status",children:o})]})]})})}function Os({onClose:t=()=>{}}){const n=ae(v),[r,o]=C("default"),[i,s]=C([]),[l,d]=C(!1);if(xn(t),!n.showGenericAccounts)return null;const{id:p,heading:u,fetchAccounts:c,accounts:f,showReactions:m}=n.showGenericAccounts,a=h=>{c&&(h&&s([]),o("loading"),(async()=>{try{const{done:g,value:y}=await c(h);Array.isArray(y)?(s(h?y:b=>[...b,...y]),d(!g)):d(!1),o("default")}catch{o("error")}})())};return _(()=>{(f==null?void 0:f.length)>0?s(f):a(!0)},[f,c]),_(()=>{var h;((h=n.reloadGenericAccounts)==null?void 0:h.id)===p&&a(!0)},[n.reloadGenericAccounts.counter]),e("div",{id:"generic-accounts-container",class:"sheet",tabindex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:u||"Accounts"})}),e("main",{children:i.length>0?e(x,{children:[e("ul",{class:"accounts-list",children:i.map(h=>{var g;return e("li",{children:[m&&((g=h._types)==null?void 0:g.length)>0&&e("div",{class:"reactions-block",children:h._types.map(y=>e(w,{icon:{reblog:"rocket",favourite:"heart"}[y],class:`${y}-icon`}))}),e(Fe,{account:h})]},h.id+(h._types||""))})}),r==="default"?l?e(it,{onChange:h=>{h&&a()},children:e("button",{type:"button",class:"plain block",onClick:()=>a(),children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}):r==="loading"&&e("p",{class:"ui-state",children:e(be,{abrupt:!0})})]}):r==="loading"?e("p",{class:"ui-state",children:e(be,{abrupt:!0})}):r==="error"?e("p",{class:"ui-state",children:"Error loading accounts"}):e("p",{class:"ui-state insignificant",children:"Nothing to show"})})]})}function Ln({alt:t,lang:n,onClose:r}){const o=ae(v),[i,s]=C(!1),l=un(!0),d=o.settings.contentTranslationHideLanguages||[],p=!!n&&n!==l&&!jt([n],[l])&&!d.find(u=>n===u||jt([n],[u]));return e("div",{class:"sheet",children:[!!r&&e("button",{type:"button",class:"sheet-close outer",onClick:r,children:e(w,{icon:"x"})}),e("header",{class:"header-grid",children:[e("h2",{children:"Media description"}),e("div",{class:"header-side",children:e(Ke,{align:"end",menuButton:e("button",{type:"button",class:"plain4",children:e(w,{icon:"more",alt:"More",size:"xl"})}),children:e(J,{disabled:i,onClick:()=>{s(!0)},children:[e(w,{icon:"translate"}),e("span",{children:"Translate"})]})})})]}),e("main",{lang:n,dir:"auto",children:[e("p",{style:{whiteSpace:"pre-wrap"},children:t}),(p||i)&&e(pn,{forceTranslate:i,sourceLanguage:n,text:t})]})]})}function An({mediaAttachments:t,statusID:n,instance:r,lang:o,index:i=0,onClose:s=()=>{}}){var g,y;const l=P(null),[d,p]=C(i),u=P(null);ze(()=>{var b;(b=u.current)==null||b.scrollIntoView()},[]);const c=P(n);_(()=>{const b=i*l.current.clientWidth,S=c.current!==n;S&&(c.current=n),l.current.scrollTo({left:b,behavior:S?"auto":"smooth"}),l.current.focus()},[i,n]);const[f,m]=C(!0);_(()=>{let b=()=>{s()};return l.current&&l.current.addEventListener("swiped-down",b),()=>{l.current&&l.current.removeEventListener("swiped-down",b)}},[]),ke("esc",s,[s]);const[a,h]=C(!1);return _(()=>{let b=()=>{const{clientWidth:S,scrollLeft:k}=l.current,T=Math.round(k/S);p(T)};return l.current&&l.current.addEventListener("scroll",b,{passive:!0}),()=>{l.current&&l.current.removeEventListener("scroll",b)}},[]),_(()=>{let b=setTimeout(()=>{var S,k;(k=(S=l.current)==null?void 0:S.focus)==null||k.call(S)},100);return()=>clearTimeout(b)},[]),e("div",{class:"media-modal-container",children:[e("div",{ref:l,tabIndex:"0","data-swipe-threshold":"44",class:"carousel",onClick:b=>{(b.target.classList.contains("carousel-item")||b.target.classList.contains("media")||b.target.classList.contains("media-zoom"))&&s()},children:t==null?void 0:t.map((b,S)=>{const{blurhash:k}=b,T=k?ss(k):null;return e("div",{class:"carousel-item",style:{"--average-color":`rgb(${T==null?void 0:T.join(",")})`,"--average-color-alpha":`rgba(${T==null?void 0:T.join(",")}, .5)`},tabindex:"0",ref:S===d?u:null,onClick:R=>{R.target!==R.currentTarget&&m(!f)},children:[!!b.description&&e("button",{type:"button",class:"media-alt",hidden:!f,onClick:()=>{h({alt:b.description,lang:o})},children:[e("span",{class:"alt-badge",children:"ALT"}),e("span",{class:"media-alt-desc",lang:o,dir:"auto",children:b.description})]}),e(Wn,{media:b,showOriginal:!0,lang:o})]},b.id)})}),e("div",{class:"carousel-top-controls",hidden:!f,children:[e("span",{children:e("button",{type:"button",class:"carousel-button",onClick:()=>s(),children:e(w,{icon:"x"})})}),(t==null?void 0:t.length)>1?e("span",{class:"carousel-dots",children:t==null?void 0:t.map((b,S)=>e("button",{type:"button",disabled:S===d,class:`carousel-dot ${S===d?"active":""}`,onClick:k=>{k.preventDefault(),k.stopPropagation(),l.current.scrollTo({left:l.current.clientWidth*S,behavior:"smooth"}),l.current.focus()},children:e(w,{icon:"round",size:"s"})},b.id))}):e("span",{}),e("span",{children:[e(Ke,{overflow:"auto",align:"end",position:"anchor",boundingBoxPadding:"8 8 8 8",gap:4,menuClassName:"glass-menu",menuButton:e("button",{type:"button",class:"carousel-button",children:e(w,{icon:"more",alt:"More"})}),children:e(Ce,{href:((g=t[d])==null?void 0:g.remoteUrl)||((y=t[d])==null?void 0:y.url),class:"carousel-button",target:"_blank",title:"Open original media in new window",children:[e(w,{icon:"popout"}),e("span",{children:"Open original media"})]})})," ",e(j,{to:`${r?`/${r}`:""}/s/${n}${window.matchMedia("(min-width: calc(40em + 350px))").matches?`?media=${d+1}`:""}`,class:"button carousel-button media-post-link",children:[e("span",{class:"button-label",children:"See post "}),"»"]})]})]}),(t==null?void 0:t.length)>1&&e("div",{class:"carousel-controls",hidden:!f,children:[e("button",{type:"button",class:"carousel-button",hidden:d===0,onClick:b=>{b.preventDefault(),b.stopPropagation(),l.current.focus(),l.current.scrollTo({left:l.current.clientWidth*(d-1),behavior:"smooth"})},children:e(w,{icon:"arrow-left"})}),e("button",{type:"button",class:"carousel-button",hidden:d===t.length-1,onClick:b=>{b.preventDefault(),b.stopPropagation(),l.current.focus(),l.current.scrollTo({left:l.current.clientWidth*(d+1),behavior:"smooth"})},children:e(w,{icon:"arrow-right"})})]}),!!a&&e(ue,{class:"light",onClick:b=>{b.target===b.currentTarget&&(h(!1),l.current.focus())},children:e(Ln,{alt:a.alt||a,lang:a==null?void 0:a.lang,onClose:()=>h(!1)})})]})}const qs=""+new URL("floating-button-ef345856.svg",import.meta.url).href,Hs=""+new URL("multi-column-d7f22033.svg",import.meta.url).href,Vs=""+new URL("tab-menu-bar-0b1df8b5.svg",import.meta.url).href;function At({children:t}){if(typeof t=="string")return t;const[n,r]=C("");return _(()=>{Promise.resolve(t).then(r)},[t]),n}const Qe=9,js=["following","mentions","notifications","list","public","trending","hashtag","bookmarks","favourites"],Mn={following:"Home / Following",notifications:"Notifications",list:"List",public:"Public (Local / Federated)",search:"Search","account-statuses":"Account",bookmarks:"Bookmarks",favourites:"Favourites",hashtag:"Hashtag",trending:"Trending",mentions:"Mentions"},pt={list:[{text:"List ID",name:"id"}],public:[{text:"Local only",name:"local",type:"checkbox"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],trending:[{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],search:[{text:"Search term",name:"query",type:"text"}],"account-statuses":[{text:"@",name:"id",type:"text",placeholder:"cheeaun@mastodon.social"}],hashtag:[{text:"#",name:"hashtag",type:"text",placeholder:"e.g. PixelArt (Max 5, space-separated)",pattern:"[^#]+"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}]},vt={following:{id:"home",title:(t,n)=>n===0?"Home":"Following",path:"/",icon:"home"},mentions:{id:"mentions",title:"Mentions",path:"/mentions",icon:"at"},notifications:{id:"notifications",title:"Notifications",path:"/notifications",icon:"notification"},list:{id:"list",title:yt(async({id:t})=>(await z().masto.v1.lists.$select(t).fetch()).title),path:({id:t})=>`/l/${t}`,icon:"list"},public:{id:"public",title:({local:t})=>t?"Local":"Federated",subtitle:({instance:t})=>t||z().instance,path:({local:t,instance:n})=>`/${n}/p${t?"/l":""}`,icon:({local:t})=>t?"group":"earth"},trending:{id:"trending",title:"Trending",subtitle:({instance:t})=>t||z().instance,path:({instance:t})=>`/${t}/trending`,icon:"chart"},search:{id:"search",title:({query:t})=>t,path:({query:t})=>`/search?q=${t}`,icon:"search"},"account-statuses":{id:"account-statuses",title:yt(async({id:t})=>{const n=await z().masto.v1.accounts.$select(t).fetch();return n.username||n.acct||n.displayName}),path:({id:t})=>`/a/${t}`,icon:"user"},bookmarks:{id:"bookmarks",title:"Bookmarks",path:"/b",icon:"bookmark"},favourites:{id:"favourites",title:"Favourites",path:"/f",icon:"heart"},hashtag:{id:"hashtag",title:({hashtag:t})=>t,subtitle:({instance:t})=>t||z().instance,path:({hashtag:t,instance:n})=>`${n?`/${n}`:""}/t/${t.split(/\s+/).join("+")}`,icon:"hashtag"}};function Gs({onClose:t}){const n=ae(v),{masto:r}=z(),{shortcuts:o}=n,[i,s]=C([]),[l,d]=C([]),[p,u]=C(!1),[c,f]=C(!1);return _(()=>{(async()=>{try{const m=await r.v1.lists.list();s(m)}catch{}})(),(async()=>{try{const m=r.v1.followedTags.list(),a=[];do{const{value:h,done:g}=await m.next();if(g||(h==null?void 0:h.length)===0)break;a.push(...h)}while(!0);d(a)}catch{}})()},[]),e("div",{id:"shortcuts-settings-container",class:"sheet",tabindex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:[e(w,{icon:"shortcut"})," Shortcuts"," ",e("sup",{style:{fontSize:12,opacity:.5,textTransform:"uppercase"},children:"beta"})]})}),e("main",{children:[e("p",{children:"Specify a list of shortcuts that'll appear as:"}),e("div",{class:"shortcuts-view-mode",children:[{value:"float-button",label:"Floating button",imgURL:qs},{value:"tab-menu-bar",label:"Tab/Menu bar",imgURL:Vs},{value:"multi-column",label:"Multi-column",imgURL:Hs}].map(({value:m,label:a,imgURL:h})=>e("label",{children:[e("input",{type:"radio",name:"shortcuts-view-mode",value:m,checked:n.settings.shortcutsViewMode===m||m==="float-button"&&!n.settings.shortcutsViewMode,onChange:g=>{v.settings.shortcutsViewMode=g.target.value}})," ",e("img",{src:h,alt:"",width:"80",height:"58"})," ",e("span",{children:a})]}))}),o.length>0?e("ol",{class:"shortcuts-list",children:o.filter(Boolean).map((m,a)=>{const h=a+Object.values(m),{type:g}=m;if(!vt[g])return null;let{icon:y,title:b,subtitle:S}=vt[g];return typeof b=="function"&&(b=b(m,a)),typeof S=="function"&&(S=S(m,a)),typeof y=="function"&&(y=y(m,a)),e("li",{children:[e(w,{icon:y}),e("span",{class:"shortcut-text",children:[e(At,{children:b}),S&&e(x,{children:[" ",e("small",{class:"ib insignificant",children:S})]})]}),e("span",{class:"shortcut-actions",children:[e("button",{type:"button",class:"plain small",disabled:a===0,onClick:()=>{const k=Array.from(v.shortcuts);if(a>0){const T=v.shortcuts[a-1];k[a-1]=m,k[a]=T,v.shortcuts=k}},children:e(w,{icon:"arrow-up",alt:"Move up"})}),e("button",{type:"button",class:"plain small",disabled:a===o.length-1,onClick:()=>{const k=Array.from(v.shortcuts);if(a<v.shortcuts.length-1){const T=v.shortcuts[a+1];k[a+1]=m,k[a]=T,v.shortcuts=k}},children:e(w,{icon:"arrow-down",alt:"Move down"})}),e("button",{type:"button",class:"plain small",onClick:()=>{u({shortcut:m,shortcutIndex:a})},children:e(w,{icon:"pencil",alt:"Edit"})})]})]},h)})}):e("div",{class:"ui-state insignificant",children:[e("p",{children:"No shortcuts yet. Tap on the Add shortcut button."}),e("p",{children:["Not sure what to add?",e("br",{}),"Try adding"," ",e("a",{href:"#",onClick:m=>{m.preventDefault(),v.shortcuts=[{type:"following"},{type:"notifications"}]},children:"Home / Following and Notifications"})," ","first."]})]}),e("p",{class:"insignificant",children:o.length>=Qe&&`Max ${Qe} shortcuts`}),e("p",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e("button",{type:"button",class:"light",onClick:()=>f(!0),children:"Import/export"}),e("button",{type:"button",disabled:o.length>=Qe,onClick:()=>u(!0),children:[e(w,{icon:"plus"})," ",e("span",{children:"Add shortcut"})]})]})]}),p&&e(ue,{class:"light",onClick:m=>{m.target===m.currentTarget&&u(!1)},children:e(Ws,{shortcut:p.shortcut,shortcutIndex:p.shortcutIndex,lists:i,followedHashtags:l,onSubmit:({result:m,mode:a})=>{a==="edit"?v.shortcuts[p.shortcutIndex]=m:v.shortcuts.push(m)},onClose:()=>u(!1)})}),c&&e(ue,{class:"light",onClick:m=>{m.target===m.currentTarget&&f(!1)},children:e(Ks,{shortcuts:o,onClose:()=>f(!1)})})]})}function Ws({lists:t,followedHashtags:n,onSubmit:r,disabled:o,shortcut:i,shortcutIndex:s,onClose:l}){var f,m;const d=!!i,[p,u]=C((i==null?void 0:i.type)||null),c=P();return _(()=>{if(d&&p&&pt[p]){const a=c.current;pt[p].forEach(({name:h,type:g})=>{const y=a.querySelector(`[name="${h}"]`);y&&i[h]&&(g==="checkbox"?y.checked=i[h]==="on":y.value=i[h])})}},[d,p]),e("div",{id:"shortcut-settings-form",class:"sheet",children:[!!l&&e("button",{type:"button",class:"sheet-close",onClick:l,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:[d?"Edit":"Add"," shortcut"]})}),e("main",{tabindex:"-1",children:e("form",{ref:c,onSubmit:a=>{a.preventDefault();const h=new FormData(a.target),g={};h.forEach((y,b)=>{g[b]=y==null?void 0:y.trim(),b==="instance"&&(g[b]=g[b].replace(/^https?:\/\//,"").replace(/\/+$/,""),g[b]=g[b].replace(/^@?[^@]+@/,""))}),g.type&&(r({result:g,mode:d?"edit":"add"}),a.target.reset(),u(null),l==null||l())},children:[e("p",{children:e("label",{children:[e("span",{children:"Timeline"}),e("select",{required:!0,disabled:o,onChange:a=>{u(a.target.value)},defaultValue:d?i.type:void 0,name:"type",children:[e("option",{}),js.map(a=>e("option",{value:a,children:Mn[a]}))]})]})}),(m=(f=pt[p])==null?void 0:f.map)==null?void 0:m.call(f,({text:a,name:h,type:g,placeholder:y,pattern:b,notRequired:S})=>p==="list"?e("p",{children:e("label",{children:[e("span",{children:"List"}),e("select",{name:"id",required:!S,disabled:o,children:t.map(k=>e("option",{value:k.id,children:k.title}))})]})}):e("p",{children:e("label",{children:[e("span",{children:a})," ",e("input",{type:g,name:h,placeholder:y,required:g==="text"&&!S,disabled:o,list:p==="hashtag"?"followed-hashtags-datalist":null,autocorrect:"off",autocapitalize:"off",spellcheck:!1,pattern:b}),p==="hashtag"&&n.length>0&&e("datalist",{id:"followed-hashtags-datalist",children:n.map(k=>e("option",{value:k.name}))})]})})),e("footer",{children:[e("button",{type:"submit",class:"block",disabled:o,children:d?"Save":"Add"}),d&&e("button",{type:"button",class:"light danger",onClick:()=>{v.shortcuts.splice(s,1),l==null||l()},children:"Remove"})]})]})})]})}function Ks({shortcuts:t,onClose:n}){var u;const r=he(()=>!t||!t.filter(Boolean).length?"":Jt.compressToEncodedURIComponent(JSON.stringify(t.filter(Boolean))),[t]),[o,i]=C(""),[s,l]=C("default"),d=he(()=>{if(!o)return l("default"),null;try{const c=JSON.parse(Jt.decompressFromEncodedURIComponent(o));if(!Array.isArray(c))throw new Error("Not an array");return l("default"),c}catch{try{const f=JSON.parse(o);if(!Array.isArray(f))throw new Error("Not an array");return l("default"),f}catch{return l("error"),null}}},[o]),p=v.shortcuts.length>0;return e("div",{id:"import-export-container",class:"sheet",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:["Import/Export ",e("small",{class:"ib insignificant",children:"Shortcuts"})]})}),e("main",{tabindex:"-1",children:[e("section",{children:[e("h3",{children:[e(w,{icon:"arrow-down-circle",size:"l",class:"insignificant"})," ",e("span",{children:"Import"})]}),e("p",{children:e("input",{type:"text",name:"import",placeholder:"Paste shortcuts here",class:"block",onInput:c=>{i(c.target.value)}})}),!!d&&Array.isArray(d)&&e(x,{children:[e("p",{children:[e("b",{children:d.length})," shortcut",d.length>1?"s":""," ",e("small",{class:"insignificant",children:["(",o.length," characters)"]})]}),e("ol",{class:"import-settings-list",children:d.map(c=>{var f,m;return e("li",{children:[e("span",{style:{opacity:t.some(a=>Object.keys(a).every(h=>a[h]===c[h]))?1:0},children:"*"}),e("span",{children:[Mn[c.type],c.type==="list"&&" ⚠️"," ",(m=(f=pt[c.type])==null?void 0:f.map)==null?void 0:m.call(f,({text:a,name:h,type:g})=>c[h]?e(x,{children:[e("span",{class:"tag collapsed insignificant",children:[a,":"," ",g==="checkbox"?c[h]==="on"?"✅":"❌":c[h]]})," "]}):null)]})]})})}),e("p",{children:[e("small",{children:"* Exists in current shortcuts"}),e("br",{}),e("small",{children:"⚠️ List may not work if it's from a different account."})]})]}),s==="error"&&e("p",{class:"error",children:e("small",{children:"⚠️ Invalid settings format"})}),e("p",{children:[p&&e(x,{children:[e(_e,{confirmLabel:"Append to current shortcuts?",menuFooter:e("div",{class:"footer",children:"Only shortcuts that don’t exist in current shortcuts will be appended."}),onClick:()=>{const c=d.filter(a=>!v.shortcuts.some(h=>Object.keys(h).every(g=>h[g]===a[g])));if(!c.length){ce("No new shortcuts to import");return}let f=[...v.shortcuts,...c];const m=f.length>Qe;m&&(f=f.slice(0,Qe)),v.shortcuts=f,ce(m?`Shortcuts imported. Exceeded max ${Qe}, so the rest are not imported.`:"Shortcuts imported"),n==null||n()},children:e("button",{type:"button",class:"plain2",disabled:!d,children:"Import & append…"})})," "]}),e(_e,{confirmLabel:p?"Override current shortcuts?":"Import shortcuts?",menuItemClassName:p?"danger":void 0,onClick:()=>{v.shortcuts=d,ce("Shortcuts imported"),n==null||n()},children:e("button",{type:"button",class:"plain2",disabled:!d,children:p?"or override…":"Import…"})})]})]}),e("section",{children:[e("h3",{children:[e(w,{icon:"arrow-up-circle",size:"l",class:"insignificant"})," ",e("span",{children:"Export"})]}),e("p",{children:e("input",{style:{width:"100%"},type:"text",value:r,readOnly:!0,onClick:c=>{if(c.target.value){c.target.select();try{navigator.clipboard.writeText(c.target.value),ce("Shortcuts copied")}catch{ce("Unable to copy shortcuts")}}}})}),e("p",{children:[e("button",{type:"button",class:"plain2",disabled:!r,onClick:()=>{try{navigator.clipboard.writeText(r),ce("Shortcut settings copied")}catch{ce("Unable to copy shortcut settings")}},children:[e(w,{icon:"clipboard"})," ",e("span",{children:"Copy"})]})," ",(navigator==null?void 0:navigator.share)&&((u=navigator==null?void 0:navigator.canShare)==null?void 0:u.call(navigator,{text:r}))&&e("button",{type:"button",class:"plain2",disabled:!r,onClick:()=>{try{navigator.share({text:r})}catch{alert("Sharing doesn't seem to work.")}},children:[e(w,{icon:"share"})," ",e("span",{children:"Share"})]})," ",r.length>0&&e("small",{class:"insignificant",children:[r.length," characters"]})]}),!!r&&e("details",{children:[e("summary",{class:"insignificant",children:e("small",{children:"Raw Shortcuts JSON"})}),e("textarea",{style:{width:"100%"},rows:10,readOnly:!0,children:JSON.stringify(t.filter(Boolean),null,2)})]})]})]})]})}is(v,t=>{for(const[n,r,o,i]of t)/^show/i.test(r)&&!o&&Lt()});function Js(){var o,i,s,l,d,p,u,c;const t=ae(v),n=wn(),r=St();return e(x,{children:[!!t.showCompose&&e(ue,{children:e(Kn,{replyToStatus:typeof t.showCompose!="boolean"?t.showCompose.replyToStatus:((o=window.__COMPOSE__)==null?void 0:o.replyToStatus)||null,editStatus:((i=v.showCompose)==null?void 0:i.editStatus)||((s=window.__COMPOSE__)==null?void 0:s.editStatus)||null,draftStatus:((l=v.showCompose)==null?void 0:l.draftStatus)||((d=window.__COMPOSE__)==null?void 0:d.draftStatus)||null,onClose:f=>{const{newStatus:m,instance:a,type:h}=f||{};v.showCompose=!1,window.__COMPOSE__=null,m&&(v.reloadStatusPage++,ce({text:{post:"Post published. Check it out.",reply:"Reply posted. Check it out.",edit:"Post updated. Check it out."}[h||"post"],delay:1e3,duration:1e4,onClick:g=>{g.hideToast(),v.prevLocation=r,n(a?`/${a}/s/${m.id}`:`/s/${m.id}`)}}))}})}),!!t.showSettings&&e(ue,{onClose:()=>{v.showSettings=!1},children:e(Ts,{onClose:()=>{v.showSettings=!1}})}),!!t.showAccounts&&e(ue,{onClose:()=>{v.showAccounts=!1},children:e(ws,{onClose:()=>{v.showAccounts=!1}})}),!!t.showAccount&&e(ue,{class:"light",onClose:()=>{v.showAccount=!1},children:e(Fs,{account:((p=t.showAccount)==null?void 0:p.account)||t.showAccount,instance:(u=t.showAccount)==null?void 0:u.instance,onClose:({destination:f}={})=>{v.showAccount=!1}})}),!!t.showDrafts&&e(ue,{onClose:()=>{v.showDrafts=!1},children:e(zs,{onClose:()=>v.showDrafts=!1})}),!!t.showMediaModal&&e(ue,{onClick:f=>{(f.target===f.currentTarget||f.target.classList.contains("media"))&&(v.showMediaModal=!1)},children:e(An,{mediaAttachments:t.showMediaModal.mediaAttachments,instance:t.showMediaModal.instance,index:t.showMediaModal.index,statusID:t.showMediaModal.statusID,onClose:()=>{v.showMediaModal=!1}})}),!!t.showShortcutsSettings&&e(ue,{class:"light",onClose:()=>{v.showShortcutsSettings=!1},children:e(Gs,{onClose:()=>v.showShortcutsSettings=!1})}),!!t.showGenericAccounts&&e(ue,{class:"light",onClose:()=>{v.showGenericAccounts=!1},children:e(Os,{onClose:()=>v.showGenericAccounts=!1})}),!!t.showMediaAlt&&e(ue,{class:"light",onClick:f=>{f.target===f.currentTarget&&(v.showMediaAlt=!1)},children:e(Ln,{alt:t.showMediaAlt.alt||t.showMediaAlt,lang:(c=t.showMediaAlt)==null?void 0:c.lang,onClose:()=>{v.showMediaAlt=!1}})})]})}function Mt({accountID:t,onChange:n}){const{masto:r}=z(),[o,i]=C("default"),[s,l]=C(null),[d,p]=C(null),u=d!==null;return e("p",{class:"follow-request-buttons",children:[e("button",{type:"button",disabled:o==="loading"||u,onClick:()=>{i("loading"),l("accept"),(async()=>{try{const c=await r.v1.followRequests.$select(t).authorize();if(!(c!=null&&c.followedBy))throw new Error("Follow request not accepted");p(c),n()}catch{}i("default")})()},children:"Accept"})," ",e("button",{type:"button",disabled:o==="loading"||u,class:"light danger",onClick:()=>{i("loading"),l("reject"),(async()=>{try{const c=await r.v1.followRequests.$select(t).reject();if(c!=null&&c.followedBy)throw new Error("Follow request not rejected");p(c),n()}catch{i("default")}})()},children:"Reject"}),e("span",{class:"follow-request-states",children:u&&s?s==="accept"?e(w,{icon:"check-circle",alt:"Accepted",class:"follow-accepted"}):e(w,{icon:"x-circle",alt:"Rejected",class:"follow-rejected"}):e(be,{hidden:o!=="loading"})})]})}const sn={mention:"comment",status:"notification",reblog:"rocket",follow:"follow",follow_request:"follow-add",favourite:"heart",poll:"poll",update:"pencil","admin.signup":"account-edit","admin.report":"account-warning"},Ze={mention:"mentioned you in their post.",status:"published a post.",reblog:"boosted your post.","reblog+account":t=>`boosted ${t} of your posts.`,reblog_reply:"boosted your reply.",follow:"followed you.",follow_request:"requested to follow you.",favourite:"favourited your post.","favourite+account":t=>`favourited ${t} of your posts.`,favourite_reply:"favourited your reply.",poll:"A poll you have voted in or created has ended.","poll-self":"A poll you have created has ended.","poll-voted":"A poll you have voted in has ended.",update:"A post you interacted with has been edited.","favourite+reblog":"boosted & favourited your post.","favourite+reblog+account":t=>`boosted & favourited ${t} of your posts.`,"favourite+reblog_reply":"boosted & favourited your reply.","admin.sign_up":"signed up.","admin.report":t=>e(x,{children:["reported ",t]})},xt=50;function Bt({notification:t,instance:n,reload:r,isStatic:o}){var A,M,B,O;const{id:i,status:s,account:l,report:d,_accounts:p,_statuses:u}=t;let{type:c}=t;const f=(s==null?void 0:s.reblog)||s,m=f==null?void 0:f.id,a=K.session.get("currentAccount"),h=a===(l==null?void 0:l.id),g=(A=s==null?void 0:s.poll)==null?void 0:A.voted,y=!!(s!=null&&s.inReplyToAccountId)&&(s==null?void 0:s.inReplyToAccountId)!==a&&((M=s==null?void 0:s.account)==null?void 0:M.id)===a;let b=0,S=0;if(c==="favourite+reblog"){for(const $ of p)(B=$._types)!=null&&B.includes("favourite")&&b++,(O=$._types)!=null&&O.includes("reblog")&&S++;!S&&b&&(c="favourite"),!b&&S&&(c="reblog")}let k;if(c==="poll"?k=Ze[h?"poll-self":g?"poll-voted":"poll"]:c==="reblog"||c==="favourite"||c==="favourite+reblog"?(u==null?void 0:u.length)>1?k=Ze[`${c}+account`]:y?k=Ze[`${c}_reply`]:k=Ze[c]:Ze[c]?k=Ze[c]:k=`[Unknown notification type: ${c}]`,typeof k=="function"){const $=(u==null?void 0:u.length)||(p==null?void 0:p.length);if($)k=k($);else if(c==="admin.report"){const E=d==null?void 0:d.targetAccount;E&&(k=k(e(bt,{account:E,showAvatar:!0})))}}if(c==="mention"&&!s)return null;const T=t.createdAt&&new Date(t.createdAt).toLocaleString(),R={"favourite+reblog":"Boosted/Favourited by…",favourite:"Favourited by…",reblog:"Boosted by…",follow:"Followed by…"}[c]||"Accounts",F=()=>{v.showGenericAccounts={heading:R,accounts:p,showReactions:c==="favourite+reblog"}};return e("div",{class:`notification notification-${c}`,tabIndex:"0",children:[e("div",{class:`notification-type notification-${c}`,title:T,children:c==="favourite+reblog"?e(x,{children:[e(w,{icon:"rocket",size:"xl",alt:c,class:"reblog-icon"}),e(w,{icon:"heart",size:"xl",alt:c,class:"favourite-icon"})]}):e(w,{icon:sn[c]||"notification",size:"xl",alt:c})}),e("div",{class:"notification-content",children:[c!=="mention"&&e(x,{children:[e("p",{children:[!/poll|update/i.test(c)&&e(x,{children:(p==null?void 0:p.length)>1?e(x,{children:[e("b",{tabIndex:"0",onClick:F,children:[e("span",{title:p.length,children:Ne(p.length)})," ","people"]})," "]}):e(x,{children:[e(bt,{account:l,showAvatar:!0})," "]})}),k,c==="mention"&&e("span",{class:"insignificant",children:[" ","•"," ",e(_t,{datetime:t.createdAt,format:"micro"})]})]}),c==="follow_request"&&e(Mt,{accountID:l.id,onChange:()=>{}})]}),(p==null?void 0:p.length)>1&&e("p",{class:"avatars-stack",children:[p.slice(0,xt).map(($,E)=>e(x,{children:[e("a",{href:$.url,rel:"noopener noreferrer",class:"account-avatar-stack",onClick:ee=>{ee.preventDefault(),v.showAccount=$},children:[e(je,{url:$.avatarStatic,size:p.length<=10?"xxl":p.length<20?"xl":p.length<30?"l":p.length<40?"m":"s",alt:`${$.displayName} @${$.acct}`,squircle:$==null?void 0:$.bot},$.id),c==="favourite+reblog"&&e("div",{class:"account-sub-icons",children:$._types.map(ee=>e(w,{icon:sn[ee],size:"s",class:`${ee}-icon`}))})]})," "]})),e("button",{type:"button",class:"small plain",onClick:F,children:[p.length>xt&&`+${p.length-xt}`,e(w,{icon:"chevron-down"})]})]}),(u==null?void 0:u.length)>1&&e("ul",{class:"notification-group-statuses",children:u.map($=>e("li",{children:e(on,{class:`status-link status-type-${c}`,to:n?`/${n}/s/${$.id}`:`/s/${$.id}`,children:e(ve,{status:$,size:"s"})})},$.id))}),s&&(!(u!=null&&u.length)||(u==null?void 0:u.length)<=1)&&e(on,{class:`status-link status-type-${c}`,to:n?`/${n}/s/${m}`:`/s/${m}`,onContextMenu:$=>{const E=$.target.querySelector(".status");if(E){if($.metaKey)return;$.preventDefault(),E.dispatchEvent(new MouseEvent("contextmenu",{clientX:$.clientX,clientY:$.clientY}))}},children:o?e(ve,{status:f,size:"s"}):e(ve,{statusID:m,size:"s"})})]})]})}function on(t){const n=Jn();return e(j,{...t,"data-read-more":"Read more →",ref:n})}const Ys=We(function(){if(!("serviceWorker"in navigator))return null;const n=ae(v),{routeNotification:r}=n,{id:o,accessToken:i}=r||{},[s,l]=C(!1);ze(()=>{if(!o||!i)return;const{instance:p}=z(),{masto:u,instance:c}=z({accessToken:i}),f=p===c,m=i?Yn(i):et();(async()=>{const a=await u.v1.notifications.$select(o).fetch();if(a&&m){const h=m.instanceURL,{type:g,status:y,account:b}=a,S=!!document.querySelector("#modal-container > *"),k=g==="follow"&&!!(b!=null&&b.id),T=!!(b!=null&&b.id),R=!!(y!=null&&y.id);k&&f?v.showAccount={account:b,instance:h}:S||!f||T&&R?l({id:o,account:m,notification:a,sameInstance:f}):R?location.hash=`/${p}/s/${y.id}`:k?location.hash=`/${p}/a/${b.id}`:location.hash="/notifications"}})()},[o,i]),ze(()=>{const p=u=>{const{type:c,id:f,accessToken:m}=(u==null?void 0:u.data)||{};c==="notification"&&(v.routeNotification={id:f,accessToken:m})};return navigator.serviceWorker.addEventListener("message",p),()=>{navigator.serviceWorker.removeEventListener("message",p)}},[]),ze(()=>{navigator!=null&&navigator.clearAppBadge&&navigator.clearAppBadge()},[]),wt(p=>{p&&(navigator!=null&&navigator.clearAppBadge)&&navigator.clearAppBadge()});const d=()=>{l(!1),v.routeNotification=null,/\/notifications\?id=/i.test(location.hash)&&(location.hash="/notifications")};if(s){const{id:p,account:u,notification:c,sameInstance:f}=s;return e(ue,{class:"light",onClick:m=>{m.target===m.currentTarget&&d()},children:e("div",{class:"sheet",tabIndex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:d,children:e(w,{icon:"x"})}),e("header",{children:e("b",{children:"Notification"})}),e("main",{children:[!f&&e("p",{children:"This notification is from your other account."}),e("div",{class:"notification-peek",onClick:m=>{const{target:a}=m;(m.target.tagName==="BUTTON"||m.target.tagName==="A")&&d()},children:e(Bt,{instance:u.instanceURL,notification:c,isStatic:!0})}),e("div",{style:{textAlign:"end"},children:e(j,{to:"/notifications",class:"button light",onClick:d,children:[e("span",{children:"View all notifications"})," ",e(w,{icon:"arrow-right"})]})})]})]})})}return null});const Dn=os((t,n)=>{const{instance:r}=z(),[o,i]=Be(),[s,l]=C(!1),[d,p]=C(o.get("q")||""),u=o.get("type"),c=P(null),f=P(null);return cs(n,()=>({setValue:m=>{p(m)},focus:()=>{f.current.focus()},select:()=>{f.current.select()},blur:()=>{f.current.blur()}})),e("form",{ref:c,class:"search-popover-container",onSubmit:m=>{var h;if(m.preventDefault(),/\/search/.test(location.hash))if(d){const g={q:d};u&&(g.type=u),i(g)}else i({});else d?location.hash=`/search?q=${encodeURIComponent(d)}${u?`&type=${u}`:""}`:location.hash="/search";(h=t==null?void 0:t.onSubmit)==null||h.call(t,m)},children:[e("input",{ref:f,value:d,name:"q",type:"search",placeholder:"Search",dir:"auto",autocomplete:"off",autocorrect:"off",autocapitalize:"off",onSearch:m=>{m.target.value||i({})},onInput:m=>{p(m.target.value),l(!0)},onFocus:()=>{l(!0)},onBlur:()=>{var m,a;setTimeout(()=>{l(!1)},100),(a=(m=c.current)==null?void 0:m.querySelector(".search-popover-item.focus"))==null||a.classList.remove("focus")},onKeyDown:m=>{var h;const{key:a}=m;switch(a){case"Escape":l(!1);break;case"Down":case"ArrowDown":if(m.preventDefault(),s){const g=c.current.querySelector(".search-popover-item.focus");if(g){let y=g.nextElementSibling;for(;y&&y.hidden;)y=y.nextElementSibling;y&&(y.classList.add("focus"),Array.from(y.parentElement.children).filter(S=>S!==y).forEach(S=>{S.classList.remove("focus")}))}else{const y=c.current.querySelector(".search-popover-item");y&&y.classList.add("focus")}}break;case"Up":case"ArrowUp":if(m.preventDefault(),s){const g=document.querySelector(".search-popover-item.focus");if(g){let y=g.previousElementSibling;for(;y&&y.hidden;)y=y.previousElementSibling;y&&(y.classList.add("focus"),Array.from(y.parentElement.children).filter(S=>S!==y).forEach(S=>{S.classList.remove("focus")}))}else{const y=document.querySelector(".search-popover-item:last-child");y&&y.classList.add("focus")}}break;case"Enter":if(s){const g=document.querySelector(".search-popover-item.focus");g&&(m.preventDefault(),g.click()),l(!1),(h=t==null?void 0:t.onSubmit)==null||h.call(t,m)}break}}}),e("div",{class:"search-popover",hidden:!s||!d,children:!!d&&[{label:e(x,{children:["Posts with ",e("q",{children:d})]}),to:`/search?q=${encodeURIComponent(d)}&type=statuses`,hidden:/^https?:/.test(d)},{label:e(x,{children:["Posts tagged with ",e("mark",{children:["#",d.replace(/^#/,"")]})]}),to:`/${r}/t/${d.replace(/^#/,"")}`,hidden:/^@/.test(d)||/^https?:/.test(d)||/\s/.test(d),top:/^#/.test(d),type:"link"},{label:e(x,{children:["Look up ",e("mark",{children:d})]}),to:`/${d}`,hidden:!/^https?:/.test(d),top:/^https?:/.test(d),type:"link"},{label:e(x,{children:["Accounts with ",e("q",{children:d})]}),to:`/search?q=${encodeURIComponent(d)}&type=accounts`}].sort((m,a)=>m.top&&!a.top?-1:!m.top&&a.top?1:0).map(({label:m,to:a,hidden:h,type:g})=>e(j,{to:a,class:"search-popover-item",hidden:h,onClick:y=>{var b;(b=t==null?void 0:t.onSubmit)==null||b.call(t,y)},children:[e(w,{icon:g==="link"?"arrow-right":"search",class:"more-insignificant"}),e("span",{children:m})," "]}))})]})}),Xs=We(function({onClose:n=()=>{}}){const[r,o]=C(!1),i=P(null);ke("/",l=>{o(!0),setTimeout(()=>{var d,p,u,c;(p=(d=i.current)==null?void 0:d.focus)==null||p.call(d),(c=(u=i.current)==null?void 0:u.select)==null||c.call(u)},0)},{preventDefault:!0,ignoreEventWhen:l=>{const d=/\/search/.test(location.hash),p=!!document.querySelector("#modal-container > *");return d||p}});const s=()=>{o(!1),n()};return ke("esc",l=>{var d,p;(p=(d=i.current)==null?void 0:d.blur)==null||p.call(d),s()},{enabled:r,enableOnFormTags:!0,preventDefault:!0}),e("div",{id:"search-command-container",hidden:!r,onClick:l=>{l.target===l.currentTarget&&s()},children:e(Dn,{ref:i,onSubmit:()=>{s()}})})});function Zs(){const{instance:t}=z(),n=ae(v),{shortcuts:r}=n;if(!r.length)return null;const o=P(),i=he(()=>r.map((l,d)=>{const{type:p,...u}=l;if(!vt[p])return null;let{id:c,path:f,title:m,subtitle:a,icon:h}=vt[p];return typeof c=="function"&&(c=c(u,d)),typeof f=="function"&&(f=f({...u,instance:u.instance||t},d)),typeof m=="function"&&(m=m(u,d)),typeof a=="function"&&(a=a(u,d)),typeof h=="function"&&(h=h(u,d)),{id:c,path:f,title:m,subtitle:a,icon:h}}).filter(Boolean),[r]),s=wn();return ke(["1","2","3","4","5","6","7","8","9"],(l,d)=>{var u,c;const p=parseInt(d.keys[0],10)-1;if(p<i.length){const{path:f}=i[p];f&&(s(f),(c=(u=o.current)==null?void 0:u.closeMenu)==null||c.call(u))}}),e("div",{id:"shortcuts",children:n.settings.shortcutsViewMode==="tab-menu-bar"?e("nav",{class:"tab-bar",children:e("ul",{children:i.map(({id:l,path:d,title:p,subtitle:u,icon:c},f)=>e("li",{children:e(j,{class:u?"has-subtitle":"",to:d,onClick:m=>{if(m.target.classList.contains("is-active")){m.preventDefault();const a=document.getElementById(`${l}-page`);if(a){a.scrollTop=0;const h=a.querySelector(".updates-button");h&&h.click()}}},children:[e(w,{icon:c,size:"xl",alt:p}),e("span",{children:[e(At,{children:p}),u&&e(x,{children:[e("br",{}),e("small",{children:u})]})]})]})},f+p))})}):e(Ke,{instanceRef:o,overflow:"auto",viewScroll:"close",boundingBoxPadding:"8 8 8 8",menuClassName:"glass-menu shortcuts-menu",gap:8,position:"anchor",menuButton:e("button",{type:"button",id:"shortcuts-button",class:"plain",onTransitionStart:l=>{var d,p;try{const{target:u}=l;getComputedStyle(u).pointerEvents==="none"&&((p=(d=o.current)==null?void 0:d.closeMenu)==null||p.call(d))}catch{}},children:e(w,{icon:"shortcut",size:"xl",alt:"Shortcuts"})}),children:i.map(({path:l,title:d,subtitle:p,icon:u},c)=>e(Ce,{to:l,class:"glass-menu-item",children:[e(w,{icon:u,size:"l"})," ",e("span",{class:"menu-grow",children:[e("span",{children:e(At,{children:d})}),p&&e(x,{children:[" ",e("small",{class:"more-insignificant",children:p})]})]}),e("span",{class:"menu-shortcut hide-until-focus-visible",children:c+1})]},c+d))})})}function ot(t){const{containerProps:n}=t,r=as(),o=P();return e(Ke,{boundingBoxPadding:gn(),repositionFlag:`${r.width}x${r.height}`,...t,instanceRef:o,containerProps:{onClick:i=>{var s,l,d;i.target===i.currentTarget&&((l=(s=o.current)==null?void 0:s.closeMenu)==null||l.call(s)),(d=n==null?void 0:n.onClick)==null||d.call(n,i)},...n}})}function Qs(t){var i;let n=[],r=[],o=0;for(let s=0;s<t.length;s++){const l=t[s];l.reblog&&!((i=l.account)!=null&&i.group)?(r.push(l),o++):(n.push(l),o<3&&(o=0))}if(t.length>10&&(r.length>t.length/4||o>=3)){const s=r.map(l=>l.id);if(r.length>t.length*3/4)n=[...n,{id:s,items:r,type:"boosts"}];else{const l=Math.floor(n.length/2);n=[...n.slice(0,l),{id:s,items:r,type:"boosts"},...n.slice(l)]}return n}else return t}function cn(t,n){const r=K.account.get("boostedStatusIDs")||{},o=t.filter(s=>{if(!s.reblog)return!0;const l=`${n}-${s.reblog.id}`,d=r[l];return d&&d!==s.id?!1:(r[l]=s.id,!0)}),i=Object.keys(r);return i.length>50&&i.slice(0,i.length-50).forEach(s=>{delete r[s]}),K.account.set("boostedStatusIDs",r),o}function ei(t){const n=[];let r=0;t.forEach(s=>{for(let d=0;d<n.length;d++){if(n[d].find(p=>p.id===s.id))return;if(n[d].find(p=>p.id===s.inReplyToId)||n[d].find(p=>p.inReplyToId===s.id)){n[d].push(s);return}}const l=t.find(d=>d.id===s.inReplyToId);l&&(n[r++]=[s,l])});for(let s=0;s<n.length;s++)for(let l=s+1;l<n.length;l++)n[s].find(p=>n[l].includes(p))&&(n[s]=[...n[s],...n[l]],n[s]=n[s].filter((p,u,c)=>c.findIndex(f=>f.id===p.id)===u),n.splice(l,1),l--);n.forEach(s=>{s.sort((l,d)=>!l.inReplyToId&&!d.inReplyToId?new Date(l.createdAt)-new Date(d.createdAt):l.inReplyToId===d.id?1:d.inReplyToId===l.id||!l.inReplyToId?-1:d.inReplyToId?new Date(l.createdAt)-new Date(d.createdAt):1)}),n.forEach(s=>{const l=s[0].account.id;s.forEach(d=>{d.account.id!==l&&(d._differentAuthor=!0)})}),n.length;const o=[],i=[];return t.forEach(s=>{if(s.reblog){o.push(s);return}for(let l=0;l<n.length;l++)if(n[l].find(d=>d.id===s.id)){if(i.includes(l))return;const d=n[l];d.sort((u,c)=>{const f=new Date(u.createdAt),m=new Date(c.createdAt);return f-m});const p=d[0].account.id;o.push({id:d.map(u=>u.id),items:d,type:d.every(u=>u.account.id===p)?"thread":"conversation"}),i.push(l);return}o.push(s)}),o}function Tt({scrollableRef:t,distanceFromStart:n=1,distanceFromEnd:r=1,scrollThresholdStart:o=10,scrollThresholdEnd:i=10,direction:s="vertical",distanceFromStartPx:l,distanceFromEndPx:d}={}){const[p,u]=C(null),[c,f]=C(!1),[m,a]=C(!1),[h,g]=C(!1),[y,b]=C(!1),S=s==="vertical";return ze(()=>{const k=t.current;if(!k)return{};let T=S?k.scrollTop:k.scrollLeft;function R(){const{scrollTop:F,scrollLeft:A,scrollHeight:M,scrollWidth:B,clientHeight:O,clientWidth:$}=k,E=S?F:A,ee=S?M:B,G=S?O:$,xe=Math.abs(E-T),we=l||Math.min(G*n,ee,E),ye=d||Math.min(G*r,ee,ee-E-G);xe>=(T<E?i:o)&&(u(T<E?"end":"start"),T=E),f(E<=0),a(E+G>=ee),g(E<=we),b(E+G>=ee-ye)}return k.addEventListener("scroll",R,{passive:!0}),()=>k.removeEventListener("scroll",R)},[n,r,o,i]),{scrollDirection:p,reachStart:c,reachEnd:m,nearReachStart:h,nearReachEnd:y,init:()=>{t.current&&t.current.dispatchEvent(new Event("scroll"))}}}function ct(t){var k,T,R,F,A;const n=ae(v),{masto:r,instance:o,authenticated:i}=z(),[s,l]=C(),[d,p]=C(!1);_(()=>{const M=K.local.getJSON("accounts")||[],B=M.find(O=>O.info.id===K.session.get("currentAccount"));B&&l(B),p(M.length>1)},[]);const u=(n.settings.shortcutsColumnsMode||n.settings.shortcutsViewMode==="multi-column")&&!n.shortcuts.find(M=>M.type==="following"),c=ls(()=>{v.showAccounts=!0},{threshold:600,detect:"touch",cancelOnMovement:!0}),f=P(),[m,a]=C(void 0),h=gn([0,0,n.settings.shortcutsViewMode==="tab-menu-bar"?50:0,0]),g=P();async function y(M){return(M||!g.current)&&(g.current=r.v1.mutes.list({limit:80})),await g.current.next()}const b=P();async function S(M){return(M||!b.current)&&(b.current=r.v1.blocks.list({limit:80})),await b.current.next()}return e(x,{children:[e("button",{ref:f,type:"button",class:`button plain nav-menu-button ${d?"with-avatar":""} ${open?"active":""}`,style:{position:"relative"},onClick:()=>{a(M=>M?void 0:"open")},onContextMenu:M=>{M.preventDefault(),v.showAccounts=!0},...c(),children:[d&&e(je,{url:((k=s==null?void 0:s.info)==null?void 0:k.avatar)||((T=s==null?void 0:s.info)==null?void 0:T.avatarStatic),size:"l",squircle:(R=s==null?void 0:s.info)==null?void 0:R.bot}),e(w,{icon:"menu",size:d?"s":"l"})]}),e(vn,{menuClassName:"nav-menu",state:m,anchorRef:f,onClose:()=>{a(void 0)},containerProps:{style:{zIndex:10},onClick:()=>{a(void 0)}},portal:{target:document.body},...t,overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:h,unmountOnClose:!0,children:[!!((F=n.appVersion)!=null&&F.commitHash)&&n.appVersion.commitHash!=="12d0e6a"&&e("div",{class:"top-menu",children:[e(J,{onClick:()=>{confirm("Reload page now to update?")&&(async()=>{try{location.reload()}catch{}})()},children:[e(w,{icon:"sparkles",class:"sparkle-icon",size:"l"})," ",e("span",{children:"New update available…"})]}),e(De,{})]}),e("section",{children:[e(Ce,{to:"/",children:[e(w,{icon:"home",size:"l"})," ",e("span",{children:"Home"})]}),i&&e(x,{children:[u&&e(Ce,{to:"/following",children:[e(w,{icon:"following",size:"l"})," ",e("span",{children:"Following"})]}),e(Ce,{to:"/mentions",children:[e(w,{icon:"at",size:"l"})," ",e("span",{children:"Mentions"})]}),e(Ce,{to:"/notifications",children:[e(w,{icon:"notification",size:"l"})," ",e("span",{children:"Notifications"}),n.notificationsShowNew&&e("sup",{title:"New",style:{opacity:.5},children:[" ","•"]})]}),e(De,{}),e(Ce,{to:"/l",children:[e(w,{icon:"list",size:"l"})," ",e("span",{children:"Lists"})]}),e(Ce,{to:"/ft",children:[e(w,{icon:"hashtag",size:"l"})," ",e("span",{children:"Followed Hashtags"})]}),e(Ce,{to:"/b",children:[e(w,{icon:"bookmark",size:"l"})," ",e("span",{children:"Bookmarks"})]}),e(Ce,{to:"/f",children:[e(w,{icon:"heart",size:"l"})," ",e("span",{children:"Favourites"})]})]}),e(De,{}),e(Ce,{to:"/search",children:[e(w,{icon:"search",size:"l"})," ",e("span",{children:"Search"})]}),e(Ce,{to:`/${o}/p/l`,children:[e(w,{icon:"group",size:"l"})," ",e("span",{children:"Local"})]}),e(Ce,{to:`/${o}/p`,children:[e(w,{icon:"earth",size:"l"})," ",e("span",{children:"Federated"})]}),e(Ce,{to:`/${o}/trending`,children:[e(w,{icon:"chart",size:"l"})," ",e("span",{children:"Trending"})]})]}),e("section",{children:i?e(x,{children:[e(De,{}),((A=s==null?void 0:s.info)==null?void 0:A.id)&&e(Ce,{to:`/${o}/a/${s.info.id}`,children:[e(w,{icon:"user",size:"l"})," ",e("span",{children:"Profile"})]}),e(J,{onClick:()=>{v.showAccounts=!0},children:[e(w,{icon:"group",size:"l"})," ",e("span",{children:"Accounts…"})]}),e(J,{onClick:()=>{v.showGenericAccounts={id:"mute",heading:"Muted users",fetchAccounts:y}},children:[e(w,{icon:"mute",size:"l"})," Muted users…"]}),e(J,{onClick:()=>{v.showGenericAccounts={id:"block",heading:"Blocked users",fetchAccounts:S}},children:[e(w,{icon:"block",size:"l"}),"Blocked users…"]}),e(De,{className:"divider-grow"}),e(J,{onClick:()=>{v.showKeyboardShortcutsHelp=!0},children:[e(w,{icon:"keyboard",size:"l"})," ",e("span",{children:"Keyboard shortcuts"})]}),e(J,{onClick:()=>{v.showShortcutsSettings=!0},children:[e(w,{icon:"shortcut",size:"l"})," ",e("span",{children:"Shortcuts / Columns…"})]}),e(J,{onClick:()=>{v.showSettings=!0},children:[e(w,{icon:"gear",size:"l"})," ",e("span",{children:"Settings…"})]})]}):e(x,{children:[e(De,{}),e(Ce,{to:"/login",children:[e(w,{icon:"user",size:"l"})," ",e("span",{children:"Log in"})]}),e(J,{onClick:()=>{v.showSettings=!0},children:[e(w,{icon:"gear",size:"l"})," ",e("span",{children:"Settings…"})]})]})})]})]})}const dt={block:"nearest",inline:"center",behavior:"smooth"};function Oe({title:t,titleComponent:n,id:r,instance:o,emptyText:i,errorText:s,useItemID:l,boostsCarousel:d,fetchItems:p=()=>{},checkForUpdates:u=()=>{},checkForUpdatesInterval:c=6e4,headerStart:f,headerEnd:m,timelineStart:a,allowFilters:h,refresh:g}){const y=ae(v),[b,S]=C([]),[k,T]=C("default"),[R,F]=C(!1),[A,M]=C(!1),[B,O]=C(!0),$=P(),E=kn(H=>{M(!1),k!=="loading"&&(T("loading"),(async()=>{try{let{done:X,value:W}=await p(H);Array.isArray(W)?(d&&(W=Qs(W)),W=ei(W),S(H?W:ne=>[...ne,...W]),W.length||(X=!0),F(!X)):F(!1),T("default")}catch{T("error")}finally{E.cancel()}})())},1500,{leading:!0,trailing:!1}),ee=".timeline-item, .timeline-item-alt",G=ke("j, shift+j",(H,X)=>{const W=document.activeElement.closest(ee),ne=W==null?void 0:W.getBoundingClientRect(),te=Array.from($.current.querySelectorAll(ee));if(W&&ne.top<$.current.clientHeight&&ne.bottom>0){const I=te.indexOf(W);let L=te[I+1];X.shift&&(L=te.find((V,N)=>N>I&&!V.classList.contains("timeline-item-alt"))),L&&(L.focus(),L.scrollIntoView(dt))}else{const I=te.find(L=>{const V=L.getBoundingClientRect();return V.top>=44&&V.left>=0});I&&(I.focus(),I.scrollIntoView(dt))}}),xe=ke("k, shift+k",(H,X)=>{const W=document.activeElement.closest(ee),ne=W==null?void 0:W.getBoundingClientRect(),te=Array.from($.current.querySelectorAll(ee));if(W&&ne.top<$.current.clientHeight&&ne.bottom>0){const I=te.indexOf(W);let L=te[I-1];X.shift&&(L=te.findLast((V,N)=>N<I&&!V.classList.contains("timeline-item-alt"))),L&&(L.focus(),L.scrollIntoView(dt))}else{const I=te.find(L=>{const V=L.getBoundingClientRect();return V.top>=44&&V.left>=0});I&&(I.focus(),I.scrollIntoView(dt))}}),we=ke(["enter","o"],()=>{const H=document.activeElement.closest(ee);H&&H.click()}),{scrollDirection:ye,nearReachStart:se,nearReachEnd:Le,reachStart:D,reachEnd:Y}=Tt({scrollableRef:$,distanceFromEnd:2,scrollThresholdStart:44});_(()=>{var H;(H=$.current)==null||H.scrollTo({top:0}),E(!0)},[]),_(()=>{E(!0)},[g]),_(()=>{D&&E(!0)},[D]),_(()=>{(Le||Y&&R)&&E()},[Le,R]);const ie=Sn(5e3),fe=Ge(async({disableHoverCheck:H=!1}={})=>{y.settings.autoRefresh&&$.current.scrollTop===0&&(H||ie)&&!si()?E(!0):await u()&&M(!0)},[r,ie,E,u,y.settings.autoRefresh]),Ae=P();wt(H=>{if(H){const X=Date.now()-Ae.current;(!Ae.current||X>1e3*60)&&fe({disableHoverCheck:!0})}else Ae.current=Date.now();O(H)},[u,fe,y.settings.autoRefresh]),dn(fe,B&&!A?c:null);const $e=ye==="end"&&!se;return e("div",{id:`${r}-page`,class:"deck-container",ref:H=>{$.current=H,G.current=H,xe.current=H,we.current=H},tabIndex:"-1",children:e("div",{class:"timeline-deck deck",children:[e("header",{hidden:$e,onClick:H=>{var X;H.target.closest("a, button")||(X=$.current)==null||X.scrollTo({top:0,behavior:"smooth"})},onDblClick:H=>{H.target.closest("a, button")||E(!0)},class:k==="loading"?"loading":"",children:[e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(ct,{}),f??e(j,{to:"/",class:"button plain home-button",children:e(w,{icon:"home",size:"l"})})]}),t&&(n||e("h1",{children:t})),e("div",{class:"header-side",children:!!m&&m})]}),b.length>0&&k!=="loading"&&!$e&&A&&e("button",{class:"updates-button shiny-pill",type:"button",onClick:()=>{var H;E(!0),(H=$.current)==null||H.scrollTo({top:0,behavior:"smooth"})},children:[e(w,{icon:"arrow-up"})," New posts"]})]}),!!a&&e("div",{class:`timeline-start ${k==="loading"?"loading":""}`,children:a}),b.length?e(x,{children:[e("ul",{class:"timeline",children:[b.map(H=>{const{id:X,reblog:W,items:ne,type:te,_pinned:I}=H,L=(W==null?void 0:W.id)||X,V=o?`/${o}/s/${L}`:`/s/${L}`;let N="";te==="boosts"?N=`${ne.length} Boosts`:te==="pinned"&&(N="Pinned posts");const Z=te==="boosts"||te==="pinned";if(ne){if(Z)return ne.sort((Q,le)=>Q._filtered&&!le._filtered?1:!Q._filtered&&le._filtered?-1:0),e("li",{class:"timeline-item-carousel",children:e(ti,{title:N,class:`${te}-carousel`,children:ne.map(Q=>{const{id:le,reblog:Re}=Q,re=(Re==null?void 0:Re.id)||le,Ee=o?`/${o}/s/${re}`:`/s/${re}`;return e("li",{children:e(j,{class:"status-carousel-link timeline-item-alt",to:Ee,children:l?e(ve,{statusID:le,instance:o,size:"s",contentTextWeight:!0,allowFilters:h}):e(ve,{status:Q,instance:o,size:"s",contentTextWeight:!0,allowFilters:h})})},le)})})},`timeline-${X}`);const Te=ne.length>3;return ne.map((Q,le)=>{const{id:Re,_differentAuthor:re}=Q,Ee=o?`/${o}/s/${Re}`:`/s/${Re}`,U=le>0&&le<ne.length-1,oe=Q.sensitive&&!!Q.spoilerText,pe=!re&&oe&&le>0||Te&&U&&(te==="thread"||te==="conversation"&&!re&&!ne[le-1]._differentAuthor&&!ne[le+1]._differentAuthor);return e("li",{class:`timeline-item-container timeline-item-container-type-${te} timeline-item-container-${le===0?"start":le===ne.length-1?"end":"middle"} ${re?"timeline-item-diff-author":""}`,children:e(j,{class:"status-link timeline-item",to:Ee,children:pe?e(ni,{status:Q,instance:o}):l?e(ve,{statusID:Re,instance:o,allowFilters:h}):e(ve,{status:Q,instance:o,allowFilters:h})})},`timeline-${Re}`)})}return e("li",{children:e(j,{class:"status-link timeline-item",to:V,children:l?e(ve,{statusID:X,instance:o,allowFilters:h}):e(ve,{status:H,instance:o,allowFilters:h})})},`timeline-${X+I}`)}),R&&k==="loading"&&e(x,{children:[e("li",{style:{height:"20vh"},children:e(ve,{skeleton:!0})}),e("li",{style:{height:"25vh"},children:e(ve,{skeleton:!0})})]})]}),k==="default"&&(R?e(it,{onChange:H=>{H&&E()},children:e("button",{type:"button",class:"plain block",onClick:()=>E(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}))]}):k==="loading"?e("ul",{class:"timeline",children:Array.from({length:5}).map((H,X)=>e("li",{children:e(ve,{skeleton:!0})},X))}):k!=="error"&&e("p",{class:"ui-state",children:i}),k==="error"&&e("p",{class:"ui-state",children:[s,e("br",{}),e("br",{}),e("button",{class:"button plain",onClick:()=>E(!b.length),children:"Try again"})]})]})})}function ti({title:t,class:n,children:r}){const o=P(),{reachStart:i,reachEnd:s,init:l}=Tt({scrollableRef:o,direction:"horizontal"});return _(()=>{l==null||l()},[]),e("div",{class:`status-carousel ${n}`,children:[e("header",{children:[e("h3",{children:t}),e("span",{children:[e("button",{type:"button",class:"small plain2",disabled:i,onClick:()=>{var d,p;(p=o.current)==null||p.scrollBy({left:-Math.min(320,(d=o.current)==null?void 0:d.offsetWidth),behavior:"smooth"})},children:e(w,{icon:"chevron-left"})})," ",e("button",{type:"button",class:"small plain2",disabled:s,onClick:()=>{var d,p;(p=o.current)==null||p.scrollBy({left:Math.min(320,(d=o.current)==null?void 0:d.offsetWidth),behavior:"smooth"})},children:e(w,{icon:"chevron-right"})})]})]}),e("ul",{ref:o,children:r})]})}function ni({status:t,instance:n}){const r=ae(v),{id:o}=t,i=bn(t),s=Ut(o,n);return e("article",{class:"status compact-thread",tabindex:"-1",children:[r.statusThreadNumber[s]?e("div",{class:"status-thread-badge",children:[e(w,{icon:"thread",size:"s"}),r.statusThreadNumber[s]?` ${r.statusThreadNumber[s]}/X`:""]}):e("div",{class:"status-thread-badge",children:e(w,{icon:"thread",size:"s"})}),e("div",{class:"content-compact",title:i,children:[i,t.sensitive&&t.spoilerText&&e(x,{children:[" ",e("span",{class:"spoiler-badge",children:e(w,{icon:"eye-close",size:"s"})})]})]})]})}function si(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}const ii=20;function oi(){const t=ae(v),{id:n,...r}=Je(),[o,i]=Be(),s=!o.get("replies"),l=!!o.get("boosts"),d=o.get("tagged"),p=!!o.get("media"),{masto:u,instance:c,authenticated:f}=z({instance:r.instance}),m=P();async function a(O){const $=[];if(O){const{value:G}=await u.v1.accounts.$select(n).statuses.list({pinned:!0}).next();if(G!=null&&G.length&&!d&&!p)if(G.forEach(xe=>{xe._pinned=!0,Se(xe,c)}),G.length>=3){const xe=G.map(we=>we.id);$.push({id:xe,items:G,type:"pinned"})}else $.push(...G)}(O||!m.current)&&(m.current=u.v1.accounts.$select(n).statuses.list({limit:ii,exclude_replies:s,exclude_reblogs:l,only_media:p,tagged:d}));const{value:E,done:ee}=await m.current.next();return E!=null&&E.length&&($.push(...E),E.forEach(G=>{Se(G,c)})),{value:$,done:ee}}const[h,g]=C(),[y,b]=C([]);Ie(`${h!=null&&h.displayName?h.displayName+" ":""}@${h!=null&&h.acct?h.acct:"Account posts"}`,"/:instance?/a/:id"),_(()=>{(async()=>{try{const O=await u.v1.accounts.$select(n).fetch();g(O)}catch{}try{const O=await u.v1.accounts.$select(n).featuredTags.list(n);b(O)}catch{}})()},[n]);const{displayName:S,acct:k,emojis:T}=h||{},R=P(),F=he(()=>{const O=t.accounts[`${n}@${c}`],$=!s||l||d||p;return e(x,{children:[e(Rn,{instance:c,account:O||n,fetchAccount:()=>u.v1.accounts.$select(n).fetch(),authenticated:f,standalone:!0}),e("div",{class:"filter-bar",ref:R,children:[$?e(j,{to:`/${c}/a/${n}`,class:"insignificant filter-clear",title:"Clear filters",children:e(w,{icon:"x",size:"l"})},"clear-filters"):e(w,{icon:"filter",class:"insignificant",size:"l"}),e(j,{to:`/${c}/a/${n}${s?"?replies=1":""}`,onClick:()=>{s&&ce("Showing post with replies")},class:s?"":"is-active",children:"+ Replies"}),e(j,{to:`/${c}/a/${n}${l?"":"?boosts=0"}`,onClick:()=>{l||ce("Showing posts without boosts")},class:l?"is-active":"",children:"- Boosts"}),e(j,{to:`/${c}/a/${n}${p?"":"?media=1"}`,onClick:()=>{p||ce("Showing posts with media")},class:p?"is-active":"",children:"Media"}),y.map(E=>e(j,{to:`/${c}/a/${n}${d===E.name?"":`?tagged=${encodeURIComponent(E.name)}`}`,onClick:()=>{d!==E.name&&ce(`Showing posts tagged with #${E.name}`)},class:d===E.name?"is-active":"",children:e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),E.name]})}))]})]})},[n,c,f,s,l,y,d,p]);_(()=>{var $;const O=($=R.current)==null?void 0:$.querySelector(".is-active");O&&R.current.scrollTo({behavior:"smooth",left:O.offsetLeft-(R.current.offsetWidth-O.offsetWidth)/2})},[y,d,p,s,l]);const A=he(()=>h!=null&&h.url?new URL(h.url).hostname:null,[h]),B=!!h&&!(c===A);return e(Oe,{title:`${h!=null&&h.acct?"@"+h.acct:"Posts"}`,titleComponent:e("h1",{class:"header-account",children:[e("b",{children:e(fn,{text:S,emojis:T})}),e("div",{children:e("span",{children:["@",k]})})]}),id:"account-statuses",instance:c,emptyText:"Nothing to see here yet.",errorText:"Unable to load posts",fetchItems:a,useItemID:!0,boostsCarousel:t.settings.boostsCarousel,timelineStart:F,refresh:[s,l,d,p].toString(),headerEnd:e(ot,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:e(J,{disabled:!B,onClick:()=>{(async()=>{try{const{masto:O}=z({instance:A}),$=await O.v1.accounts.lookup({acct:h.acct}),{id:E}=$;location.hash=`/${A}/a/${E}`}catch{alert("Unable to fetch account info")}})()},children:[e(w,{icon:"transfer"})," ",e("small",{class:"menu-double-lines",children:["Switch to account's instance (",e("b",{children:A}),")"]})]})})},n)}const ci=20;function En(){Ie("Bookmarks","/b");const{masto:t,instance:n}=z(),r=P();async function o(i){return(i||!r.current)&&(r.current=t.v1.bookmarks.list({limit:ci})),await r.current.next()}return e(Oe,{title:"Bookmarks",id:"bookmarks",emptyText:"No bookmarks yet. Go bookmark something!",errorText:"Unable to load bookmarks",instance:n,fetchItems:o})}const ai=20;function Pn(){Ie("Favourites","/f");const{masto:t,instance:n}=z(),r=P();async function o(i){return(i||!r.current)&&(r.current=t.v1.favourites.list({limit:ai})),await r.current.next()}return e(Oe,{title:"Favourites",id:"favourites",emptyText:"No favourites yet. Go favourite something!",errorText:"Unable to load favourites",instance:n,fetchItems:o})}const li=200;function ri(){const{masto:t,instance:n}=z();Ie("Followed Hashtags","/ft");const[r,o]=C("default"),[i,s]=C([]);return _(()=>{o("loading"),(async()=>{try{const l=t.v1.followedTags.list({limit:li}),d=[];do{const{value:p,done:u}=await l.next();if(u||(p==null?void 0:p.length)===0)break;d.push(...p)}while(!0);d.sort((p,u)=>p.name.localeCompare(u.name)),s(d),o("default")}catch{o("error")}})()},[]),e("div",{id:"followed-hashtags-page",class:"deck-container",tabIndex:"-1",children:e("div",{class:"timeline-deck deck",children:[e("header",{children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(ct,{}),e(j,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l"})})]}),e("h1",{children:"Followed Hashtags"}),e("div",{class:"header-side"})]})}),e("main",{children:i.length>0?e("ul",{class:"link-list",children:i.map(l=>e("li",{children:e(j,{to:n?`/${n}/t/${l.name}`:`/t/${l.name}`,children:[e(w,{icon:"hashtag"})," ",e("span",{children:l.name})]})}))}):r==="loading"?e("p",{class:"ui-state",children:e(be,{abrupt:!0})}):r==="error"?e("p",{class:"ui-state",children:"Unable to load followed hashtags."}):e("p",{class:"ui-state",children:"No hashtags followed yet."})})]})})}function di(t,n,r){var p;const{filtered:o}=t;if(!(o!=null&&o.length)||r&&((p=t.account)==null?void 0:p.id)===r)return!0;const s=o.filter(u=>{const{filter:c}=u,f=c.context.includes(n);return f?c.expiresAt?new Date(c.expiresAt)>new Date:f:!1});if(!s.length)return!0;if(s.some(u=>u.filter.filterAction==="hide"))return!1;const d=s.some(u=>u.filter.filterAction==="warn");if(d){const u=s.map(c=>c.filter.title);t._filtered={titles:u,titlesStr:u.join(" • ")}}return d}function He(t,n){if(!(t!=null&&t.length))return[];if(!n)return t;const r=K.session.get("currentAccount");return t.filter(o=>di(o,n,r))}const ui=20;function Ot({title:t,path:n,id:r,...o}){Ie(t||"Following",n||"/following");const{masto:i,streaming:s,instance:l}=z(),d=ae(v),p=P(),u=P();async function c(m){(m||!p.current)&&(p.current=i.v1.timelines.home.list({limit:ui}));const a=await p.current.next();let{value:h}=a;return h!=null&&h.length&&(m&&(u.current=h[0].id),h=He(h,"home"),h.forEach(g=>{Se(g,l)}),h=cn(h,l),h.sort((g,y)=>{const b=new Date(g.createdAt);return new Date(y.createdAt)-b})),{...a,value:h}}async function f(){try{const m=await i.v1.timelines.home.list({limit:5,since_id:u.current}).next();let{value:a}=m;return!!(a!=null&&a.length&&(u.current=a[0].id,a=cn(a,l),a=He(a,"home"),a.some(h=>!h.reblog)))}catch{return!1}}return _(()=>{let m;return(async()=>{if(s){m=s.user.subscribe();for await(const a of m){if(!m)break;if(a.event==="status.update"){const h=a.payload;Se(h,l)}else if(a.event==="delete"){const h=a.payload,g=yn(h,l);g&&(g._deleted=!0)}}}})(),()=>{var a;(a=m==null?void 0:m.unsubscribe)==null||a.call(m),m=null}},[s]),e(Oe,{title:t||"Following",id:r||"following",emptyText:"Nothing to see here.",errorText:"Unable to load posts.",instance:l,fetchItems:c,checkForUpdates:f,useItemID:!0,boostsCarousel:d.settings.boostsCarousel,...o,allowFilters:!0})}const hi=20,fi=4,an=fi+1;function Nn({columnMode:t,...n}){let{hashtag:r,...o}=t?{}:Je();n.hashtag&&(r=n.hashtag);let i=r.trim().split(/[\s+]+/);i.sort(),r=i[0];const{masto:s,instance:l,authenticated:d}=z({instance:(n==null?void 0:n.instance)||o.instance}),{authenticated:p}=z(),u=i.map(T=>`#${T}`).join(" "),c=l?`${u} on ${l}`:u;Ie(c,"/:instance?/t/:hashtag");const f=P(),m=P(void 0);async function a(T){const R=await s.v1.timelines.tag.$select(r).list({limit:hi,any:i.slice(1),maxId:T?void 0:m.current}).next(),{value:F}=R;return F!=null&&F.length&&(T&&(f.current=F[0].id),F.forEach(A=>{Se(A,l)}),m.current=F[F.length-1].id),{...R,value:F}}async function h(){try{const T=await s.v1.timelines.tag.$select(r).list({limit:1,any:i.slice(1),since_id:f.current}).next(),{value:R}=T;return!!(R!=null&&R.length)}catch{return!1}}const[g,y]=C("default"),[b,S]=C();_(()=>{(async()=>{try{const T=await s.v1.tags.$select(r).fetch();S(T)}catch{}})()},[r]);const k=i.length>=an;return e(Oe,{title:c,titleComponent:!!l&&e("h1",{class:"header-account",children:[e("b",{children:u}),e("div",{children:l})]}),id:"hashtag",instance:l,emptyText:"No one has posted anything with this tag yet.",errorText:"Unable to load posts with this tag",fetchItems:a,checkForUpdates:h,useItemID:!0,headerEnd:e(ot,{portal:!0,setDownOverflow:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[!!b&&i.length===1&&e(x,{children:[e(_e,{subMenu:!0,confirm:b.following,confirmLabel:`Unfollow #${r}?`,disabled:g==="loading"||!d,onClick:()=>{y("loading"),b.following?s.v1.tags.$select(r).unfollow().then(()=>{S({...b,following:!1}),ce(`Unfollowed #${r}`)}).catch(T=>{alert(T)}).finally(()=>{y("default")}):s.v1.tags.$select(r).follow().then(()=>{S({...b,following:!0}),ce(`Followed #${r}`)}).catch(T=>{alert(T)}).finally(()=>{y("default")})},children:b.following?e(x,{children:[e(w,{icon:"check-circle"})," ",e("span",{children:"Following…"})]}):e(x,{children:[e(w,{icon:"plus"})," ",e("span",{children:"Follow"})]})}),e(De,{})]}),e(rs,{className:"menu-field",disabled:k,children:({ref:T})=>e("form",{onSubmit:R=>{var A,M;R.preventDefault();const F=(M=(A=R.target[0].value)==null?void 0:A.trim)==null?void 0:M.call(A);F&&!i.some(B=>B.toLowerCase()===F.toLowerCase())&&(i.push(F),i.sort(),location.hash=l?`/${l}/t/${i.join("+")}`:`/t/${i.join("+")}`)},children:[e(w,{icon:"hashtag"}),e("input",{ref:T,type:"text",placeholder:k?`Max ${an} tags`:"Add hashtag",required:!0,autocorrect:"off",autocapitalize:"off",spellcheck:!1,pattern:"[^#][^\\s#]+[^#]",disabled:k})]})}),e(ds,{takeOverflow:!0,children:i.map((T,R)=>e(J,{disabled:i.length===1,onClick:F=>{i.splice(R,1),i.sort(),location.hash=l?`/${l}/t/${i.join("+")}`:`/t/${i.join("+")}`},children:[e(w,{icon:"x",alt:"Remove hashtag",class:"danger-icon"}),e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),T]})]},T))}),e(De,{}),e(J,{disabled:!p,onClick:()=>{const T={type:"hashtag",hashtag:i.join(" "),instance:l};v.shortcuts.some(F=>F.type===T.type&&F.hashtag.split(/[\s+]+/).sort().join(" ")===T.hashtag.split(/[\s+]+/).sort().join(" ")&&(F.instance?F.instance===T.instance:!0))?alert("This shortcut already exists"):(v.shortcuts.push(T),ce("Hashtag shortcut added"))},children:[e(w,{icon:"shortcut"})," ",e("span",{children:"Add to Shorcuts"})]}),e(J,{onClick:()=>{let T=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(T)){T&&alert("Invalid instance");return}T&&(T=T.toLowerCase().trim(),location.hash=`/${T}/t/${i.join("+")}`)},children:[e(w,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]})]})},l+u)}const pi=20;function _n(t){var g;const n=ae(v),{masto:r,instance:o}=z(),i=(t==null?void 0:t.id)||((g=Je())==null?void 0:g.id),s=P(),l=P();async function d(y){(y||!l.current)&&(l.current=r.v1.timelines.list.$select(i).list({limit:pi}));const b=await l.current.next();let{value:S}=b;return S!=null&&S.length&&(y&&(s.current=S[0].id),S=He(S,"home"),S.forEach(k=>{Se(k,o)})),{...b,value:S}}async function p(){try{const y=await r.v1.timelines.list.$select(i).list({limit:1,since_id:s.current});let{value:b}=y;return b=He(b,"home"),!!(b!=null&&b.length)}catch{return!1}}const[u,c]=C({title:"List"});Ie(u.title,"/l/:id"),_(()=>{(async()=>{try{const y=await r.v1.lists.$select(i).fetch();c(y)}catch{}})()},[i]);const[f,m]=C(!1),[a,h]=C(!1);return e(x,{children:[e(Oe,{title:u.title,id:"list",emptyText:"Nothing yet.",errorText:"Unable to load posts.",instance:o,fetchItems:d,checkForUpdates:p,useItemID:!0,boostsCarousel:n.settings.boostsCarousel,allowFilters:!0,headerStart:e(j,{to:"/l",class:"button plain",children:e(w,{icon:"list",size:"l"})}),headerEnd:e(ot,{portal:!0,setDownOverflow:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[e(J,{onClick:()=>m({list:u}),children:[e(w,{icon:"pencil",size:"l"}),e("span",{children:"Edit"})]}),e(J,{onClick:()=>h(!0),children:[e(w,{icon:"group",size:"l"}),e("span",{children:"Manage members"})]})]})},i),f&&e(ue,{class:"light",onClick:y=>{y.target===y.currentTarget&&m(!1)},children:e(zt,{list:f==null?void 0:f.list,onClose:y=>{y.state==="success"&&y.list?c(y.list):y.state==="deleted"&&(location.hash="/l"),m(!1)}})}),a&&e(ue,{class:"light",onClick:y=>{y.target===y.currentTarget&&h(!1)},children:e(gi,{listID:i,onClose:()=>h(!1)})})]})}const mi=40;function gi({listID:t,onClose:n}){const{masto:r,instance:o}=z(),[i,s]=C([]),[l,d]=C("default"),[p,u]=C(!1),c=P();async function f(m){u(!1),d("loading"),(async()=>{try{(m||!c.current)&&(c.current=r.v1.lists.$select(t).accounts.list({limit:mi}));const a=await c.current.next();let{done:h,value:g}=a;g!=null&&g.length?(s(m?g:i.concat(g)),u(!h)):u(!1),d("default")}catch{d("error")}})()}return _(()=>{f(!0)},[]),e("div",{class:"sheet",id:"list-manage-members-container",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Manage members"})}),e("main",{children:e("ul",{children:[i.map(m=>e("li",{children:[e(Fe,{account:m,instance:o}),e(bi,{account:m,listID:t})]},m.id)),p&&l==="default"&&e(it,{as:"li",onChange:m=>m&&f(),children:e("button",{type:"button",class:"light block",onClick:f,children:"Show more…"})})]})})]})}function bi({account:t,listID:n}){const{masto:r}=z(),[o,i]=C("default"),[s,l]=C(!1);return e(_e,{confirm:!s,confirmLabel:e("span",{children:["Remove @",t.username," from list?"]}),align:"end",menuItemClassName:"danger",onClick:()=>{s?(i("loading"),(async()=>{try{await r.v1.lists.$select(n).accounts.create({accountIds:[t.id]}),i("default"),l(!1)}catch{i("error")}})()):(i("loading"),(async()=>{try{await r.v1.lists.$select(n).accounts.remove({accountIds:[t.id]}),i("default"),l(!0)}catch{i("error")}})())},children:e("button",{type:"button",class:`light ${s?"":"danger"}`,disabled:o==="loading",children:s?"Add":"Remove…"})})}const ln=20,yi=new URLSearchParams;function Un({columnMode:t,...n}){Ie("Mentions","/mentions");const{masto:r,instance:o}=z(),[i]=t?[yi]:Be(),[s,l]=C(null),d=(n==null?void 0:n.type)||i.get("type")||s,p=P(),u=P();async function c(b){(b||!p.current)&&(p.current=r.v1.notifications.list({limit:ln,types:["mention"]}));const S=await p.current.next();let{value:k}=S;return k!=null&&k.length&&(b&&(u.current=k[0].id),k.forEach(({status:T})=>{Se(T,o)})),{...S,value:k==null?void 0:k.map(T=>T.status)}}const f=P(),m=P();async function a(b){(b||!f.current)&&(f.current=r.v1.conversations.list({limit:ln}));const S=await f.current.next();let{value:k}=S;return k=k==null?void 0:k.filter(T=>T.lastStatus),k!=null&&k.length&&(b&&(m.current=k[0].lastStatus.id),k.forEach(({lastStatus:T})=>{Se(T,o)})),{...S,value:k==null?void 0:k.map(T=>T.lastStatus)}}function h(...b){return d==="private"?a(...b):c(...b)}async function g(){if(d==="private")try{const b=await r.v1.conversations.list({limit:1,since_id:m.current}).next();let{value:S}=b;return S!=null&&S.length?(m.current=S[0].lastStatus.id,!0):!1}catch{return!1}else try{const b=await r.v1.notifications.list({limit:1,types:["mention"],since_id:u.current}).next();let{value:S}=b;return S!=null&&S.length?(u.current=S[0].id,!0):!1}catch{return!1}}const y=he(()=>e("div",{class:"filter-bar centered",children:[e(j,{to:"/mentions",class:d?"":"is-active",onClick:b=>{t&&(b.preventDefault(),l(null))},children:"All"}),e(j,{to:"/mentions?type=private",class:d==="private"?"is-active":"",onClick:b=>{t&&(b.preventDefault(),l("private"))},children:"Private"})]}),[d]);return e(Oe,{title:"Mentions",id:"mentions",emptyText:"No one mentioned you :(",errorText:"Unable to load mentions.",instance:o,fetchItems:h,checkForUpdates:g,useItemID:!0,timelineStart:y,refresh:d})}function Fn(t){const n={},r=[];for(let s=0,l=0;s<t.length;s++){const d=t[s],{status:p,account:u,type:c,createdAt:f}=d,m=new Date(f).toLocaleDateString();let a=c;(c==="favourite"||c==="reblog")&&(a="favourite+reblog");const h=`${p==null?void 0:p.id}-${a}-${m}`,g=n[h];if(a==="follow_request")r[l++]=d;else if(g!=null&&g.account){const y=g._accounts.find(b=>b.id===u.id);y?(y._types.push(c),y._types.sort().reverse()):(u._types=[c],g._accounts.push(u))}else{u._types=[c];let y=n[h]={...d,type:a,_accounts:[u]};r[l++]=y}}const o={},i=[];for(let s=0,l=0;s<r.length;s++){const d=r[s],{account:p,_accounts:u,type:c,createdAt:f}=d,m=new Date(f).toLocaleDateString();if(c==="favourite+reblog"&&p&&u.length===1){const a=`${p==null?void 0:p.id}-${c}-${m}`,h=o[a];if(h)h._statuses.push(d.status);else{let g=o[a]={...d,type:c,_statuses:[d.status]};i[l++]=g}}else i[l++]=d}return i}const wi=30,vi=new URLSearchParams;function ki({columnMode:t}){Ie("Notifications","/notifications");const{masto:n,instance:r}=z(),o=ae(v),[i,s]=C("default"),[l]=t?[vi]:Be(),d=l.get("id"),p=l.get("access_token"),[u,c]=C(!1),[f,m]=C(!1),a=P(),{nearReachEnd:h,scrollDirection:g,reachStart:y,nearReachStart:b}=Tt({scrollableRef:a}),S=g==="end"&&!b,[k,T]=C([]),[R,F]=C([]),A=P();async function M(D){(D||!A.current)&&(A.current=n.v1.notifications.list({limit:wi,excludeTypes:["follow_request"]}));const Y=await A.current.next(),ie=Y.value;if(ie!=null&&ie.length){ie.forEach(Ae=>{Se(Ae.status,r,{skipThreading:!0})});const fe=Fn(ie);D?(v.notificationsLast=ie[0],v.notifications=fe,n.v1.markers.create({notifications:{lastReadId:ie[0].id}}).catch(()=>{})):v.notifications.push(...fe)}return v.notificationsShowNew=!1,v.notificationsLastFetchTime=Date.now(),Y}async function B(){try{return await n.v1.followRequests.list({limit:80})}catch{return[]}}const O=()=>{s("loading"),(async()=>{try{const D=await B();T(D),s("default")}catch{s("error")}})()};async function $(){try{return await n.v1.announcements.list()}catch{return[]}}const E=D=>{s("loading"),(async()=>{try{const Y=M(D),ie=B(),fe=$();if(D){const $e=await fe;$e.sort((X,W)=>{const ne=new Date(X.updatedAt||X.createdAt);return new Date(W.updatedAt||W.createdAt)-ne}),F($e);const H=await ie;T(H)}const{done:Ae}=await Y;c(!Ae),s("default")}catch{s("error")}})()};_(()=>{E(!0)},[]),_(()=>{y&&E(!0)},[y]),_(()=>{h&&u&&E()},[h,u]);const ee=Sn(5e3),G=Ge(()=>{var D;o.settings.autoRefresh&&((D=a.current)==null?void 0:D.scrollTop)===0&&ee&&!Si()&&o.notificationsShowNew&&i!=="loading"&&E(!0)},[ee,o.notificationsShowNew,o.settings.autoRefresh,i]);_(G,[o.notificationsShowNew]);const xe=new Date,we=new Date(xe-24*60*60*1e3);let ye=new Date;const se=!o.notifications.some(D=>new Date(D.createdAt).toDateString()===xe.toDateString()),Le=P();return _(()=>{d&&(v.routeNotification={id:d,accessToken:atob(p)})},[d,p]),_(()=>{i==="default"&&(async()=>{try{const D=await Tn();if(D!=null&&D.getNotifications){const Y=await D.getNotifications()}}catch{}})()},[i]),e("div",{id:"notifications-page",class:"deck-container",ref:a,tabIndex:"-1",children:e("div",{class:`timeline-deck deck ${f?"only-mentions":""}`,children:[e("header",{hidden:S,onClick:D=>{var Y;D.target.closest("a, button")||(Y=a.current)==null||Y.scrollTo({top:0,behavior:"smooth"})},class:i==="loading"?"loading":"",children:[e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(ct,{}),e(j,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l",alt:"Home"})})]}),e("h1",{children:"Notifications"}),e("div",{class:"header-side"})]}),o.notificationsShowNew&&i!=="loading"&&e("button",{class:"updates-button shiny-pill",type:"button",onClick:()=>{var D;E(!0),(D=a.current)==null||D.scrollTo({top:0,behavior:"smooth"})},children:[e(w,{icon:"arrow-up"})," New notifications"]})]}),R.length>0&&e("div",{class:"shazam-container",children:e("div",{class:"shazam-container-inner",children:e("details",{class:"announcements",children:[e("summary",{children:[e("span",{children:[e(w,{icon:"announce",class:"announcement-icon",size:"l"})," ",e("b",{children:["Announcement",R.length>1?"s":""]})," ",e("small",{class:"insignificant",children:r})]}),R.length>1&&e("span",{class:"announcements-nav-buttons",children:R.map((D,Y)=>e("button",{type:"button",class:"plain2 small",onClick:()=>{var ie;(ie=Le.current)==null||ie.children[Y].scrollIntoView({behavior:"smooth",block:"nearest"})},children:Y+1}))})]}),e("ul",{class:`announcements-list-${R.length>1?"multiple":"single"}`,ref:Le,children:R.map(D=>e("li",{children:e(Ii,{announcement:D})}))})]})})}),k.length>0&&e("div",{class:"follow-requests",children:[e("h2",{class:"timeline-header",children:"Follow requests"}),k.length>5?e("details",{children:[e("summary",{children:[k.length," follow requests"]}),e("ul",{children:k.map(D=>e("li",{children:[e(Fe,{account:D}),e(Mt,{accountID:D.id,onChange:()=>{}})]},D.id))})]}):e("ul",{children:k.map(D=>e("li",{children:[e(Fe,{account:D}),e(Mt,{accountID:D.id,onChange:()=>{}})]},D.id))})]}),e("div",{id:"mentions-option",children:e("label",{children:[e("input",{type:"checkbox",checked:f,onChange:D=>{m(D.target.checked)}})," ","Only mentions"]})}),e("h2",{class:"timeline-header",children:"Today"}),se&&!!o.notifications.length&&e("p",{class:"ui-state insignificant",children:i==="default"?"You're all caught up.":e(x,{children:"…"})}),o.notifications.length?e(x,{children:o.notifications.filter(D=>D.type!=="follow_request").map(D=>{if(f&&D.type!=="mention")return null;const Y=new Date(D.createdAt),ie=Y.toDateString()!==ye.toDateString();ie&&(ye=Y);const fe=Y.toDateString()===we.toDateString()?"Yesterday":qe(ye,{hideTime:!0});return e(x,{children:[ie&&e("h2",{class:"timeline-header",children:fe}),e(Bt,{instance:r,notification:D,reload:()=>{E(!0),O()}},D.id)]})})}):e(x,{children:[i==="loading"&&e(x,{children:e("ul",{class:"timeline flat",children:Array.from({length:5}).map((D,Y)=>e("li",{class:"notification skeleton",children:[e("div",{class:"notification-type",children:e(w,{icon:"notification",size:"xl"})}),e("div",{class:"notification-content",children:e("p",{children:"███████████ ████"})})]}))})}),i==="error"&&e("p",{class:"ui-state",children:["Unable to load notifications",e("br",{}),e("br",{}),e("button",{type:"button",onClick:()=>E(!0),children:"Try again"})]})]}),u&&e("button",{type:"button",class:"plain block",disabled:i==="loading",onClick:()=>E(),style:{marginBlockEnd:"6em"},children:i==="loading"?e(be,{abrupt:!0}):e(x,{children:"Show more…"})})]})})}function Si(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}function Ii({announcement:t}){const{instance:n}=z(),{contact:r}=Xn(),o=r==null?void 0:r.account,{id:i,content:s,startsAt:l,endsAt:d,published:p,allDay:u,publishedAt:c,updatedAt:f,read:m,mentions:a,statuses:h,tags:g,emojis:y,reactions:b}=t,S=new Date(c),k=qe(S),T=new Date(f),R=qe(T);return e("div",{class:"announcement-block",children:[e(Fe,{account:o}),e("div",{class:"announcement-content",onClick:hn({mentions:a,instance:n}),dangerouslySetInnerHTML:{__html:Rt(s,{emojis:y})}}),e("p",{class:"insignificant",children:[e("time",{datetime:S.toISOString(),children:qe(S)}),f&&R!==k&&e(x,{children:[" ","•"," ",e("span",{class:"ib",children:["Updated"," ",e("time",{datetime:T.toISOString(),children:qe(T)})]})]})]}),e("div",{class:"announcement-reactions",hidden:!0,children:b.map(F=>{const{name:A,count:M,me:B,staticUrl:O,url:$}=F;return e("button",{type:"button",class:`plain4 small ${B?"reacted":""}`,children:[$||O?e("img",{src:$||O,alt:A,width:"16",height:"16"}):e("span",{children:A})," ",e("span",{class:"count",children:Ne(M)})]})})})]})}const zn=We(ki),Ti=20;function Dt({local:t,columnMode:n,...r}){const o=ae(v),i=!!t,s=n?{}:Je(),{masto:l,instance:d}=z({instance:(r==null?void 0:r.instance)||s.instance}),p=`${i?"Local":"Federated"} timeline (${d})`;Ie(p,i?"/:instance?/p/l":"/:instance?/p");const u=P(),c=P();async function f(a){(a||!c.current)&&(c.current=l.v1.timelines.public.list({limit:Ti,local:i}));const h=await c.current.next();let{value:g}=h;return g!=null&&g.length&&(a&&(u.current=g[0].id),g=He(g,"public"),g.forEach(y=>{Se(y,d)})),{...h,value:g}}async function m(){try{const a=await l.v1.timelines.public.list({limit:1,local:i,since_id:u.current}).next();let{value:h}=a;return h=He(h,"public"),!!(h!=null&&h.length)}catch{return!1}}return e(Oe,{title:p,titleComponent:e("h1",{class:"header-account",children:[e("b",{children:i?"Local timeline":"Federated timeline"}),e("div",{children:d})]}),id:"public",instance:d,emptyText:"No one has posted anything yet.",errorText:"Unable to load posts",fetchItems:f,checkForUpdates:m,useItemID:!0,headerStart:e(x,{}),boostsCarousel:o.settings.boostsCarousel,allowFilters:!0,headerEnd:e(ot,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[e(J,{href:i?`/#/${d}/p`:`/#/${d}/p/l`,children:i?e(x,{children:[e(w,{icon:"transfer"})," ",e("span",{children:"Switch to Federated"})]}):e(x,{children:[e(w,{icon:"transfer"})," ",e("span",{children:"Switch to Local"})]})}),e(De,{}),e(J,{onClick:()=>{let a=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(a)){a&&alert("Invalid instance");return}a&&(a=a.toLowerCase().trim(),location.hash=i?`/${a}/p/l`:`/${a}/p`)},children:[e(w,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]})]})},d+i)}const Ci=20;function Bn({columnMode:t,...n}){const r=ae(v),o=t?{}:Je(),{masto:i,instance:s}=z({instance:(n==null?void 0:n.instance)||o.instance}),l=`Trending (${s})`;Ie(l,"/:instance?/trending");const d=P(),[p,u]=C([]),c=P();async function f(h){if(h||!c.current){c.current=i.v1.trends.statuses.list({limit:Ci});try{const b=i.v1.trends.tags.list(),{value:S}=await b.next();u(S)}catch{}}const g=await c.current.next();let{value:y}=g;return y!=null&&y.length&&(h&&(d.current=y[0].id),y=He(y,"public"),y.forEach(b=>{Se(b,s)})),{...g,value:y}}async function m(){try{const h=await i.v1.trends.statuses.list({limit:1}).next();let{value:g}=h;return g=He(g,"public"),g!=null&&g.length&&g[0].id!==d.current?(d.current=g[0].id,!0):!1}catch{return!1}}const a=he(()=>p.length?e("div",{class:"filter-bar",children:[e(w,{icon:"chart",class:"insignificant",size:"l"}),p.map((h,g)=>{const{name:y,history:b}=h,S=b.reduce((k,T)=>k+ +T.uses,0);return e(j,{to:`/${s}/t/${y}`,children:[e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),y]}),e("span",{class:"filter-count",children:S.toLocaleString()})]})})]}):null,[p]);return e(Oe,{title:l,titleComponent:e("h1",{class:"header-account",children:[e("b",{children:"Trending"}),e("div",{children:s})]}),id:"trending",instance:s,emptyText:"No trending posts.",errorText:"Unable to load posts",fetchItems:f,checkForUpdates:m,checkForUpdatesInterval:5*60*1e3,useItemID:!0,headerStart:e(x,{}),boostsCarousel:r.settings.boostsCarousel,allowFilters:!0,timelineStart:a,headerEnd:e(ot,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:e(J,{onClick:()=>{let h=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(h)){h&&alert("Invalid instance");return}h&&(h=h.toLowerCase().trim(),location.hash=`/${h}/trending`)},children:[e(w,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]})})},s)}function xi(){Ie("Home","/");const t=ae(v),{shortcuts:n}=t,r=n.map(o=>{if(!o)return null;const{type:i,...s}=o,l={following:Ot,notifications:zn,list:_n,public:Dt,bookmarks:En,favourites:Pn,hashtag:Nn,mentions:Un,trending:Bn}[i];return l?e(l,{...s,columnMode:!0},i+JSON.stringify(s)):null});return ke(["1","2","3","4","5","6","7","8","9"],(o,i)=>{try{const s=parseInt(i.keys[0],10)-1;document.querySelectorAll("#columns > *")[s].focus()}catch{}}),e("div",{id:"columns",children:r})}function $i(){var n;const t=ae(v);return _(()=>{(async()=>{const r=await tt.drafts.keys();if(r.length){const o=mn();r.filter(s=>s.startsWith(o)).length&&(v.showDrafts=!0)}})()},[]),e(x,{children:(t.settings.shortcutsColumnsMode||t.settings.shortcutsViewMode==="multi-column")&&((n=t.shortcuts)!=null&&n.length)?e(xi,{}):e(Ot,{title:"Home",path:"/",id:"home",headerStart:!1,headerEnd:e(Ri,{})})})}function Ri(){const t=ae(v),n=P(),[r,o]=C(void 0);return e(x,{children:[e(j,{ref:n,to:"/notifications",class:`button plain notifications-button ${t.notificationsShowNew?"has-badge":""} ${r||""}`,onClick:i=>{i.stopPropagation(),window.matchMedia("(min-width: calc(40em))").matches&&(i.preventDefault(),o(s=>s?void 0:"open"))},children:e(w,{icon:"notification",size:"l",alt:"Notifications"})}),e(Mi,{state:r,anchorRef:n,onClose:()=>o(void 0)})]})}const Li=30,Ai=5;function Mi({anchorRef:t,state:n,onClose:r}){const{masto:o,instance:i}=z(),s=ae(v),[l,d]=C("default"),p=o.v1.notifications.list({limit:Li});async function u(){const h=await p.next(),g=h.value;if(g!=null&&g.length){g.forEach(b=>{Se(b.status,i,{skipThreading:!0})});const y=Fn(g);v.notificationsLast=g[0],v.notifications=y,o.v1.markers.create({notifications:{lastReadId:g[0].id}}).catch(()=>{})}return v.notificationsShowNew=!1,v.notificationsLastFetchTime=Date.now(),h}const[c,f]=C(!1);function m(){return o.v1.followRequests.list({limit:1})}function a(){d("loading"),(async()=>{try{await u();const h=await m();f(!!(h!=null&&h.length)),d("default")}catch{d("error")}})()}return _(()=>{n==="open"&&a()},[n]),e(vn,{menuClassName:"notifications-menu",state:n,anchorRef:t,onClose:r,portal:{target:document.body},overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:"8 8 8 8",children:[e("header",{children:e("h2",{children:"Notifications"})}),e("main",{children:s.notifications.length?e(x,{children:s.notifications.slice(0,Ai).map(h=>e(Bt,{instance:i,notification:h},h.id))}):l==="loading"?e("div",{class:"ui-state",children:e(be,{abrupt:!0})}):l==="error"&&e("div",{class:"ui-state",children:[e("p",{children:"Unable to fetch notifications."}),e("p",{children:e("button",{type:"button",onClick:a,children:"Try again"})})]})}),e("footer",{children:[e(j,{to:"/mentions",class:"button plain",children:[e(w,{icon:"at"})," ",e("span",{children:"Mentions"})]}),e(j,{to:"/notifications",class:"button plain2",children:[c?e(x,{children:[e("span",{class:"tag collapsed",children:"New"})," ",e("span",{children:"Follow Requests"})]}):e("b",{children:"See all"})," ",e(w,{icon:"arrow-right"})]})]})]})}const Di=We($i),Ei=/\/@([^@\/]+)@?([^\/]+)?\/([^\/]+)\/?$/i,Pi=/\/notes\/([^\/]+)\/?$/i;function On(t){const{hostname:n,pathname:r}=new URL(t),[,o,i,s]=r.match(Ei)||[];if(s)return`/${n}/s/${s}`;const[,l]=r.match(Pi)||[];if(l)return`/${n}/s/${l}`}function Ni(){const n=St().pathname.replace(/^\//,""),r=On(n);return ze(()=>{r&&setTimeout(()=>{window.location.hash=r+"?view=full"},300)},[r]),e("div",{class:"ui-state",tabIndex:"-1",children:[r?e(x,{children:[e("h2",{children:"Redirecting…"}),e("p",{children:e("a",{href:`#${r}?view=full`,children:r})})]}):e(x,{children:[e("h2",{children:"Unable to process URL"}),e("p",{children:e("a",{href:n,target:"_blank",rel:"noopener noreferrer",children:n})})]}),e("hr",{}),e("p",{children:e(j,{to:"/",children:"Go home"})})]})}function _i(){const{masto:t}=z();Ie("Lists","/l");const[n,r]=C("default"),[o,i]=kt(u=>u+1,0),[s,l]=C([]);_(()=>{r("loading"),(async()=>{try{const u=await t.v1.lists.list();l(u),r("default")}catch{r("error")}})()},[o]);const[d,p]=C(!1);return e("div",{id:"lists-page",class:"deck-container",tabIndex:"-1",children:[e("div",{class:"timeline-deck deck",children:[e("header",{children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(ct,{}),e(j,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l"})})]}),e("h1",{children:"Lists"}),e("div",{class:"header-side",children:e("button",{type:"button",class:"plain",onClick:()=>p(!0),children:e(w,{icon:"plus",size:"l",alt:"New list"})})})]})}),e("main",{children:s.length>0?e("ul",{class:"link-list",children:s.map(u=>e("li",{children:e(j,{to:`/l/${u.id}`,children:e("span",{children:[e(w,{icon:"list"})," ",e("span",{children:u.title})]})})}))}):n==="loading"?e("p",{class:"ui-state",children:e(be,{})}):n==="error"?e("p",{class:"ui-state",children:"Unable to load lists."}):e("p",{class:"ui-state",children:"No lists yet."})})]}),d&&e(ue,{class:"light",onClick:u=>{u.target===u.currentTarget&&p(!1)},children:e(zt,{list:d==null?void 0:d.list,onClose:u=>{u.state==="success"&&i(),p(!1)}})})]})}const Ui=""+new URL("instances-48462af0.json",import.meta.url).href,{VITE_CLIENT_NAME:Fi,VITE_WEBSITE:zi}={VITE_CLIENT_NAME:"IMSB.APP",VITE_CLIENT_ID:"app.imsb.app",VITE_WEBSITE:"https://app.imsb.app",VITE_APP_ENV:"production",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1},qt="read write follow push";async function Bi({instanceURL:t}){const n=new URLSearchParams({client_name:Fi,redirect_uris:location.origin+location.pathname,scopes:qt,website:zi});return await(await fetch(`https://${t}/api/v1/apps`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n.toString()})).json()}async function Oi({instanceURL:t,client_id:n}){const r=new URLSearchParams({client_id:n,scope:qt,redirect_uri:location.origin+location.pathname,response_type:"code"});return`https://${t}/oauth/authorize?${r.toString()}`}async function qi({instanceURL:t,client_id:n,client_secret:r,code:o}){const i=new URLSearchParams({client_id:n,client_secret:r,redirect_uri:location.origin+location.pathname,grant_type:"authorization_code",code:o,scope:qt});return await(await fetch(`https://${t}/oauth/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:i.toString()})).json()}function Hi(){Ie("Log in");const t=P(),n=K.local.get("instanceURL"),[r,o]=C("default"),[i]=Be(),s=i.get("instance"),[l,d]=C(s||(n==null?void 0:n.toLowerCase())||""),[p,u]=C([]);_(()=>{(async()=>{try{const h=await(await fetch(Ui)).json();u(h)}catch{}})()},[]);const c=a=>{K.local.set("instanceURL",a),(async()=>{o("loading");try{const{client_id:h,client_secret:g,vapid_key:y}=await Bi({instanceURL:a});h&&g?(K.session.set("clientID",h),K.session.set("clientSecret",g),K.session.set("vapidKey",y),location.href=await Oi({instanceURL:a,client_id:h})):alert("Failed to register application"),o("default")}catch{o("error")}})()},f=a=>{a.preventDefault();const{elements:h}=a.target;let g=h.instanceURL.value.toLowerCase();g=g.replace(/^https?:\/\//,"").replace(/\/+$/,""),g=g.replace(/^@?[^@]+@/,""),/\./.test(g)||(g=p.find(y=>y.includes(g))),c(g)},m=l?p.filter(a=>a.includes(l)).sort((a,h)=>{const g=a.toLowerCase().startsWith(l.toLowerCase()),y=h.toLowerCase().startsWith(l.toLowerCase());return g&&!y?-1:!g&&y?1:0}).slice(0,10):[];return e("main",{id:"login",style:{textAlign:"center"},children:e("form",{onSubmit:f,children:[e("h1",{children:"Log in"}),e("label",{children:[e("p",{children:"Instance"}),e("input",{value:l,required:!0,type:"text",class:"large",id:"instanceURL",ref:t,disabled:r==="loading",autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellcheck:!1,placeholder:"instance domain",onInput:a=>{d(a.target.value)}}),(m==null?void 0:m.length)>0?e("ul",{id:"instances-suggestions",children:m.map(a=>e("li",{children:e("button",{type:"button",class:"plain4",onClick:()=>{c(a)},children:a})}))}):e("div",{id:"instances-eg",children:"e.g. “mastodon.social’"})]}),r==="error"&&e("p",{class:"error",children:"Failed to log in. Please try again or another instance."}),e("div",{children:[e("button",{class:"large",disabled:r==="loading",children:"Log in"})," "]}),e(be,{hidden:r!=="loading"}),e("hr",{}),e("p",{children:e("a",{href:"https://joinmastodon.org/servers",target:"_blank",children:"Don't have an account? Create one!"})}),e("p",{children:e(j,{to:"/",children:"Go home"})})]})})}const ut=5,$t=40;function Vi(t){const n=Je(),{masto:r,instance:o,authenticated:i}=z({instance:n.instance}),[s,l]=C("default"),[d]=Be(),p=P(),u=(t==null?void 0:t.query)||d.get("q"),c=(t==null?void 0:t.type)||d.get("type");Ie(u?`Search: ${u}${c?` (${{statuses:"Posts",accounts:"Accounts",hashtags:"Hashtags"}[c]})`:""}`:"Search","/search");const[f,m]=C(!1),a=P(0);_(()=>{a.current=0},[u,c]);const h=P();ze(()=>{var A,M;(M=(A=h.current)==null?void 0:A.scrollTo)==null||M.call(A,0,0)},[u,c]);const[g,y]=C([]),[b,S]=C([]),[k,T]=C([]);_(()=>{y([]),S([]),T([])},[u]);const R={statuses:y,accounts:S,hashtags:T};function F(A){l("loading"),A&&!c&&(y(g.slice(0,ut)),S(b.slice(0,ut)),T(k.slice(0,ut))),(async()=>{var B,O;const M={q:u,resolve:i,limit:ut};c&&(M.limit=$t,M.type=c,i&&(M.offset=a.current));try{const $=await r.v2.search.fetch(M);if(c)if(A){R[c]($[c]);const E=(B=$[c])==null?void 0:B.length;a.current=$t,m(!!E)}else{R[c](ee=>[...ee,...$[c]]);const E=(O=$[c])==null?void 0:O.length;a.current=a.current+$t,m(!!E)}else y($.statuses),S($.accounts),T($.hashtags),a.current=0,m(!1);l("default")}catch{l("error")}})()}return _(()=>{var A,M,B,O;u?((M=(A=p.current)==null?void 0:A.setValue)==null||M.call(A,u),F(!0)):(O=(B=p.current)==null?void 0:B.focus)==null||O.call(B)},[u,c,o]),ke("/",A=>{var M,B;(B=(M=p.current)==null?void 0:M.focus)==null||B.call(M)},{preventDefault:!0}),e("div",{id:"search-page",class:"deck-container",ref:h,children:e("div",{class:"timeline-deck deck",children:[e("header",{children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:e(ct,{})}),e(Dn,{ref:p}),e("div",{class:"header-side",children:" "})]})}),e("main",{children:[!!u&&e("div",{class:`filter-bar ${s==="loading"?"loading":""}`,children:[!!c&&e(j,{to:`/search${u?`?q=${encodeURIComponent(u)}`:""}`,children:"‹ All"}),[{label:"Accounts",type:"accounts",to:`/search?q=${encodeURIComponent(u)}&type=accounts`},{label:"Hashtags",type:"hashtags",to:`/search?q=${encodeURIComponent(u)}&type=hashtags`},{label:"Posts",type:"statuses",to:`/search?q=${encodeURIComponent(u)}&type=statuses`}].sort((A,M)=>A.type===c?-1:M.type===c?1:0).map(A=>e(j,{to:A.to,children:A.label}))]}),u?e(x,{children:[(!c||c==="accounts")&&e(x,{children:[c!=="accounts"&&e("h2",{class:"timeline-header",children:"Accounts"}),b.length>0?e(x,{children:[e("ul",{class:"timeline flat accounts-list",children:b.map(A=>e("li",{children:e(Fe,{account:A,instance:o,showStats:!0})},A.id))}),c!=="accounts"&&e("div",{class:"ui-state",children:e(j,{class:"plain button",to:`/search?q=${u}&type=accounts`,children:["See more accounts ",e(w,{icon:"arrow-right"})]})})]}):!c&&(s==="loading"?e("p",{class:"ui-state",children:e(be,{abrupt:!0})}):e("p",{class:"ui-state",children:"No accounts found."}))]}),(!c||c==="hashtags")&&e(x,{children:[c!=="hashtags"&&e("h2",{class:"timeline-header",children:"Hashtags"}),k.length>0?e(x,{children:[e("ul",{class:"link-list hashtag-list",children:k.map(A=>e("li",{children:e(j,{to:o?`/${o}/t/${A.name}`:`/t/${A.name}`,children:[e(w,{icon:"hashtag"}),e("span",{children:A.name})]})},A.name))}),c!=="hashtags"&&e("div",{class:"ui-state",children:e(j,{class:"plain button",to:`/search?q=${u}&type=hashtags`,children:["See more hashtags ",e(w,{icon:"arrow-right"})]})})]}):!c&&(s==="loading"?e("p",{class:"ui-state",children:e(be,{abrupt:!0})}):e("p",{class:"ui-state",children:"No hashtags found."}))]}),(!c||c==="statuses")&&e(x,{children:[c!=="statuses"&&e("h2",{class:"timeline-header",children:"Posts"}),g.length>0?e(x,{children:[e("ul",{class:"timeline",children:g.map(A=>e("li",{children:e(j,{class:"status-link",to:o?`/${o}/s/${A.id}`:`/s/${A.id}`,children:e(ve,{status:A})})},A.id))}),c!=="statuses"&&e("div",{class:"ui-state",children:e(j,{class:"plain button",to:`/search?q=${u}&type=statuses`,children:["See more posts ",e(w,{icon:"arrow-right"})]})})]}):!c&&(s==="loading"?e("p",{class:"ui-state",children:e(be,{abrupt:!0})}):e("p",{class:"ui-state",children:"No posts found."}))]}),!!c&&(s==="default"?f?e(it,{onChange:A=>{A&&F()},children:e("button",{type:"button",class:"plain block",onClick:()=>F(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}):s==="loading"&&e("p",{class:"ui-state",children:e(be,{abrupt:!0})}))]}):s==="loading"?e("p",{class:"ui-state",children:e(be,{abrupt:!0})}):e("p",{class:"ui-state",children:"Enter your search term or paste a URL above to get started."})]})]})})}const ht=40,ji=10,Gi=5;let Et={},mt={},gt={};function Pt(t){delete mt[t],delete gt[t]}const ft={block:"nearest",inline:"center",behavior:"smooth"};function Wi(t){const{id:n}=t,{masto:r,instance:o}=z({instance:t.instance}),i=ae(v),[s,l]=Be(),d=s.get("media"),p=s.get("media-only"),u=parseInt(d||p,10);let c=u>0;const f=s.get("mediaStatusID"),m=yn(f,o);f&&!m&&(c=!1);const a=c&&!!p,h=Ut(n,o),[g,y]=C(v.statuses[h]);_(()=>{v.statuses[h]&&y(v.statuses[h])},[h]);const b=he(()=>{const{prevLocation:T}=v,R=((T==null?void 0:T.pathname)||"")+((T==null?void 0:T.search)||""),F=st("/:instance/s/:id",R)||st("/s/:id",R);return!R||F?"/":R},[]);_(()=>{!g&&c&&(async()=>{try{const T=await r.v1.statuses.$select(n).fetch();Se(T,o),y(T)}catch{alert("Unable to load post."),location.hash=b}})()},[c]);const S=f?m==null?void 0:m.mediaAttachments:g==null?void 0:g.mediaAttachments,k=Ge(()=>{!window.matchMedia("(min-width: calc(40em + 350px))").matches&&i.prevLocation?history.back():a?location.hash=b:(s.delete("media"),s.delete("mediaStatusID"),l(s))},[a,b,i.prevLocation]);return e("div",{class:"deck-backdrop",children:[c?S!=null&&S.length?e(An,{mediaAttachments:S,statusID:f||n,instance:o,lang:g==null?void 0:g.language,index:u-1,onClose:k}):e("div",{class:"media-modal-container loading",children:e(be,{abrupt:!0})}):e(j,{to:b}),!a&&e(Ki,{id:n,instance:t.instance,closeLink:b})]})}function Ki({id:t,closeLink:n="/",instance:r}){var te;const[o,i]=Be(),s=o.get("media"),l=parseInt(s,10)>0,[d,p]=C(o.get("view")),u=!!parseInt(o.get("translate")),{masto:c,instance:f}=z({instance:r}),{masto:m,instance:a,authenticated:h}=z(),g=f===a,y=ae(v),[b,S]=C([]),[k,T]=C("default"),R=P(),F=Ut(t,f),A=P(0),M=P();_(()=>{var I;(I=M.current)==null||I.focus()},[]),_(()=>{var L;const I=us(()=>{if(!M.current)return;const{scrollTop:V}=M.current;k!=="loading"&&(gt[t]=V)},50);return(L=M.current)==null||L.addEventListener("scroll",I,{passive:!0}),I(),()=>{var V;I.cancel(),(V=M.current)==null||V.removeEventListener("scroll",I)}},[t,k!=="loading"]);const B=P(),O=({reloadHero:I}={})=>{T("loading");let L;const V=mt[t];if(V){const N=V.filter(Z=>v.statuses[F]);S(N)}else S([{id:t}]);return(async()=>{var le,Re;const N=()=>Yt(()=>c.v1.statuses.$select(t).fetch(),{retries:4}),Z=Yt(()=>c.v1.statuses.$select(t).context.fetch(),{retries:8}),Te=!!y.statuses[F];let Q=y.statuses[F];if(!(Te&&!I))try{Q=await N(),Se(Q,f),await new Promise(re=>{setTimeout(re,100)})}catch{T("error");return}try{let re=function(q){return q==null?void 0:q.map(de=>({id:de.id,account:de.account,repliesCount:de.repliesCount,content:de.content,weight:nt(de),replies:re(de.__replies)}))};const Ee=await Z,{ancestors:U,descendants:oe}=Ee;A.current=(oe==null?void 0:oe.length)||0;const pe=new Set;U.forEach(q=>{Se(q,f,{skipThreading:!0}),q.inReplyToId&&!U.find(de=>de.id===q.inReplyToId)&&pe.add(q.inReplyToId)});const me=U.every(q=>q.account.id===Q.account.id),Pe=[];oe.forEach(q=>{if(Se(q,f,{skipThreading:!0}),q.inReplyToId&&!oe.find(de=>de.id===q.inReplyToId)&&q.inReplyToId!==Q.id&&pe.add(q.inReplyToId),q.inReplyToAccountId===q.account.id)Pe.push(q);else if(q.inReplyToId===Q.id)Pe.push(q);else if(!q.inReplyToAccountId&&Pe.find(de=>de.id===q.inReplyToId)&&q.account.id===Q.account.id)Pe.push(q);else{const de=oe.find(Ye=>Ye.id===q.inReplyToId);de&&(de.__replies||(de.__replies=[]),de.__replies.push(q))}}),pe.size;const Ue=[...U.map(q=>({id:q.id,ancestor:!0,isThread:me,accountID:q.account.id,account:q.account,repliesCount:q.repliesCount,weight:nt(q)})),{id:t,accountID:Q.account.id,weight:nt(Q)},...Pe.map(q=>({id:q.id,account:q.account,accountID:q.account.id,descendant:!0,thread:q.account.id===Q.account.id,weight:nt(q),replies:re(q.__replies)}))];T("default"),B.current={offsetTop:(le=R.current)==null?void 0:le.offsetTop,scrollTop:(Re=M.current)==null?void 0:Re.scrollTop};const Me=Ue.findIndex(q=>q.id===t);Me>=we&&ye(Me+1),S(Ue),mt[t]=Ue,Zn(Q,f)}catch{T("error")}})(),()=>{clearTimeout(L)}};_(O,[t,c]),_(()=>{var L,V;if(!b.length)return;const I=gt[t];if(I)M.current.scrollTop=I;else if(B.current){const N={offsetTop:(L=R.current)==null?void 0:L.offsetTop,scrollTop:(V=M.current)==null?void 0:V.scrollTop},Z=N.offsetTop-B.current.offsetTop+N.scrollTop;M.current.scrollTop=Z}else b.length===1&&(M.current.scrollTop=0);B.current=null},[b]),_(()=>{y.reloadStatusPage<=0||(async()=>{try{const{instanceURL:I}=et(),L=`https://${I}/api/v1/statuses/${t}/context`;return await(await caches.open("api")).delete(L,{ignoreVary:!0}),O({reloadHero:!0})}catch{}})()},[y.reloadStatusPage]),_(()=>()=>{gt={},v.reloadStatusPage=0,mt={},Et={},Nt.clear()},[]);const $=y.statuses[F]||y.statuses[t],E=he(()=>{if(!$)return"";const{account:I}=$,L=document.createElement("div");return L.innerHTML=I.displayName,L.innerText.trim()},[$]),ee=he(()=>{if(!$)return"";let I=bn($);return I.length>64&&(I=I.slice(0,64)+"…"),I},[$]);Ie(E&&ee?`${E}: "${ee}"`:"Status","/:instance?/s/:id");const G=he(()=>{if(!$)return;const{url:I}=$;if(I)return new URL(I).hostname},[$]),xe=he(()=>{if(G)return G===f},[G,f]),[we,ye]=C(ht),se=he(()=>b.length-we,[b.length,we]),Le=b.some(I=>I.descendant),D=b.filter(I=>I.ancestor),[Y,ie]=C(!0),fe=kn(ie,100),Ae=he(()=>{if(!R.current||Y)return null;const{top:I}=R.current.getBoundingClientRect();return I>0?"down":"up"},[Y]);ke("esc",()=>{location.hash=n},{enabled:!l}),ke("backspace",()=>{location.hash=n}),ke("j",()=>{const I=document.activeElement.closest(".status-link, .status-focus"),L=I==null?void 0:I.getBoundingClientRect(),V=Array.from(M.current.querySelectorAll(".status-link:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *), .status-focus:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *)"));if(I&&L.top<M.current.clientHeight&&L.bottom>0){const N=V.indexOf(I);let Z=V[N+1];Z&&(Z.focus(),Z.scrollIntoView(ft))}else{const N=V.find(Z=>{const Te=Z.getBoundingClientRect();return Te.top>=44&&Te.left>=0});N&&(N.focus(),N.scrollIntoView(ft))}}),ke("k",()=>{const I=document.activeElement.closest(".status-link, .status-focus"),L=I==null?void 0:I.getBoundingClientRect(),V=Array.from(M.current.querySelectorAll(".status-link:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *), .status-focus:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *)"));if(I&&L.top<M.current.clientHeight&&L.bottom>0){const N=V.indexOf(I);let Z=V[N-1];Z&&(Z.focus(),Z.scrollIntoView(ft))}else{const N=V.find(Z=>{const Te=Z.getBoundingClientRect();return Te.top>=44&&Te.left>=0});N&&(N.focus(),N.scrollIntoView(ft))}}),ke("x",()=>{const I=document.activeElement.closest(".status-link, .status-focus");if(I){const L=I.nextElementSibling;L&&L.tagName.toLowerCase()==="details"&&(L.open=!L.open)}});const{nearReachStart:$e}=Tt({scrollableRef:M,distanceFromStartPx:16}),H=P(l?"media+status":"status"),X=Ge((I,L,V,N)=>{I.preventDefault(),I.stopPropagation(),i({media:L+1,mediaStatusID:N.id})},[t]),W=Ge((I,L)=>{Pt(L.id)},[]),ne=I=>{const{id:L,ancestor:V,isThread:N,descendant:Z,thread:Te,replies:Q,repliesCount:le,weight:Re}=I,re=L===t;return e("li",{ref:re?R:null,class:`${V?"ancestor":""} ${Z?"descendant":""} ${Te?"thread":""} ${re?"hero":""}`,children:[re?e(x,{children:[e(it,{threshold:.1,onChange:fe,class:"status-focus",tabIndex:0,children:e(ve,{statusID:L,instance:f,withinContext:!0,size:"l",enableTranslate:!0,forceTranslate:u})}),k!=="loading"&&!h?e("div",{class:"post-status-banner",children:[e("p",{children:"You're not logged in. Interactions (reply, boost, etc) are not possible."}),e(j,{to:"/login",class:"button",children:"Log in"})]}):!g&&e("div",{class:"post-status-banner",children:[e("p",{children:["This post is from another instance (",e("b",{children:f}),"). Interactions (reply, boost, etc) are not possible."]}),e("button",{type:"button",disabled:k==="loading",onClick:()=>{T("loading"),(async()=>{try{const Ee=await m.v2.search.fetch({q:$.url,type:"statuses",resolve:!0,limit:1});if(Ee.statuses.length){const U=Ee.statuses[0];location.hash=a?`/${a}/s/${U.id}`:`/s/${U.id}`}else throw new Error("No results")}catch(Ee){T("default"),alert("Error: "+Ee)}})()},children:[e(w,{icon:"transfer"})," Switch to my instance to enable interactions"]})]})]}):e(j,{class:"status-link",to:f?`/${f}/s/${L}`:`/s/${L}`,onClick:()=>{Pt(L)},children:[e(ve,{statusID:L,instance:f,withinContext:!0,size:Te||V?"m":"s",enableTranslate:!0,onMediaClick:X,onStatusLinkClick:W}),V&&N&&le>1&&e("div",{class:"replies-link",children:[e(w,{icon:"comment"})," ",e("span",{title:le,children:Ne(le)})]})," "]}),Z&&(Q==null?void 0:Q.length)>0&&e(qn,{instance:f,replies:Q,hasParentThread:Te,level:1,accWeight:Re,openAll:A.current<ji}),k==="loading"&&re&&!!($!=null&&$.repliesCount)&&!Le&&e("div",{class:"status-loading",children:e(be,{})}),k==="error"&&re&&!!($!=null&&$.repliesCount)&&!Le&&e("div",{class:"status-error",children:["Unable to load replies.",e("br",{}),e("button",{type:"button",class:"plain",onClick:()=>{v.reloadStatusPage++},children:"Try again"})]})]},L)};return e("div",{tabIndex:"-1",ref:M,class:`status-deck deck contained ${b.length>1?"padded-bottom":""} ${H.current==="status"?"slide-in":""} ${d?`deck-view-${d}`:""}`,onAnimationEnd:I=>{H.current==="status"&&(H.current=null)},children:[e("header",{class:`${Y?"inview":""} ${k==="loading"?"loading":""}`,onDblClick:I=>{v.reloadStatusPage++},children:e("div",{class:"header-grid header-grid-2",children:[e("h1",{children:[!!/\/s\//i.test((te=y.prevLocation)==null?void 0:te.pathname)&&e("button",{type:"button",class:"plain deck-back",onClick:()=>{history.back()},children:e(w,{icon:"chevron-left",size:"xl"})}),!Y&&$&&k!=="loading"?e(x,{children:[e("span",{class:"hero-heading",children:[e(bt,{account:$.account,instance:f,showAvatar:!0,short:!0})," ",e("span",{class:"insignificant",children:["•"," ",e(_t,{datetime:$.createdAt,format:"micro"})]})]})," ",e("button",{type:"button",class:"ancestors-indicator light small",onClick:I=>{I.preventDefault(),I.stopPropagation(),R.current.scrollIntoView({behavior:"smooth",block:"start"})},title:"Go to main post",children:e(w,{icon:Ae==="down"?"arrow-down":"arrow-up"})})]}):e(x,{children:["Post"," ",e("button",{type:"button",class:"ancestors-indicator light small",onClick:I=>{I.preventDefault(),I.stopPropagation(),M.current.scrollTo({top:0,behavior:"smooth"})},hidden:!D.length||$e,title:`${D.length} posts above ‒ Go to top`,children:[e(w,{icon:"arrow-up"}),D.filter((I,L,V)=>V.findIndex(N=>N.accountID===I.accountID)===L).slice(0,3).map(I=>e(je,{url:I.account.avatar,alt:I.account.displayName},I.account.id)),D.length>3&&e(x,{children:[" ",e("span",{class:"insignificant",children:Ne(D.length)})]})]})]})]}),e("div",{class:"header-side",children:[e(Ke,{align:"end",portal:{target:M.current},menuButton:e("button",{type:"button",class:"button plain4",children:e(w,{icon:"more",alt:"Actions",size:"xl"})}),children:[e(J,{disabled:k==="loading",onClick:()=>{v.reloadStatusPage++},children:[e(w,{icon:"refresh"}),e("span",{children:"Refresh"})]}),e(J,{className:"menu-switch-view",onClick:()=>{p(d==="full"?null:"full"),o.delete("media"),o.delete("media-only"),d==="full"?o.delete("view"):o.set("view","full"),i(o)},children:[e(w,{icon:{"":"layout5",full:"layout4"}[d||""]}),e("span",{children:["Switch to ",d==="full"?"Side Peek":"Full"," view"]})]}),e(J,{onClick:()=>{Array.from(M.current.querySelectorAll("button.spoiler:not(.spoiling)")).forEach(L=>{L.click()})},children:[e(w,{icon:"eye-open"})," ",e("span",{children:"Show all sensitive content"})]}),e(De,{}),e(hs,{className:"plain",children:"Experimental"}),e(J,{disabled:xe,onClick:()=>{const I=On($.url);I?location.hash=I:alert("Unable to switch")},children:[e(w,{icon:"transfer"}),e("small",{class:"menu-double-lines",children:["Switch to post's instance (",e("b",{children:G}),")"]})]})]}),e(j,{class:"button plain deck-close",to:n,children:e(w,{icon:"x",size:"xl"})})]})]})}),b.length&&$?e("ul",{class:`timeline flat contextual grow ${k==="loading"?"loading":""}`,children:[b.slice(0,we).map(ne),se>0&&e("li",{children:e("button",{type:"button",class:"plain block show-more",disabled:k==="loading",onClick:()=>ye(I=>I+ht),style:{marginBlockEnd:"6em"},children:[e("div",{class:"ib avatars-bunch",children:b.slice(we,we+5).map(I=>e(je,{url:I.account.avatarStatic},I.id))})," ",e("div",{class:"ib",children:["Show more…"," ",e("span",{class:"tag",children:se>ht?`${ht}+`:se})]})]})})]}):e(x,{children:[k==="loading"&&e("ul",{class:"timeline flat contextual grow loading",children:e("li",{children:e(ve,{skeleton:!0,size:"l"})})}),k==="error"&&e("p",{class:"ui-state",children:["Unable to load post",e("br",{}),e("br",{}),e("button",{type:"button",onClick:()=>{v.reloadStatusPage++},children:"Try again"})]})]})]})}function qn({replies:t,instance:n,hasParentThread:r,level:o,accWeight:i,openAll:s}){const[l,d]=Be(),p=b=>b.reduce((S,k)=>{const{repliesCount:T,replies:R}=k,F=(R==null?void 0:R.length)||T;return S+F+p(R||[])},0),u=t.length+p(t),c=t.length===u,f=t.map(b=>b.account).filter((b,S,k)=>k.findIndex(T=>T.id===b.id)===S).slice(0,3),m=he(()=>t==null?void 0:t.reduce((b,S)=>b+(S==null?void 0:S.weight),i),[i,t==null?void 0:t.length]);let a=!1;(s||m<=Gi||!r&&u===1&&nt(t[0])<2)&&(a=!0);const h=Et[t[0].id],g=Ge((b,S,k,T)=>{b.preventDefault(),b.stopPropagation(),d({media:S+1,mediaStatusID:T.id})},[]),y=P();return ze(()=>{var S;function b(k){k.target.dataset.scrollLeft=k.target.scrollLeft}return(S=y.current)==null||S.addEventListener("scroll",b,{passive:!0}),()=>{var k;(k=y.current)==null||k.removeEventListener("scroll",b)}},[]),e("details",{ref:y,class:"replies",open:h||a,onToggle:b=>{const{open:S}=b.target;Et[t[0].id]=S},style:{"--comments-level":o},"data-comments-level":o,"data-comments-level-overflow":o>4,children:[e("summary",{class:"replies-summary",hidden:a,children:[e("span",{class:"avatars",children:f.map(b=>e(je,{url:b.avatarStatic,title:`${b.displayName} @${b.username}`,squircle:b==null?void 0:b.bot},b.id))}),e("span",{children:[e("span",{title:t.length,children:Ne(t.length)})," ","repl",t.length===1?"y":"ies"]}),!c&&u>1&&e(x,{children:[" ","·"," ",e("span",{children:[e("span",{title:u,children:Ne(u)})," ","comment",u===1?"":"s"]})]})]}),e("ul",{children:t.map(b=>{var S,k;return e("li",{children:[e(j,{class:"status-link",to:n?`/${n}/s/${b.id}`:`/s/${b.id}`,onClick:()=>{Pt(b.id)},children:[e(ve,{statusID:b.id,instance:n,withinContext:!0,size:"s",enableTranslate:!0,onMediaClick:g}),!((S=b.replies)!=null&&S.length)&&b.repliesCount>0&&e("div",{class:"replies-link",children:[e(w,{icon:"comment"})," ",e("span",{title:b.repliesCount,children:Ne(b.repliesCount)})]})]}),((k=b.replies)==null?void 0:k.length)&&e(qn,{instance:n,replies:b.replies,level:o+1,accWeight:a?m:b.weight,openAll:s})]},b.id)})})]})}const Ji=140,Yi=35,Xi=70,Zi=140,Nt=new Map;function nt(t){var a,h;const n=Nt.get(t.id);if(n)return n;const{spoilerText:r,content:o,mediaAttachments:i,poll:s,card:l}=t,d=Qn(r+o),p=i!=null&&i.length?Ji:0,u=(((a=s==null?void 0:s.options)==null?void 0:a.length)||0)*Yi,c=l&&(i!=null&&i.length||(h=s==null?void 0:s.options)!=null&&h.length)?0:Xi,m=(d+p+u+c)/Zi;return Nt.set(t.id,m),m}const Qi=We(Wi);function eo(){const t=Je(),{id:n,instance:r}=t;return e(Qi,{id:n,instance:r})}const to=""+new URL("boosts-carousel-c271525c.jpg",import.meta.url).href,no=""+new URL("grouped-notifications-3dcc5ef2.jpg",import.meta.url).href,so=""+new URL("multi-column-962e6b3c.jpg",import.meta.url).href,io=""+new URL("multi-hashtag-timeline-24789e5e.jpg",import.meta.url).href,oo=""+new URL("nested-comments-thread-38ddecea.jpg",import.meta.url).href,co=""+new URL("logo-text-810e685b.svg",import.meta.url).href;function rn(){return Ie(null,["/","/welcome"]),e("main",{id:"welcome",children:[e("div",{class:"hero-container",children:[e("h1",{children:[e("img",{src:In,alt:"",width:"200",height:"200",style:{aspectRatio:"1/1",marginBlockEnd:-16}}),e("img",{src:co,alt:"Phanpy",width:"250"})]}),e("p",{children:e("big",{children:e("b",{children:e(j,{to:"/login",class:"button",children:"Log in"})})})}),e("p",{class:"desc",children:"A minimalistic opinionated Mastodon web client."})]}),e("div",{id:"why-container",children:e("div",{class:"sections",children:[e("section",{children:[e("img",{src:to,alt:"Screenshot of Boosts Carousel",loading:"lazy"}),e("h4",{children:"Boosts Carousel"}),e("p",{children:"Visually separate original posts and re-shared posts (boosted posts)."})]}),e("section",{children:[e("img",{src:oo,alt:"Screenshot of nested comments thread",loading:"lazy"}),e("h4",{children:"Nested comments thread"}),e("p",{children:"Effortlessly follow conversations. Semi-collapsible replies."})]}),e("section",{children:[e("img",{src:no,alt:"Screenshot of grouped notifications",loading:"lazy"}),e("h4",{children:"Grouped notifications"}),e("p",{children:"Similar notifications are grouped and collapsed to reduce clutter."})]}),e("section",{children:[e("img",{src:so,alt:"Screenshot of multi-column UI",loading:"lazy"}),e("h4",{children:"Single or multi-column"}),e("p",{children:"By default, single column for zen-mode seekers. Configurable multi-column for power users."})]}),e("section",{children:[e("img",{src:io,alt:"Screenshot of multi-hashtag timeline with a form to add more hashtags",loading:"lazy"}),e("h4",{children:"Multi-hashtag timeline"}),e("p",{children:"Up to 5 hashtags combined into a single timeline."})]})]})}),e("hr",{}),e("p",{children:[e("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",children:"Built"})," ","by"," ",e("a",{href:"https://mastodon.social/@cheeaun",target:"_blank",onClick:t=>{t.preventDefault(),v.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"}),"."," ",e("a",{href:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",target:"_blank",children:"Privacy Policy"}),"."]})]})}const ao=window.alert;window.__nativeAlert||(window.__nativeAlert=ao);window.alert=function(t){t instanceof Error&&(t!=null&&t.message)&&(t=t.message),typeof t!="string"&&(t=JSON.stringify(t));const n=fs({text:t,className:"alert",gravity:"top",position:"center",duration:1e4,offset:{y:48},onClick:()=>{n.hideToast()}});n.showToast()};window.__STATES__=v;setTimeout(()=>{var t,n,r,o;for(const i in rt)Array.isArray(rt[i])?(n=(t=rt[i])[0])==null||n.call(t):(o=(r=rt)[i])==null||o.call(r)},5e3);function lo(){const t=ae(v),[n,r]=C(!1),[o,i]=C("loading");ze(()=>{const c=K.local.get("theme");c&&(document.documentElement.classList.add(`is-${c}`),document.querySelector('meta[name="color-scheme"]').setAttribute("content",c==="auto"?"dark light":c));const f=K.local.get("textSize");f&&document.documentElement.style.setProperty("--text-size",`${f}px`)},[]),_(()=>{const c=K.local.get("instanceURL"),f=decodeURIComponent((window.location.search.match(/code=([^&]+)/)||[,""])[1]);if(f){window.history.replaceState({},document.title,s.pathname||"/");const m=K.session.get("clientID"),a=K.session.get("clientSecret"),h=K.session.get("vapidKey");(async()=>{i("loading");const{access_token:g}=await qi({instanceURL:c,client_id:m,client_secret:a,code:f}),y=es({instance:c,accessToken:g});await Promise.allSettled([Gt(y,c),ts(y,c,g,h)]),Wt(),Kt(y),r(!0),i("default")})()}else{window.__IGNORE_GET_ACCOUNT_ERROR__=!0;const m=et();if(m){K.session.set("currentAccount",m.info.id);const{client:a}=z({account:m}),{instance:h}=a;Wt(),Kt(a),i("loading"),(async()=>{try{await Gt(a,h)}catch{}finally{r(!0),i("default")}})()}else i("default")}},[]);let s=St();v.currentLocation=s.pathname,_(Lt,[s,n]);const l=t.prevLocation,d=P(l||null);if(he(()=>st("/:instance/s/:id",s.pathname)||st("/s/:id",s.pathname),[s.pathname,st])?d.current||(d.current=l):d.current=null,/\/https?:/.test(s.pathname))return e(Ni,{});const u=he(()=>{const{pathname:c}=s;return!/^\/(login|welcome)/.test(c)},[s]);return _(()=>{var f;const c=document.getElementById("app");c&&(c.dataset.shortcutsViewMode=(f=t.shortcuts)!=null&&f.length?t.settings.shortcutsViewMode:"")},[t.shortcuts,t.settings.shortcutsViewMode]),_(()=>{document.body.classList.toggle("cloak",t.settings.cloakMode)},[t.settings.cloakMode]),e(x,{children:[e(Ct,{location:u||s,children:[e(ge,{path:"/",element:n?e(Di,{}):o==="loading"?e(be,{id:"loader-root"}):e(rn,{})}),e(ge,{path:"/login",element:e(Hi,{})}),e(ge,{path:"/welcome",element:e(rn,{})})]}),e(Ct,{location:d.current||s,children:[n&&e(ge,{path:"/notifications",element:e(zn,{})}),n&&e(ge,{path:"/mentions",element:e(Un,{})}),n&&e(ge,{path:"/following",element:e(Ot,{})}),n&&e(ge,{path:"/b",element:e(En,{})}),n&&e(ge,{path:"/f",element:e(Pn,{})}),n&&e(ge,{path:"/l",children:[e(ge,{index:!0,element:e(_i,{})}),e(ge,{path:":id",element:e(_n,{})})]}),n&&e(ge,{path:"/ft",element:e(ri,{})}),e(ge,{path:"/:instance?/t/:hashtag",element:e(Nn,{})}),e(ge,{path:"/:instance?/a/:id",element:e(oi,{})}),e(ge,{path:"/:instance?/p",children:[e(ge,{index:!0,element:e(Dt,{})}),e(ge,{path:"l",element:e(Dt,{local:!0})})]}),e(ge,{path:"/:instance?/trending",element:e(Bn,{})}),e(ge,{path:"/:instance?/search",element:e(Vi,{})})]}),o==="default"&&e(Ct,{children:e(ge,{path:"/:instance?/s/:id",element:e(eo,{})})}),n&&e(bs,{}),n&&!t.settings.shortcutsColumnsMode&&t.settings.shortcutsViewMode!=="multi-column"&&e(Zs,{}),e(Js,{}),n&&e(Ys,{}),e(gs,{isLoggedIn:n}),o!=="loading"&&e(Xs,{onClose:Lt}),e(ys,{})]})}"AbortSignal"in window&&(AbortSignal.timeout=AbortSignal.timeout||(t=>{const n=new AbortController;return setTimeout(()=>n.abort(),t),n.signal}));ps(e(ms,{children:e(lo,{})}),document.getElementById("app"));setTimeout(()=>{try{Object.keys(localStorage).forEach(t=>{t.startsWith("iconify")&&localStorage.removeItem(t)}),Object.keys(sessionStorage).forEach(t=>{t.startsWith("iconify")&&sessionStorage.removeItem(t)}),localStorage.removeItem("settings:boostsCarousel")}catch{}},5e3);window.__CLOAK__=()=>{document.body.classList.toggle("cloak")};
//# sourceMappingURL=main-c1a777a1.js.map
