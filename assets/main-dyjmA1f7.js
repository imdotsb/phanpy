import{s as I,a as q,b as xe,u as En,c as me,o as gs,I as w,M as Ie,d as se,A as tt,N as Ct,e as Fe,f as Be,L as ee,g as ct,h as Pn,l as bs,t as en,R as At,i as ys,p as nt,j as He,k as Nn,m as Dt,E as Dn,n as Ne,q as Ze,r as ws,v as Te,w as tn,T as Un,x as ft,y as Fn,z as nn,B as vs,C as Ss,D as On,F as Re,G as ks,S as $e,H as Is,J as Ts,K as Ge,O as Bn,P as Ut,Q as Cs,U as lt,V as zn,W as Me,X as qn,Y as $s,Z as xs,_ as As,$ as bt,a0 as Ls,a1 as sn,a2 as Ms,a3 as on,a4 as an}from"./useTitle-tYrc2SF5.js";import{_ as D,p as z,h as $,u as Le,w as ze,a as e,b as Se,g as A,s as Lt,c as Vt,M as ie,d as Ee,e as dt,F as he,T as Ve,S as Rs,I as je,y as Ye,f as Hn,l as cn,i as Vn,j as Gn,k as qe,A as _s,N as Es,m as Ps,q as Ns,J as Ds,C as jn,n as Us,o as st,r as Yn,t as Fs,v as Os,x as Bs,z as mt,B as Wn,D as rn,E as zs,R as Gt,G as Ce,H as qs,K as Hs}from"./vendor-ygncGLEO.js";function rt(t=()=>{},n=[]){const i=D(t);z(()=>{i.current=t},[n]),z(()=>{const o=()=>{const a=document.hidden||document.visibilityState==="hidden";i.current(!a)};return document.addEventListener("visibilitychange",o),()=>document.removeEventListener("visibilitychange",o)},[])}const Vs=1e3*3,Gs=15e3,js=ze(function({isLoggedIn:n}){const[i,o]=$(!0);rt(o);const a=async(l,c,d)=>{var h;if(I.notificationsLast){const r=l.v1.notifications.list({limit:1,sinceId:I.notificationsLast.id}),{value:p}=await r.next();if(p!=null&&p.length)if(d)I.notificationsShowNew=!0;else{let f;try{const g=await l.v1.markers.fetch({timeline:"notifications"});f=(h=g==null?void 0:g.notifications)==null?void 0:h.lastReadId}catch{}f?I.notificationsShowNew=p[0].id!==f:I.notificationsShowNew=!0}}};z(()=>{let l,c;if(n&&i){const{masto:d,streaming:h,instance:r}=q();(async()=>{await a(d,r);let p=!1;h&&(c=setTimeout(()=>{(async()=>{try{p=!0,l=h.user.notification.subscribe();for await(const f of l){if(!l||!i)break;f.event==="notification"&&xe(f.payload,r,{skipThreading:!0}),I.notificationsShowNew=!0}}catch{p=!1}p||(c=setInterval(()=>{a(d,r,!0)},Gs))})()},Vs))})()}return()=>{var d;(d=l==null?void 0:l.unsubscribe)==null||d.call(l),l=null,clearTimeout(c),clearInterval(c)}},[i,n]);const s=D(),u=()=>{s.current=Date.now(),fetch("./version.json").then(l=>l.json()).then(l=>{l&&(I.appVersion=l)}).catch(l=>{})};return En(u,i&&1e3*60*30),rt(l=>{l&&(s.current?Date.now()-s.current>1e3*60*60&&u():u())}),Le("shift+alt+k",()=>{const l=I.settings.cloakMode;I.settings.cloakMode=!l,me({text:`Cloak mode ${l?"disabled":"enabled"}`})}),null});function Ys(){function t(n){n.shiftKey?gs()||(I.showCompose=!0):I.showCompose=!0}return Le("c, shift+c",t,{ignoreEventWhen:n=>!!document.querySelector("#modal-container > *")}),e("button",{type:"button",id:"compose-button",onClick:t,children:e(w,{icon:"quill",size:"xl",alt:"Compose"})})}const Ws=ze(function(){const n=Se(I);function i(){I.showKeyboardShortcutsHelp=!1}return Le("?, shift+?",o=>{I.showKeyboardShortcutsHelp=!0},{ignoreEventWhen:o=>!!document.querySelector("#modal-container > *")}),!!n.showKeyboardShortcutsHelp&&e(Ie,{class:"light",onClose:i,children:e("div",{id:"keyboard-shortcuts-help-container",class:"sheet",tabindex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:i,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Keyboard shortcuts"})}),e("main",{children:e("table",{children:[{action:"Keyboard shortcuts help",keys:e("kbd",{children:"?"})},{action:"Next post",keys:e("kbd",{children:"j"})},{action:"Previous post",keys:e("kbd",{children:"k"})},{action:"Skip carousel to next post",keys:e(A,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"j"})]})},{action:"Skip carousel to previous post",keys:e(A,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"k"})]})},{action:"Open post details",keys:e(A,{children:[e("kbd",{children:"Enter"})," or ",e("kbd",{children:"o"})]})},{action:e(A,{children:["Expand content warning or",e("br",{}),"toggle expanded/collapsed thread"]}),keys:e("kbd",{children:"x"})},{action:"Close post or dialogs",keys:e(A,{children:[e("kbd",{children:"Esc"})," or ",e("kbd",{children:"Backspace"})]})},{action:"Focus column in multi-column mode",keys:e(A,{children:[e("kbd",{children:"1"})," to ",e("kbd",{children:"9"})]})},{action:"Compose new post",keys:e("kbd",{children:"c"})},{action:"Compose new post (new window)",className:"insignificant",keys:e(A,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"c"})]})},{action:"Send post",keys:e(A,{children:[e("kbd",{children:"Ctrl"})," + ",e("kbd",{children:"Enter"})," or ",e("kbd",{children:"⌘"})," +"," ",e("kbd",{children:"Enter"})]})},{action:"Search",keys:e("kbd",{children:"/"})},{action:"Reply",keys:e("kbd",{children:"r"})},{action:"Reply (new window)",className:"insignificant",keys:e(A,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"r"})]})},{action:"Like (favourite)",keys:e(A,{children:[e("kbd",{children:"l"})," or ",e("kbd",{children:"f"})]})},{action:"Boost",keys:e(A,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"b"})]})},{action:"Bookmark",keys:e("kbd",{children:"d"})},{action:"Toggle Cloak mode",keys:e(A,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"Alt"})," + ",e("kbd",{children:"k"})]})}].map(({action:o,className:a,keys:s})=>e("tr",{children:[e("th",{class:a,children:o}),e("td",{children:s})]},o))})})]})})});function Ks({onClose:t}){const{masto:n}=q(),i=se.local.getJSON("accounts"),o=se.session.get("currentAccount"),a=i.length>1,[s,u]=Lt(c=>c+1,0),[l]=Vt();return e("div",{id:"accounts-container",class:"sheet",tabIndex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{class:"header-grid",children:e("h2",{children:"Accounts"})}),e("main",{children:e("section",{children:[e("ul",{class:"accounts-list",ref:l,children:i.map((c,d)=>{const h=c.info.id===o,r=d===0;return e("li",{children:[e("div",{children:[a&&e("span",{class:`current ${h?"is-current":""}`,children:e(w,{icon:"check-circle",alt:"Current"})}),e(tt,{url:c.info.avatarStatic,size:"xxl",onDblClick:async()=>{if(h)try{const p=await n.v1.accounts.$select(c.info.id).fetch();c.info=p,se.local.setJSON("accounts",i),u()}catch{}}}),e(Ct,{account:a?{...c.info,acct:/@/.test(c.info.acct)?c.info.acct:`${c.info.acct}@${c.instanceURL}`}:c.info,showAcct:!0,onClick:()=>{h?I.showAccount=`${c.info.username}@${c.instanceURL}`:(se.session.set("currentAccount",c.info.id),location.reload())}})]}),e("div",{class:"actions",children:[r&&a&&e(A,{children:[e("span",{class:"tag",children:"Default"})," "]}),e(Fe,{align:"end",menuButton:e("button",{type:"button",title:"More",class:"plain more-button",children:e(w,{icon:"more",size:"l",alt:"More"})}),children:[e(ie,{onClick:()=>{I.showAccount=`${c.info.username}@${c.instanceURL}`},children:[e(w,{icon:"user"}),e("span",{children:"View profile…"})]}),e(Ee,{}),a&&e(ie,{disabled:r,onClick:()=>{i.splice(d,1),i.unshift(c),se.local.setJSON("accounts",i),u()},children:[e(w,{icon:"check-circle"}),e("span",{children:"Set as default"})]}),e(Be,{subMenu:!0,confirmLabel:e(A,{children:[e(w,{icon:"exit"}),e("span",{children:["Log out @",c.info.acct,"?"]})]}),disabled:!h,menuItemClassName:"danger",onClick:()=>{i.splice(d,1),se.local.setJSON("accounts",i),location.href=location.pathname||"/"},children:[e(w,{icon:"exit"}),e("span",{children:"Log out…"})]})]})]})]},c.info.id)})}),e("p",{children:e(ee,{to:"/login",class:"button plain2",onClick:t,children:[e(w,{icon:"plus"})," ",e("span",{children:"Add an existing account"})]})}),a&&e("p",{children:e("small",{children:["Note: ",e("i",{children:"Default"})," account will always be used for first load. Switched accounts will persist during the session."]})})]})})]})}const jt="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20fill-rule='evenodd'%20stroke-linejoin='round'%20stroke-miterlimit='2'%20clip-rule='evenodd'%20viewBox='0%200%2064%2064'%3e%3cpath%20fill='none'%20d='M0%200h63.994v63.994H0z'/%3e%3cpath%20fill='%23a4bff7'%20d='M37.774%2011.471c14.639%203.752%2019.034%2016.557%2015.889%2031.304-.696%203.261-2.563%206.661-6.356%208.693-3.204%201.717-8.07%202.537-15.338.55l-9.634-2.404C11.651%2046.992%208.378%2038.733%2010.027%2031.823c3.627-15.201%2015.543-23.48%2027.747-20.352Z'/%3e%3cpath%20fill='%23d8e7fe'%20d='M36.76%2015.429c12.289%203.15%2015.547%2014.114%2012.907%2026.493-.947%204.44-4.937%209.365-16.664%206.143l-9.684-2.417c-7.854-1.923-10.53-7.8-9.318-12.877%203.016-12.639%2012.611-19.943%2022.759-17.342Z'/%3e%3cpath%20fill='%236081e6'%20d='M27.471%2024.991c-1.457-.698-7.229%203.213-7.663%208.926-.182%202.39%204.55%203.237%205.071-.169.725-4.743%203.715-8.218%202.592-8.757Zm10.746%202.005c-2.083.327-.382%205.901-.595%2010.727-.123%202.8%204.388%203.464%204.703%202.011%201.098-5.073-2.066-13.058-4.108-12.738Z'/%3e%3c/svg%3e";function ln(t){const{masto:n}=q();return n.v1.push.subscription.create(t)}function Zs(){const{masto:t}=q();return t.v1.push.subscription.fetch()}function Js(t){const{masto:n}=q();return n.v1.push.subscription.update(t)}function Xs(){const{masto:t}=q();return t.v1.push.subscription.remove()}function Mt(){return"serviceWorker"in navigator&&"PushManager"in window}function Qs(){return navigator.serviceWorker.getRegistration()}async function Yt(){const t=await Qs(),n=t?await t.pushManager.getSubscription():void 0;return{registration:t,subscription:n}}function Kn(t){const n="=".repeat((4-t.length%4)%4),i=`${t}${n}`.replace(/-/g,"+").replace(/_/g,"/"),o=window.atob(i),a=new Uint8Array(o.length);for(let s=0;s<o.length;++s)a[s]=o.charCodeAt(s);return a}async function ei(){if(!Mt())return;const{subscription:t}=await Yt();let n=null;try{n=await Zs()}catch(i){if(!/(not found|unknown)/i.test(i.message))throw i}if(n&&t){const i=n.endpoint===t.endpoint,{vapidKey:o}=ct(),a=n.serverKey===o;if(!i)throw new Error("Backend subscription endpoint changed");if(!a)throw new Error("Backend subscription key and vapid key changed")}if(t&&!n){const{vapidKey:i}=ct(),{applicationServerKey:o}=t.options,a=Kn(i).toString(),s=new Uint8Array(o).toString();if(!(a===s))throw await t.unsubscribe(),new Error("Subscription key and vapid key changed")}return{subscription:t,backendSubscription:n}}async function dn({data:t,policy:n}){if(!Mt())return;let{registration:i,subscription:o}=await Yt(),a=null;if(o)try{a=await Js({data:t,policy:n})}catch{a=await ln({subscription:o,data:t,policy:n})}else{const{vapidKey:s}=ct();if(!s)throw new Error("No server key found");o=await i.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:Kn(s)}),a=await ln({subscription:o,data:t,policy:n})}return{subscription:o,backendSubscription:a}}async function un(){if(!Mt())return;const{subscription:t}=await Yt();t&&(await Xs(),await t.unsubscribe())}var ti={PHANPY_CLIENT_NAME:"IMSB",PHANPY_WEBSITE:"https://app.imsb.app",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",VITE_APP_ENV:"production",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const hn=16,et=[15,16,17,18,19,20],{PHANPY_WEBSITE:fn,PHANPY_PRIVACY_POLICY_URL:ni,PHANPY_IMG_ALT_API_URL:si}=ti;function ii({onClose:t}){const n=Se(I),i=se.local.get("theme")||"auto",o=D(),a=n.settings.contentTranslationTargetLanguage||null,s=Pn(),u=bs(s),l=se.local.get("textSize")||hn,[c,d]=$(se.account.get("preferences")||{}),{masto:h,authenticated:r,instance:p}=q();return e("div",{id:"settings-container",class:"sheet",tabIndex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Settings"})}),e("main",{children:[e("section",{children:e("ul",{children:[e("li",{children:[e("div",{children:e("label",{children:"Appearance"})}),e("div",{children:e("form",{ref:o,onInput:f=>{f.preventDefault();const m=new FormData(o.current).get("theme"),S=document.documentElement;if(m==="auto"){S.classList.remove("is-light","is-dark");const y=document.querySelector('meta[data-theme-setting="manual"]');y&&(y.name=""),document.querySelectorAll('meta[data-theme-setting="auto"]').forEach(v=>{v.name="theme-color"})}else{S.classList.toggle("is-light",m==="light"),S.classList.toggle("is-dark",m==="dark");const y=document.querySelector('meta[data-theme-setting="manual"]');y&&(y.name="theme-color",y.content=m==="light"?y.dataset.themeLightColor:y.dataset.themeDarkColor),document.querySelectorAll('meta[data-theme-setting="auto"]').forEach(v=>{v.name=""})}document.querySelector('meta[name="color-scheme"]').setAttribute("content",m==="auto"?"dark light":m),m==="auto"?se.local.del("theme"):se.local.set("theme",m)},children:e("div",{class:"radio-group",children:[e("label",{children:[e("input",{type:"radio",name:"theme",value:"light",defaultChecked:i==="light"}),e("span",{children:"Light"})]}),e("label",{children:[e("input",{type:"radio",name:"theme",value:"dark",defaultChecked:i==="dark"}),e("span",{children:"Dark"})]}),e("label",{children:[e("input",{type:"radio",name:"theme",value:"auto",defaultChecked:i!=="light"&&i!=="dark"}),e("span",{children:"Auto"})]})]})})})]}),e("li",{children:[e("div",{children:e("label",{children:"Text size"})}),e("div",{class:"range-group",children:[e("span",{style:{fontSize:et[0]},children:"A"})," ",e("input",{type:"range",min:et[0],max:et[et.length-1],step:"1",value:l,list:"sizes",onChange:f=>{const g=parseInt(f.target.value,10);document.documentElement.style.setProperty("--text-size",`${g}px`),g===hn?se.local.del("textSize"):se.local.set("textSize",f.target.value)}})," ",e("span",{style:{fontSize:et[et.length-1]},children:"A"}),e("datalist",{id:"sizes",children:et.map(f=>e("option",{value:f}))})]})]})]})}),r&&e(A,{children:[e("h3",{children:"Posting"}),e("section",{children:e("ul",{children:e("li",{children:[e("div",{children:e("label",{for:"posting-privacy-field",children:["Default visibility"," ",e(w,{icon:"cloud",alt:"Synced",class:"synced-icon"})]})}),e("div",{children:e("select",{id:"posting-privacy-field",value:c["posting:default:visibility"]||"public",onChange:f=>{const{value:g}=f.target;(async()=>{try{await h.v1.accounts.updateCredentials({source:{privacy:g}}),d({...c,"posting:default:visibility":g}),se.account.set("preferences",{...c,"posting:default:visibility":g})}catch{alert("Failed to update posting privacy")}})()},children:[e("option",{value:"public",children:"Public"}),e("option",{value:"unlisted",children:"Unlisted"}),e("option",{value:"private",children:"Followers only"})]})})]})})}),e("p",{class:"section-postnote",children:[e(w,{icon:"cloud",alt:"Synced",class:"synced-icon"})," ",e("small",{children:["Synced to your instance server's settings."," ",e("a",{href:`https://${p}/`,target:"_blank",rel:"noopener noreferrer",children:["Go to your instance (",p,") for more settings."]})]})]})]}),e("h3",{children:"Experiments"}),e("section",{children:e("ul",{children:[e("li",{children:e("label",{children:[e("input",{type:"checkbox",checked:n.settings.autoRefresh,onChange:f=>{I.settings.autoRefresh=f.target.checked}})," ","Auto refresh timeline posts"]})}),e("li",{children:e("label",{children:[e("input",{type:"checkbox",checked:n.settings.boostsCarousel,onChange:f=>{I.settings.boostsCarousel=f.target.checked}})," ","Boosts carousel"]})}),e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslation,onChange:f=>{const{checked:g}=f.target;I.settings.contentTranslation=g,g||(I.settings.contentTranslationTargetLanguage=null)}})," ","Post translation"]}),e("div",{class:`sub-section ${n.settings.contentTranslation?"":"more-insignificant"}`,children:[e("div",{children:e("label",{children:["Translate to"," ",e("select",{value:a||"",disabled:!n.settings.contentTranslation,onChange:f=>{I.settings.contentTranslationTargetLanguage=f.target.value||null},children:[e("option",{value:"",children:["System language (",u,")"]}),e("option",{disabled:!0,children:"──────────"}),en.map(f=>e("option",{value:f.code,children:f.name}))]})]})}),e("hr",{}),e("p",{class:"checkbox-fieldset",children:['Hide "Translate" button for',n.settings.contentTranslationHideLanguages.length>0&&e(A,{children:[" ","(",n.settings.contentTranslationHideLanguages.length,")"]}),":",e("div",{class:"checkbox-fields",children:en.map(f=>e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslationHideLanguages.includes(f.code),onChange:g=>{const{checked:m}=g.target;m?I.settings.contentTranslationHideLanguages.push(f.code):I.settings.contentTranslationHideLanguages=n.settings.contentTranslationHideLanguages.filter(S=>S!==f.code)}})," ",f.name]}))})]}),e("p",{class:"insignificant",children:e("small",{children:["Note: This feature uses external translation services, powered by"," ",e("a",{href:"https://github.com/cheeaun/lingva-api",target:"_blank",rel:"noopener noreferrer",children:"Lingva API"})," ","&"," ",e("a",{href:"https://github.com/thedaviddelta/lingva-translate",target:"_blank",rel:"noopener noreferrer",children:"Lingva Translate"}),"."]})}),e("hr",{}),e("div",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslationAutoInline,disabled:!n.settings.contentTranslation,onChange:f=>{I.settings.contentTranslationAutoInline=f.target.checked}})," ","Auto inline translation"]}),e("p",{class:"insignificant",children:e("small",{children:["Automatically show translation for posts in timeline. Only works for ",e("b",{children:"short"})," posts without content warning, media and poll."]})})]})]})]}),!!si&&e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.mediaAltGenerator,onChange:f=>{I.settings.mediaAltGenerator=f.target.checked}})," ","Image description generator"," ",e(w,{icon:"sparkles2",class:"more-insignificant"})]}),e("div",{class:"sub-section insignificant",children:e("small",{children:"Only for new images while composing new posts."})}),e("div",{class:"sub-section insignificant",children:e("small",{children:["Note: This feature uses external AI service, powered by"," ",e("a",{href:"https://github.com/cheeaun/img-alt-api",target:"_blank",rel:"noopener noreferrer",children:"img-alt-api"}),". May not work well. Only for images and in English."]})})]}),e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.cloakMode,onChange:f=>{I.settings.cloakMode=f.target.checked}})," ","Cloak mode"," ",e("span",{class:"insignificant",children:["(",e("samp",{children:"Text"})," → ",e("samp",{children:"████"}),")"]})]}),e("div",{class:"sub-section insignificant",children:e("small",{children:"Replace text as blocks, useful when taking screenshots, for privacy reasons."})})]}),r&&e("li",{children:e("button",{type:"button",class:"light",onClick:()=>{I.showDrafts=!0,I.showSettings=!1},children:"Unsent drafts"})})]})}),r&&e(oi,{onClose:t}),e("h3",{children:"About"}),e("section",{children:[e("div",{style:{display:"flex",flexWrap:"wrap",gap:8,lineHeight:1.25,alignItems:"center",marginTop:8},children:[e("img",{src:jt,alt:"",width:"64",height:"64",style:{aspectRatio:"1/1",verticalAlign:"middle",background:"#b7cdf9",borderRadius:12}}),e("div",{children:[e("b",{children:"Phanpy"})," ",e("a",{href:"https://hachyderm.io/@phanpy",rel:"noopener noreferrer",onClick:f=>{f.preventDefault(),I.showAccount="phanpy@hachyderm.io"},children:"@phanpy"}),e("br",{}),e("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",rel:"noopener noreferrer",children:"Built"})," ","by"," ",e("a",{href:"https://mastodon.social/@cheeaun",rel:"noopener noreferrer",onClick:f=>{f.preventDefault(),I.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"})]})]}),e("p",{children:[e("a",{href:"https://github.com/sponsors/cheeaun",target:"_blank",rel:"noopener noreferrer",children:"Sponsor"})," ","·"," ",e("a",{href:"https://www.buymeacoffee.com/cheeaun",target:"_blank",rel:"noopener noreferrer",children:"Donate"})," ","·"," ",e("a",{href:ni,target:"_blank",rel:"noopener noreferrer",children:"Privacy Policy"})]}),e("p",{children:[fn&&e(A,{children:[e("span",{class:"insignificant",children:"Site:"})," ",fn.replace(/https?:\/\//g,"").replace(/\/$/,""),e("br",{})]}),e("span",{class:"insignificant",children:"Version:"})," ",e("input",{type:"text",class:"version-string",readOnly:!0,size:"18",value:`${"2024-01-08T03:33:07.851Z".slice(0,10).replace(/-/g,".")}.99b0b7c`,onClick:f=>{f.target.select();try{navigator.clipboard.writeText(f.target.value),me("Version string copied")}catch{me("Unable to copy version string")}}})," ",e("span",{class:"ib insignificant",children:["(",e("a",{href:"https://github.com/cheeaun/phanpy/commit/99b0b7c",target:"_blank",rel:"noopener noreferrer",children:e(At,{datetime:new Date("2024-01-08T03:33:07.851Z")})}),")"]})]})]})]})]})}function oi({onClose:t}){if(!Mt())return null;const{instance:n}=q(),[i,o]=$("default"),a=D(),[s,u]=$(!1),[l,c]=$(!1),d=D();z(()=>{(async()=>{o("loading");try{const{subscription:r,backendSubscription:p}=await ei();if(p!=null&&p.policy&&p.policy!=="none"){u(!0);const{alerts:f,policy:g}=p;d.current=g;const{elements:m}=a.current,S=m.namedItem(g);S&&(S.value=g),Object.keys(f).forEach(y=>{const b=m.namedItem(y);(b==null?void 0:b.type)==="checkbox"&&(b.checked=!0)})}o("default")}catch(r){/outside.*authorized/i.test(r.message)?c(!0):alert((r==null?void 0:r.message)||r),o("error")}})()},[]);const h=i==="loading";return e("form",{ref:a,onChange:()=>{const r=Object.fromEntries(new FormData(a.current)),p=!!r["policy-allow"],f={policy:r.policy,data:{alerts:{mention:!!r.mention,favourite:!!r.favourite,reblog:!!r.reblog,follow:!!r.follow,follow_request:!!r.followRequest,poll:!!r.poll,update:!!r.update,status:!!r.status}}};let g=0;Object.keys(f.data.alerts).forEach(S=>{f.data.alerts[S]?g++:delete f.data.alerts[S]});const m=d.current!==f.policy;p&&g>0?m?un().then(()=>{dn(f)}).catch(S=>{alert("Failed to update subscription. Please try again.")}):dn(f).catch(S=>{alert("Failed to update subscription. Please try again.")}):un().catch(S=>{alert("Failed to remove subscription. Please try again.")})},children:[e("h3",{children:"Push Notifications (beta)"}),e("section",{children:e("ul",{children:e("li",{children:[e("label",{children:[e("input",{type:"checkbox",disabled:h||l,name:"policy-allow",checked:s,onChange:async r=>{const{checked:p}=r.target;if(p){const f=await Notification.requestPermission();f==="granted"?u(!0):(u(!1),f==="denied"&&alert("Push notifications are blocked. Please enable them in your browser settings."))}else u(!1)}})," ","Allow from"," ",e("select",{name:"policy",disabled:h||l||!s,children:[{value:"all",label:"anyone"},{value:"followed",label:"people I follow"},{value:"follower",label:"followers"}].map(r=>e("option",{value:r.value,children:r.label}))})]}),e("div",{class:"shazam-container no-animation",style:{width:"100%"},hidden:!s,children:e("div",{class:"shazam-container-inner",children:e("div",{class:"sub-section",children:e("ul",{children:[{value:"mention",label:"Mentions"},{value:"favourite",label:"Likes"},{value:"reblog",label:"Boosts"},{value:"follow",label:"Follows"},{value:"followRequest",label:"Follow requests"},{value:"poll",label:"Polls"},{value:"update",label:"Post edits"},{value:"status",label:"New posts"}].map(r=>e("li",{children:e("label",{children:[e("input",{type:"checkbox",name:r.value})," ",r.label]})}))})})})}),l&&e("div",{class:"sub-section",children:e("p",{children:["Push permission was not granted since your last login. You'll need to"," ",e(ee,{to:`/login?instance=${n}`,onClick:t,children:[e("b",{children:"log in"})," again to grant push permission"]}),"."]})})]})})}),e("p",{class:"section-postnote",children:e("small",{children:["NOTE: Push notifications only work for ",e("b",{children:"one account"}),"."]})})]})}const Ft=()=>{let t=setTimeout(()=>{if(!document.getElementById("columns")){const i=document.querySelectorAll("#modal-container > *");if(i!=null&&i.length){const u=i[i.length-1],l=u.querySelector('[tabindex="-1"]')||u;if(l){l.focus();return}}if(document.querySelector(".deck-backdrop"))return;const a=document.querySelectorAll(".deck-container"),s=a[a.length-1];s&&s.tabIndex===-1&&s.focus()}},100);return()=>clearTimeout(t)};function Zn(t){if(!t)return;const n=dt(),i=D(n.pathname);z(()=>{i.current&&n.pathname!==i.current&&(t==null||t())},[n.pathname,t])}function Wt({list:t,onClose:n}){const{masto:i}=q(),[o,a]=$("default"),s=!!t,u=D(),l=D(),c=D();z(()=>{s&&(u.current.value=t.title,l.current.value=t.repliesPolicy,c.current&&(c.current.checked=t.exclusive))},[s]);const d=ys("@mastodon/list-exclusive");return e("div",{class:"sheet",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})})," ",e("header",{children:e("h2",{children:s?"Edit list":"New list"})}),e("main",{children:e("form",{class:"list-form",onSubmit:h=>{h.preventDefault();const r=new FormData(h.target),p=r.get("title"),f=r.get("replies_policy"),g=r.get("exclusive")==="on";a("loading"),(async()=>{try{let m;s?m=await i.v1.lists.$select(t.id).update({title:p,replies_policy:f,exclusive:g}):m=await i.v1.lists.create({title:p,replies_policy:f,exclusive:g}),a("default"),n==null||n({state:"success",list:m})}catch{a("error"),alert(s?"Unable to edit list.":"Unable to create list.")}})()},children:[e("div",{class:"list-form-row",children:e("label",{for:"list-title",children:["Name"," ",e("input",{ref:u,type:"text",id:"list-title",name:"title",required:!0,disabled:o==="loading",dir:"auto"})]})}),e("div",{class:"list-form-row",children:e("select",{ref:l,name:"replies_policy",required:!0,disabled:o==="loading",children:[e("option",{value:"list",children:"Show replies to list members"}),e("option",{value:"followed",children:"Show replies to people I follow"}),e("option",{value:"none",children:"Don't show replies"})]})}),d&&e("div",{class:"list-form-row",children:e("label",{class:"label-block",children:[e("input",{ref:c,type:"checkbox",name:"exclusive",disabled:o==="loading"})," ","Hide posts on this list from Home/Following"]})}),e("div",{class:"list-form-footer",children:[e("button",{type:"submit",disabled:o==="loading",children:s?"Save":"Create"}),s&&e(Be,{disabled:o==="loading",align:"end",menuItemClassName:"danger",confirmLabel:"Delete this list?",onClick:()=>{a("loading"),(async()=>{try{await i.v1.lists.$select(t.id).remove(),a("default"),n==null||n({state:"deleted"})}catch{a("error"),alert("Unable to delete list.")}})()},children:e("button",{type:"button",class:"light danger",disabled:o==="loading",children:"Delete…"})})]})]})})]})}const ai=[60*5,60*30,60*60,60*60*6,60*60*24,60*60*24*3,60*60*24*7,0],pn={0:"Forever",300:"5 minutes",1800:"30 minutes",3600:"1 hour",21600:"6 hours",86400:"1 day",259200:"3 days",604800:"1 week"},mn=80,Jn=1e3*60*10;function ci(t,n){return n.v1.accounts.familiarFollowers.fetch({id:[t]})}const ri=nt(ci,{maxAge:Jn});async function li(t,n){const i=n.v1.accounts.$select(t).statuses.list({limit:20}).next(),{value:o}=await i,a={total:o.length,originals:0,replies:0,boosts:0};return o.forEach(s=>{s.reblog?a.boosts++:s.inReplyToId&&s.inReplyToAccountId!==s.account.id?a.replies++:a.originals++}),o.length&&(a.daysSinceLastPost=Math.ceil((Date.now()-new Date(o[o.length-1].createdAt))/864e5)),a}const di=nt(li,{maxAge:Jn});function Xn({account:t,fetchAccount:n=()=>{},standalone:i,instance:o,authenticated:a}){const{masto:s}=q({instance:o}),{masto:u,instance:l}=q(),[c,d]=$("default"),h=typeof t=="string",[r,p]=$(h?null:t),f=he(()=>o===l,[o,l]);z(()=>{if(!h){p(t);return}d("loading"),(async()=>{try{const F=await n();I.accounts[`${F.id}@${o}`]=F,p(F),d("default")}catch{p(null),d("error")}})()},[h,t,n]);const{acct:g,avatar:m,avatarStatic:S,bot:y,createdAt:b,displayName:v,emojis:k,fields:T,followersCount:x,followingCount:L,group:N,id:B,lastStatusAt:U,locked:P,note:R,statusesCount:C,url:_,username:O,memorial:K,moved:te,roles:Y}=r||{};let ke=!1,{header:re,headerStatic:X}=r||{};(!re||/missing\.png$/.test(re))&&m&&!/missing\.png$/.test(m)&&(re=m,ke=!0,S&&!/missing\.png$/.test(S)&&(X=S));const E=he(()=>B===se.session.get("currentAccount"),[B]);z(()=>{const F=!!(r!=null&&r.id&&(r!=null&&r.username)&&(r!=null&&r.acct)&&(r!=null&&r.avatar)&&(r!=null&&r.avatarStatic)&&(r!=null&&r.displayName)&&(r!=null&&r.url));if(E&&o&&F){const pe=se.local.getJSON("accounts");let ve=!1;pe.forEach(ue=>{ue.info.id===r.id&&ue.instanceURL===o&&(ue.info=r,ve=!0)}),ve&&se.local.setJSON("accounts",pe)}},[E,r,o]);const W=he(()=>_?new URL(_).hostname:null,[_]),[ne,le]=$([]),H=D(),oe=D([]);async function Q(F){(F||!H.current)&&(H.current=s.v1.accounts.$select(B).followers.list({limit:mn}));const pe=await H.current.next();if(E||!f)return pe;const{value:ve}=pe;let ue=[];if(F){const Pe=await s.v1.accounts.familiarFollowers.fetch({id:[B]});oe.current=Pe[0].accounts,ue=[...oe.current,...ve.filter(De=>!oe.current.some(ye=>ye.id===De.id))]}else ve!=null&&ve.length&&(ue=ve.filter(Pe=>!oe.current.some(De=>De.id===Pe.id)));return{...pe,value:ue}}const ge=D();async function G(F){return(F||!ge.current)&&(ge.current=s.v1.accounts.$select(B).following.list({limit:mn})),await ge.current.next()}const Z=i?"div":ee,ae=o?`/${o}/a/${B}`:`/a/${B}`,[fe,be]=$([]),[de,Xe]=$(),[M,V]=$("default"),j=!!(de!=null&&de.total),ce=async F=>{try{const pe=await ri(F,u);be(pe[0].accounts.slice(0,ui))}catch{}},we=async()=>{if(B){V("loading");try{const F=await di(B,s);Xe(F),V("default")}catch{V("error")}}},_e=Ve(({relationship:F,currentID:pe})=>{F.following||(ce(pe),!i&&C>0&&we())},[i,B,C]);return e("div",{tabIndex:"-1",class:`account-container  ${c==="loading"?"skeleton":""}`,style:{"--header-color-1":ne[0],"--header-color-2":ne[1],"--header-color-3":ne[2],"--header-color-4":ne[3]},children:[c==="error"&&e("div",{class:"ui-state",children:[e("p",{children:"Unable to load account."}),e("p",{children:e("a",{href:h?t:_,target:"_blank",rel:"noopener noreferrer",children:["Go to account page ",e(w,{icon:"external"})]})})]}),c==="loading"?e(A,{children:[e("header",{children:e(He,{avatarSize:"xxxl",skeleton:!0})}),e("main",{children:[e("div",{class:"note",children:[e("p",{children:"███████ ████ ████"}),e("p",{children:"████ ████████ ██████ █████████ ████ ██"})]}),e("div",{class:"account-metadata-box",children:[e("div",{class:"profile-metadata",children:[e("div",{class:"profile-field",children:[e("b",{class:"more-insignificant",children:"███"}),e("p",{children:"██████"})]}),e("div",{class:"profile-field",children:[e("b",{class:"more-insignificant",children:"████"}),e("p",{children:"███████████"})]})]}),e("div",{class:"stats",children:[e("div",{children:[e("span",{children:"██"})," Followers"]}),e("div",{children:[e("span",{children:"██"})," Following"]}),e("div",{children:[e("span",{children:"██"})," Posts"]})]})]}),e("div",{class:"actions",children:[e("span",{}),e("span",{class:"buttons",children:e("button",{type:"button",title:"More",class:"plain",disabled:!0,children:e(w,{icon:"more",size:"l",alt:"More"})})})]})]})]}):r&&e(A,{children:[!!te&&e("div",{class:"account-moved",children:[e("p",{children:[e("b",{children:v})," has indicated that their new account is now:"]}),e(He,{account:te,instance:o,onClick:F=>{F.stopPropagation(),I.showAccount=te}})]}),!!re&&!/missing\.png$/.test(re)&&e("img",{src:re,alt:"",class:`header-banner ${ke?"header-is-avatar":""}`,onError:F=>{F.target.crossOrigin?F.target.src!==X?F.target.src=X:(F.target.removeAttribute("crossorigin"),F.target.src=re):F.target.src!==X?F.target.src=X:F.target.remove()},crossOrigin:"anonymous",onLoad:F=>{F.target.classList.add("loaded");try{const pe=document.createElement("canvas"),ve=pe.getContext("2d",{willReadFrequently:!0});pe.width=F.target.width,pe.height=F.target.height,ve.drawImage(F.target,0,0);const ue=10,De=[ve.getImageData(0,0,ue,ue).data,ve.getImageData(F.target.width-ue,0,ue,ue).data,ve.getImageData(0,F.target.height-ue,ue,ue).data,ve.getImageData(F.target.width-ue,F.target.height-ue,ue,ue).data].map(ye=>{let Ue=0,it=0,Oe=0,Ke=0;for(let J=0;J<ye.length;J+=4)Ue+=ye[J],it+=ye[J+1],Oe+=ye[J+2],Ke+=ye[J+3];const Qe=ye.length/4;return[Ue/Qe,it/Qe,Oe/Qe,Ke/Qe]}).map(ye=>{const[Ue,it,Oe,Ke]=fi(ye);return`rgba(${Ue}, ${it}, ${Oe}, ${Ke})`});le(De)}catch{}}}),e("header",{children:e(He,{account:r,instance:o,avatarSize:"xxxl",external:i,internal:!i})}),e("div",{class:"faux-header-bg","aria-hidden":"true"}),e("main",{children:[!!K&&e("span",{class:"tag",children:"In Memoriam"}),!!y&&e("span",{class:"tag",children:[e(w,{icon:"bot"})," Automated"]}),!!N&&e("span",{class:"tag",children:[e(w,{icon:"group"})," Group"]}),Y==null?void 0:Y.map(F=>e("span",{class:"tag",children:[F.name,!!W&&e(A,{children:[" ",e("span",{class:"more-insignificant",children:W})]})]})),e("div",{class:"note",dir:"auto",onClick:Nn({instance:l}),dangerouslySetInnerHTML:{__html:Dt(R,{emojis:k})}}),e("div",{class:"account-metadata-box",children:[(T==null?void 0:T.length)>0&&e("div",{class:"profile-metadata",children:T.map(({name:F,value:pe,verifiedAt:ve},ue)=>e("div",{class:`profile-field ${ve?"profile-verified":""}`,dir:"auto",children:[e("b",{children:[e(Dn,{text:F,emojis:k})," ",!!ve&&e(w,{icon:"check-circle",size:"s"})]}),e("p",{dangerouslySetInnerHTML:{__html:Dt(pe,{emojis:k})}})]},F+ue))}),e("div",{class:"stats",children:[e(Z,{tabIndex:0,to:ae,onClick:()=>{setTimeout(()=>{I.showGenericAccounts={heading:"Followers",fetchAccounts:Q,instance:o,excludeRelationshipAttrs:E?["followedBy"]:[]}},0)},children:[!!fe.length&&e("span",{class:"shazam-container-horizontal",children:e("span",{class:"shazam-container-inner stats-avatars-bunch",children:fe.map(F=>e(tt,{url:F.avatarStatic,size:"s",alt:`${F.displayName} @${F.acct}`,squircle:F==null?void 0:F.bot}))})}),e("span",{title:x,children:Ne(x)})," ","Followers"]}),e(Z,{class:"insignificant",tabIndex:0,to:ae,onClick:()=>{setTimeout(()=>{I.showGenericAccounts={heading:"Following",fetchAccounts:G,instance:o,excludeRelationshipAttrs:E?["following"]:[]}},0)},children:[e("span",{title:L,children:Ne(L)})," ","Following",e("br",{})]}),e(Z,{class:"insignificant",to:ae,children:[e("span",{title:C,children:Ne(C)})," ","Posts"]}),!!b&&e("div",{class:"insignificant",children:["Joined"," ",e("time",{datetime:b,children:Ze(b,{hideTime:!0})})]})]})]}),!!de&&e(Z,{to:ae,class:"account-metadata-box",children:e("div",{class:"shazam-container",children:e("div",{class:"shazam-container-inner",children:j?e("div",{class:"posting-stats",title:`${Math.round(de.originals/de.total*100)}% original posts, ${Math.round(de.replies/de.total*100)}% replies, ${Math.round(de.boosts/de.total*100)}% boosts`,children:[e("div",{children:de.daysSinceLastPost<365?`Last ${de.total} post${de.total>1?"s":""} in the past 
                      ${de.daysSinceLastPost} day${de.daysSinceLastPost>1?"s":""}`:`
                      Last ${de.total} posts in the past year(s)
                      `}),e("div",{class:"posting-stats-bar",style:{"--originals-percentage":`${de.originals/de.total*100}%`,"--replies-percentage":`${(de.originals+de.replies)/de.total*100}%`}}),e("div",{class:"posting-stats-legends",children:[e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-originals"})," ","Original"]})," ",e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-replies"})," ","Replies"]})," ",e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-boosts"})," ","Boosts"]})]})]}):e("div",{class:"posting-stats",children:"Post stats unavailable."})})})}),e("div",{class:"account-metadata-box",children:e("div",{class:"shazam-container no-animation",hidden:!!de,children:e("div",{class:"shazam-container-inner",children:e("button",{type:"button",class:"posting-stats-button",disabled:M==="loading",onClick:()=>{we()},children:[e("div",{class:`posting-stats-bar posting-stats-icon ${M==="loading"?"loading":""}`,style:{"--originals-percentage":"33%","--replies-percentage":"66%"}}),"View post stats"," "]})})})})]}),e("footer",{children:e(hi,{info:r,instance:o,authenticated:a,onRelationshipChange:_e})})]})]})}const ui=3;function hi({info:t,instance:n,authenticated:i,onRelationshipChange:o=()=>{}}){var ge;if(!t)return null;const{masto:a,instance:s,authenticated:u}=q(),l=n===s,[c,d]=$("default"),[h,r]=$(null),{id:p,acct:f,url:g,username:m,locked:S,lastStatusAt:y,note:b,fields:v,moved:k}=t,T=D(p),{following:x,showingReblogs:L,notifying:N,followedBy:B,blocking:U,blockedBy:P,muting:R,mutingNotifications:C,requested:_,domainBlocking:O,endorsed:K,note:te}=h||{},[Y,ke]=$(null),[re,X]=$(!1);z(()=>{if(t){const G=se.session.get("currentAccount");let Z;(async()=>{if(l&&i)Z=p;else if(!l&&u){const fe=t.acct.includes("@");try{const be=await a.v2.search.fetch({q:fe?t.acct:`${t.username}@${n}`,type:"accounts",limit:1,resolve:!0});be.accounts.length&&(Z=be.accounts[0].id,ke(be.accounts[0]))}catch{}}if(!Z)return;if(G===Z){X(!0);return}if(T.current=Z,k)return;d("loading");const ae=a.v1.accounts.relationships.fetch({id:[Z]});try{const fe=await ae;if(d("default"),fe.length){const be=fe[0];r(be),o({relationship:be,currentID:Z})}}catch{d("error")}})()}},[t,i]),z(()=>{t&&re&&ws(t)},[t,re]);const E=c==="loading",[W,ne]=$(!1),[le,H]=$(!1),[oe,Q]=$(!1);return e(A,{children:[e("div",{class:"actions",children:[e("span",{children:[B?e("span",{class:"tag",children:"Follows you"}):y?e("small",{class:"insignificant",children:["Last post:"," ",e("span",{class:"ib",children:Ze(y,{hideTime:!0})})]}):e("span",{}),R&&e("span",{class:"tag danger",children:"Muted"}),U&&e("span",{class:"tag danger",children:"Blocked"})]})," ",e("span",{class:"buttons",children:[!!te&&e("button",{type:"button",class:"private-note-tag",title:"Private note",onClick:()=>{Q(!0)},dir:"auto",children:e("span",{children:te})}),e(Fe,{portal:{target:document.body},containerProps:{style:{zIndex:1001}},align:"center",position:"anchor",overflow:"auto",menuButton:e("button",{type:"button",title:"More",class:"plain",disabled:E,children:e(w,{icon:"more",size:"l",alt:"More"})}),children:[u&&!re&&e(A,{children:[e(ie,{onClick:()=>{I.showCompose={draftStatus:{status:`@${(Y==null?void 0:Y.acct)||f} `}}},children:[e(w,{icon:"at"}),e("span",{children:["Mention @",m]})]}),e(ie,{onClick:()=>{ne(!0)},children:[e(w,{icon:"translate"}),e("span",{children:"Translate bio"})]}),e(ie,{onClick:()=>{Q(!0)},children:[e(w,{icon:"pencil"}),e("span",{children:te?"Edit private note":"Add private note"})]}),x&&e(ie,{onClick:()=>{H(!0)},children:[e(w,{icon:"list"}),e("span",{children:"Add/remove from Lists"})]}),e(Ee,{})]}),e(ie,{href:g,target:"_blank",children:[e(w,{icon:"external"}),e("small",{class:"menu-double-lines",children:pi(g)})]}),e("div",{class:"menu-horizontal",children:[e(ie,{onClick:()=>{try{navigator.clipboard.writeText(g),me("Link copied")}catch{me("Unable to copy link")}},children:[e(w,{icon:"link"}),e("span",{children:"Copy"})]}),(navigator==null?void 0:navigator.share)&&((ge=navigator==null?void 0:navigator.canShare)==null?void 0:ge.call(navigator,{url:g}))&&e(ie,{onClick:()=>{try{navigator.share({url:g})}catch{alert("Sharing doesn't seem to work.")}},children:[e(w,{icon:"share"}),e("span",{children:"Share…"})]})]}),!!h&&e(A,{children:[e(Ee,{}),R?e(ie,{onClick:()=>{d("loading"),(async()=>{try{const G=await a.v1.accounts.$select((Y==null?void 0:Y.id)||p).unmute();r(G),d("default"),me(`Unmuted @${m}`),I.reloadGenericAccounts.id="mute",I.reloadGenericAccounts.counter++}catch{d("error")}})()},children:[e(w,{icon:"unmute"}),e("span",{children:["Unmute @",m]})]}):e(Rs,{openTrigger:"clickOnly",direction:"bottom",overflow:"auto",shift:16,label:e(A,{children:[e(w,{icon:"mute"}),e("span",{class:"menu-grow",children:["Mute @",m,"…"]}),e("span",{style:{textOverflow:"clip"},children:[e(w,{icon:"time"}),e(w,{icon:"chevron-right"})]})]}),children:e("div",{class:"menu-wrap",children:ai.map(G=>e(ie,{onClick:()=>{d("loading"),(async()=>{try{const Z=await a.v1.accounts.$select((Y==null?void 0:Y.id)||p).mute({duration:G});r(Z),d("default"),me(`Muted @${m} for ${pn[G]}`),I.reloadGenericAccounts.id="mute",I.reloadGenericAccounts.counter++}catch{d("error"),me(`Unable to mute @${m}`)}})()},children:pn[G]}))})}),e(Be,{subMenu:!0,confirm:!U,confirmLabel:e(A,{children:[e(w,{icon:"block"}),e("span",{children:["Block @",m,"?"]})]}),menuItemClassName:"danger",onClick:()=>{d("loading"),(async()=>{try{if(U){const G=await a.v1.accounts.$select((Y==null?void 0:Y.id)||p).unblock();r(G),d("default"),me(`Unblocked @${m}`)}else{const G=await a.v1.accounts.$select((Y==null?void 0:Y.id)||p).block();r(G),d("default"),me(`Blocked @${m}`)}I.reloadGenericAccounts.id="block",I.reloadGenericAccounts.counter++}catch{d("error"),U?me(`Unable to unblock @${m}`):me(`Unable to block @${m}`)}})()},children:U?e(A,{children:[e(w,{icon:"unblock"}),e("span",{children:["Unblock @",m]})]}):e(A,{children:[e(w,{icon:"block"}),e("span",{children:["Block @",m,"…"]})]})})]})]}),!h&&c==="loading"&&e(Te,{abrupt:!0}),!!h&&e(Be,{confirm:x||_,confirmLabel:e("span",{children:_?"Withdraw follow request?":`Unfollow @${t.acct||t.username}?`}),menuItemClassName:"danger",align:"end",disabled:E,onClick:()=>{d("loading"),(async()=>{try{let G;x||_?G=await a.v1.accounts.$select(T.current).unfollow():G=await a.v1.accounts.$select(T.current).follow(),G&&r(G),d("default")}catch(G){alert(G),d("error")}})()},children:e("button",{type:"button",class:`${x||_?"light swap":""}`,"data-swap-state":x||_?"danger":"",disabled:E,children:x?e(A,{children:[e("span",{children:"Following"}),e("span",{children:"Unfollow…"})]}):_?e(A,{children:[e("span",{children:"Requested"}),e("span",{children:"Withdraw…"})]}):S?e(A,{children:[e(w,{icon:"lock"})," ",e("span",{children:"Follow"})]}):"Follow"})})]})]}),!!W&&e(Ie,{class:"light",onClose:()=>{ne(!1)},children:e(mi,{note:b,fields:v,onClose:()=>ne(!1)})}),!!le&&e(Ie,{class:"light",onClose:()=>{H(!1)},children:e(gi,{accountID:T.current,onClose:()=>H(!1)})}),!!oe&&e(Ie,{class:"light",onClose:()=>{Q(!1)},children:e(bi,{account:t,note:te,onRelationshipChange:G=>{r(G)},onClose:()=>Q(!1)})})]})}function fi([t,n,i]){const o=.2126*t+.7152*n+.0722*i;let a;return o>=220?a=1:o<=50?a=.1:a=o/255,a=Math.min(1,a),[t,n,i,a]}function pi(t){if(!t)return;const n=new URL(t),{host:i,pathname:o}=n,a=o.replace(/\/$/,"").replace(/^\//,"");return e(A,{children:[e("span",{class:"more-insignificant",children:[i,"/"]}),e("wbr",{}),e("span",{children:a})]})}function mi({note:t,fields:n,onClose:i}){const o=(n==null?void 0:n.map(({name:s,value:u})=>`${s}
${tn(u)}`).join(`

`))||"",a=tn(t)+(o?`

${o}`:"");return e("div",{class:"sheet",children:[!!i&&e("button",{type:"button",class:"sheet-close",onClick:i,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Translated Bio"})}),e("main",{children:[e("p",{style:{whiteSpace:"pre-wrap"},children:a}),e(Un,{forceTranslate:!0,text:a})]})]})}function gi({accountID:t,onClose:n}){const{masto:i}=q(),[o,a]=$("default"),[s,u]=$([]),[l,c]=$([]),[d,h]=Lt(f=>f+1,0);z(()=>{a("loading"),(async()=>{try{const f=await i.v1.lists.list();f.sort((m,S)=>m.title.localeCompare(S.title));const g=await i.v1.accounts.$select(t).lists.list();u(f),c(g),a("default")}catch{a("error")}})()},[d]);const[r,p]=$(!1);return e("div",{class:"sheet",id:"list-add-remove-container",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Add/Remove from Lists"})}),e("main",{children:[s.length>0?e("ul",{class:"list-add-remove",children:s.map(f=>{const g=l.some(m=>m.id===f.id);return e("li",{children:e("button",{type:"button",class:`light ${g?"checked":""}`,disabled:o==="loading",onClick:()=>{a("loading"),(async()=>{try{g?await i.v1.lists.$select(f.id).accounts.remove({accountIds:[t]}):await i.v1.lists.$select(f.id).accounts.create({accountIds:[t]}),h()}catch{a("error"),alert(g?"Unable to remove from list.":"Unable to add to list.")}})()},children:[e(w,{icon:"check-circle"}),e("span",{children:f.title})]})})})}):o==="loading"?e("p",{class:"ui-state",children:e(Te,{abrupt:!0})}):o==="error"?e("p",{class:"ui-state",children:"Unable to load lists."}):e("p",{class:"ui-state",children:"No lists."}),e("button",{type:"button",class:"plain2",onClick:()=>p(!0),disabled:o!=="default",children:[e(w,{icon:"plus",size:"l"})," ",e("span",{children:"New list"})]})]}),r&&e(Ie,{class:"light",onClick:f=>{f.target===f.currentTarget&&p(!1)},children:e(Wt,{list:r==null?void 0:r.list,onClose:f=>{f.state==="success"&&h(),p(!1)}})})]})}function bi({account:t,note:n,onRelationshipChange:i=()=>{},onClose:o=()=>{}}){const{masto:a}=q(),[s,u]=$("default"),l=D(null);return z(()=>{let c;return l.current&&!n&&(c=setTimeout(()=>{var d,h;(h=(d=l.current).focus)==null||h.call(d)},100)),()=>{clearTimeout(c)}},[]),e("div",{class:"sheet",id:"private-note-container",children:[!!o&&e("button",{type:"button",class:"sheet-close",onClick:o,children:e(w,{icon:"x"})}),e("header",{children:e("b",{children:["Private note about @",(t==null?void 0:t.username)||(t==null?void 0:t.acct)]})}),e("main",{children:e("form",{onSubmit:c=>{c.preventDefault();const h=new FormData(c.target).get("note");(h==null?void 0:h.trim())!==(n==null?void 0:n.trim())&&(u("loading"),(async()=>{try{const r=await a.v1.accounts.$select(t==null?void 0:t.id).note.create({comment:h});u("default"),i(r),o()}catch(r){u("error"),alert((r==null?void 0:r.message)||"Unable to update private note.")}})())},children:[e("textarea",{ref:l,name:"note",disabled:s==="loading",children:n}),e("footer",{children:[e("button",{type:"button",class:"light",disabled:s==="loading",onClick:()=>{o==null||o()},children:"Cancel"}),e("span",{children:[e(Te,{abrupt:!0,hidden:s!=="loading"}),e("button",{disabled:s==="loading",type:"submit",children:"Save & close"})]})]})]})})]})}function yi({account:t,instance:n,onClose:i}){const{masto:o,instance:a,authenticated:s}=q({instance:n}),u=typeof t=="string";return z(()=>{u||(I.accounts[`${t.id}@${a}`]=t)},[t]),Zn(i),e("div",{class:"sheet",children:[!!i&&e("button",{type:"button",class:"sheet-close outer",onClick:i,children:e(w,{icon:"x"})}),e(Xn,{instance:a,authenticated:s,account:t,fetchAccount:async()=>{if(u)try{return await o.v1.accounts.lookup({acct:t,skip_webfinger:!1})}catch{const c=await o.v2.search.fetch({q:t,type:"accounts",limit:1,resolve:s});if(c.accounts.length)return c.accounts[0];if(/https?:\/\/[^/]+\/@/.test(t)){const h=new URL(t).pathname.replace(/^\//,""),r=await o.v2.search.fetch({q:h,type:"accounts",limit:1,resolve:s});if(r.accounts.length)return r.accounts[0]}}else return t}})]})}function wi({onClose:t}){const{masto:n}=q(),[i,o]=$("default"),[a,s]=$([]),[u,l]=Lt(d=>d+1,0);z(()=>{o("loading"),(async()=>{try{const d=await ft.drafts.keys();if(d.length){const h=Fn(),r=d.filter(p=>p.startsWith(h));if(r.length){const p=await ft.drafts.getMany(r);p.sort((f,g)=>new Date(g.updatedAt).getTime()-new Date(f.updatedAt).getTime()),s(p)}else s([])}else s([]);o("default")}catch{o("error")}})()},[u]);const c=(a==null?void 0:a.length)>0;return e("div",{class:"sheet",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:[e("h2",{children:["Unsent drafts ",e(Te,{abrupt:!0,hidden:i!=="loading"})]}),c&&e("div",{class:"insignificant",children:"Looks like you have unsent drafts. Let's continue where you left off."})]}),e("main",{children:c?e(A,{children:[e("ul",{class:"drafts-list",children:a.map(d=>{const{updatedAt:h,key:r,draftStatus:p,replyTo:f}=d,g=new Date(h);return e("li",{children:[e("div",{class:"mini-draft-meta",children:[e("b",{children:[e(w,{icon:f?"reply":"quill",size:"s"})," ",e("time",{children:[!!f&&e(A,{children:["@",f.account.acct,e("br",{})]}),Ze(g)]})]}),e(Be,{confirmLabel:e("span",{children:"Delete this draft?"}),menuItemClassName:"danger",align:"end",disabled:i==="loading",onClick:()=>{(async()=>{try{await ft.drafts.del(r),l()}catch{alert("Error deleting draft! Please try again.")}})()},children:e("button",{type:"button",class:"small light",disabled:i==="loading",children:"Delete…"})})]}),e("button",{type:"button",disabled:i==="loading",class:"draft-item",onClick:async()=>{let m;if(f){o("loading");try{m=await n.v1.statuses.$select(f.id).fetch()}catch{alert("Error fetching reply-to status!"),o("default");return}o("default")}window.__COMPOSE__={draftStatus:p,replyToStatus:m},I.showCompose=!0,I.showDrafts=!1},children:e(vi,{draft:d})})]},h)})}),a.length>1&&e("p",{children:e(Be,{confirmLabel:e("span",{children:"Delete all drafts?"}),menuItemClassName:"danger",disabled:i==="loading",onClick:()=>{(async()=>{o("loading");try{await ft.drafts.delMany(a.map(d=>d.key)),o("default"),l()}catch{alert("Error deleting drafts! Please try again."),o("error")}})()},children:e("button",{type:"button",class:"light danger",disabled:i==="loading",children:"Delete all…"})})})]}):e("p",{children:"No drafts found."})})]})}function vi({draft:t}){var r;const{draftStatus:n,replyTo:i}=t,{status:o,spoilerText:a,poll:s,mediaAttachments:u}=n,l=((r=s==null?void 0:s.options)==null?void 0:r.length)>0,c=(u==null?void 0:u.length)>0,d=l||c,h=he(()=>{if(!c)return;const p=u.find(m=>/image/.test(m.type));if(!p)return;const{file:f}=p;return URL.createObjectURL(f)},[c,u]);return e(A,{children:e("div",{class:"mini-draft",children:[d&&e("div",{class:`mini-draft-aside ${h?"has-image":""}`,style:h?{"--bg-image":`url(${h})`}:{},children:[l&&e(w,{icon:"poll"}),c&&e("span",{children:[e(w,{icon:"attachment"})," ",e("small",{children:u==null?void 0:u.length})]})]}),e("div",{class:"mini-draft-main",children:[!!a&&e("div",{class:"mini-draft-spoiler",children:a}),!!o&&e("div",{class:"mini-draft-status",children:o})]})]})})}function Si({html:t,url:n,onClose:i=()=>{}}){return e("div",{class:"embed-modal-container",children:[e("div",{class:"top-controls",children:[e("button",{type:"button",class:"light",onClick:()=>i(),children:e(w,{icon:"x"})}),n&&e("a",{href:n,target:"_blank",rel:"noopener noreferrer",class:"button plain",children:[e("span",{children:"Open link"})," ",e(w,{icon:"external"})]})]}),e("div",{class:"embed-content",dangerouslySetInnerHTML:{__html:t}})]})}async function Kt(t,n={}){if(!(t!=null&&t.length))return;const{masto:i}=q(),o=se.session.get("currentAccount"),a=t.reduce((s,u)=>(!s.includes(u.id)&&!n[u.id]&&u.id!==o&&s.push(u.id),s),[]);if(!a.length)return null;try{return(await i.v1.accounts.relationships.fetch({id:a})).reduce((l,c)=>(l[c.id]=c,l),{})}catch{return null}}function ki({instance:t,excludeRelationshipAttrs:n=[],onClose:i=()=>{}}){const{masto:o,instance:a}=q(),s=t?t===a:!0,u=Se(I),[l,c]=$("default"),[d,h]=$([]),[r,p]=$(!1);if(Zn(i),!u.showGenericAccounts)return null;const{id:f,heading:g,fetchAccounts:m,accounts:S,showReactions:y}=u.showGenericAccounts,[b,v]=$({}),k=async L=>{if(!(L!=null&&L.length)||!s)return;const N=await Kt(L,b);N&&v({...b,...N})},T=L=>{m&&(L&&h([]),c("loading"),(async()=>{try{const{done:N,value:B}=await m(L);if(Array.isArray(B)){if(L){const U=[];for(let P=0;P<B.length;P++){const R=B[P],C=U.find((_,O)=>_.id===R.id&&P!==O);C?C._types.push(...R._types):U.push({_types:[],...R})}h(U)}else h(U=>{const P=U;for(const R of B){const C=P.find(_=>_.id===R.id);C?C._types.push(...R._types):P.push(R)}return P});p(!N),k(B)}else p(!1);c("default")}catch{c("error")}})())},x=D(!0);return z(()=>{(S==null?void 0:S.length)>0?(h(S),k(S)):(T(!0),x.current=!1)},[S,m]),z(()=>{var L;x.current||((L=u.reloadGenericAccounts)==null?void 0:L.id)===f&&T(!0)},[u.reloadGenericAccounts.counter]),e("div",{id:"generic-accounts-container",class:"sheet",tabindex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:i,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:g||"Accounts"})}),e("main",{children:d.length>0?e(A,{children:[e("ul",{class:"accounts-list",children:d.map(L=>{var U,P;const N=b[L.id],B=`${L.id}-${((U=L._types)==null?void 0:U.length)||""}`;return e("li",{children:[y&&((P=L._types)==null?void 0:P.length)>0&&e("div",{class:"reactions-block",children:L._types.map(R=>e(w,{icon:{reblog:"rocket",favourite:"heart"}[R],class:`${R}-icon`}))}),e("div",{class:"account-relationships",children:e(He,{account:L,showStats:!0,relationship:N,excludeRelationshipAttrs:n})})]},B)})}),l==="default"?r?e(je,{onChange:L=>{L&&T()},children:e("button",{type:"button",class:"plain block",onClick:()=>T(),children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}):l==="loading"&&e("p",{class:"ui-state",children:e(Te,{abrupt:!0})})]}):l==="loading"?e("p",{class:"ui-state",children:e(Te,{abrupt:!0})}):l==="error"?e("p",{class:"ui-state",children:"Error loading accounts"}):e("p",{class:"ui-state insignificant",children:"Nothing to show"})})]})}function Ii({alt:t,lang:n,onClose:i}){const o=Se(I),[a,s]=$(!1),u=Pn(!0),l=o.settings.contentTranslationHideLanguages||[],c=!!n&&n!==u&&!nn([n],[u])&&!l.find(d=>n===d||nn([n],[d]));return e("div",{class:"sheet",tabindex:"-1",children:[!!i&&e("button",{type:"button",class:"sheet-close outer",onClick:i,children:e(w,{icon:"x"})}),e("header",{class:"header-grid",children:[e("h2",{children:"Media description"}),e("div",{class:"header-side",children:e(Fe,{align:"end",menuButton:e("button",{type:"button",class:"plain4",children:e(w,{icon:"more",alt:"More",size:"xl"})}),children:[e(ie,{disabled:a,onClick:()=>{s(!0)},children:[e(w,{icon:"translate"}),e("span",{children:"Translate"})]}),vs&&e(ie,{onClick:()=>{Ss(t,n)},children:[e(w,{icon:"speak"}),e("span",{children:"Speak"})]})]})})]}),e("main",{lang:n,dir:"auto",children:[e("p",{style:{whiteSpace:"pre-wrap",textWrap:"pretty"},children:t}),(c||a)&&e(Un,{forceTranslate:a,sourceLanguage:n,text:t})]})]})}function Rt(t,n,i){return Math.max(Math.min(t,i),n)}const _t=t=>t>=.04045?Math.pow((t+.055)/1.055,2.4):t/12.92,Et=t=>t>=.0031308?1.055*Math.pow(t,1/2.4)-.055:12.92*t;function Qn([t,n,i]){t=_t(t/255),n=_t(n/255),i=_t(i/255);var o=.4122214708*t+.5363325363*n+.0514459929*i,a=.2119034982*t+.6806995451*n+.1073969566*i,s=.0883024619*t+.2817188376*n+.6299787005*i;return o=Math.cbrt(o),a=Math.cbrt(a),s=Math.cbrt(s),[o*.2104542553+a*.793617785+s*-.0040720468,o*1.9779984951+a*-2.428592205+s*.4505937099,o*.0259040371+a*.7827717662+s*-.808675766]}function es([t,n,c]){var o=t+n*.3963377774+c*.2158037573,a=t+n*-.1055613458+c*-.0638541728,s=t+n*-.0894841775+c*-1.291485548;o=o**3,a=a**3,s=s**3;var u=o*4.0767416621+a*-3.3077115913+s*.2309699292,l=o*-1.2684380046+a*2.6097574011+s*-.3413193965,c=o*-.0041960863+a*-.7034186147+s*1.707614701;return u=255*Et(u),l=255*Et(l),c=255*Et(c),u=Rt(u,0,255),l=Rt(l,0,255),c=Rt(c,0,255),u=Math.round(u),l=Math.round(l),c=Math.round(c),[u,l,c]}var Ti={PHANPY_CLIENT_NAME:"IMSB",PHANPY_WEBSITE:"https://app.imsb.app",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",VITE_APP_ENV:"production",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{PHANPY_IMG_ALT_API_URL:Ca}=Ti;function ts({mediaAttachments:t,statusID:n,instance:i,lang:o,index:a=0,onClose:s=()=>{}}){var b,v;const[u,l]=$("default"),c=D(null),[d,h]=$(a),r=D(null);Ye(()=>{var k;(k=r.current)==null||k.scrollIntoView()},[]);const p=D(n);z(()=>{const k=a*c.current.clientWidth,T=p.current!==n;T&&(p.current=n),c.current.scrollTo({left:k,behavior:T?"auto":"smooth"}),c.current.focus()},[a,n]);const[f,g]=$(!0);z(()=>{let k=()=>{s()};return c.current&&c.current.addEventListener("swiped-down",k),()=>{c.current&&c.current.removeEventListener("swiped-down",k)}},[]),Le("esc",s,{ignoreEventWhen:k=>!!document.querySelector("#modal-container > *")},[s]),z(()=>{let k=()=>{const{clientWidth:T,scrollLeft:x}=c.current,L=Math.round(x/T);h(L)};return c.current&&c.current.addEventListener("scroll",k,{passive:!0}),()=>{c.current&&c.current.removeEventListener("scroll",k)}},[]),z(()=>{let k=setTimeout(()=>{var T,x;(x=(T=c.current)==null?void 0:T.focus)==null||x.call(T)},100);return()=>clearTimeout(k)},[]);const m=he(()=>t==null?void 0:t.map(k=>{const{blurhash:T}=k;if(T){const x=Hn(T),L=Qn(x);return es([.6,L[1],L[2]])}return null}),[t]),S=he(()=>{var x;const T=100/m.length;return((x=m==null?void 0:m.map((L,N)=>{const B=N*T+5,U=(N+1)*T-5;return L?`
            rgba(${L==null?void 0:L.join(",")}, 0.4) ${B}%,
            rgba(${L==null?void 0:L.join(",")}, 0.4) ${U}%
          `:`
            transparent ${B}%,
            transparent ${U}%
          `}))==null?void 0:x.join(", "))||"transparent"},[m]);let y=D(null);return z(()=>()=>{var k,T;(T=(k=y.current)==null?void 0:k.hideToast)==null||T.call(k)},[]),e("div",{class:`media-modal-container media-modal-count-${t==null?void 0:t.length}`,children:[e("div",{ref:c,tabIndex:"0","data-swipe-threshold":"44",class:"carousel",onClick:k=>{(k.target.classList.contains("carousel-item")||k.target.classList.contains("media")||k.target.classList.contains("media-zoom"))&&s()},style:t.length>1?{backgroundAttachment:"local",backgroundImage:`linear-gradient(
            to right, ${S})`}:{},children:t==null?void 0:t.map((k,T)=>{const x=t.length===1?m[T]:null;return e("div",{class:"carousel-item",style:x?{"--accent-color":`rgb(${x==null?void 0:x.join(",")})`,"--accent-alpha-color":`rgba(${x==null?void 0:x.join(",")}, 0.4)`}:{},tabindex:"0",ref:T===d?r:null,onClick:L=>{L.target.classList.contains("media")||g(!f)},children:[!!k.description&&e("button",{type:"button",class:"media-alt",hidden:!f,onClick:()=>{I.showMediaAlt={alt:k.description,lang:o}},children:[e("span",{class:"alt-badge",children:"ALT"}),e("span",{class:"media-alt-desc",lang:o,dir:"auto",children:k.description})]}),e(On,{media:k,showOriginal:!0,lang:o})]},k.id)})}),e("div",{class:"carousel-top-controls",hidden:!f,children:[e("span",{children:e("button",{type:"button",class:"carousel-button",onClick:()=>s(),children:e(w,{icon:"x"})})}),(t==null?void 0:t.length)>1?e("span",{class:"carousel-dots",children:t==null?void 0:t.map((k,T)=>e("button",{type:"button",disabled:T===d,class:`carousel-dot ${T===d?"active":""}`,onClick:x=>{x.preventDefault(),x.stopPropagation(),c.current.scrollTo({left:c.current.clientWidth*T,behavior:"smooth"}),c.current.focus()},children:e(w,{icon:"round",size:"s"})},k.id))}):e("span",{}),e("span",{children:[e(Fe,{overflow:"auto",align:"end",position:"anchor",gap:4,menuClassName:"glass-menu",menuButton:e("button",{type:"button",class:"carousel-button",children:e(w,{icon:"more",alt:"More"})}),children:[e(Re,{href:((b=t[d])==null?void 0:b.remoteUrl)||((v=t[d])==null?void 0:v.url),class:"carousel-button",target:"_blank",title:"Open original media in new window",children:[e(w,{icon:"popout"}),e("span",{children:"Open original media"})]}),!1]})," ",e(ee,{to:`${i?`/${i}`:""}/s/${n}${window.matchMedia("(min-width: calc(40em + 350px))").matches?`?media=${d+1}`:""}`,class:"button carousel-button media-post-link",children:[e("span",{class:"button-label",children:"View post "}),"»"]})]})]}),(t==null?void 0:t.length)>1&&e("div",{class:"carousel-controls",hidden:!f,children:[e("button",{type:"button",class:"carousel-button",hidden:d===0,onClick:k=>{k.preventDefault(),k.stopPropagation(),c.current.focus(),c.current.scrollTo({left:c.current.clientWidth*(d-1),behavior:"smooth"})},children:e(w,{icon:"arrow-left"})}),e("button",{type:"button",class:"carousel-button",hidden:d===t.length-1,onClick:k=>{k.preventDefault(),k.stopPropagation(),c.current.focus(),c.current.scrollTo({left:c.current.clientWidth*(d+1),behavior:"smooth"})},children:e(w,{icon:"arrow-right"})})]})]})}const Ci="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2084%2062'%3e%3crect%20width='64'%20height='48'%20x='18'%20y='2'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3crect%20width='32'%20height='48'%20x='2'%20y='12'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%234169E1'%20d='M14%2052a4%204%200%201%201-8%200%204%204%200%200%201%208%200Zm64-42a4%204%200%201%201-8%200%204%204%200%200%201%208%200Z'/%3e%3c/svg%3e",$i="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2082%2062'%3e%3crect%20width='78'%20height='58'%20x='2'%20y='2'%20fill='%23999'%20fill-opacity='.3'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3crect%20width='18'%20height='46'%20x='8'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3crect%20width='18'%20height='46'%20x='32'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3crect%20width='18'%20height='46'%20x='56'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3c/svg%3e",xi="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2084%2062'%3e%3crect%20width='64'%20height='48'%20x='18'%20y='2'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%23999'%20fill-opacity='.3'%20d='M19%203h62v10H19z'/%3e%3cpath%20stroke='%234169E1'%20stroke-width='2'%20d='M43%208a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3cpath%20stroke='%23999'%20stroke-width='2'%20d='M52%208a2%202%200%201%201-4%200%202%202%200%200%201%204%200Zm9%200a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3crect%20width='32'%20height='48'%20x='2'%20y='12'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%23999'%20fill-opacity='.3'%20d='M3%2049h30v10H3z'/%3e%3cpath%20stroke='%234169E1'%20stroke-width='2'%20d='M11%2054a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3cpath%20stroke='%23999'%20stroke-width='2'%20d='M20%2054a2%202%200%201%201-4%200%202%202%200%200%201%204%200Zm9%200a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3c/svg%3e",Ai=200,Li=10;async function $t(){const{masto:t}=q(),n=t.v1.followedTags.list({limit:Ai}),i=[];let o=0;do{const{value:a,done:s}=await n.next();if(s||(a==null?void 0:a.length)===0)break;i.push(...a),o++}while(o<Li);return i.sort((a,s)=>a.name.localeCompare(s.name)),i.length&&setTimeout(()=>{se.account.set("followedTags",{tags:i,updatedAt:Date.now()})},1),i}const Mi=24*60*60*1e3;async function Ri(){try{const{tags:t,updatedAt:n}=se.account.get("followedTags")||{};return t!=null&&t.length?(Date.now()-n>Mi&&$t(),t):await $t()}catch{return[]}}const gn=document.createElement("div"),_i=t=>{if(!t)return[];if(t.indexOf("#")===-1)return[];gn.innerHTML=t;const n=gn.querySelectorAll("a.hashtag");return n.length?Array.from(n).map(i=>i.innerText.trim().replace(/^[^#]*#+/,"")):[]};function Ot({children:t}){if(typeof t=="string")return t;const[n,i]=$("");return z(()=>{Promise.resolve(t).then(i)},[t]),n}const Je=9,Ei=["following","mentions","notifications","list","public","trending","search","hashtag","bookmarks","favourites"],ns={following:"Home / Following",notifications:"Notifications",list:"List",public:"Public (Local / Federated)",search:"Search","account-statuses":"Account",bookmarks:"Bookmarks",favourites:"Likes",hashtag:"Hashtag",trending:"Trending",mentions:"Mentions"},St={list:[{text:"List ID",name:"id"}],public:[{text:"Local only",name:"local",type:"checkbox"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],trending:[{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],search:[{text:"Search term",name:"query",type:"text",placeholder:"Optional, unless for multi-column mode",notRequired:!0}],"account-statuses":[{text:"@",name:"id",type:"text",placeholder:"cheeaun@mastodon.social"}],hashtag:[{text:"#",name:"hashtag",type:"text",placeholder:"e.g. PixelArt (Max 5, space-separated)",pattern:"[^#]+"},{text:"Media only",name:"media",type:"checkbox"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}]},Pi=nt(async({id:t})=>(await q().masto.v1.lists.$select(t).fetch()).title),Ni=nt(async({id:t})=>{const n=await q().masto.v1.accounts.$select(t).fetch();return n.username||n.acct||n.displayName}),xt={following:{id:"home",title:(t,n)=>n===0?"Home":"Following",path:"/",icon:"home"},mentions:{id:"mentions",title:"Mentions",path:"/mentions",icon:"at"},notifications:{id:"notifications",title:"Notifications",path:"/notifications",icon:"notification"},list:{id:"list",title:Pi,path:({id:t})=>`/l/${t}`,icon:"list"},public:{id:"public",title:({local:t})=>t?"Local":"Federated",subtitle:({instance:t})=>t||q().instance,path:({local:t,instance:n})=>`/${n}/p${t?"/l":""}`,icon:({local:t})=>t?"building":"earth"},trending:{id:"trending",title:"Trending",subtitle:({instance:t})=>t||q().instance,path:({instance:t})=>`/${t}/trending`,icon:"chart"},search:{id:"search",title:({query:t})=>t?`"${t}"`:"Search",path:({query:t})=>t?`/search?q=${encodeURIComponent(t)}&type=statuses`:"/search",icon:"search",excludeViewMode:({query:t})=>t?[]:["multi-column"]},"account-statuses":{id:"account-statuses",title:Ni,path:({id:t})=>`/a/${t}`,icon:"user"},bookmarks:{id:"bookmarks",title:"Bookmarks",path:"/b",icon:"bookmark"},favourites:{id:"favourites",title:"Likes",path:"/f",icon:"heart"},hashtag:{id:"hashtag",title:({hashtag:t})=>t,subtitle:({instance:t})=>t||q().instance,path:({hashtag:t,instance:n,media:i})=>`${n?`/${n}`:""}/t/${t.split(/\s+/).join("+")}${i?"?media=1":""}`,icon:"hashtag"}};function Di({onClose:t}){const n=Se(I),{shortcuts:i}=n,[o,a]=$(!1),[s,u]=$(!1),[l]=Vt();return e("div",{id:"shortcuts-settings-container",class:"sheet",tabindex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:[e(w,{icon:"shortcut"})," Shortcuts"," ",e("sup",{style:{fontSize:12,opacity:.5,textTransform:"uppercase"},children:"beta"})]})}),e("main",{children:[e("p",{children:"Specify a list of shortcuts that'll appear as:"}),e("div",{class:"shortcuts-view-mode",children:[{value:"float-button",label:"Floating button",imgURL:Ci},{value:"tab-menu-bar",label:"Tab/Menu bar",imgURL:xi},{value:"multi-column",label:"Multi-column",imgURL:$i}].map(({value:c,label:d,imgURL:h})=>{const r=n.settings.shortcutsViewMode===c||c==="float-button"&&!n.settings.shortcutsViewMode;return e("label",{class:r?"checked":"",children:[e("input",{type:"radio",name:"shortcuts-view-mode",value:c,checked:r,onChange:p=>{I.settings.shortcutsViewMode=p.target.value}})," ",e("img",{src:h,alt:"",width:"80",height:"58"})," ",e("span",{children:d})]},c)})}),i.length>0?e("ol",{class:"shortcuts-list",ref:l,children:i.filter(Boolean).map((c,d)=>{const h=Object.values(c).join("-"),{type:r}=c;if(!xt[r])return null;let{icon:p,title:f,subtitle:g,excludeViewMode:m}=xt[r];typeof f=="function"&&(f=f(c,d)),typeof g=="function"&&(g=g(c,d)),typeof p=="function"&&(p=p(c,d)),typeof m=="function"&&(m=m(c,d));const S=m==null?void 0:m.includes(n.settings.shortcutsViewMode);return e("li",{children:[e(w,{icon:p}),e("span",{class:"shortcut-text",children:[e(Ot,{children:f}),g&&e(A,{children:[" ",e("small",{class:"ib insignificant",children:g})]}),S&&e("span",{class:"tag",children:"Not available in current view mode"})]}),e("span",{class:"shortcut-actions",children:[e("button",{type:"button",class:"plain small",disabled:d===0,onClick:()=>{const y=Array.from(I.shortcuts);if(d>0){const b=I.shortcuts[d-1];y[d-1]=c,y[d]=b,I.shortcuts=y}},children:e(w,{icon:"arrow-up",alt:"Move up"})}),e("button",{type:"button",class:"plain small",disabled:d===i.length-1,onClick:()=>{const y=Array.from(I.shortcuts);if(d<I.shortcuts.length-1){const b=I.shortcuts[d+1];y[d+1]=c,y[d]=b,I.shortcuts=y}},children:e(w,{icon:"arrow-down",alt:"Move down"})}),e("button",{type:"button",class:"plain small",onClick:()=>{a({shortcut:c,shortcutIndex:d})},children:e(w,{icon:"pencil",alt:"Edit"})})]})]},h)})}):e("div",{class:"ui-state insignificant",children:[e("p",{children:"No shortcuts yet. Tap on the Add shortcut button."}),e("p",{children:["Not sure what to add?",e("br",{}),"Try adding"," ",e("a",{href:"#",onClick:c=>{c.preventDefault(),I.shortcuts=[{type:"following"},{type:"notifications"}]},children:"Home / Following and Notifications"})," ","first."]})]}),e("p",{class:"insignificant",children:i.length>=Je&&`Max ${Je} shortcuts`}),e("p",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e("button",{type:"button",class:"light",onClick:()=>u(!0),children:"Import/export"}),e("button",{type:"button",disabled:i.length>=Je,onClick:()=>a(!0),children:[e(w,{icon:"plus"})," ",e("span",{children:"Add shortcut"})]})]})]}),o&&e(Ie,{class:"light",onClick:c=>{c.target===c.currentTarget&&a(!1)},children:e(Oi,{shortcut:o.shortcut,shortcutIndex:o.shortcutIndex,onSubmit:({result:c,mode:d})=>{d==="edit"?I.shortcuts[o.shortcutIndex]=c:I.shortcuts.push(c)},onClose:()=>a(!1)})}),s&&e(Ie,{class:"light",onClick:c=>{c.target===c.currentTarget&&u(!1)},children:e(Bi,{shortcuts:i,onClose:()=>u(!1)})})]})}const Ui=1e3*60,Fi=nt(()=>{const{masto:t}=q();return t.v1.lists.list()},{maxAge:Ui}),bn={search:"For multi-column mode, search term is required, else the column will not be shown.",hashtag:"Multiple hashtags are supported. Space-separated."};function Oi({onSubmit:t,disabled:n,shortcut:i,shortcutIndex:o,onClose:a}){var S,y;const s=!!i,[u,l]=$((i==null?void 0:i.type)||null),{masto:c}=q(),[d,h]=$("default"),[r,p]=$([]),[f,g]=$([]);z(()=>{(async()=>{if(u==="list")try{h("loading");const b=await Fi();b.sort((v,k)=>v.title.localeCompare(k.title)),p(b),h("default")}catch{h("error")}})(),(async()=>{if(u==="hashtag")try{const b=await $t();g(b)}catch{}})()},[u]);const m=D();return z(()=>{if(s&&u&&St[u]){const b=m.current;St[u].forEach(({name:v,type:k})=>{const T=b.querySelector(`[name="${v}"]`);T&&i[v]&&(k==="checkbox"?T.checked=i[v]==="on":T.value=i[v])})}},[s,u]),e("div",{id:"shortcut-settings-form",class:"sheet",children:[!!a&&e("button",{type:"button",class:"sheet-close",onClick:a,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:[s?"Edit":"Add"," shortcut"]})}),e("main",{tabindex:"-1",children:e("form",{ref:m,onSubmit:b=>{b.preventDefault();const v=new FormData(b.target),k={};v.forEach((T,x)=>{k[x]=T==null?void 0:T.trim(),x==="instance"&&(k[x]=k[x].replace(/^https?:\/\//,"").replace(/\/+$/,""),k[x]=k[x].replace(/^@?[^@]+@/,""))}),k.type&&(t({result:k,mode:s?"edit":"add"}),b.target.reset(),l(null),a==null||a())},children:[e("p",{children:e("label",{children:[e("span",{children:"Timeline"}),e("select",{required:!0,disabled:n,onChange:b=>{l(b.target.value)},defaultValue:s?i.type:void 0,name:"type",children:[e("option",{}),Ei.map(b=>e("option",{value:b,children:ns[b]}))]})]})}),(y=(S=St[u])==null?void 0:S.map)==null?void 0:y.call(S,({text:b,name:v,type:k,placeholder:T,pattern:x,notRequired:L})=>u==="list"?e("p",{children:e("label",{children:[e("span",{children:"List"}),e("select",{name:"id",required:!L,disabled:n||d==="loading",defaultValue:s?i.id:void 0,children:r.map(N=>e("option",{value:N.id,children:N.title}))})]})}):e("p",{children:e("label",{children:[e("span",{children:b})," ",e("input",{type:k,switch:k==="checkbox"||void 0,name:v,placeholder:T,required:k==="text"&&!L,disabled:n,list:u==="hashtag"?"followed-hashtags-datalist":null,autocorrect:"off",autocapitalize:"off",spellcheck:!1,pattern:x}),u==="hashtag"&&f.length>0&&e("datalist",{id:"followed-hashtags-datalist",children:f.map(N=>e("option",{value:N.name}))})]})})),!!bn[u]&&e("p",{class:"form-note insignificant",children:[e(w,{icon:"info"}),bn[u]]}),e("footer",{children:[e("button",{type:"submit",class:"block",disabled:n||d==="loading",children:s?"Save":"Add"}),s&&e("button",{type:"button",class:"light danger",onClick:()=>{I.shortcuts.splice(o,1),a==null||a()},children:"Remove"})]})]})})]})}function Bi({shortcuts:t,onClose:n}){var d;const i=he(()=>!t||!t.filter(Boolean).length?"":cn.compressToEncodedURIComponent(JSON.stringify(t.filter(Boolean))),[t]),[o,a]=$(""),[s,u]=$("default"),l=he(()=>{if(!o)return u("default"),null;try{const h=JSON.parse(cn.decompressFromEncodedURIComponent(o));if(!Array.isArray(h))throw new Error("Not an array");return u("default"),h}catch{try{const r=JSON.parse(o);if(!Array.isArray(r))throw new Error("Not an array");return u("default"),r}catch{return u("error"),null}}},[o]),c=I.shortcuts.length>0;return e("div",{id:"import-export-container",class:"sheet",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:["Import/Export ",e("small",{class:"ib insignificant",children:"Shortcuts"})]})}),e("main",{tabindex:"-1",children:[e("section",{children:[e("h3",{children:[e(w,{icon:"arrow-down-circle",size:"l",class:"insignificant"})," ",e("span",{children:"Import"})]}),e("p",{children:e("input",{type:"text",name:"import",placeholder:"Paste shortcuts here",class:"block",onInput:h=>{a(h.target.value)}})}),!!l&&Array.isArray(l)&&e(A,{children:[e("p",{children:[e("b",{children:l.length})," shortcut",l.length>1?"s":""," ",e("small",{class:"insignificant",children:["(",o.length," characters)"]})]}),e("ol",{class:"import-settings-list",children:l.map(h=>{var r,p;return e("li",{children:[e("span",{style:{opacity:t.some(f=>Object.keys(f).every(g=>f[g]===h[g]))?1:0},children:"*"}),e("span",{children:[ns[h.type],h.type==="list"&&" ⚠️"," ",(p=(r=St[h.type])==null?void 0:r.map)==null?void 0:p.call(r,({text:f,name:g,type:m})=>h[g]?e(A,{children:[e("span",{class:"tag collapsed insignificant",children:[f,":"," ",m==="checkbox"?h[g]==="on"?"✅":"❌":h[g]]})," "]}):null)]})]})})}),e("p",{children:[e("small",{children:"* Exists in current shortcuts"}),e("br",{}),e("small",{children:"⚠️ List may not work if it's from a different account."})]})]}),s==="error"&&e("p",{class:"error",children:e("small",{children:"⚠️ Invalid settings format"})}),e("p",{children:[c&&e(A,{children:[e(Be,{confirmLabel:"Append to current shortcuts?",menuFooter:e("div",{class:"footer",children:"Only shortcuts that don’t exist in current shortcuts will be appended."}),onClick:()=>{const h=l.filter(f=>!I.shortcuts.some(g=>Object.keys(g).every(m=>g[m]===f[m])));if(!h.length){me("No new shortcuts to import");return}let r=[...I.shortcuts,...h];const p=r.length>Je;p&&(r=r.slice(0,Je)),I.shortcuts=r,me(p?`Shortcuts imported. Exceeded max ${Je}, so the rest are not imported.`:"Shortcuts imported"),n==null||n()},children:e("button",{type:"button",class:"plain2",disabled:!l,children:"Import & append…"})})," "]}),e(Be,{confirmLabel:c?"Override current shortcuts?":"Import shortcuts?",menuItemClassName:c?"danger":void 0,onClick:()=>{I.shortcuts=l,me("Shortcuts imported"),n==null||n()},children:e("button",{type:"button",class:"plain2",disabled:!l,children:c?"or override…":"Import…"})})]})]}),e("section",{children:[e("h3",{children:[e(w,{icon:"arrow-up-circle",size:"l",class:"insignificant"})," ",e("span",{children:"Export"})]}),e("p",{children:e("input",{style:{width:"100%"},type:"text",value:i,readOnly:!0,onClick:h=>{if(h.target.value){h.target.select();try{navigator.clipboard.writeText(h.target.value),me("Shortcuts copied")}catch{me("Unable to copy shortcuts")}}}})}),e("p",{children:[e("button",{type:"button",class:"plain2",disabled:!i,onClick:()=>{try{navigator.clipboard.writeText(i),me("Shortcut settings copied")}catch{me("Unable to copy shortcut settings")}},children:[e(w,{icon:"clipboard"})," ",e("span",{children:"Copy"})]})," ",(navigator==null?void 0:navigator.share)&&((d=navigator==null?void 0:navigator.canShare)==null?void 0:d.call(navigator,{text:i}))&&e("button",{type:"button",class:"plain2",disabled:!i,onClick:()=>{try{navigator.share({text:i})}catch{alert("Sharing doesn't seem to work.")}},children:[e(w,{icon:"share"})," ",e("span",{children:"Share"})]})," ",i.length>0&&e("small",{class:"insignificant",children:[i.length," characters"]})]}),!!i&&e("details",{children:[e("summary",{class:"insignificant",children:e("small",{children:"Raw Shortcuts JSON"})}),e("textarea",{style:{width:"100%"},rows:10,readOnly:!0,children:JSON.stringify(t.filter(Boolean),null,2)})]})]})]})]})}Vn(I,t=>{for(const[n,i,o,a]of t)/^show/i.test(i)&&!o&&Ft()});function zi(){var o,a,s,u,l,c,d,h;const t=Se(I),n=Gn(),i=dt();return e(A,{children:[!!t.showCompose&&e(Ie,{children:e(ks,{replyToStatus:typeof t.showCompose!="boolean"?t.showCompose.replyToStatus:((o=window.__COMPOSE__)==null?void 0:o.replyToStatus)||null,editStatus:((a=I.showCompose)==null?void 0:a.editStatus)||((s=window.__COMPOSE__)==null?void 0:s.editStatus)||null,draftStatus:((u=I.showCompose)==null?void 0:u.draftStatus)||((l=window.__COMPOSE__)==null?void 0:l.draftStatus)||null,onClose:r=>{const{newStatus:p,instance:f,type:g}=r||{};I.showCompose=!1,window.__COMPOSE__=null,p&&(I.reloadStatusPage++,me({text:{post:"Post published. Check it out.",reply:"Reply posted. Check it out.",edit:"Post updated. Check it out."}[g||"post"],delay:1e3,duration:1e4,onClick:m=>{m.hideToast(),I.prevLocation=i,n(f?`/${f}/s/${p.id}`:`/s/${p.id}`)}}))}})}),!!t.showSettings&&e(Ie,{onClose:()=>{I.showSettings=!1},children:e(ii,{onClose:()=>{I.showSettings=!1}})}),!!t.showAccounts&&e(Ie,{onClose:()=>{I.showAccounts=!1},children:e(Ks,{onClose:()=>{I.showAccounts=!1}})}),!!t.showAccount&&e(Ie,{class:"light",onClose:()=>{I.showAccount=!1},children:e(yi,{account:((c=t.showAccount)==null?void 0:c.account)||t.showAccount,instance:(d=t.showAccount)==null?void 0:d.instance,onClose:({destination:r}={})=>{I.showAccount=!1}})}),!!t.showDrafts&&e(Ie,{onClose:()=>{I.showDrafts=!1},children:e(wi,{onClose:()=>I.showDrafts=!1})}),!!t.showMediaModal&&e(Ie,{onClick:r=>{(r.target===r.currentTarget||r.target.classList.contains("media"))&&(I.showMediaModal=!1)},children:e(ts,{mediaAttachments:t.showMediaModal.mediaAttachments,instance:t.showMediaModal.instance,index:t.showMediaModal.index,statusID:t.showMediaModal.statusID,onClose:()=>{I.showMediaModal=!1}})}),!!t.showShortcutsSettings&&e(Ie,{class:"light",onClose:()=>{I.showShortcutsSettings=!1},children:e(Di,{onClose:()=>I.showShortcutsSettings=!1})}),!!t.showGenericAccounts&&e(Ie,{class:"light",onClose:()=>{I.showGenericAccounts=!1},children:e(ki,{instance:t.showGenericAccounts.instance,excludeRelationshipAttrs:t.showGenericAccounts.excludeRelationshipAttrs,onClose:()=>I.showGenericAccounts=!1})}),!!t.showMediaAlt&&e(Ie,{class:"light",onClose:r=>{I.showMediaAlt=!1},children:e(Ii,{alt:t.showMediaAlt.alt||t.showMediaAlt,lang:(h=t.showMediaAlt)==null?void 0:h.lang,onClose:()=>{I.showMediaAlt=!1}})}),!!t.showEmbedModal&&e(Ie,{onClose:()=>{I.showEmbedModal=!1},children:e(Si,{html:t.showEmbedModal.html,url:t.showEmbedModal.url,onClose:()=>{I.showEmbedModal=!1}})})]})}function Bt({accountID:t,onChange:n}){const{masto:i}=q(),[o,a]=$("default"),[s,u]=$(null),[l,c]=$(null),d=l!==null;return e("p",{class:"follow-request-buttons",children:[e("button",{type:"button",disabled:o==="loading"||d,onClick:()=>{a("loading"),u("accept"),(async()=>{try{const h=await i.v1.followRequests.$select(t).authorize();if(!(h!=null&&h.followedBy))throw new Error("Follow request not accepted");c(h),n()}catch{}a("default")})()},children:"Accept"})," ",e("button",{type:"button",disabled:o==="loading"||d,class:"light danger",onClick:()=>{a("loading"),u("reject"),(async()=>{try{const h=await i.v1.followRequests.$select(t).reject();if(h!=null&&h.followedBy)throw new Error("Follow request not rejected");c(h),n()}catch{a("default")}})()},children:"Reject"}),e("span",{class:"follow-request-states",children:d&&s?s==="accept"?e(w,{icon:"check-circle",alt:"Accepted",class:"follow-accepted"}):e(w,{icon:"x-circle",alt:"Rejected",class:"follow-rejected"}):e(Te,{hidden:o!=="loading"})})]})}const yn={mention:"comment",status:"notification",reblog:"rocket",follow:"follow",follow_request:"follow-add",favourite:"heart",poll:"poll",update:"pencil","admin.signup":"account-edit","admin.report":"account-warning"},ot={mention:"mentioned you in their post.",status:"published a post.",reblog:"boosted your post.","reblog+account":t=>`boosted ${t} of your posts.`,reblog_reply:"boosted your reply.",follow:"followed you.",follow_request:"requested to follow you.",favourite:"liked your post.","favourite+account":t=>`liked ${t} of your posts.`,favourite_reply:"liked your reply.",poll:"A poll you have voted in or created has ended.","poll-self":"A poll you have created has ended.","poll-voted":"A poll you have voted in has ended.",update:"A post you interacted with has been edited.","favourite+reblog":"boosted & liked your post.","favourite+reblog+account":t=>`boosted & liked ${t} of your posts.`,"favourite+reblog_reply":"boosted & liked your reply.","admin.sign_up":"signed up.","admin.report":t=>e(A,{children:["reported ",t]})},Pt=50;function qi({notification:t,instance:n,isStatic:i,disableContextMenu:o}){var L,N,B,U;const{id:a,status:s,account:u,report:l,_accounts:c,_statuses:d}=t;let{type:h}=t;const r=(s==null?void 0:s.reblog)||s,p=r==null?void 0:r.id,f=se.session.get("currentAccount"),g=f===(u==null?void 0:u.id),m=(L=s==null?void 0:s.poll)==null?void 0:L.voted,S=!!(s!=null&&s.inReplyToAccountId)&&(s==null?void 0:s.inReplyToAccountId)!==f&&((N=s==null?void 0:s.account)==null?void 0:N.id)===f;let y=0,b=0;if(h==="favourite+reblog"){for(const P of c)(B=P._types)!=null&&B.includes("favourite")&&y++,(U=P._types)!=null&&U.includes("reblog")&&b++;!b&&y&&(h="favourite"),!y&&b&&(h="reblog")}let v;if(h==="poll"?v=ot[g?"poll-self":m?"poll-voted":"poll"]:h==="reblog"||h==="favourite"||h==="favourite+reblog"?(d==null?void 0:d.length)>1?v=ot[`${h}+account`]:S?v=ot[`${h}_reply`]:v=ot[h]:ot[h]?v=ot[h]:v=`[Unknown notification type: ${h}]`,typeof v=="function"){const P=(d==null?void 0:d.length)||(c==null?void 0:c.length);if(P)v=v(P);else if(h==="admin.report"){const R=l==null?void 0:l.targetAccount;R&&(v=v(e(Ct,{account:R,showAvatar:!0})))}}if(h==="mention"&&!s)return null;const k=t.createdAt&&new Date(t.createdAt).toLocaleString(),T={"favourite+reblog":"Boosted/Liked by…",favourite:"Liked by…",reblog:"Boosted by…",follow:"Followed by…"}[h]||"Accounts",x=()=>{I.showGenericAccounts={heading:T,accounts:c,showReactions:h==="favourite+reblog",excludeRelationshipAttrs:h==="follow"?["followedBy"]:[]}};return e("div",{class:`notification notification-${h}`,"data-notification-id":a,tabIndex:"0",children:[e("div",{class:`notification-type notification-${h}`,title:k,children:h==="favourite+reblog"?e(A,{children:[e(w,{icon:"rocket",size:"xl",alt:h,class:"reblog-icon"}),e(w,{icon:"heart",size:"xl",alt:h,class:"favourite-icon"})]}):e(w,{icon:yn[h]||"notification",size:"xl",alt:h})}),e("div",{class:"notification-content",children:[h!=="mention"&&e(A,{children:[e("p",{children:[!/poll|update/i.test(h)&&e(A,{children:(c==null?void 0:c.length)>1?e(A,{children:[e("b",{tabIndex:"0",onClick:x,children:[e("span",{title:c.length,children:Ne(c.length)})," ","people"]})," "]}):e(A,{children:[e(Ct,{account:u,showAvatar:!0})," "]})}),v,h==="mention"&&e("span",{class:"insignificant",children:[" ","•"," ",e(At,{datetime:t.createdAt,format:"micro"})]})]}),h==="follow_request"&&e(Bt,{accountID:u.id})]}),(c==null?void 0:c.length)>1&&e("p",{class:"avatars-stack",children:[c.slice(0,Pt).map(P=>e(A,{children:[e("a",{href:P.url,rel:"noopener noreferrer",class:"account-avatar-stack",onClick:R=>{R.preventDefault(),I.showAccount=P},children:[e(tt,{url:P.avatarStatic,size:c.length<=10?"xxl":c.length<20?"xl":c.length<30?"l":c.length<40?"m":"s",alt:`${P.displayName} @${P.acct}`,squircle:P==null?void 0:P.bot},P.id),h==="favourite+reblog"&&e("div",{class:"account-sub-icons",children:P._types.map(R=>e(w,{icon:yn[R],size:"s",class:`${R}-icon`}))})]},P.id)," "]},P.id)),e("button",{type:"button",class:"small plain",onClick:x,children:[c.length>Pt&&`+${c.length-Pt}`,e(w,{icon:"chevron-down"})]})]}),(d==null?void 0:d.length)>1&&e("ul",{class:"notification-group-statuses",children:d.map(P=>e("li",{children:e(wn,{class:`status-link status-type-${h}`,to:n?`/${n}/s/${P.id}`:`/s/${P.id}`,children:e($e,{status:P,size:"s"})})},P.id))}),s&&(!(d!=null&&d.length)||(d==null?void 0:d.length)<=1)&&e(wn,{class:`status-link status-type-${h}`,to:n?`/${n}/s/${p}`:`/s/${p}`,onContextMenu:o?void 0:P=>{const R=P.target.querySelector(".status");if(R){if(P.metaKey)return;P.preventDefault(),R.dispatchEvent(new MouseEvent("contextmenu",{clientX:P.clientX,clientY:P.clientY}))}},children:i?e($e,{status:r,size:"s"}):e($e,{statusID:p,size:"s"})})]})]})}function wn(t){const n=Is();return e(ee,{...t,"data-read-more":"Read more →",ref:n})}const Zt=ze(qi);"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",t=>{const{type:n,id:i,accessToken:o}=(t==null?void 0:t.data)||{};n==="notification"&&(I.routeNotification={id:i,accessToken:o})});const Hi=ze(function(){if(!("serviceWorker"in navigator))return null;const n=Se(I),{routeNotification:i}=n,{id:o,accessToken:a}=i||{},[s,u]=$(!1);Ye(()=>{if(!o||!a)return;const{instance:c}=q(),{masto:d,instance:h}=q({accessToken:a}),r=c===h,p=a?Ts(a):ct();(async()=>{const f=await d.v1.notifications.$select(o).fetch();if(f&&p){const g=p.instanceURL,{type:m,status:S,account:y}=f,b=!!document.querySelector("#modal-container > *"),v=m==="follow"&&!!(y!=null&&y.id),k=!!(y!=null&&y.id),T=!!(S!=null&&S.id);v&&r?I.showAccount={account:y,instance:g}:b||!r||k&&T?u({id:o,account:p,notification:f,sameInstance:r}):T?location.hash=`/${c}/s/${S.id}`:v?location.hash=`/${c}/a/${y.id}`:location.hash="/notifications"}})()},[o,a]),Ye(()=>{navigator!=null&&navigator.clearAppBadge&&navigator.clearAppBadge()},[]),rt(c=>{c&&(navigator!=null&&navigator.clearAppBadge)&&navigator.clearAppBadge()});const l=()=>{u(!1),I.routeNotification=null,/\/notifications\?id=/i.test(location.hash)&&(location.hash="/notifications")};if(s){const{id:c,account:d,notification:h,sameInstance:r}=s;return e(Ie,{class:"light",onClick:p=>{p.target===p.currentTarget&&l()},children:e("div",{class:"sheet",tabIndex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:l,children:e(w,{icon:"x"})}),e("header",{children:e("b",{children:"Notification"})}),e("main",{children:[!r&&e("p",{children:"This notification is from your other account."}),e("div",{class:"notification-peek",onClick:p=>{const{target:f}=p;(p.target.tagName==="BUTTON"||p.target.tagName==="A")&&l()},children:e(Zt,{instance:d.instanceURL,notification:h,isStatic:!0})}),e("div",{style:{textAlign:"end"},children:e(ee,{to:"/notifications",class:"button light",onClick:l,children:[e("span",{children:"View all notifications"})," ",e(w,{icon:"arrow-right"})]})})]})]})})}return null}),ss=Es((t,n)=>{const{instance:i}=q(),[o,a]=qe(),[s,u]=$(!1),[l,c]=$(o.get("q")||""),d=o.get("type"),h=D(null),r=D(null);return _s(n,()=>({setValue:p=>{c(p)},focus:()=>{r.current.focus()},select:()=>{r.current.select()},blur:()=>{r.current.blur()}})),e("form",{ref:h,class:"search-popover-container",onSubmit:p=>{var g;if(p.preventDefault(),/\/search/.test(location.hash))if(l){const m={q:l};d&&(m.type=d),a(m)}else a({});else l?location.hash=`/search?q=${encodeURIComponent(l)}${d?`&type=${d}`:""}`:location.hash="/search";(g=t==null?void 0:t.onSubmit)==null||g.call(t,p)},children:[e("input",{ref:r,value:l,name:"q",type:"search",placeholder:"Search",dir:"auto",autocomplete:"off",autocorrect:"off",autocapitalize:"off",onSearch:p=>{p.target.value||a({})},onInput:p=>{c(p.target.value),u(!0)},onFocus:()=>{u(!0)},onBlur:()=>{var p,f;setTimeout(()=>{u(!1)},100),(f=(p=h.current)==null?void 0:p.querySelector(".search-popover-item.focus"))==null||f.classList.remove("focus")},onKeyDown:p=>{var g;const{key:f}=p;switch(f){case"Escape":u(!1);break;case"Down":case"ArrowDown":if(p.preventDefault(),s){const m=h.current.querySelector(".search-popover-item.focus");if(m){let S=m.nextElementSibling;for(;S&&S.hidden;)S=S.nextElementSibling;S&&(S.classList.add("focus"),Array.from(S.parentElement.children).filter(b=>b!==S).forEach(b=>{b.classList.remove("focus")}))}else{const S=h.current.querySelector(".search-popover-item");S&&S.classList.add("focus")}}break;case"Up":case"ArrowUp":if(p.preventDefault(),s){const m=document.querySelector(".search-popover-item.focus");if(m){let S=m.previousElementSibling;for(;S&&S.hidden;)S=S.previousElementSibling;S&&(S.classList.add("focus"),Array.from(S.parentElement.children).filter(b=>b!==S).forEach(b=>{b.classList.remove("focus")}))}else{const S=document.querySelector(".search-popover-item:last-child");S&&S.classList.add("focus")}}break;case"Enter":if(s){const m=document.querySelector(".search-popover-item.focus");m&&(p.preventDefault(),m.click()),u(!1),(g=t==null?void 0:t.onSubmit)==null||g.call(t,p)}break}}}),e("div",{class:"search-popover",hidden:!s||!l,children:!!l&&[{label:e(A,{children:["Posts with ",e("q",{children:l})]}),to:`/search?q=${encodeURIComponent(l)}&type=statuses`,hidden:/^https?:/.test(l)},{label:e(A,{children:["Posts tagged with ",e("mark",{children:["#",l.replace(/^#/,"")]})]}),to:`/${i}/t/${l.replace(/^#/,"")}`,hidden:/^@/.test(l)||/^https?:/.test(l)||/\s/.test(l),top:/^#/.test(l),type:"link"},{label:e(A,{children:["Look up ",e("mark",{children:l})]}),to:`/${l}`,hidden:!/^https?:/.test(l),top:/^https?:/.test(l),type:"link"},{label:e(A,{children:["Accounts with ",e("q",{children:l})]}),to:`/search?q=${encodeURIComponent(l)}&type=accounts`}].sort((p,f)=>p.top&&!f.top?-1:!p.top&&f.top?1:0).map(({label:p,to:f,hidden:g,type:m})=>e(ee,{to:f,class:"search-popover-item",hidden:g,onClick:S=>{var y;(y=t==null?void 0:t.onSubmit)==null||y.call(t,S)},children:[e(w,{icon:m==="link"?"arrow-right":"search",class:"more-insignificant"}),e("span",{children:p})," "]}))})]})}),Vi=ze(function({onClose:n=()=>{}}){const[i,o]=$(!1),a=D(null);Le("/",u=>{o(!0),setTimeout(()=>{var l,c,d,h;(c=(l=a.current)==null?void 0:l.focus)==null||c.call(l),(h=(d=a.current)==null?void 0:d.select)==null||h.call(d)},0)},{preventDefault:!0,ignoreEventWhen:u=>{const l=/\/search/.test(location.hash),c=!!document.querySelector("#modal-container > *");return l||c}});const s=()=>{o(!1),n()};return Le("esc",u=>{var l,c;(c=(l=a.current)==null?void 0:l.blur)==null||c.call(l),s()},{enabled:i,enableOnFormTags:!0,preventDefault:!0}),e("div",{id:"search-command-container",hidden:!i,onClick:u=>{u.target===u.currentTarget&&s()},children:e(ss,{ref:a,onSubmit:()=>{s()}})})});function Gi(){const{instance:t}=q(),n=Se(I),{shortcuts:i,settings:o}=n;if(!i.length||o.shortcutsViewMode==="multi-column"||!o.shortcutsViewMode&&o.shortcutsColumnsMode)return null;const a=D(),s=he(()=>i.map((l,c)=>{const{type:d,...h}=l;if(!xt[d])return null;let{id:r,path:p,title:f,subtitle:g,icon:m}=xt[d];return typeof r=="function"&&(r=r(h,c)),typeof p=="function"&&(p=p({...h,instance:h.instance||t},c)),typeof f=="function"&&(f=f(h,c)),typeof g=="function"&&(g=g(h,c)),typeof m=="function"&&(m=m(h,c)),{id:r,path:p,title:f,subtitle:g,icon:m}}).filter(Boolean),[i]),u=Gn();return Le(["1","2","3","4","5","6","7","8","9"],(l,c)=>{var h,r;const d=parseInt(c.keys[0],10)-1;if(d<s.length){const{path:p}=s[d];p&&(u(p),(r=(h=a.current)==null?void 0:h.closeMenu)==null||r.call(h))}}),e("div",{id:"shortcuts",children:n.settings.shortcutsViewMode==="tab-menu-bar"?e("nav",{class:"tab-bar",onContextMenu:l=>{l.preventDefault(),I.showShortcutsSettings=!0},children:e("ul",{children:s.map(({id:l,path:c,title:d,subtitle:h,icon:r},p)=>e("li",{children:e(ee,{class:h?"has-subtitle":"",to:c,onClick:f=>{if(f.target.classList.contains("is-active")){f.preventDefault();const g=document.getElementById(`${l}-page`);if(g){g.scrollTop=0;const m=g.querySelector(".updates-button");m&&m.click()}}},children:[e(w,{icon:r,size:"xl",alt:d}),e("span",{children:[e(Ot,{children:d}),h&&e(A,{children:[e("br",{}),e("small",{children:h})]})]})]})},`${p}-${l}-${d}-${h}-${c}`))})}):e(Fe,{instanceRef:a,overflow:"auto",viewScroll:"close",menuClassName:"glass-menu shortcuts-menu",gap:8,position:"anchor",menuButton:e("button",{type:"button",id:"shortcuts-button",class:"plain",onContextMenu:l=>{l.preventDefault(),I.showShortcutsSettings=!0},onTransitionStart:l=>{var c,d;try{const{target:h}=l;getComputedStyle(h).pointerEvents==="none"&&((d=(c=a.current)==null?void 0:c.closeMenu)==null||d.call(c))}catch{}},children:e(w,{icon:"shortcut",size:"xl",alt:"Shortcuts"})}),children:s.map(({id:l,path:c,title:d,subtitle:h,icon:r},p)=>e(Re,{to:c,class:"glass-menu-item",children:[e(w,{icon:r,size:"l"})," ",e("span",{class:"menu-grow",children:[e("span",{children:e(Ot,{children:d})}),h&&e(A,{children:[" ",e("small",{class:"more-insignificant",children:h})]})]}),e("span",{class:"menu-shortcut hide-until-focus-visible",children:p+1})]},`${p}-${l}-${d}-${h}-${c}`))})})}const ji=ze(Gi);function Yi(t){var a;let n=[],i=[],o=0;for(let s=0;s<t.length;s++){const u=t[s];u.reblog&&!((a=u.account)!=null&&a.group)?(i.push(u),o++):(n.push(u),o<3&&(o=0))}if(t.length>10&&(i.length>t.length/4||o>=3)){const s=i.map(u=>u.id);if(i.length>t.length*3/4)n=[...n,{id:s,items:i,type:"boosts"}];else{const u=Math.floor(n.length/2);n=[...n.slice(0,u),{id:s,items:i,type:"boosts"},...n.slice(u)]}return n}else return t}function vn(t,n){const i=se.account.get("boostedStatusIDs")||{},o=t.filter(s=>{if(!s.reblog)return!0;const u=`${n}-${s.reblog.id}`,l=i[u];return l&&l!==s.id?!1:(i[u]=s.id,!0)}),a=Object.keys(i);return a.length>50&&a.slice(0,a.length-50).forEach(s=>{delete i[s]}),se.account.set("boostedStatusIDs",i),o}function Wi(t){const n=[];let i=0;t.forEach(s=>{for(let l=0;l<n.length;l++){if(n[l].find(c=>c.id===s.id))return;if(n[l].find(c=>c.id===s.inReplyToId)||n[l].find(c=>c.inReplyToId===s.id)){n[l].push(s);return}}const u=t.find(l=>l.id===s.inReplyToId);u&&(n[i++]=[s,u])});for(let s=0;s<n.length;s++)for(let u=s+1;u<n.length;u++)n[s].find(c=>n[u].includes(c))&&(n[s]=[...n[s],...n[u]],n[s]=n[s].filter((c,d,h)=>h.findIndex(r=>r.id===c.id)===d),n.splice(u,1),u--);n.forEach(s=>{s.sort((u,l)=>!u.inReplyToId&&!l.inReplyToId?new Date(u.createdAt)-new Date(l.createdAt):u.inReplyToId===l.id?1:l.inReplyToId===u.id||!u.inReplyToId?-1:l.inReplyToId?new Date(u.createdAt)-new Date(l.createdAt):1)}),n.forEach(s=>{const u=s[0].account.id;s.forEach(l=>{l.account.id!==u&&(l._differentAuthor=!0)})}),n.length;const o=[],a=[];return t.forEach(s=>{if(s.reblog){o.push(s);return}for(let u=0;u<n.length;u++)if(n[u].find(l=>l.id===s.id)){if(a.includes(u))return;const l=n[u];l.sort((d,h)=>{const r=new Date(d.createdAt),p=new Date(h.createdAt);return r-p});const c=l[0].account.id;o.push({id:l.map(d=>d.id),items:l,type:l.every(d=>d.account.id===c)?"thread":"conversation"}),a.push(u);return}o.push(s)}),o}async function Ki(t,n){const i=await Ri();if(!i.length)return;const{statusFollowedTags:o}=I,a=[];if(t.forEach(s=>{var p;if(s.reblog)return;const{id:u,content:l,tags:c=[]}=s,d=Ge(u,n);if((p=o[d])!=null&&p.length)return;const h=_i(l);if(!h.length&&!c.length)return;const r=i.reduce((f,g)=>((h.some(m=>m.toLowerCase()===g.name.toLowerCase())||c.some(m=>m.name.toLowerCase()===g.name.toLowerCase()))&&f.push(g.name),f),[]);r.length&&a.push({item:s,sKey:d,followedTags:r})}),a.length){const s=a.map(l=>l.item.account),u=await Kt(s);if(!u)return;a.forEach(l=>{const{item:c,sKey:d,followedTags:h}=l;u[c.account.id].following||(o[d]=h)})}}function Zi(){I.statusFollowedTags={}}function Ji({scrollableRef:t,distanceFromStart:n=1,distanceFromEnd:i=1,scrollThresholdStart:o=10,scrollThresholdEnd:a=10,direction:s="vertical",distanceFromStartPx:u,distanceFromEndPx:l}={}){const[c,d]=$(null),[h,r]=$(!1),[p,f]=$(!1),[g,m]=$(!1),[S,y]=$(!1),b=s==="vertical";return Ye(()=>{const v=t.current;if(!v)return{};let k=b?v.scrollTop:v.scrollLeft;function T(){const{scrollTop:x,scrollLeft:L,scrollHeight:N,scrollWidth:B,clientHeight:U,clientWidth:P}=v,R=b?x:L,C=b?N:B,_=b?U:P,O=Math.abs(R-k),K=u||Math.min(_*n,C,R),te=l||Math.min(_*i,C,C-R-_);O>=(k<R?a:o)&&(d(k<R?"end":"start"),k=R),r(R<=0),f(R+_>=C),m(R<=K),y(R+_>=C-te)}return v.addEventListener("scroll",T,{passive:!0}),()=>v.removeEventListener("scroll",T)},[n,i,o,a]),{scrollDirection:c,reachStart:h,reachEnd:p,nearReachStart:g,nearReachEnd:S,init:()=>{t.current&&t.current.dispatchEvent(new Event("scroll"))}}}function Xi({scrollableRef:t,distanceFromStart:n=1,distanceFromEnd:i=1,scrollThresholdStart:o=10,scrollThresholdEnd:a=10,direction:s="vertical",distanceFromStartPx:u,distanceFromEndPx:l,init:c}={},d,h){if(!d)return;const[r,p]=$(null),[f,g]=$(!1),[m,S]=$(!1),[y,b]=$(!1),[v,k]=$(!1),T=s==="vertical",x=D(null),L=Ps(()=>{const N=t.current,{scrollTop:B,scrollLeft:U,scrollHeight:P,scrollWidth:R,clientHeight:C,clientWidth:_}=N,O=T?B:U,K=T?P:R,te=T?C:_,Y=Math.abs(O-x.current),ke=u||Math.min(te*n,K,O),re=l||Math.min(te*i,K,K-O-te);Y>=(x.current<O?a:o)&&(p(x.current<O?"end":"start"),x.current=O),g(O<=0),S(O+te>=K),b(O<=ke),k(O+te>=K-re)},500);Ye(()=>{const N=t.current;return N?(x.current=N[T?"scrollTop":"scrollLeft"],N.addEventListener("scroll",L,{passive:!0}),()=>N.removeEventListener("scroll",L)):{}},[n,i,o,a]),z(()=>{d({scrollDirection:r,reachStart:f,reachEnd:m,nearReachStart:y,nearReachEnd:v})},[r,f,m,y,v,...h]),z(()=>{c&&t.current&&queueMicrotask(()=>{t.current.dispatchEvent(new Event("scroll"))})},[c])}function Qi({class:t,statusID:n,status:i,instance:o,parent:a,onMediaClick:s}){let u=Ge(n,o);const l=Se(I);if(i||(i=l.statuses[u]||l.statuses[n],u=Ge(i==null?void 0:i.id,o)),!i)return null;const{account:{acct:c,avatar:d,avatarStatic:h,id:r,url:p,displayName:f,username:g,emojis:m,bot:S,group:y},id:b,repliesCount:v,reblogged:k,reblogsCount:T,favourited:x,favouritesCount:L,bookmarked:N,poll:B,muted:U,sensitive:P,spoilerText:R,visibility:C,language:_,editedAt:O,filtered:K,card:te,createdAt:Y,inReplyToId:ke,inReplyToAccountId:re,content:X,mentions:E,mediaAttachments:W,reblog:ne,uri:le,url:H,emojis:oe,_deleted:Q,_pinned:ge}=i;if(!(W!=null&&W.length))return null;const G=j=>{j.shiftKey},Z=he(()=>se.session.get("currentAccount"),[]),ae=he(()=>Z&&Z===r,[r,Z]),fe=Ns(Bn),be=!ae&&Ut(K,fe);if((be==null?void 0:be.action)==="hide")return null;const de=P,M=he(()=>(se.account.get("preferences")||{})["reading:expand:media"]||"default",[])==="show_all",V=a||"div";return W.map((j,ce)=>{const we=`${u}-${j.id}`,_e=be==null?void 0:be.titlesStr;return e(V,{"data-state-post-id":u,onMouseEnter:G,"data-spoiler-text":R||(P?"Sensitive media":void 0),"data-filtered-text":be?`Filtered${_e?`: ${_e}`:""}`:void 0,class:`
          media-post
          ${be?"filtered":""}
          ${de?"has-spoiler":""}
          ${M?"show-media":""}
        `,children:e(On,{class:t,media:j,lang:_,to:`/${o}/s/${b}?media-only=${ce+1}`,onClick:s?F=>s(F,ce,j,i):void 0})},we)})}const Sn=ze(Qi);function gt(t){var v,k,T,x,L;const n=Se(I),{masto:i,instance:o,authenticated:a}=q(),[s,u]=$(),[l,c]=$(!1);z(()=>{const N=se.local.getJSON("accounts")||[],B=N.find(U=>U.info.id===se.session.get("currentAccount"));B&&u(B),c(N.length>1)},[]);const d=(n.settings.shortcutsViewMode==="multi-column"||!n.settings.shortcutsViewMode&&n.settings.shortcutsColumnsMode)&&!n.shortcuts.find(N=>N.type==="following"),h=Ds(()=>{I.showAccounts=!0},{threshold:600,detect:"touch",cancelOnMovement:!0}),r=D(),[p,f]=$(void 0),g=Cs([0,0,n.settings.shortcutsViewMode==="tab-menu-bar"?50:0,0]),m=D();async function S(N){return(N||!m.current)&&(m.current=i.v1.mutes.list({limit:80})),await m.current.next()}const y=D();async function b(N){return(N||!y.current)&&(y.current=i.v1.blocks.list({limit:80})),await y.current.next()}return e(A,{children:[e("button",{ref:r,type:"button",class:`button plain nav-menu-button ${l?"with-avatar":""} ${open?"active":""}`,style:{position:"relative"},onClick:()=>{f(N=>N?void 0:"open")},onContextMenu:N=>{N.preventDefault(),I.showAccounts=!0},...h(),children:[l&&e(tt,{url:((v=s==null?void 0:s.info)==null?void 0:v.avatar)||((k=s==null?void 0:s.info)==null?void 0:k.avatarStatic),size:"l",squircle:(T=s==null?void 0:s.info)==null?void 0:T.bot}),e(w,{icon:"menu",size:l?"s":"l"})]}),e(jn,{menuClassName:"nav-menu",state:p,anchorRef:r,onClose:()=>{f(void 0)},containerProps:{style:{zIndex:10},onClick:()=>{f(void 0)}},portal:{target:document.body},...t,overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:g,unmountOnClose:!0,children:[!!((x=n.appVersion)!=null&&x.commitHash)&&n.appVersion.commitHash!=="99b0b7c"&&e("div",{class:"top-menu",children:[e(ie,{onClick:()=>{confirm("Reload page now to update?")&&(async()=>{try{location.reload()}catch{}})()},children:[e(w,{icon:"sparkles",class:"sparkle-icon",size:"l"})," ",e("span",{children:"New update available…"})]}),e(Ee,{})]}),e("section",{children:[e(Re,{to:"/",children:[e(w,{icon:"home",size:"l"})," ",e("span",{children:"Home"})]}),a&&e(A,{children:[d&&e(Re,{to:"/following",children:[e(w,{icon:"following",size:"l"})," ",e("span",{children:"Following"})]}),e(Re,{to:"/mentions",children:[e(w,{icon:"at",size:"l"})," ",e("span",{children:"Mentions"})]}),e(Re,{to:"/notifications",children:[e(w,{icon:"notification",size:"l"})," ",e("span",{children:"Notifications"}),n.notificationsShowNew&&e("sup",{title:"New",style:{opacity:.5},children:[" ","•"]})]}),e(Ee,{}),e(Re,{to:"/l",children:[e(w,{icon:"list",size:"l"})," ",e("span",{children:"Lists"})]}),e(Re,{to:"/ft",children:[e(w,{icon:"hashtag",size:"l"})," ",e("span",{children:"Followed Hashtags"})]}),e(Re,{to:"/b",children:[e(w,{icon:"bookmark",size:"l"})," ",e("span",{children:"Bookmarks"})]}),e(Re,{to:"/f",children:[e(w,{icon:"heart",size:"l"})," ",e("span",{children:"Likes"})]})]}),e(Ee,{}),e(Re,{to:"/search",children:[e(w,{icon:"search",size:"l"})," ",e("span",{children:"Search"})]}),e(Re,{to:`/${o}/p/l`,children:[e(w,{icon:"building",size:"l"})," ",e("span",{children:"Local"})]}),e(Re,{to:`/${o}/p`,children:[e(w,{icon:"earth",size:"l"})," ",e("span",{children:"Federated"})]}),e(Re,{to:`/${o}/trending`,children:[e(w,{icon:"chart",size:"l"})," ",e("span",{children:"Trending"})]})]}),e("section",{children:a?e(A,{children:[e(Ee,{}),((L=s==null?void 0:s.info)==null?void 0:L.id)&&e(Re,{to:`/${o}/a/${s.info.id}`,children:[e(w,{icon:"user",size:"l"})," ",e("span",{children:"Profile"})]}),e(ie,{onClick:()=>{I.showAccounts=!0},children:[e(w,{icon:"group",size:"l"})," ",e("span",{children:"Accounts…"})]}),e(ie,{onClick:()=>{I.showGenericAccounts={id:"mute",heading:"Muted users",fetchAccounts:S,excludeRelationshipAttrs:["muting"]}},children:[e(w,{icon:"mute",size:"l"})," Muted users…"]}),e(ie,{onClick:()=>{I.showGenericAccounts={id:"block",heading:"Blocked users",fetchAccounts:b,excludeRelationshipAttrs:["blocking"]}},children:[e(w,{icon:"block",size:"l"}),"Blocked users…"]}),e(Ee,{className:"divider-grow"}),e(ie,{onClick:()=>{I.showKeyboardShortcutsHelp=!0},children:[e(w,{icon:"keyboard",size:"l"})," ",e("span",{children:"Keyboard shortcuts"})]}),e(ie,{onClick:()=>{I.showShortcutsSettings=!0},children:[e(w,{icon:"shortcut",size:"l"})," ",e("span",{children:"Shortcuts / Columns…"})]}),e(ie,{onClick:()=>{I.showSettings=!0},children:[e(w,{icon:"gear",size:"l"})," ",e("span",{children:"Settings…"})]})]}):e(A,{children:[e(Ee,{}),e(Re,{to:"/login",children:[e(w,{icon:"user",size:"l"})," ",e("span",{children:"Log in"})]}),e(ie,{onClick:()=>{I.showSettings=!0},children:[e(w,{icon:"gear",size:"l"})," ",e("span",{children:"Settings…"})]})]})})]})]})}const yt={block:"nearest",inline:"center",behavior:"smooth"};function We({title:t,titleComponent:n,id:i,instance:o,emptyText:a,errorText:s,useItemID:u,boostsCarousel:l,fetchItems:c=()=>{},checkForUpdates:d=()=>{},checkForUpdatesInterval:h=15e3,headerStart:r,headerEnd:p,timelineStart:f,refresh:g,view:m,filterContext:S,showFollowedTags:y}){const b=Se(I),[v,k]=$([]),[T,x]=$("default"),[L,N]=$(!1),[B,U]=$(!1),[P,R]=$(!0),C=D(),_=m!=="media",O=Us(H=>{U(!1),T!=="loading"&&(x("loading"),(async()=>{try{let{done:oe,value:Q}=await c(H);if(Array.isArray(Q)){const[ge,G]=Q.reduce((Z,ae)=>(ae._pinned?Z[0].push(ae):Z[1].push(ae),Z),[[],[]]);Q=G,_&&(l&&(Q=Yi(Q)),Q=Wi(Q)),ge.length&&(Q=ge.concat(Q)),k(H?Q:Z=>[...Z,...Q]),Q.length||(oe=!0),N(!oe)}else N(!1);x("default")}catch{x("error")}finally{O.cancel()}})())},1500,{leading:!0,trailing:!1}),K=".timeline-item, .timeline-item-alt",te=Le("j, shift+j",(H,oe)=>{const Q=document.activeElement.closest(K),ge=Q==null?void 0:Q.getBoundingClientRect(),G=Array.from(C.current.querySelectorAll(K));if(Q&&ge.top<C.current.clientHeight&&ge.bottom>0){const Z=G.indexOf(Q);let ae=G[Z+1];oe.shift&&(ae=G.find((fe,be)=>be>Z&&!fe.classList.contains("timeline-item-alt"))),ae&&(ae.focus(),ae.scrollIntoView(yt))}else{const Z=G.find(ae=>{const fe=ae.getBoundingClientRect();return fe.top>=44&&fe.left>=0});Z&&(Z.focus(),Z.scrollIntoView(yt))}}),Y=Le("k, shift+k",(H,oe)=>{const Q=document.activeElement.closest(K),ge=Q==null?void 0:Q.getBoundingClientRect(),G=Array.from(C.current.querySelectorAll(K));if(Q&&ge.top<C.current.clientHeight&&ge.bottom>0){const Z=G.indexOf(Q);let ae=G[Z-1];oe.shift&&(ae=G.findLast((fe,be)=>be<Z&&!fe.classList.contains("timeline-item-alt"))),ae&&(ae.focus(),ae.scrollIntoView(yt))}else{const Z=G.find(ae=>{const fe=ae.getBoundingClientRect();return fe.top>=44&&fe.left>=0});Z&&(Z.focus(),Z.scrollIntoView(yt))}}),ke=Le(["enter","o"],()=>{const H=document.activeElement.closest(K);H&&H.click()}),re=D(),[X,E]=$(!1);Xi({scrollableRef:C,distanceFromEnd:2,scrollThresholdStart:44},({scrollDirection:H,nearReachStart:oe,nearReachEnd:Q,reachStart:ge,reachEnd:G})=>{if(re.current){const Z=H==="end"&&!oe;re.current.hidden=Z}E(oe),ge&&O(!0)},[]),z(()=>{var H;(H=C.current)==null||H.scrollTo({top:0}),O(!0)},[]),z(()=>{O(!0)},[g]);const W=D(m);z(()=>{W.current!==m&&(W.current=m,k([]))},[m]);const ne=Ve(async({disableIdleCheck:H=!1}={})=>{const oe=C.current?getComputedStyle(C.current).pointerEvents==="none":!1;b.settings.autoRefresh&&C.current.scrollTop<16&&(H||window.__IDLE__)&&!so()&&!oe?O(!0):await d()&&U(!0)},[i,O,d,b.settings.autoRefresh]),le=D();return rt(H=>{if(H){const oe=Date.now()-le.current;(!le.current||oe>1e3*3)&&ne({disableIdleCheck:!0})}else le.current=Date.now();R(H)},[d,ne,b.settings.autoRefresh]),En(ne,P&&!B?h*(X?1:2):null),e(Bn.Provider,{value:S,children:e("div",{id:`${i}-page`,class:"deck-container",ref:H=>{C.current=H,te.current=H,Y.current=H,ke.current=H},tabIndex:"-1",children:e("div",{class:"timeline-deck deck",children:[e("header",{ref:re,onClick:H=>{var oe;H.target.closest("a, button")||(oe=C.current)==null||oe.scrollTo({top:0,behavior:"smooth"})},onDblClick:H=>{H.target.closest("a, button")||O(!0)},class:T==="loading"?"loading":"",children:[e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(gt,{}),r??e(ee,{to:"/",class:"button plain home-button",children:e(w,{icon:"home",size:"l"})})]}),t&&(n||e("h1",{children:t})),e("div",{class:"header-side",children:!!p&&p})]}),v.length>0&&T!=="loading"&&B&&e("button",{class:"updates-button shiny-pill",type:"button",onClick:()=>{var H;O(!0),(H=C.current)==null||H.scrollTo({top:0,behavior:"smooth"})},children:[e(w,{icon:"arrow-up"})," New posts"]})]}),!!f&&e("div",{class:`timeline-start ${T==="loading"?"loading":""}`,children:f}),v.length?e(A,{children:[e("ul",{class:`timeline ${m?`timeline-${m}`:""}`,children:[v.map(H=>e(eo,{status:H,instance:o,useItemID:u,filterContext:S,view:m,showFollowedTags:y},H.id+(H==null?void 0:H._pinned)+m)),L&&T==="loading"&&(m==="media"?null:e(A,{children:[e("li",{style:{height:"20vh"},children:e($e,{skeleton:!0})}),e("li",{style:{height:"25vh"},children:e($e,{skeleton:!0})})]}))]}),T==="default"&&(L?e(je,{root:C.current,rootMargin:`0px 0px ${screen.height*1.5}px 0px`,onChange:H=>{H&&O()},children:e("button",{type:"button",class:"plain block",onClick:()=>O(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}))]}):T==="loading"?e("ul",{class:"timeline",children:Array.from({length:5}).map((H,oe)=>m==="media"?e("div",{style:{height:"50vh"}}):e("li",{children:e($e,{skeleton:!0})},oe))}):T!=="error"&&e("p",{class:"ui-state",children:a}),T==="error"&&e("p",{class:"ui-state",children:[s,e("br",{}),e("br",{}),e("button",{type:"button",onClick:()=>O(!v.length),children:"Try again"})]})]})})})}function eo({status:t,instance:n,useItemID:i,filterContext:o,view:a,showFollowedTags:s}){const{id:u,reblog:l,items:c,type:d,_pinned:h}=t;h&&(i=!1);const r=(l==null?void 0:l.id)||u,p=n?`/${n}/s/${r}`:`/s/${r}`;let f="";d==="boosts"?f=`${c.length} Boosts`:d==="pinned"&&(f="Pinned posts");const g=d==="boosts"||d==="pinned";if(c){const S=lt(c,o);if(g)return S.sort((b,v)=>{const k=Ut(b.filtered,o),T=Ut(v.filtered,o);return k&&!T?1:!k&&T?-1:0}),e("li",{class:"timeline-item-carousel",children:e(to,{title:f,class:`${d}-carousel`,children:S.map(b=>{const{id:v,reblog:k,_pinned:T}=b,x=(k==null?void 0:k.id)||v,L=n?`/${n}/s/${x}`:`/s/${x}`;return T&&(i=!1),e("li",{children:e(ee,{class:"status-carousel-link timeline-item-alt",to:L,children:i?e($e,{statusID:v,instance:n,size:"s",contentTextWeight:!0,enableCommentHint:!0}):e($e,{status:b,instance:n,size:"s",contentTextWeight:!0,enableCommentHint:!0})})},v)})})},`timeline-${u}`);const y=S.length>3;return S.map((b,v)=>{const{id:k,_differentAuthor:T}=b,x=n?`/${n}/s/${k}`:`/s/${k}`,L=v>0&&v<S.length-1,N=b.sensitive&&!!b.spoilerText,B=!T&&N&&v>0||y&&L&&(d==="thread"||d==="conversation"&&!T&&!S[v-1]._differentAuthor&&!S[v+1]._differentAuthor),U=v===0,P=v===S.length-1;return e("li",{class:`timeline-item-container timeline-item-container-type-${d} timeline-item-container-${U?"start":P?"end":"middle"} ${T?"timeline-item-diff-author":""}`,children:e(ee,{class:"status-link timeline-item",to:x,children:B?e(no,{status:b,instance:n}):i?e($e,{statusID:k,instance:n,enableCommentHint:P,showFollowedTags:s}):e($e,{status:b,instance:n,enableCommentHint:P,showFollowedTags:s})})},`timeline-${k}`)})}const m=`timeline-${u+h}`;return a==="media"?i?e(Sn,{class:"timeline-item",parent:"li",statusID:u,instance:n},m):e(Sn,{class:"timeline-item",parent:"li",status:t,instance:n},m):e("li",{children:e(ee,{class:"status-link timeline-item",to:p,children:i?e($e,{statusID:u,instance:n,enableCommentHint:!0,showFollowedTags:s}):e($e,{status:t,instance:n,enableCommentHint:!0,showFollowedTags:s})})},m)}function to({title:t,class:n,children:i}){const o=D(),a=D(),s=D(),[u,l]=$(!1);return z(()=>{setTimeout(()=>{l(!0)},1)},[]),e("div",{class:`status-carousel ${n}`,children:[e("header",{children:[e("h3",{children:t}),e("span",{children:[e("button",{ref:a,type:"button",class:"small plain2",onClick:()=>{var c,d;(d=o.current)==null||d.scrollBy({left:-Math.min(320,(c=o.current)==null?void 0:c.offsetWidth),behavior:"smooth"})},children:e(w,{icon:"chevron-left"})})," ",e("button",{ref:s,type:"button",class:"small plain2",onClick:()=>{var c,d;(d=o.current)==null||d.scrollBy({left:Math.min(320,(c=o.current)==null?void 0:c.offsetWidth),behavior:"smooth"})},children:e(w,{icon:"chevron-right"})})]})]}),e("ul",{ref:o,children:[e(je,{class:"status-carousel-beacon",onChange:c=>{a.current&&(a.current.disabled=c)}}),i[0],u&&i.slice(1),e(je,{class:"status-carousel-beacon",onChange:c=>{s.current&&(s.current.disabled=c)}})]})]})}function no({status:t,instance:n}){const i=Se(I),{id:o,visibility:a}=t,s=zn(t),u=Ge(o,n);return e("article",{class:`status compact-thread ${a==="direct"?"visibility-direct":""}`,tabindex:"-1",children:[i.statusThreadNumber[u]?e("div",{class:"status-thread-badge",children:[e(w,{icon:"thread",size:"s"}),i.statusThreadNumber[u]?` ${i.statusThreadNumber[u]}/X`:""]}):e("div",{class:"status-thread-badge",children:e(w,{icon:"thread",size:"s"})}),e("div",{class:"content-compact",title:s,children:[s,t.sensitive&&t.spoilerText&&e(A,{children:[" ",e("span",{class:"spoiler-badge",children:e(w,{icon:"eye-close",size:"s"})})]})]})]})}function so(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}const at=20,Jt=1983,kn=`${Jt}-01`,io=(()=>{try{const t=document.createElement("input");return t.setAttribute("type","month"),t.type==="month"}catch{return!1}})();async function oo(t){var o;const{masto:n}=q({instance:t}),i=await n.v2.search.fetch({q:"from:me",type:"statuses",limit:1});return!!((o=i==null?void 0:i.statuses)!=null&&o.length)}const ao=nt(oo);function co(){const t=Se(I),{id:n,...i}=st(),[o,a]=qe(),s=o.get("month"),u=!o.get("replies"),l=!!o.get("boosts"),c=o.get("tagged"),d=!!o.get("media"),{masto:h,instance:r,authenticated:p}=q({instance:i.instance}),{masto:f,instance:g}=q(),m=D(),S=[s,u,l,c,d],[y,b]=$(),v=D(0);z(()=>{v.current=0},S);const k=he(()=>r===g,[r,g]),[T,x]=$(!1);z(()=>{k&&y!=null&&y.acct&&(async()=>{const X=await ao(r);x(X)})()},[r,k,y==null?void 0:y.acct]);async function L(X){var oe,Q,ge;const E=/^\d{4}-[01]\d$/.test(s),W=((Q=(oe=s==null?void 0:s.split)==null?void 0:oe.call(s,"-"))==null?void 0:Q[0])>=Jt;if(E&&W){if(!y)return{value:[],done:!0};const[G,Z]=s.split("-"),ae=parseInt(Z,10)-1,fe=new Date(G,ae,0),be=`${fe.getFullYear()}-${(fe.getMonth()+1).toString().padStart(2,"0")}-${fe.getDate().toString().padStart(2,"0")}`,de=new Date(G,ae+1,1),Xe=`${de.getFullYear()}-${(de.getMonth()+1).toString().padStart(2,"0")}-${de.getDate().toString().padStart(2,"0")}`;let M;X?(M=at+1,v.current=0):(M=at+v.current+1,v.current+=at);const V=await h.v2.search.fetch({q:`from:${y.acct} after:${be} before:${Xe}`,type:"statuses",limit:M,offset:v.current});if((ge=V==null?void 0:V.statuses)!=null&&ge.length){const j=V.statuses.slice(0,at);j.forEach(we=>{xe(we,r)});const ce=V.statuses.length<=at;return{value:j,done:ce}}else return{value:[],done:!0}}const ne=[];if(X){const{value:G}=await h.v1.accounts.$select(n).statuses.list({pinned:!0}).next();if(G!=null&&G.length&&!c&&!d){const Z=G.map(ae=>(xe(ae,r),{...ae,_pinned:!0}));if(Z.length>=3){const ae=Z.map(fe=>fe.id);ne.push({id:ae,items:Z,type:"pinned"})}else ne.push(...Z)}}(X||!m.current)&&(m.current=h.v1.accounts.$select(n).statuses.list({limit:at,exclude_replies:u,exclude_reblogs:l,only_media:d,tagged:c}));const{value:le,done:H}=await m.current.next();return le!=null&&le.length&&(ne.push(...le),le.forEach(G=>{xe(G,r)})),{value:ne,done:H}}const[N,B]=$([]);Me(y!=null&&y.acct?`${y!=null&&y.displayName?y.displayName+" ":""}@${y.acct}${u?l?" (- Boosts)":c?` (#${c})`:d?" (Media)":s?` (${new Date(s).toLocaleString("default",{month:"long",year:"numeric"})})`:"":" (+ Replies)"}`:"Account posts","/:instance?/a/:id");const U=D(),P=Ve(()=>{const X=U.current||h.v1.accounts.$select(n).fetch();return U.current=X,X},[n,h]);z(()=>{(async()=>{try{const X=await P();b(X)}catch{}try{const X=await h.v1.accounts.$select(n).featuredTags.list();B(X)}catch{}})()},[n]);const{displayName:R,acct:C,emojis:_}=y||{},O=he(()=>{const X=t.accounts[`${n}@${r}`];return e(Xn,{instance:r,account:X||n,fetchAccount:P,authenticated:p,standalone:!0})},[n,r,p,P]),K=D(),te=he(()=>e(A,{children:[O,e("div",{class:"filter-bar",ref:K,style:{position:"relative"},children:[!u||l||c||d||!!s?e(ee,{to:`/${r}/a/${n}`,class:"insignificant filter-clear",title:"Clear filters",children:e(w,{icon:"x",size:"l"})},"clear-filters"):e(w,{icon:"filter",class:"insignificant",size:"l"}),e(ee,{to:`/${r}/a/${n}${u?"?replies=1":""}`,onClick:()=>{u&&me("Showing post with replies")},class:u?"":"is-active",children:"+ Replies"}),e(ee,{to:`/${r}/a/${n}${l?"":"?boosts=0"}`,onClick:()=>{l||me("Showing posts without boosts")},class:l?"is-active":"",children:"- Boosts"}),e(ee,{to:`/${r}/a/${n}${d?"":"?media=1"}`,onClick:()=>{d||me("Showing posts with media")},class:d?"is-active":"",children:"Media"}),N.map(E=>e(ee,{to:`/${r}/a/${n}${c===E.name?"":`?tagged=${encodeURIComponent(E.name)}`}`,onClick:()=>{c!==E.name&&me(`Showing posts tagged with #${E.name}`)},class:c===E.name?"is-active":"",children:e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),E.name]})},E.id)),T&&(io?e("label",{class:`filter-field ${s?"is-active":""}`,children:[e(w,{icon:"month",size:"l"}),e("input",{type:"month",disabled:!(y!=null&&y.acct),value:s||"",min:kn,max:new Date().toISOString().slice(0,7),onInput:E=>{const{value:W,validity:ne}=E.currentTarget;if(!ne.valid)return;a(W?{month:W}:{});const[le,H]=W.split("-"),oe=parseInt(H,10)-1,Q=new Date(le,oe);me(`Showing posts in ${Q.toLocaleString("default",{month:"long",year:"numeric"})}`)}})]}):e(ro,{class:`filter-field ${s?"is-active":""}`,disabled:!(y!=null&&y.acct),value:s||"",min:kn,max:new Date().toISOString().slice(0,7),onInput:E=>{const{value:W,validity:ne}=E;ne.valid&&a(W?{month:W}:{})}}))]})]}),[n,r,p,N,T,...S]);z(()=>{var E;const X=(E=K.current)==null?void 0:E.querySelector(".is-active");X&&K.current.scrollTo({behavior:"smooth",left:X.offsetLeft-(K.current.offsetWidth-X.offsetWidth)/2})},[N,T,...S]);const Y=he(()=>y!=null&&y.url?new URL(y.url).hostname:null,[y]),re=!!y&&!(r===Y);return e(We,{title:`${y!=null&&y.acct?"@"+y.acct:"Posts"}`,titleComponent:e("h1",{class:"header-double-lines header-account",children:[e("b",{children:e(Dn,{text:R,emojis:_})}),e("div",{children:e("span",{children:["@",C]})})]}),id:"account-statuses",instance:r,emptyText:"Nothing to see here yet.",errorText:"Unable to load posts",fetchItems:L,useItemID:!0,view:d?"media":void 0,boostsCarousel:t.settings.boostsCarousel,timelineStart:te,refresh:[u,l,c,d,s+(y==null?void 0:y.acct)].toString(),headerEnd:e(Fe,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[e(ie,{disabled:!re,onClick:()=>{(async()=>{try{const{masto:X}=q({instance:Y}),E=await X.v1.accounts.lookup({acct:y.acct}),{id:W}=E;location.hash=`/${Y}/a/${W}`}catch{alert("Unable to fetch account info")}})()},children:[e(w,{icon:"transfer"})," ",e("small",{class:"menu-double-lines",children:["Switch to account's instance (",e("b",{children:Y}),")"]})]}),!k&&e(ie,{onClick:()=>{(async()=>{try{const X=await f.v1.accounts.lookup({acct:y.acct+"@"+r}),{id:E}=X;location.hash=`/${g}/a/${E}`}catch{alert("Unable to fetch account info")}})()},children:[e(w,{icon:"transfer"})," ",e("small",{class:"menu-double-lines",children:["Switch to my instance (",e("b",{children:g}),")"]})]})]})},n)}function ro(t){const{class:n,disabled:i,value:o,min:a,max:s,onInput:u=()=>{}}=t,[l,c]=(o==null?void 0:o.split("-"))||[],d=D(),h=D(),r=(p,f)=>{const[g,m]=(a==null?void 0:a.split("-"))||[],[S,y]=(s==null?void 0:s.split("-"))||[];return!(f<g||f>S||f===g&&p<m||f===S&&p>y)};return e("div",{class:n,children:[e(w,{icon:"month",size:"l"}),e("select",{ref:d,disabled:i,value:c||"",onInput:p=>{const{value:f}=p.currentTarget,g=h.current.value;if(!r(f,g))return{value:"",validity:{valid:!1}};u({value:f?`${g}-${f}`:"",validity:{valid:!0}})},children:[e("option",{value:"",children:"Month"}),e("option",{disabled:!0,children:"-----"}),Array.from({length:12},(p,f)=>e("option",{value:(f+1).toString().padStart(2,"0"),children:new Date(0,f).toLocaleString("default",{month:"long"})},f))]})," ",e("input",{ref:h,type:"number",disabled:i,value:l||new Date().getFullYear(),min:(a==null?void 0:a.slice(0,4))||Jt,max:(s==null?void 0:s.slice(0,4))||new Date().getFullYear(),onInput:p=>{const{value:f,validity:g}=p.currentTarget,m=d.current.value;if(!g.valid||!r(m,f))return{value:"",validity:{valid:!1}};u({value:f?`${f}-${m}`:"",validity:{valid:!0}})},style:{width:"4.5em"}})]})}const lo=20;function is(){Me("Bookmarks","/b");const{masto:t,instance:n}=q(),i=D();async function o(a){return(a||!i.current)&&(i.current=t.v1.bookmarks.list({limit:lo})),await i.current.next()}return e(We,{title:"Bookmarks",id:"bookmarks",emptyText:"No bookmarks yet. Go bookmark something!",errorText:"Unable to load bookmarks",instance:n,fetchItems:o})}const uo=20;function os(){Me("Likes","/f");const{masto:t,instance:n}=q(),i=D();async function o(a){return(a||!i.current)&&(i.current=t.v1.favourites.list({limit:uo})),await i.current.next()}return e(We,{title:"Likes",id:"favourites",emptyText:"No likes yet. Go like something!",errorText:"Unable to load likes",instance:n,fetchItems:o})}function ho(){const{masto:t,instance:n}=q();Me("Followed Hashtags","/ft");const[i,o]=$("default"),[a,s]=$([]);return z(()=>{o("loading"),(async()=>{try{const u=await $t();s(u),o("default")}catch{o("error")}})()},[]),e("div",{id:"followed-hashtags-page",class:"deck-container",tabIndex:"-1",children:e("div",{class:"timeline-deck deck",children:[e("header",{children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(gt,{}),e(ee,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l"})})]}),e("h1",{children:"Followed Hashtags"}),e("div",{class:"header-side"})]})}),e("main",{children:a.length>0?e("ul",{class:"link-list",children:a.map(u=>e("li",{children:e(ee,{to:n?`/${n}/t/${u.name}`:`/t/${u.name}`,children:[e(w,{icon:"hashtag"})," ",e("span",{children:u.name})]})}))}):i==="loading"?e("p",{class:"ui-state",children:e(Te,{abrupt:!0})}):i==="error"?e("p",{class:"ui-state",children:"Unable to load followed hashtags."}):e("p",{class:"ui-state",children:"No hashtags followed yet."})})]})})}const fo=20;function Xt({title:t,path:n,id:i,...o}){Me(t||"Following",n||"/following");const{masto:a,streaming:s,instance:u}=q(),l=Se(I),c=D(),d=D();async function h(p){(p||!c.current)&&(c.current=a.v1.timelines.home.list({limit:fo}));const f=await c.current.next();let{value:g}=f;if(g!=null&&g.length){let m=!1;p&&(g[0].id!==d.current&&(m=!0),d.current=g[0].id),g.forEach(S=>{xe(S,u)}),g=vn(g,u),p&&m&&Zi(),Ki(g,u),g.sort((S,y)=>{const b=new Date(S.createdAt);return new Date(y.createdAt)-b})}return{...f,value:g}}async function r(){try{const p=await a.v1.timelines.home.list({limit:5,since_id:d.current}).next();let{value:f}=p;return!!(f!=null&&f.length&&(d.current=f[0].id,f=vn(f,u),f=lt(f,"home"),f.some(g=>!g.reblog)))}catch{return!1}}return z(()=>{let p;return(async()=>{if(s){p=s.user.subscribe();for await(const f of p){if(!p)break;if(f.event==="status.update"){const g=f.payload;xe(g,u)}else if(f.event==="delete"){const g=f.payload,m=qn(g,u);m&&(m._deleted=!0)}}}})(),()=>{var f;(f=p==null?void 0:p.unsubscribe)==null||f.call(p),p=null}},[s]),e(We,{title:t||"Following",id:i||"following",emptyText:"Nothing to see here.",errorText:"Unable to load posts.",instance:u,fetchItems:h,checkForUpdates:r,useItemID:!0,boostsCarousel:l.settings.boostsCarousel,...o,filterContext:"home",showFollowedTags:!0})}const po=20,mo=4,In=mo+1;function as({media:t,columnMode:n,...i}){let{hashtag:o,...a}=n?{}:st();i.hashtag&&(o=i.hashtag);let s=o.trim().split(/[\s+]+/);s.sort(),o=s[0];const[u,l]=qe(),c=t||!!u.get("media"),d=c?"?media=1":"",{masto:h,instance:r,authenticated:p}=q({instance:(i==null?void 0:i.instance)||a.instance}),{masto:f,instance:g,authenticated:m}=q(),S=s.map(R=>`#${R}`).join(" "),y=c?" (Media only)":"",b=r?`${S}${y} on ${r}`:`${S}${y}`;Me(b,"/:instance?/t/:hashtag");const v=D(),k=D(void 0);async function T(R){const C=await h.v1.timelines.tag.$select(o).list({limit:po,any:s.slice(1),maxId:R?void 0:k.current,onlyMedia:c}).next();let{value:_}=C;return _!=null&&_.length&&(R&&(v.current=_[0].id),_.forEach(O=>{xe(O,r,{skipThreading:c})}),k.current=_[_.length-1].id),{...C,value:_}}async function x(){try{const R=await h.v1.timelines.tag.$select(o).list({limit:1,any:s.slice(1),since_id:v.current,onlyMedia:c}).next();let{value:C}=R;return C=lt(C,"public"),!!(C!=null&&C.length)}catch{return!1}}const[L,N]=$("default"),[B,U]=$();z(()=>{(async()=>{try{const R=await h.v1.tags.$select(o).fetch();U(R)}catch{}})()},[o]);const P=s.length>=In;return e(We,{title:b,titleComponent:!!r&&e("h1",{class:"header-double-lines",children:[e("b",{children:S}),e("div",{children:r})]}),id:"hashtag",instance:r,emptyText:"No one has posted anything with this tag yet.",errorText:"Unable to load posts with this tag",fetchItems:T,checkForUpdates:x,useItemID:!0,view:c?"media":void 0,refresh:c,filterContext:"public",headerEnd:e(Fe,{portal:!0,setDownOverflow:!0,overflow:"auto",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[!!B&&s.length===1&&e(A,{children:[e(Be,{subMenu:!0,confirm:B.following,confirmLabel:`Unfollow #${o}?`,disabled:L==="loading"||!p,onClick:()=>{N("loading"),B.following?h.v1.tags.$select(o).unfollow().then(()=>{U({...B,following:!1}),me(`Unfollowed #${o}`)}).catch(R=>{alert(R)}).finally(()=>{N("default")}):h.v1.tags.$select(o).follow().then(()=>{U({...B,following:!0}),me(`Followed #${o}`)}).catch(R=>{alert(R)}).finally(()=>{N("default")})},children:B.following?e(A,{children:[e(w,{icon:"check-circle"})," ",e("span",{children:"Following…"})]}):e(A,{children:[e(w,{icon:"plus"})," ",e("span",{children:"Follow"})]})}),e(Ee,{})]}),e(Yn,{className:"plain",children:"Filters"}),e(ie,{type:"checkbox",checked:!!c,onClick:()=>{c?u.delete("media"):u.set("media","1"),l(u)},children:[e(w,{icon:"check-circle"})," ",e("span",{class:"menu-grow",children:"Media only"})]}),e(Ee,{}),e(Fs,{className:"menu-field",disabled:P,children:({ref:R})=>e("form",{onSubmit:C=>{var O,K;C.preventDefault();const _=(K=(O=C.target[0].value)==null?void 0:O.trim)==null?void 0:K.call(O);_&&!s.some(te=>te.toLowerCase()===_.toLowerCase())&&(s.push(_),s.sort(),location.hash=r?`/${r}/t/${s.join("+")}`:`/t/${s.join("+")}${d}`)},children:[e(w,{icon:"hashtag"}),e("input",{ref:R,type:"text",placeholder:P?`Max ${In} tags`:"Add hashtag",required:!0,autocorrect:"off",autocapitalize:"off",spellcheck:!1,pattern:"[^#][^\\s#]+[^#]",disabled:P})]})}),e(Os,{takeOverflow:!0,children:s.map((R,C)=>e(ie,{disabled:s.length===1,onClick:_=>{s.splice(C,1),s.sort(),location.hash=r?`/${r}/t/${s.join("+")}${d}`:`/t/${s.join("+")}${d}`},children:[e(w,{icon:"x",alt:"Remove hashtag",class:"danger-icon"}),e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),R]})]},R))}),e(Ee,{}),e(ie,{disabled:!m,onClick:()=>{if(I.shortcuts.length>=Je){alert(`Max ${Je} shortcuts reached. Unable to add shortcut.`);return}const R={type:"hashtag",hashtag:s.join(" "),instance:r,media:c?"on":void 0};I.shortcuts.some(_=>_.type===R.type&&_.hashtag.split(/[\s+]+/).sort().join(" ")===R.hashtag.split(/[\s+]+/).sort().join(" ")&&(_.instance?_.instance===R.instance:!0)&&(_.media?!!_.media==!!R.media:!0))?alert("This shortcut already exists"):(I.shortcuts.push(R),me("Hashtag shortcut added"))},children:[e(w,{icon:"shortcut"})," ",e("span",{children:"Add to Shorcuts"})]}),e(ie,{onClick:()=>{let R=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(R)){R&&alert("Invalid instance");return}R&&(R=R.toLowerCase().trim(),location.hash=`/${R}/t/${s.join("+")}${d}`)},children:[e(w,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]}),g!==r&&e(ie,{onClick:()=>{location.hash=`/${g}/t/${s.join("+")}${d}`},children:[e(w,{icon:"bus"})," ",e("small",{class:"menu-double-lines",children:["Go to my instance (",e("b",{children:g}),")"]})]})]})},r+S)}const go=20;function cs(t){var m;const n=Se(I),{masto:i,instance:o}=q(),a=(t==null?void 0:t.id)||((m=st())==null?void 0:m.id),s=D(),u=D();async function l(S){(S||!u.current)&&(u.current=i.v1.timelines.list.$select(a).list({limit:go}));const y=await u.current.next();let{value:b}=y;return b!=null&&b.length&&(S&&(s.current=b[0].id),b.forEach(v=>{xe(v,o)})),{...y,value:b}}async function c(){try{const S=await i.v1.timelines.list.$select(a).list({limit:1,since_id:s.current});let{value:y}=S;return y=lt(y,"home"),!!(y!=null&&y.length)}catch{return!1}}const[d,h]=$({title:"List"});Me(d.title,"/l/:id"),z(()=>{(async()=>{try{const S=await i.v1.lists.$select(a).fetch();h(S)}catch{}})()},[a]);const[r,p]=$(!1),[f,g]=$(!1);return e(A,{children:[e(We,{title:d.title,id:"list",emptyText:"Nothing yet.",errorText:"Unable to load posts.",instance:o,fetchItems:l,checkForUpdates:c,useItemID:!0,boostsCarousel:n.settings.boostsCarousel,filterContext:"home",headerStart:e(ee,{to:"/l",class:"button plain",children:e(w,{icon:"list",size:"l"})}),headerEnd:e(Fe,{portal:!0,setDownOverflow:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[e(ie,{onClick:()=>p({list:d}),children:[e(w,{icon:"pencil",size:"l"}),e("span",{children:"Edit"})]}),e(ie,{onClick:()=>g(!0),children:[e(w,{icon:"group",size:"l"}),e("span",{children:"Manage members"})]})]})},a),r&&e(Ie,{class:"light",onClick:S=>{S.target===S.currentTarget&&p(!1)},children:e(Wt,{list:r==null?void 0:r.list,onClose:S=>{S.state==="success"&&S.list?h(S.list):S.state==="deleted"&&(location.hash="/l"),p(!1)}})}),f&&e(Ie,{class:"light",onClick:S=>{S.target===S.currentTarget&&g(!1)},children:e(yo,{listID:a,onClose:()=>g(!1)})})]})}const bo=40;function yo({listID:t,onClose:n}){const{masto:i,instance:o}=q(),[a,s]=$([]),[u,l]=$("default"),[c,d]=$(!1),h=D();async function r(p){d(!1),l("loading"),(async()=>{try{(p||!h.current)&&(h.current=i.v1.lists.$select(t).accounts.list({limit:bo}));const f=await h.current.next();let{done:g,value:m}=f;m!=null&&m.length?(s(p?m:a.concat(m)),d(!g)):d(!1),l("default")}catch{l("error")}})()}return z(()=>{r(!0)},[]),e("div",{class:"sheet",id:"list-manage-members-container",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Manage members"})}),e("main",{children:e("ul",{children:[a.map(p=>e("li",{children:[e(He,{account:p,instance:o}),e(wo,{account:p,listID:t})]},p.id)),c&&u==="default"&&e(je,{as:"li",onChange:p=>p&&r(),children:e("button",{type:"button",class:"light block",onClick:r,children:"Show more…"})})]})})]})}function wo({account:t,listID:n}){const{masto:i}=q(),[o,a]=$("default"),[s,u]=$(!1);return e(Be,{confirm:!s,confirmLabel:e("span",{children:["Remove @",t.username," from list?"]}),align:"end",menuItemClassName:"danger",onClick:()=>{s?(a("loading"),(async()=>{try{await i.v1.lists.$select(n).accounts.create({accountIds:[t.id]}),a("default"),u(!1)}catch{a("error")}})()):(a("loading"),(async()=>{try{await i.v1.lists.$select(n).accounts.remove({accountIds:[t.id]}),a("default"),u(!0)}catch{a("error")}})())},children:e("button",{type:"button",class:`light ${s?"":"danger"}`,disabled:o==="loading",children:s?"Add":"Remove…"})})}const Tn=20,vo=new URLSearchParams;function rs({columnMode:t,...n}){const{masto:i,instance:o}=q(),[a]=t?[vo]:qe(),[s,u]=$(null),l=(n==null?void 0:n.type)||a.get("type")||s;Me(`Mentions${l==="private"?" (Private)":""}`,"/mentions");const c=D(),d=D();async function h(y){(y||!c.current)&&(c.current=i.v1.notifications.list({limit:Tn,types:["mention"]}));const b=await c.current.next();let{value:v}=b;return v!=null&&v.length&&(y&&(d.current=v[0].id),v.forEach(({status:k})=>{xe(k,o)})),{...b,value:v==null?void 0:v.map(k=>k.status)}}const r=D(),p=D();async function f(y){(y||!r.current)&&(r.current=i.v1.conversations.list({limit:Tn}));const b=await r.current.next();let{value:v}=b;return v=v==null?void 0:v.filter(k=>k.lastStatus),v!=null&&v.length&&(y&&(p.current=v[0].lastStatus.id),v.forEach(({lastStatus:k})=>{xe(k,o)})),{...b,value:v==null?void 0:v.map(k=>k.lastStatus)}}function g(...y){return l==="private"?f(...y):h(...y)}async function m(){if(l==="private")try{const y=await i.v1.conversations.list({limit:1,since_id:p.current}).next();let{value:b}=y;return b!=null&&b.length?(p.current=b[0].lastStatus.id,!0):!1}catch{return!1}else try{const y=await i.v1.notifications.list({limit:1,types:["mention"],since_id:d.current}).next();let{value:b}=y;return b!=null&&b.length?(d.current=b[0].id,!0):!1}catch{return!1}}const S=he(()=>e("div",{class:"filter-bar centered",children:[e(ee,{to:"/mentions",class:l?"":"is-active",onClick:y=>{t&&(y.preventDefault(),u(null))},children:"All"}),e(ee,{to:"/mentions?type=private",class:l==="private"?"is-active":"",onClick:y=>{t&&(y.preventDefault(),u("private"))},children:"Private"})]}),[l]);return e(We,{title:"Mentions",id:"mentions",emptyText:"No one mentioned you :(",errorText:"Unable to load mentions.",instance:o,fetchItems:g,checkForUpdates:m,useItemID:!0,timelineStart:S,refresh:l})}const So={mention:["account","status"],status:["account","status"],reblog:["account","status"],follow:["account"],follow_request:["account"],favourite:["account","status"],poll:["status"],update:["status"]};function ko(t){return t.filter(n=>{const{type:i,id:o,createdAt:a}=n;if(!i)return!1;const s=So[i];return s!=null&&s.length?s.every(u=>!!n[u]):!0})}function ls(t){t=ko(t);const n={},i=[];for(let s=0,u=0;s<t.length;s++){const l=t[s],{id:c,status:d,account:h,type:r,createdAt:p}=l,f=p?new Date(p).toLocaleDateString():"";let g=r;(r==="favourite"||r==="reblog")&&(g="favourite+reblog");const m=`${d==null?void 0:d.id}-${g}-${f}`,S=n[m];if(g==="follow_request")i[u++]=l;else if(S!=null&&S.account){const y=S._accounts.find(b=>b.id===h.id);y?(y._types.push(r),y._types.sort().reverse(),S.id+=`-${c}`):(h._types=[r],S._accounts.push(h),S.id+=`-${c}`)}else{h._types=[r];let y=n[m]={...l,type:g,_accounts:[h]};i[u++]=y}}const o={},a=[];for(let s=0,u=0;s<i.length;s++){const l=i[s],{id:c,account:d,_accounts:h,type:r,createdAt:p}=l,f=p?new Date(p).toLocaleDateString():"";if(r==="favourite+reblog"&&d&&h.length===1){const g=`${d==null?void 0:d.id}-${r}-${f}`,m=o[g];if(m)m._statuses.push(l.status),m.id+=`-${c}`;else{let S=o[g]={...l,type:r,_statuses:[l.status]};a[u++]=S}}else a[u++]=l}return a}const Io=30,To=new URLSearchParams;function Co({columnMode:t}){Me("Notifications","/notifications");const{masto:n,instance:i}=q(),o=Se(I),[a,s]=$("default"),[u]=t?[To]:qe(),l=u.get("id"),c=u.get("access_token"),[d,h]=$(!1),[r,p]=$(!1),f=D(),{nearReachEnd:g,scrollDirection:m,reachStart:S,nearReachStart:y}=Ji({scrollableRef:f}),b=m==="end"&&!y,[v,k]=$([]),[T,x]=$([]),L=D();async function N(E){(E||!L.current)&&(L.current=n.v1.notifications.list({limit:Io,excludeTypes:["follow_request"]}));const W=await L.current.next(),ne=W.value;if(ne!=null&&ne.length){ne.forEach(H=>{xe(H.status,i,{skipThreading:!0})});const le=ls(ne);E?(I.notificationsLast=ne[0],I.notifications=le,n.v1.markers.create({notifications:{lastReadId:ne[0].id}}).catch(()=>{})):I.notifications.push(...le)}return I.notificationsShowNew=!1,I.notificationsLastFetchTime=Date.now(),W}async function B(){try{return await n.v1.followRequests.list({limit:80})}catch{return[]}}const U=()=>{s("loading"),(async()=>{try{const E=await B();k(E),s("default")}catch{s("error")}})()};async function P(){try{return await n.v1.announcements.list()}catch{return[]}}const R=E=>{_(!1),s("loading"),(async()=>{try{const W=N(E);E&&(P().then(le=>{le.sort((H,oe)=>{const Q=new Date(H.updatedAt||H.createdAt);return new Date(oe.updatedAt||oe.createdAt)-Q}),x(le)}).catch(()=>{}),B().then(le=>{k(le)}).catch(()=>{}));const{done:ne}=await W;h(!ne),s("default")}catch{s("error")}})()};z(()=>{R(!0)},[]),z(()=>{S&&R(!0)},[S]);const[C,_]=$(!1),O=Ve(({disableIdleCheck:E=!1}={})=>{var W;a!=="loading"&&o.settings.autoRefresh&&((W=f.current)==null?void 0:W.scrollTop)<16&&(E||window.__IDLE__)&&!$o()&&R(!0)},[o.notificationsShowNew,o.settings.autoRefresh,a]),K=D();rt(E=>{let W;if(E){const ne=Date.now()-K.current;!K.current||ne>1e3*3?O({disableIdleCheck:!0}):K.current=Date.now(),W=Bs(I,"notificationsShowNew",le=>{le&&O(),_(le)})}return()=>{W==null||W()}});const te=new Date,Y=new Date(te-24*60*60*1e3);let ke=new Date;const re=!o.notifications.some(E=>new Date(E.createdAt).toDateString()===te.toDateString()),X=D();return z(()=>{l&&(I.routeNotification={id:l,accessToken:atob(c)})},[l,c]),e("div",{id:"notifications-page",class:"deck-container",ref:f,tabIndex:"-1",children:e("div",{class:`timeline-deck deck ${r?"only-mentions":""}`,children:[e("header",{hidden:b,onClick:E=>{var W;E.target.closest("a, button")||(W=f.current)==null||W.scrollTo({top:0,behavior:"smooth"})},class:a==="loading"?"loading":"",children:[e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(gt,{}),e(ee,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l",alt:"Home"})})]}),e("h1",{children:"Notifications"}),e("div",{class:"header-side"})]}),C&&a!=="loading"&&e("button",{class:"updates-button shiny-pill",type:"button",onClick:()=>{var E;R(!0),(E=f.current)==null||E.scrollTo({top:0,behavior:"smooth"})},children:[e(w,{icon:"arrow-up"})," New notifications"]})]}),T.length>0&&e("div",{class:"shazam-container",children:e("div",{class:"shazam-container-inner",children:e("details",{class:"announcements",children:[e("summary",{children:[e("span",{children:[e(w,{icon:"announce",class:"announcement-icon",size:"l"})," ",e("b",{children:["Announcement",T.length>1?"s":""]})," ",e("small",{class:"insignificant",children:i})]}),T.length>1&&e("span",{class:"announcements-nav-buttons",children:T.map((E,W)=>e("button",{type:"button",class:"plain2 small",onClick:()=>{var ne;(ne=X.current)==null||ne.children[W].scrollIntoView({behavior:"smooth",block:"nearest"})},children:W+1}))})]}),e("ul",{class:`announcements-list-${T.length>1?"multiple":"single"}`,ref:X,children:T.map(E=>e("li",{children:e(xo,{announcement:E})}))})]})})}),v.length>0&&e("div",{class:"follow-requests",children:[e("h2",{class:"timeline-header",children:"Follow requests"}),v.length>5?e("details",{children:[e("summary",{children:[v.length," follow requests"]}),e("ul",{children:v.map(E=>e("li",{children:[e(He,{account:E}),e(Bt,{accountID:E.id,onChange:()=>{}})]},E.id))})]}):e("ul",{children:v.map(E=>e("li",{children:[e(He,{account:E}),e(Bt,{accountID:E.id,onChange:()=>{}})]},E.id))})]}),e("div",{id:"mentions-option",children:e("label",{children:[e("input",{type:"checkbox",checked:r,onChange:E=>{p(E.target.checked)}})," ","Only mentions"]})}),e("h2",{class:"timeline-header",children:"Today"}),re&&!!o.notifications.length&&e("p",{class:"ui-state insignificant",children:a==="default"?"You're all caught up.":e(A,{children:"…"})}),o.notifications.length?e(A,{children:o.notifications.filter(E=>E.type!=="follow_request").map(E=>{if(r&&E.type!=="mention")return null;const W=new Date(E.createdAt),ne=W.toDateString()!==ke.toDateString();ne&&(ke=W);const le=W.toDateString()===Y.toDateString()?"Yesterday":Ze(ke,{hideTime:!0});return e(A,{children:[ne&&e("h2",{class:"timeline-header",children:le}),e(Zt,{instance:i,notification:E},E.id)]},E.id)})}):e(A,{children:[a==="loading"&&e(A,{children:e("ul",{class:"timeline flat",children:Array.from({length:5}).map((E,W)=>e("li",{class:"notification skeleton",children:[e("div",{class:"notification-type",children:e(w,{icon:"notification",size:"xl"})}),e("div",{class:"notification-content",children:e("p",{children:"███████████ ████"})})]}))})}),a==="error"&&e("p",{class:"ui-state",children:["Unable to load notifications",e("br",{}),e("br",{}),e("button",{type:"button",onClick:()=>R(!0),children:"Try again"})]})]}),d&&e(je,{onChange:E=>{E&&R()},children:e("button",{type:"button",class:"plain block",disabled:a==="loading",onClick:()=>R(),style:{marginBlockEnd:"6em"},children:a==="loading"?e(Te,{abrupt:!0}):e(A,{children:"Show more…"})})})]})})}function $o(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}function xo({announcement:t}){const{instance:n}=q(),{contact:i}=$s(),o=i==null?void 0:i.account,{id:a,content:s,startsAt:u,endsAt:l,published:c,allDay:d,publishedAt:h,updatedAt:r,read:p,mentions:f,statuses:g,tags:m,emojis:S,reactions:y}=t,b=new Date(h),v=Ze(b),k=new Date(r),T=Ze(k);return e("div",{class:"announcement-block",children:[e(He,{account:o}),e("div",{class:"announcement-content",onClick:Nn({mentions:f,instance:n}),dangerouslySetInnerHTML:{__html:Dt(s,{emojis:S})}}),e("p",{class:"insignificant",children:[e("time",{datetime:b.toISOString(),children:Ze(b)}),r&&T!==v&&e(A,{children:[" ","•"," ",e("span",{class:"ib",children:["Updated"," ",e("time",{datetime:k.toISOString(),children:Ze(k)})]})]})]}),e("div",{class:"announcement-reactions",hidden:!0,children:y.map(x=>{const{name:L,count:N,me:B,staticUrl:U,url:P}=x;return e("button",{type:"button",class:`plain4 small ${B?"reacted":""}`,children:[P||U?e("img",{src:P||U,alt:L,width:"16",height:"16"}):e("span",{children:L})," ",e("span",{class:"count",children:Ne(N)})]})})})]})}const ds=ze(Co),Ao=20;function zt({local:t,columnMode:n,...i}){const o=Se(I),a=!!t,s=n?{}:st(),{masto:u,instance:l}=q({instance:(i==null?void 0:i.instance)||s.instance}),{masto:c,instance:d}=q(),h=`${a?"Local":"Federated"} timeline (${l})`;Me(h,a?"/:instance?/p/l":"/:instance?/p");const r=D(),p=D();async function f(m){(m||!p.current)&&(p.current=u.v1.timelines.public.list({limit:Ao,local:a}));const S=await p.current.next();let{value:y}=S;return y!=null&&y.length&&(m&&(r.current=y[0].id),y.forEach(b=>{xe(b,l)})),{...S,value:y}}async function g(){try{const m=await u.v1.timelines.public.list({limit:1,local:a,since_id:r.current}).next();let{value:S}=m;return S=lt(S,"public"),!!(S!=null&&S.length)}catch{return!1}}return e(We,{title:h,titleComponent:e("h1",{class:"header-double-lines",children:[e("b",{children:a?"Local timeline":"Federated timeline"}),e("div",{children:l})]}),id:"public",instance:l,emptyText:"No one has posted anything yet.",errorText:"Unable to load posts",fetchItems:f,checkForUpdates:g,useItemID:!0,headerStart:e(A,{}),boostsCarousel:o.settings.boostsCarousel,filterContext:"public",headerEnd:e(Fe,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[e(ie,{href:a?`/#/${l}/p`:`/#/${l}/p/l`,children:a?e(A,{children:[e(w,{icon:"transfer"})," ",e("span",{children:"Switch to Federated"})]}):e(A,{children:[e(w,{icon:"transfer"})," ",e("span",{children:"Switch to Local"})]})}),e(Ee,{}),e(ie,{onClick:()=>{let m=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(m)){m&&alert("Invalid instance");return}m&&(m=m.toLowerCase().trim(),location.hash=a?`/${m}/p/l`:`/${m}/p`)},children:[e(w,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]}),d!==l&&e(ie,{onClick:()=>{location.hash=a?`/${d}/p/l`:`/${d}/p`},children:[e(w,{icon:"bus"})," ",e("small",{class:"menu-double-lines",children:["Go to my instance (",e("b",{children:d}),")"]})]})]})},l+a)}const wt=5,Nt=40,Lo=new URLSearchParams;function us({columnMode:t,...n}){const i=t?{}:st(),{masto:o,instance:a,authenticated:s}=q({instance:i.instance}),[u,l]=$("default"),[c]=t?[Lo]:qe(),d=D(),h=(n==null?void 0:n.query)||c.get("q"),r=t?"statuses":(n==null?void 0:n.type)||c.get("type");Me(h?`Search: ${h}${r?` (${{statuses:"Posts",accounts:"Accounts",hashtags:"Hashtags"}[r]})`:""}`:"Search","/search");const[p,f]=$(!1),g=D(0);z(()=>{g.current=0},[h,r]);const m=D();Ye(()=>{var C,_;(_=(C=m.current)==null?void 0:C.scrollTo)==null||_.call(C,0,0)},[h,r]);const[S,y]=$([]),[b,v]=$([]),[k,T]=$([]);z(()=>{y([]),v([]),T([])},[h]);const x={statuses:y,accounts:v,hashtags:T},[L,N]=$({}),B=async C=>{if(!(C!=null&&C.length))return;const _=await Kt(C,L);_&&N({...L,..._})};function U(C){C&&(g.current=0),!(!C&&!s)&&(l("loading"),C&&!r&&(y(S.slice(0,wt)),v(b.slice(0,wt)),T(k.slice(0,wt))),(async()=>{var O,K;const _={q:h,resolve:s,limit:wt};r&&(_.limit=Nt,_.type=r,s&&(_.offset=g.current));try{const te=await o.v2.search.fetch(_);if(r)if(C){x[r](te[r]);const Y=(O=te[r])==null?void 0:O.length;g.current=Nt,f(!!Y)}else{x[r](ke=>[...ke,...te[r]]);const Y=(K=te[r])==null?void 0:K.length;g.current=g.current+Nt,f(!!Y)}else y(te.statuses||[]),v(te.accounts||[]),T(te.hashtags||[]),g.current=0,f(!1);B(te.accounts),l("default")}catch{l("error")}})())}const P=D();rt(C=>{var O;const _=((O=m.current)==null?void 0:O.scrollTop)===0;if(C&&_){const K=Date.now()-P.current;!P.current||K>1e3*3?U(!0):P.current=Date.now()}}),z(()=>{var C,_,O,K;(_=(C=d.current)==null?void 0:C.setValue)==null||_.call(C,h||""),h?U(!0):(K=(O=d.current)==null?void 0:O.focus)==null||K.call(O)},[h,r,a]),Le("/",C=>{var _,O;(O=(_=d.current)==null?void 0:_.focus)==null||O.call(_)},{preventDefault:!0});const[R]=Vt();return e("div",{id:"search-page",class:"deck-container",ref:m,children:e("div",{class:"timeline-deck deck",children:[e("header",{class:u==="loading"?"loading":"",children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:e(gt,{})}),e(ss,{ref:d}),e("div",{class:"header-side",children:e("button",{type:"button",class:"plain",onClick:()=>{U(!0)},disabled:u==="loading",children:e(w,{icon:"search",size:"l"})})})]})}),e("main",{children:[!!h&&!t&&e("div",{ref:R,class:`filter-bar ${u==="loading"?"loading":""}`,children:[!!r&&e(ee,{to:`/search${h?`?q=${encodeURIComponent(h)}`:""}`,children:"‹ All"}),[{label:"Accounts",type:"accounts",to:`/search?q=${encodeURIComponent(h)}&type=accounts`},{label:"Hashtags",type:"hashtags",to:`/search?q=${encodeURIComponent(h)}&type=hashtags`},{label:"Posts",type:"statuses",to:`/search?q=${encodeURIComponent(h)}&type=statuses`}].sort((C,_)=>C.type===r?-1:_.type===r?1:0).map(C=>e(ee,{to:C.to,children:C.label},C.type))]}),h?e(A,{children:[(!r||r==="accounts")&&e(A,{children:[r!=="accounts"&&e("h2",{class:"timeline-header",children:"Accounts"}),b.length>0?e(A,{children:[e("ul",{class:"timeline flat accounts-list",children:b.map(C=>e("li",{children:e(He,{account:C,instance:a,showStats:!0,relationship:L[C.id]})},C.id))}),r!=="accounts"&&e("div",{class:"ui-state",children:e(ee,{class:"plain button",to:`/search?q=${h}&type=accounts`,children:["See more accounts ",e(w,{icon:"arrow-right"})]})})]}):!r&&(u==="loading"?e("p",{class:"ui-state",children:e(Te,{abrupt:!0})}):e("p",{class:"ui-state",children:"No accounts found."}))]}),(!r||r==="hashtags")&&e(A,{children:[r!=="hashtags"&&e("h2",{class:"timeline-header",children:"Hashtags"}),k.length>0?e(A,{children:[e("ul",{class:"link-list hashtag-list",children:k.map(C=>{var te;const{name:_,history:O}=C,K=(te=O==null?void 0:O.reduce)==null?void 0:te.call(O,(Y,ke)=>Y+ +ke.uses,0);return e("li",{children:e(ee,{to:a?`/${a}/t/${_}`:`/t/${_}`,children:[e(w,{icon:"hashtag"}),e("span",{children:_}),!!K&&e("span",{class:"count",children:Ne(K)})]})},`${_}-${K}`)})}),r!=="hashtags"&&e("div",{class:"ui-state",children:e(ee,{class:"plain button",to:`/search?q=${h}&type=hashtags`,children:["See more hashtags ",e(w,{icon:"arrow-right"})]})})]}):!r&&(u==="loading"?e("p",{class:"ui-state",children:e(Te,{abrupt:!0})}):e("p",{class:"ui-state",children:"No hashtags found."}))]}),(!r||r==="statuses")&&e(A,{children:[r!=="statuses"&&e("h2",{class:"timeline-header",children:"Posts"}),S.length>0?e(A,{children:[e("ul",{class:"timeline",children:S.map(C=>e("li",{children:e(ee,{class:"status-link",to:a?`/${a}/s/${C.id}`:`/s/${C.id}`,children:e($e,{status:C})})},C.id))}),r!=="statuses"&&e("div",{class:"ui-state",children:e(ee,{class:"plain button",to:`/search?q=${h}&type=statuses`,children:["See more posts ",e(w,{icon:"arrow-right"})]})})]}):!r&&(u==="loading"?e("p",{class:"ui-state",children:e(Te,{abrupt:!0})}):e("p",{class:"ui-state",children:"No posts found."}))]}),!!r&&(u==="default"?p?e(je,{onChange:C=>{C&&U()},children:e("button",{type:"button",class:"plain block",onClick:()=>U(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}):u==="loading"&&e("p",{class:"ui-state",children:e(Te,{abrupt:!0})}))]}):u==="loading"?e("p",{class:"ui-state",children:e(Te,{abrupt:!0})}):e("p",{class:"ui-state",children:"Enter your search term or paste a URL above to get started."})]})]})})}const Mo=20,Ro=nt(t=>t.v1.trends.links.list().next(),{maxAge:10*60*1e3});function hs({columnMode:t,...n}){const i=Se(I),o=t?{}:st(),{masto:a,instance:s}=q({instance:(n==null?void 0:n.instance)||o.instance}),{masto:u,instance:l}=q(),c=`Trending (${s})`;Me(c,"/:instance?/trending");const d=D(),[h,r]=$([]),[p,f]=$([]),g=D();async function m(b){var T;if(b||!g.current){g.current=a.v1.trends.statuses.list({limit:Mo});try{const x=a.v1.trends.tags.list(),{value:L}=await x.next();L!=null&&L.length&&r(L)}catch{}try{const{value:x}=await Ro(a),L=(T=x==null?void 0:x.filter)==null?void 0:T.call(x,N=>N.type==="link");L!=null&&L.length&&f(L)}catch{}}const v=await g.current.next();let{value:k}=v;return k!=null&&k.length&&(b&&(d.current=k[0].id),k.forEach(x=>{xe(x,s)})),{...v,value:k}}async function S(){try{const b=await a.v1.trends.statuses.list({limit:1}).next();let{value:v}=b;return v=lt(v,"public"),v!=null&&v.length&&v[0].id!==d.current?(d.current=v[0].id,!0):!1}catch{return!1}}const y=he(()=>e(A,{children:[!!h.length&&e("div",{class:"filter-bar expandable",children:[e(w,{icon:"chart",class:"insignificant",size:"l"}),h.map((b,v)=>{const{name:k,history:T}=b,x=T.reduce((L,N)=>L+ +N.uses,0);return e(ee,{to:`/${s}/t/${k}`,children:[e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),k]}),e("span",{class:"filter-count",children:Ne(x)})]},k)})]}),!!p.length&&e("div",{class:"links-bar",children:[e("header",{children:e("h3",{children:"Trending News"})}),p.map(b=>{const{authorName:v,authorUrl:k,blurhash:T,description:x,height:L,image:N,imageDescription:B,language:U,providerName:P,providerUrl:R,publishedAt:C,title:_,url:O,width:K}=b,te=new URL(O).hostname.replace(/^www\./,"").replace(/\/$/,"");let Y;if(T){const ke=Hn(T),re=Qn(ke);Y=es([.6,re[1],re[2]])}return e("a",{href:O,target:"_blank",rel:"noopener noreferrer",style:Y?{"--accent-color":`rgb(${Y.join(",")})`,"--accent-alpha-color":`rgba(${Y.join(",")}, 0.4)`}:{},children:e("article",{children:[e("figure",{children:e("img",{src:N,alt:B,width:K,height:L,loading:"lazy"})}),e("div",{class:"article-body",children:[e("header",{children:[e("div",{class:"article-meta",children:[e("span",{class:"domain",children:te})," ",!!C&&e(A,{children:"· "}),!!C&&e(A,{children:e(At,{datetime:C,format:"micro"})})]}),!!_&&e("h1",{class:"title",lang:U,dir:"auto",children:_})]}),!!x&&e("p",{class:"description",lang:U,dir:"auto",children:x})]})]})},O)})]})]}),[h,p]);return e(We,{title:c,titleComponent:e("h1",{class:"header-double-lines",children:[e("b",{children:"Trending"}),e("div",{children:s})]}),id:"trending",instance:s,emptyText:"No trending posts.",errorText:"Unable to load posts",fetchItems:m,checkForUpdates:S,checkForUpdatesInterval:5*60*1e3,useItemID:!0,headerStart:e(A,{}),boostsCarousel:i.settings.boostsCarousel,filterContext:"public",timelineStart:y,headerEnd:e(Fe,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[e(ie,{onClick:()=>{let b=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(b)){b&&alert("Invalid instance");return}b&&(b=b.toLowerCase().trim(),location.hash=`/${b}/trending`)},children:[e(w,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]}),l!==s&&e(ie,{onClick:()=>{location.hash=`/${l}/trending`},children:[e(w,{icon:"bus"})," ",e("small",{class:"menu-double-lines",children:["Go to my instance (",e("b",{children:l}),")"]})]})]})},s)}function _o(){Me("Home","/");const t=Se(I),{shortcuts:n}=t,i=n.map(o=>{if(!o)return null;const{type:a,...s}=o,u={following:Xt,notifications:ds,list:cs,public:zt,bookmarks:is,favourites:os,hashtag:as,mentions:rs,trending:hs,search:us}[a];return!u||a==="search"&&!s.query?null:e(u,{...s,columnMode:!0},a+JSON.stringify(s))});return Le(["1","2","3","4","5","6","7","8","9"],(o,a)=>{try{const s=parseInt(a.keys[0],10)-1;document.querySelectorAll("#columns > *")[s].focus()}catch{}}),e("div",{id:"columns",onContextMenu:o=>{o.target.closest(".deck > header")&&!o.target.closest("a")&&!o.target.closest("button")&&(o.preventDefault(),I.showShortcutsSettings=!0)},children:i})}function Eo(){var n;const t=Se(I);return z(()=>{(async()=>{const i=await ft.drafts.keys();if(i.length){const o=Fn();i.filter(s=>s.startsWith(o)).length&&(I.showDrafts=!0)}})()},[]),e(A,{children:(t.settings.shortcutsViewMode==="multi-column"||!t.settings.shortcutsViewMode&&t.settings.shortcutsColumnsMode)&&((n=t.shortcuts)!=null&&n.length)?e(_o,{}):e(Xt,{title:"Home",path:"/",id:"home",headerStart:!1,headerEnd:e(Po,{})})})}function Po(){const t=Se(I),n=D(),[i,o]=$(void 0);return e(A,{children:[e(ee,{ref:n,to:"/notifications",class:`button plain notifications-button ${t.notificationsShowNew?"has-badge":""} ${i||""}`,onClick:a=>{a.stopPropagation(),window.matchMedia("(min-width: calc(40em))").matches&&(a.preventDefault(),o(s=>s?void 0:"open"))},children:e(w,{icon:"notification",size:"l",alt:"Notifications"})}),e(Uo,{state:i,anchorRef:n,onClose:()=>o(void 0)})]})}const No=30,Do=5;function Uo({anchorRef:t,state:n,onClose:i}){const{masto:o,instance:a}=q(),s=Se(I),[u,l]=$("default"),c=o.v1.notifications.list({limit:No});async function d(){const g=await c.next(),m=g.value;if(m!=null&&m.length){m.forEach(y=>{xe(y.status,a,{skipThreading:!0})});const S=ls(m);I.notificationsLast=m[0],I.notifications=S,o.v1.markers.create({notifications:{lastReadId:m[0].id}}).catch(()=>{})}return I.notificationsShowNew=!1,I.notificationsLastFetchTime=Date.now(),g}const[h,r]=$(!1);function p(){return o.v1.followRequests.list({limit:1})}function f(){l("loading"),(async()=>{try{await d();const g=await p();r(!!(g!=null&&g.length)),l("default")}catch{l("error")}})()}return z(()=>{n==="open"&&f()},[n]),e(jn,{menuClassName:"notifications-menu",state:n,anchorRef:t,onClose:i,portal:{target:document.body},overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:"8 8 8 8",children:[e("header",{children:e("h2",{children:"Notifications"})}),e("main",{children:s.notifications.length?e(A,{children:s.notifications.slice(0,Do).map(g=>e(Zt,{instance:a,notification:g,disableContextMenu:!0},g.id))}):u==="loading"?e("div",{class:"ui-state",children:e(Te,{abrupt:!0})}):u==="error"&&e("div",{class:"ui-state",children:[e("p",{children:"Unable to fetch notifications."}),e("p",{children:e("button",{type:"button",onClick:f,children:"Try again"})})]})}),e("footer",{children:[e(ee,{to:"/mentions",class:"button plain",children:[e(w,{icon:"at"})," ",e("span",{children:"Mentions"})]}),e(ee,{to:"/notifications",class:"button plain2",children:[h?e(A,{children:[e("span",{class:"tag collapsed",children:"New"})," ",e("span",{children:"Follow Requests"})]}):e("b",{children:"See all"})," ",e(w,{icon:"arrow-right"})]})]})]})}const Fo=ze(Eo),Oo=[/^\/@[^@\/]+\/(?:statuses|posts)\/([^\/]+)/i,/\/notes\/([^\/]+)/i,/^\/(?:notice|objects)\/([a-z0-9-]+)/i,/\/@[^@\/]+@?[^\/]+?\/([^\/]+)/i];function fs(t){const{hostname:n,pathname:i}=new URL(t);for(const o of Oo){const[,a]=i.match(o)||[];if(a)return{instance:n,id:a}}return{}}function Bo(t){const{instance:n,id:i}=fs(t);return n&&i?`/${n}/s/${i}`:null}function zo(){const n=dt().pathname.replace(/^\//,""),i=fs(n),o=i!=null&&i.instance?`/${i.instance}/s/${i.id}`:null,[a,s]=$("loading");return Ye(()=>{s("loading"),(async()=>{try{const{instance:u,id:l}=i,{masto:c}=q({instance:u});if(await c.v1.statuses.$select(l).fetch()){window.location.hash=o+"?view=full";return}}catch{}{const{masto:u,instance:l}=q(),c=await u.v2.search.fetch({q:n,limit:1,resolve:!0});if(c.statuses.length){const d=c.statuses[0];window.location.hash=`/${l}/s/${d.id}?view=full`}else if(c.accounts.length){const d=c.accounts[0];window.location.hash=`/${l}/a/${d.id}`}else o?window.location.hash=o+"?view=full":s("error")}})()},[o]),e("div",{class:"ui-state",tabIndex:"-1",children:[a==="loading"?e(A,{children:[e(Te,{abrupt:!0}),e("h2",{children:"Resolving…"}),e("p",{children:e("a",{href:n,target:"_blank",rel:"noopener noreferrer",children:n})})]}):e(A,{children:[e("h2",{children:"Unable to resolve URL"}),e("p",{children:e("a",{href:n,target:"_blank",rel:"noopener noreferrer",children:n})})]}),e("hr",{}),e("p",{children:e(ee,{to:"/",children:"Go home"})})]})}function qo(){const{masto:t}=q();Me("Lists","/l");const[n,i]=$("default"),[o,a]=Lt(d=>d+1,0),[s,u]=$([]);z(()=>{i("loading"),(async()=>{try{const d=await t.v1.lists.list();d.sort((h,r)=>h.title.localeCompare(r.title)),u(d),i("default")}catch{i("error")}})()},[o]);const[l,c]=$(!1);return e("div",{id:"lists-page",class:"deck-container",tabIndex:"-1",children:[e("div",{class:"timeline-deck deck",children:[e("header",{children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(gt,{}),e(ee,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l"})})]}),e("h1",{children:"Lists"}),e("div",{class:"header-side",children:e("button",{type:"button",class:"plain",onClick:()=>c(!0),children:e(w,{icon:"plus",size:"l",alt:"New list"})})})]})}),e("main",{children:s.length>0?e("ul",{class:"link-list",children:s.map(d=>e("li",{children:e(ee,{to:`/l/${d.id}`,children:e("span",{children:[e(w,{icon:"list"})," ",e("span",{children:d.title})]})})}))}):n==="loading"?e("p",{class:"ui-state",children:e(Te,{})}):n==="error"?e("p",{class:"ui-state",children:"Unable to load lists."}):e("p",{class:"ui-state",children:"No lists yet."})})]}),l&&e(Ie,{class:"light",onClick:d=>{d.target===d.currentTarget&&c(!1)},children:e(Wt,{list:l==null?void 0:l.list,onClose:d=>{d.state==="success"&&a(),c(!1)}})})]})}const Ho=""+new URL("instances-sPUlg_c1.json",import.meta.url).href;var Vo={PHANPY_CLIENT_NAME:"IMSB",PHANPY_WEBSITE:"https://app.imsb.app",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",VITE_APP_ENV:"production",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{PHANPY_CLIENT_NAME:Go,PHANPY_WEBSITE:jo}=Vo,Qt="read write follow push";async function Yo({instanceURL:t}){const n=new URLSearchParams({client_name:Go,redirect_uris:location.origin+location.pathname,scopes:Qt,website:jo});return await(await fetch(`https://${t}/api/v1/apps`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n.toString()})).json()}async function Wo({instanceURL:t,client_id:n}){const i=new URLSearchParams({client_id:n,scope:Qt,redirect_uri:location.origin+location.pathname,response_type:"code"});return`https://${t}/oauth/authorize?${i.toString()}`}async function Ko({instanceURL:t,client_id:n,client_secret:i,code:o}){const a=new URLSearchParams({client_id:n,client_secret:i,redirect_uri:location.origin+location.pathname,grant_type:"authorization_code",code:o,scope:Qt});return await(await fetch(`https://${t}/oauth/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a.toString()})).json()}var Zo={PHANPY_CLIENT_NAME:"IMSB",PHANPY_WEBSITE:"https://app.imsb.app",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",VITE_APP_ENV:"production",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{PHANPY_DEFAULT_INSTANCE:Jo}=Zo;function Xo(){Me("Log in");const t=D(),n=se.local.get("instanceURL"),[i,o]=$("default"),[a]=qe(),s=a.get("instance"),u=a.get("submit"),[l,c]=$(s||(n==null?void 0:n.toLowerCase())||""),[d,h]=$([]);z(()=>{(async()=>{try{const b=await(await fetch(Ho)).json();h(b)}catch{}})()},[]);const r=y=>{y&&(se.local.set("instanceURL",y),(async()=>{o("loading");try{const{client_id:b,client_secret:v,vapid_key:k}=await Yo({instanceURL:y});b&&v?(se.session.set("clientID",b),se.session.set("clientSecret",v),se.session.set("vapidKey",k),location.href=await Wo({instanceURL:y,client_id:b})):alert("Failed to register application"),o("default")}catch{o("error")}})())},p=l?l.replace(/^https?:\/\//,"").replace(/\/+$/,"").replace(/^@?[^@]+@/,"").trim():null,f=/[^\s\r\n\t\/\\]+\.[^\s\r\n\t\/\\]+/.test(p)&&!/[\s\/\\@]/.test(p),g=p?d.filter(y=>y.includes(l)).sort((y,b)=>{const v=y.toLowerCase().startsWith(l.toLowerCase()),k=b.toLowerCase().startsWith(l.toLowerCase());return v&&!k?-1:!v&&k?1:0}).slice(0,10):[],m=f?p:g!=null&&g.length?g[0]:l?d.find(y=>y.includes(l)):null,S=y=>{y.preventDefault(),r(m)};return u&&z(()=>{r(s||m)},[]),e("main",{id:"login",style:{textAlign:"center"},children:e("form",{onSubmit:S,children:[e("h1",{children:[e("img",{src:jt,alt:"",width:"80",height:"80"}),e("br",{}),"Log in"]}),e("label",{children:[e("p",{children:"Instance"}),e("input",{value:l,required:!0,type:"text",class:"large",id:"instanceURL",ref:t,disabled:i==="loading",autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellcheck:!1,placeholder:"instance domain",onInput:y=>{c(y.target.value)}}),(g==null?void 0:g.length)>0?e("ul",{id:"instances-suggestions",children:g.map((y,b)=>e("li",{children:e("button",{type:"button",class:"plain5",onClick:()=>{r(y)},children:y})}))}):e("div",{id:"instances-eg",children:"e.g. “mastodon.social”"})]}),i==="error"&&e("p",{class:"error",children:"Failed to log in. Please try again or another instance."}),e("div",{children:[e("button",{disabled:i==="loading"||!l||!m,children:m?`Continue with ${m}`:"Continue"})," "]}),e(Te,{hidden:i!=="loading"}),e("hr",{}),!Jo&&e("p",{children:e("a",{href:"https://joinmastodon.org/servers",target:"_blank",children:"Don't have an account? Create one!"})}),e("p",{children:e(ee,{to:"/",children:"Go home"})})]})})}const vt=40,Qo=10,ea=5;let qt={},kt={},It={};function Tt(t){delete kt[t],delete It[t]}const ut={block:"nearest",inline:"center",behavior:"smooth"},Cn=".status-link:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *), .status-focus:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *)",$n=/\/s\//i;function ta(t){const{id:n}=t,{masto:i,instance:o}=q({instance:t.instance}),a=Se(I),[s,u]=qe(),l=s.get("media"),c=s.get("media-only"),d=parseInt(l||c,10);let h=d>0;const r=s.get("mediaStatusID"),p=qn(r,o);r&&!p&&(h=!1);const f=h&&!!c,g=Ge(n,o),[m,S]=$(I.statuses[g]);z(()=>{I.statuses[g]&&S(I.statuses[g])},[g]);const y=he(()=>{const{prevLocation:k}=I,T=((k==null?void 0:k.pathname)||"")+((k==null?void 0:k.search)||""),x=mt("/:instance/s/:id",T)||mt("/s/:id",T);return!T||x?"/":T},[]);z(()=>{!m&&h&&(async()=>{try{const k=await i.v1.statuses.$select(n).fetch();xe(k,o),S(k)}catch{alert("Unable to load post."),location.hash=y}})()},[h]);const b=r?p==null?void 0:p.mediaAttachments:m==null?void 0:m.mediaAttachments,v=Ve(()=>{!window.matchMedia("(min-width: calc(40em + 350px))").matches&&a.prevLocation?history.back():f?location.hash=y:(s.delete("media"),s.delete("mediaStatusID"),u(s))},[f,y,a.prevLocation]);return z(()=>{let k=setTimeout(()=>{const T=document.querySelector(".carousel");T&&T.focus()},100);return()=>clearTimeout(k)},[f]),e("div",{class:"deck-backdrop",children:[h?b!=null&&b.length?e(ts,{mediaAttachments:b,statusID:r||n,instance:o,lang:m==null?void 0:m.language,index:d-1,onClose:v}):e("div",{class:"media-modal-container loading",children:e(Te,{abrupt:!0})}):e(ee,{to:y}),!f&&e(sa,{id:n,instance:t.instance,closeLink:y})]})}function na(t){const{linkable:n,to:i,onClick:o,...a}=t;return n?e(ee,{class:"status-link",to:i,onClick:o,...a}):e("div",{class:"status-focus",tabIndex:0,...a})}function sa({id:t,closeLink:n="/",instance:i}){var de,Xe;const[o,a]=qe(),s=o.get("media"),u=o.get("mediaStatusID"),l=parseInt(s,10)>0,c=D(!I.prevLocation&&(history.length===1||"navigation"in window&&((Xe=(de=navigation==null?void 0:navigation.entries)==null?void 0:de.call(navigation))==null?void 0:Xe.length)===1)),[d,h]=$(o.get("view")||c.current?"full":null),r=!!parseInt(o.get("translate")),{masto:p,instance:f}=q({instance:i}),{masto:g,instance:m,authenticated:S}=q(),y=f===m,b=Se(I),[v,k]=$([]),[T,x]=$("default"),L=D(),N=Ge(t,f),B=D(0),U=D();z(()=>{var M;(M=U.current)==null||M.focus()},[]),z(()=>{var V;const M=Wn(()=>{if(!U.current)return;const{scrollTop:j}=U.current;T!=="loading"&&(It[t]=j)},50);return(V=U.current)==null||V.addEventListener("scroll",M,{passive:!0}),M(),()=>{var j;M.cancel(),(j=U.current)==null||j.removeEventListener("scroll",M)}},[t,T!=="loading"]);const P=D(),R=({reloadHero:M}={})=>{x("loading");let V;const j=kt[t];if(j){const ce=j.filter(we=>I.statuses[N]);k(ce)}else k([{id:t}]);return(async()=>{var pe,ve;const ce=()=>rn(()=>p.v1.statuses.$select(t).fetch(),{retries:4}),we=rn(()=>p.v1.statuses.$select(t).context.fetch(),{retries:8}),_e=!!b.statuses[N];let F=b.statuses[N];if(!(_e&&!M))try{F=await ce(),xe(F,f),await new Promise(ue=>{setTimeout(ue,100)})}catch{x("error");return}try{let ue=function(J){return J==null?void 0:J.map(Ae=>({id:Ae.id,account:Ae.account,repliesCount:Ae.repliesCount,content:Ae.content,weight:pt(Ae),replies:ue(Ae.__replies)}))};const Pe=await we,{ancestors:De,descendants:ye}=Pe;B.current=(ye==null?void 0:ye.length)||0;const Ue=new Set;De.forEach(J=>{xe(J,f,{skipThreading:!0}),J.inReplyToId&&!De.find(Ae=>Ae.id===J.inReplyToId)&&Ue.add(J.inReplyToId)});const it=De.every(J=>J.account.id===F.account.id),Oe=[];ye.forEach(J=>{if(xe(J,f,{skipThreading:!0}),J.inReplyToId&&!ye.find(Ae=>Ae.id===J.inReplyToId)&&J.inReplyToId!==F.id&&Ue.add(J.inReplyToId),J.inReplyToAccountId===J.account.id)Oe.push(J);else if(J.inReplyToId===F.id)Oe.push(J);else if(!J.inReplyToAccountId&&Oe.find(Ae=>Ae.id===J.inReplyToId)&&J.account.id===F.account.id)Oe.push(J);else{const Ae=ye.find(ms=>ms.id===J.inReplyToId);Ae&&(Ae.__replies||(Ae.__replies=[]),Ae.__replies.push(J))}}),Ue.size;const Ke=[...De.map(J=>({id:J.id,ancestor:!0,isThread:it,accountID:J.account.id,account:J.account,repliesCount:J.repliesCount,weight:pt(J)})),{id:t,accountID:F.account.id,weight:pt(F)},...Oe.map(J=>({id:J.id,account:J.account,accountID:J.account.id,descendant:!0,thread:J.account.id===F.account.id,weight:pt(J),replies:ue(J.__replies)}))];x("default"),P.current={offsetTop:(pe=L.current)==null?void 0:pe.offsetTop,scrollTop:(ve=U.current)==null?void 0:ve.scrollTop};const Qe=Ke.findIndex(J=>J.id===t);Qe>=Y&&ke(Qe+1),k(Ke),kt[t]=Ke,xs(F,f)}catch{x("error")}})(),()=>{clearTimeout(V)}};z(R,[t,p]),Ye(()=>{var V,j;if(!v.length)return;const M=It[t];if(M)U.current.scrollTop=M;else if(P.current){const ce={offsetTop:(V=L.current)==null?void 0:V.offsetTop,scrollTop:(j=U.current)==null?void 0:j.scrollTop},we=ce.offsetTop-P.current.offsetTop+ce.scrollTop;U.current.scrollTop=we}else v.length===1&&(U.current.scrollTop=0);P.current=null},[v]),z(()=>{b.reloadStatusPage<=0||(async()=>{try{const{instanceURL:M}=ct(),V=`https://${M}/api/v1/statuses/${t}/context`;return await(await caches.open("api")).delete(V,{ignoreVary:!0}),R({reloadHero:!0})}catch{}})()},[b.reloadStatusPage]),z(()=>()=>{It={},I.reloadStatusPage=0,kt={},qt={},Ht.clear()},[]);const C=b.statuses[N]||b.statuses[t],_=he(()=>{if(!C)return"";const{account:M}=C,V=document.createElement("div");return V.innerHTML=M.displayName,V.innerText.trim()},[C]),O=he(()=>{if(!C)return"";let M=zn(C);return M.length>64&&(M=M.slice(0,64)+"…"),M},[C]);Me(_&&O?`${_}: "${O}"`:"Status","/:instance?/s/:id");const K=he(()=>{if(!C)return;const{url:M}=C;if(M)return new URL(M).hostname},[C]),te=he(()=>{if(K)return K===f},[K,f]),[Y,ke]=$(vt),re=he(()=>v.length-Y,[v.length,Y]),X=v.some(M=>M.descendant),E=v.filter(M=>M.ancestor),[W,ne]=$(!0),le=he(()=>{if(!L.current||W)return null;const{top:M}=L.current.getBoundingClientRect();return M>0?"down":"up"},[W]);Le("esc",()=>{location.hash=n},{enabled:!l,ignoreEventWhen:M=>!!document.querySelector("#modal-container > *")}),Le("backspace",()=>{location.hash=n}),Le("j",()=>{const M=document.activeElement.closest(".status-link, .status-focus"),V=M==null?void 0:M.getBoundingClientRect(),j=Array.from(U.current.querySelectorAll(Cn));if(M&&V.top<U.current.clientHeight&&V.bottom>0){const ce=j.indexOf(M);let we=j[ce+1];we&&(we.focus(),we.scrollIntoView(ut))}else{const ce=j.find(we=>{const _e=we.getBoundingClientRect();return _e.top>=44&&_e.left>=0});ce&&(ce.focus(),ce.scrollIntoView(ut))}}),Le("k",()=>{const M=document.activeElement.closest(".status-link, .status-focus"),V=M==null?void 0:M.getBoundingClientRect(),j=Array.from(U.current.querySelectorAll(Cn));if(M&&V.top<U.current.clientHeight&&V.bottom>0){const ce=j.indexOf(M);let we=j[ce-1];we&&(we.focus(),we.scrollIntoView(ut))}else{const ce=j.find(we=>{const _e=we.getBoundingClientRect();return _e.top>=44&&_e.left>=0});ce&&(ce.focus(),ce.scrollIntoView(ut))}}),Le("x",()=>{const M=document.activeElement.closest(".status-link, .status-focus");if(M){const V=M.nextElementSibling;V&&V.tagName.toLowerCase()==="details"&&(V.open=!V.open)}});const[H,oe]=$(!1),Q=D(l?"media+status":"status"),ge=Ve((M,V,j,ce)=>{M.preventDefault(),M.stopPropagation(),a({media:V+1,mediaStatusID:ce.id})},[t]),G=Ve((M,V)=>{Tt(V.id)},[]);z(()=>{let M;return u&&l&&(M=setTimeout(()=>{var j;const V=(j=U.current)==null?void 0:j.querySelector(`.status-link[href*="/${u}"]`);V&&V.scrollIntoView(ut)},400)),()=>{clearTimeout(M)}},[u,l]);const Z=Ve((M,V)=>{const{id:j,ancestor:ce,isThread:we,descendant:_e,thread:F,replies:pe,repliesCount:ve,weight:ue}=M,Pe=j===t;return e("li",{ref:Pe?L:null,class:`${ce?"ancestor":""} ${_e?"descendant":""} ${F?"thread":""} ${Pe?"hero":""}`,children:[Pe?e(A,{children:[e(je,{threshold:.1,onChange:ye=>{queueMicrotask(()=>{requestAnimationFrame(()=>{ne(ye)})})},class:"status-focus",tabIndex:0,children:e($e,{statusID:j,instance:f,withinContext:!0,size:"l",enableTranslate:!0,forceTranslate:r})}),T!=="loading"&&!S?e("div",{class:"post-status-banner",children:[e("p",{children:"You're not logged in. Interactions (reply, boost, etc) are not possible."}),e(ee,{to:"/login",class:"button",children:"Log in"})]}):!y&&e("div",{class:"post-status-banner",children:[e("p",{children:["This post is from another instance (",e("b",{children:f}),"). Interactions (reply, boost, etc) are not possible."]}),e("button",{type:"button",disabled:T==="loading",onClick:()=>{x("loading"),(async()=>{try{const ye=await g.v2.search.fetch({q:C.url,type:"statuses",resolve:!0,limit:1});if(ye.statuses.length){const Ue=ye.statuses[0];location.hash=m?`/${m}/s/${Ue.id}`:`/s/${Ue.id}`}else throw new Error("No results")}catch(ye){x("default"),alert("Error: "+ye)}})()},children:[e(w,{icon:"transfer"})," Switch to my instance to enable interactions"]})]})]}):e(na,{linkable:we||ce,to:f?`/${f}/s/${j}`:`/s/${j}`,onClick:()=>{Tt(j)},children:[V===0&&ce?e(je,{threshold:.5,onChange:ye=>{queueMicrotask(()=>{requestAnimationFrame(()=>{oe(ye)})})},children:e($e,{statusID:j,instance:f,withinContext:!0,size:F||ce?"m":"s",enableTranslate:!0,onMediaClick:ge,onStatusLinkClick:G})}):e($e,{statusID:j,instance:f,withinContext:!0,size:F||ce?"m":"s",enableTranslate:!0,onMediaClick:ge,onStatusLinkClick:G}),ce&&ve>1&&e("div",{class:"replies-link",children:[e(w,{icon:"comment2"})," ",e("span",{title:ve,children:Ne(ve)})]})," "]}),_e&&(pe==null?void 0:pe.length)>0&&e(ps,{instance:f,replies:pe,hasParentThread:F,level:1,accWeight:ue,openAll:B.current<Qo,parentLink:{to:f?`/${f}/s/${j}`:`/s/${j}`,onClick:()=>Tt(j)}}),T==="loading"&&Pe&&!!(C!=null&&C.repliesCount)&&!X&&e("div",{class:"status-loading",children:e(Te,{})}),T==="error"&&Pe&&!!(C!=null&&C.repliesCount)&&!X&&e("div",{class:"status-error",children:["Unable to load replies.",e("br",{}),e("button",{type:"button",class:"plain",onClick:()=>{I.reloadStatusPage++},children:"Try again"})]})]},j)},[t,f,T,S,y,r,ge,G,X]),ae=he(()=>{var M;if("navigation"in window&&(navigation!=null&&navigation.entries)){const V=navigation.entries()[navigation.currentEntry.index-1];if(V!=null&&V.url)return $n.test(V.url)}return $n.test((M=I.prevLocation)==null?void 0:M.pathname)},[N]),fe=he(()=>{if(!re)return[];const M=[];function V(j){M.push(j.id),j.replies&&j.replies.forEach(V)}return v.slice(Y).forEach(V),M.map(j=>Ge(j,f))},[re,v,Y,f]),be=he(()=>v.slice(0,Y).map(Z),[v,Y,Z]);return e("div",{tabIndex:"-1",ref:U,class:`status-deck deck contained ${v.length>1?"padded-bottom":""} ${Q.current==="status"&&!c.current?"slide-in":""} ${d?`deck-view-${d}`:""}`,onAnimationEnd:M=>{Q.current==="status"&&(Q.current=null)},children:[e("header",{class:`${T==="loading"?"loading":""}`,onDblClick:M=>{I.reloadStatusPage++},children:e("div",{class:"header-grid header-grid-2",children:[e("h1",{children:[ae&&e("button",{type:"button",class:"plain deck-back",onClick:()=>{history.back()},children:e(w,{icon:"chevron-left",size:"xl"})}),!W&&C&&T!=="loading"?e(A,{children:[e("span",{class:"hero-heading",children:[e(Ct,{account:C.account,instance:f,showAvatar:!0,short:!0})," ",e("span",{class:"insignificant",children:["•"," ",e(At,{datetime:C.createdAt,format:"micro"})]})]})," ",e("button",{type:"button",class:"ancestors-indicator light small",onClick:M=>{M.preventDefault(),M.stopPropagation(),L.current.scrollIntoView({behavior:"smooth",block:"start"})},title:"Go to main post",children:e(w,{icon:le==="down"?"arrow-down":"arrow-up"})})]}):e(A,{children:["Post"," ",e("button",{type:"button",class:"ancestors-indicator light small",onClick:M=>{M.preventDefault(),M.stopPropagation(),U.current.scrollTo({top:0,behavior:"smooth"})},hidden:!E.length||H,title:`${E.length} posts above ‒ Go to top`,children:[e(w,{icon:"arrow-up"}),E.filter((M,V,j)=>j.findIndex(ce=>ce.accountID===M.accountID)===V).slice(0,3).map(M=>e(tt,{url:M.account.avatar,alt:M.account.displayName},M.account.id)),E.length>3&&e(A,{children:[" ",e("span",{class:"insignificant",children:Ne(E.length)})]})]})]})]}),e("div",{class:"header-side",children:[e("button",{type:"button",class:"plain4 button-switch-view",style:{display:d==="full"?"":"none"},onClick:()=>{h(null),o.delete("media"),o.delete("media-only"),o.delete("view"),a(o)},title:"Switch to Side Peek view",children:e(w,{icon:"layout4",size:"l"})}),e(Fe,{align:"end",portal:{target:U.current},menuButton:e("button",{type:"button",class:"button plain4",children:e(w,{icon:"more",alt:"Actions",size:"xl"})}),children:[e(ie,{disabled:T==="loading",onClick:()=>{I.reloadStatusPage++},children:[e(w,{icon:"refresh"}),e("span",{children:"Refresh"})]}),e(ie,{className:"menu-switch-view",onClick:()=>{h(d==="full"?null:"full"),o.delete("media"),o.delete("media-only"),d==="full"?o.delete("view"):o.set("view","full"),a(o)},children:[e(w,{icon:{"":"layout5",full:"layout4"}[d||""]}),e("span",{children:["Switch to ",d==="full"?"Side Peek":"Full"," view"]})]}),e(ie,{onClick:()=>{Array.from(U.current.querySelectorAll(".spoiler-button:not(.spoiling), .spoiler-media-button:not(.spoiling)")).forEach(V=>{V.click()})},children:[e(w,{icon:"eye-open"})," ",e("span",{children:"Show all sensitive content"})]}),e(Ee,{}),e(Yn,{className:"plain",children:"Experimental"}),e(ie,{disabled:!K||te,onClick:()=>{const M=Bo(C.url);M?location.hash=M:alert("Unable to switch")},children:[e(w,{icon:"transfer"}),e("small",{class:"menu-double-lines",children:["Switch to post's instance",K?e(A,{children:[" ","(",e("b",{children:K}),")"]}):""]})]})]}),e(ee,{class:"button plain deck-close",to:n,children:e(w,{icon:"x",size:"xl"})})]})]})}),v.length&&C?e("ul",{class:`timeline flat contextual grow ${T==="loading"?"loading":""}`,children:[be,re>0&&e("li",{children:e("button",{type:"button",class:"plain block show-more",disabled:T==="loading",onClick:()=>ke(M=>M+vt),style:{marginBlockEnd:"6em"},"data-state-post-ids":fe.join(" "),children:[e("div",{class:"ib avatars-bunch",children:v.slice(Y,Y+5).map(M=>e(tt,{url:M.account.avatarStatic},M.id))})," ",e("div",{class:"ib",children:["Show more…"," ",e("span",{class:"tag",children:re>vt?`${vt}+`:re})]})]})})]}):e(A,{children:[T==="loading"&&e("ul",{class:"timeline flat contextual grow loading",children:e("li",{children:e($e,{skeleton:!0,size:"l"})})}),T==="error"&&e("p",{class:"ui-state",children:["Unable to load post",e("br",{}),e("br",{}),e("button",{type:"button",onClick:()=>{I.reloadStatusPage++},children:"Try again"})]})]})]})}function ps({replies:t,instance:n,hasParentThread:i,level:o,accWeight:a,openAll:s,parentLink:u}){const[l,c]=qe(),d=b=>b.reduce((v,k)=>{const{repliesCount:T,replies:x}=k,L=(x==null?void 0:x.length)||T;return v+L+d(x||[])},0),h=t.length+d(t),r=t.length===h,p=t.map(b=>b.account).filter((b,v,k)=>k.findIndex(T=>T.id===b.id)===v).slice(0,3),f=he(()=>t==null?void 0:t.reduce((b,v)=>b+(v==null?void 0:v.weight),a),[a,t==null?void 0:t.length]);let g=!1;(s||f<=ea||!i&&h===1&&pt(t[0])<2)&&(g=!0);const m=qt[t[0].id],S=Ve((b,v,k,T)=>{b.preventDefault(),b.stopPropagation(),c({media:v+1,mediaStatusID:T.id})},[]),y=D();return Ye(()=>{var v;function b(k){k.target.dataset.scrollLeft=k.target.scrollLeft}return(v=y.current)==null||v.addEventListener("scroll",b,{passive:!0}),()=>{var k;(k=y.current)==null||k.removeEventListener("scroll",b)}},[]),e("details",{ref:y,class:"replies",open:m||g,onToggle:b=>{const{open:v}=b.target;qt[t[0].id]=v},style:{"--comments-level":o},"data-comments-level":o,"data-comments-level-overflow":o>4,children:[e("summary",{class:"replies-summary",hidden:g,children:[e("span",{class:"avatars",children:p.map(b=>e(tt,{url:b.avatarStatic,title:`${b.displayName} @${b.username}`,squircle:b==null?void 0:b.bot},b.id))}),e("span",{class:"replies-counts",children:[e("b",{children:[e("span",{title:t.length,children:Ne(t.length)})," ","repl",t.length===1?"y":"ies"]}),!r&&h>1&&e(A,{children:[" ","·"," ",e("span",{children:[e("span",{title:h,children:Ne(h)})," ","comment",h===1?"":"s"]})]})]}),e(w,{icon:"chevron-down",class:"replies-summary-chevron"}),!!u&&e(ee,{class:"replies-parent-link",to:u.to,onClick:u.onClick,title:"View post with its replies",children:"»"})]}),e("ul",{children:t.map(b=>{var v,k;return e("li",{children:[e("div",{class:"status-focus",tabIndex:0,children:[e($e,{statusID:b.id,instance:n,withinContext:!0,size:"s",enableTranslate:!0,onMediaClick:S}),!((v=b.replies)!=null&&v.length)&&b.repliesCount>0&&e("div",{class:"replies-link",children:[e(w,{icon:"comment2"})," ",e("span",{title:b.repliesCount,children:Ne(b.repliesCount)})]})]}),((k=b.replies)==null?void 0:k.length)&&e(ps,{instance:n,replies:b.replies,level:o+1,accWeight:g?f:b.weight,openAll:s,parentLink:{to:n?`/${n}/s/${b.id}`:`/s/${b.id}`,onClick:()=>{Tt(b.id)}}})]},b.id)})})]})}const ia=140,oa=35,aa=70,ca=140,Ht=new Map;function pt(t){var f,g;const n=Ht.get(t.id);if(n)return n;const{spoilerText:i,content:o,mediaAttachments:a,poll:s,card:u}=t,l=As(i+o),c=a!=null&&a.length?ia:0,d=(((f=s==null?void 0:s.options)==null?void 0:f.length)||0)*oa,h=u&&(a!=null&&a.length||(g=s==null?void 0:s.options)!=null&&g.length)?0:aa,p=(l+c+d+h)/ca;return Ht.set(t.id,p),p}const ra=ze(ta);function la(){const t=st(),{id:n,instance:i}=t;return e(ra,{id:n,instance:i})}const da=""+new URL("boosts-carousel-YjmjXTE6.jpg",import.meta.url).href,ua=""+new URL("grouped-notifications-xYMFVY91.jpg",import.meta.url).href,ha=""+new URL("multi-column-ETnJNDVb.jpg",import.meta.url).href,fa=""+new URL("multi-hashtag-timeline-x-SDVR4g.jpg",import.meta.url).href,pa=""+new URL("nested-comments-thread-Ib-fZGS3.jpg",import.meta.url).href,ma="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20fill-rule='evenodd'%20stroke-linejoin='round'%20stroke-miterlimit='2'%20clip-rule='evenodd'%20viewBox='0%200%20102%2028'%3e%3cpath%20fill='none'%20d='M0%200h101.5v27.5H0z'/%3e%3cg%20fill-rule='nonzero'%3e%3cpath%20fill='url(%23a)'%20d='M2.32%2021.85c1.4%200%202.21-.85%202.21-2.3v-4.64H8.5c4.45%200%207.54-2.9%207.54-7.24%200-4.35-2.98-7.24-7.32-7.24h-6.4C.93.43.11%201.28.11%202.73v16.82c0%201.45.82%202.3%202.21%202.3Zm2.21-10.4V3.94h3c2.54%200%204%201.34%204%203.75s-1.47%203.76-4%203.76h-3Z'/%3e%3cpath%20fill='url(%23b)'%20d='M20.52%2021.88c1.25%200%202.13-.76%202.13-2.23v-7.04c0-2.07%201.2-3.49%203.21-3.49%201.95%200%202.95%201.23%202.95%203.25v7.28c0%201.47.89%202.23%202.13%202.23%201.26%200%202.14-.76%202.14-2.23v-8.18c0-3.64-1.99-5.9-5.48-5.9-2.38%200-4.1%201.12-4.93%203.1h-.09V2.3c0-1.38-.78-2.2-2.1-2.2-1.31%200-2.1.82-2.1%202.2v17.34c0%201.47.9%202.23%202.14%202.23Z'/%3e%3cpath%20fill='url(%23c)'%20d='M40.45%2021.82c1.96%200%203.93-.98%204.8-2.65h.1v.8c.08%201.27.89%201.91%202.05%201.91%201.21%200%202.08-.73%202.08-2.15v-8.95c0-3.17-2.63-5.25-6.65-5.25-3.26%200-5.78%201.16-6.5%203.04-.15.32-.23.63-.23.96%200%20.97.75%201.64%201.79%201.64.69%200%201.23-.26%201.7-.79.95-1.23%201.74-1.65%203.04-1.65%201.62%200%202.64.85%202.64%202.31v1.04l-3.95.24c-3.93.23-6.13%201.88-6.13%204.74%200%202.83%202.27%204.76%205.26%204.76Zm1.4-3.09c-1.43%200-2.4-.73-2.4-1.9%200-1.12.91-1.83%202.51-1.95l3.31-.2v1.14c0%201.7-1.54%202.91-3.41%202.91Z'/%3e%3cpath%20fill='url(%23d)'%20d='M54.37%2021.88c1.26%200%202.14-.76%202.14-2.23v-7.09c0-2.03%201.21-3.44%203.13-3.44s2.89%201.17%202.89%203.22v7.31c0%201.47.88%202.23%202.14%202.23%201.24%200%202.13-.76%202.13-2.23v-8.2c0-3.68-1.96-5.87-5.45-5.87-2.41%200-4%201.07-4.83%203.01h-.09v-.87c0-1.35-.85-2.17-2.14-2.17-1.28%200-2.06.82-2.06%202.15v11.95c0%201.47.9%202.23%202.14%202.23Z'/%3e%3cpath%20fill='url(%23e)'%20d='M71.65%2027.17c1.26%200%202.14-.76%202.14-2.23v-6h.09a5.15%205.15%200%200%200%204.88%202.88c3.92%200%206.35-3.05%206.35-8.1%200-5.07-2.44-8.1-6.43-8.1a5.12%205.12%200%200%200-4.86%202.99h-.09v-.85c0-1.45-.88-2.21-2.1-2.21-1.24%200-2.11.76-2.11%202.2v17.2c0%201.46.89%202.22%202.13%202.22Zm5.6-8.8c-2.1%200-3.47-1.8-3.47-4.65%200-2.81%201.37-4.67%203.47-4.67%202.14%200%203.49%201.83%203.49%204.67%200%202.86-1.35%204.66-3.5%204.66Z'/%3e%3cpath%20fill='url(%23f)'%20d='M89.61%2027.39c3.44%200%205.26-1.5%206.73-5.55l4.81-13.1a4%204%200%200%200%20.24-1.26c0-1.13-.85-1.93-2.08-1.93-1.1%200-1.71.51-2.07%201.7l-3.4%2010.9h-.08L90.35%207.28c-.36-1.25-.94-1.73-2.07-1.73-1.26%200-2.21.83-2.21%201.99%200%20.35.09.82.25%201.26l5%2013.21-.21.56c-.52%201.1-1.32%201.42-2.07%201.42l-.75-.01c-.96%200-1.56.54-1.56%201.4%200%201.29%201%202%202.88%202Z'/%3e%3c/g%3e%3cdefs%3e%3cradialGradient%20id='a'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='b'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='c'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='d'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='e'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='f'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3c/defs%3e%3c/svg%3e";var ga={PHANPY_CLIENT_NAME:"IMSB",PHANPY_WEBSITE:"https://app.imsb.app",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",VITE_APP_ENV:"production",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{PHANPY_DEFAULT_INSTANCE:ht,PHANPY_WEBSITE:xn,PHANPY_PRIVACY_POLICY_URL:ba,PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:An}=ga,Ln=xn?xn.replace(/https?:\/\//g,"").replace(/\/$/,""):null,Mn=`${"2024-01-08T03:33:07.851Z".slice(0,10).replace(/-/g,".")}.99b0b7c`;function Rn(){return Me(null,["/","/welcome"]),e("main",{id:"welcome",children:[e("div",{class:"hero-container",children:[e("div",{class:"hero-content",children:[e("h1",{children:[e("img",{src:jt,alt:"",width:"160",height:"160",style:{aspectRatio:"1/1",marginBlockEnd:-16}}),e("img",{src:ma,alt:"Phanpy",width:"200"})]}),e("p",{class:"desc",children:"A minimalistic opinionated Mastodon web client."}),e("p",{children:e(ee,{to:ht?`/login?instance=${ht}&submit=1`:"/login",class:"button",children:ht?"Log in":"Log in with Mastodon"})}),ht&&An&&e("p",{children:e("a",{href:An,class:"button plain5",children:"Sign up"})}),!ht&&e("p",{class:"insignificant",children:e("small",{children:["Connect your existing Mastodon/Fediverse account.",e("br",{}),"Your credentials are not stored on this server."]})})]}),(Ln||Mn)&&e("p",{class:"app-site-version",children:e("small",{children:[Ln," ",Mn]})}),e("p",{children:[e("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",children:"Built"})," ","by"," ",e("a",{href:"https://mastodon.social/@cheeaun",target:"_blank",onClick:t=>{t.preventDefault(),I.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"}),"."," ",e("a",{href:ba,target:"_blank",children:"Privacy Policy"}),"."]})]}),e("div",{id:"why-container",children:e("div",{class:"sections",children:[e("section",{children:[e("img",{src:da,alt:"Screenshot of Boosts Carousel",loading:"lazy"}),e("h4",{children:"Boosts Carousel"}),e("p",{children:"Visually separate original posts and re-shared posts (boosted posts)."})]}),e("section",{children:[e("img",{src:pa,alt:"Screenshot of nested comments thread",loading:"lazy"}),e("h4",{children:"Nested comments thread"}),e("p",{children:"Effortlessly follow conversations. Semi-collapsible replies."})]}),e("section",{children:[e("img",{src:ua,alt:"Screenshot of grouped notifications",loading:"lazy"}),e("h4",{children:"Grouped notifications"}),e("p",{children:"Similar notifications are grouped and collapsed to reduce clutter."})]}),e("section",{children:[e("img",{src:ha,alt:"Screenshot of multi-column UI",loading:"lazy"}),e("h4",{children:"Single or multi-column"}),e("p",{children:"By default, single column for zen-mode seekers. Configurable multi-column for power users."})]}),e("section",{children:[e("img",{src:fa,alt:"Screenshot of multi-hashtag timeline with a form to add more hashtags",loading:"lazy"}),e("h4",{children:"Multi-hashtag timeline"}),e("p",{children:"Up to 5 hashtags combined into a single timeline."})]})]})})]})}const ya=window.alert;window.__nativeAlert||(window.__nativeAlert=ya);window.alert=function(t){t instanceof Error&&(t!=null&&t.message)&&(t=t.message),typeof t!="string"&&(t=JSON.stringify(t));const n=zs({text:t,className:"alert",gravity:"top",position:"center",duration:1e4,offset:{y:48},onClick:()=>{n.hideToast()}});n.showToast()};window.__STATES__=I;window.__STATES_STATS__=()=>{const t=["statuses","accounts","spoilers","unfurledLinks","statusQuotes"],n={};t.forEach(a=>{n[a]=Object.keys(I[a]).length});const{statuses:i}=I,o=[];for(const a in i)document.querySelector(`[data-state-post-id~="${a}"], [data-state-post-ids~="${a}"]`)||o.push(a)};setInterval(()=>{if(!window.__IDLE__)return;const{statuses:t,unfurledLinks:n,notifications:i}=I;let o=0;const{instance:a}=q();for(const s in t){if(!window.__IDLE__)break;try{const u=document.querySelector(`[data-state-post-id~="${s}"], [data-state-post-ids~="${s}"]`),l=i.some(c=>{var d;return s===Ge((d=c.status)==null?void 0:d.id,a)});if(!u&&!l){delete I.statuses[s],delete I.statusQuotes[s];for(const c in n){const d=n[c];if(Ge(d.id,d.instance)===s){delete I.unfurledLinks[c];break}}o++}}catch{}}},15*60*1e3);setTimeout(()=>{for(const t in bt)queueMicrotask(()=>{var n,i,o,a;Array.isArray(bt[t])?(i=(n=bt[t])[0])==null||i.call(n):(a=(o=bt)[t])==null||a.call(o)})},5e3);(()=>{window.__IDLE__=!0;const t=["mousemove","mousedown","resize","keydown","touchstart","pointerdown","pointermove","wheel"],n=()=>{window.__IDLE__=!0},o=Wn(n,3e3),a=()=>{window.__IDLE__=!1,o()};t.forEach(s=>{window.addEventListener(s,a,{passive:!0,capture:!0})}),window.addEventListener("blur",n,{passive:!0}),document.documentElement.addEventListener("mouseleave",s=>{!s.relatedTarget&&!s.toElement&&n()},{passive:!0})})();const wa=/iPad|iPhone|iPod/.test(navigator.userAgent);wa&&document.addEventListener("visibilitychange",()=>{if(document.visibilityState==="visible"){const t=se.local.get("theme");let n;if(t){if(n=document.querySelector('meta[name="theme-color"][data-theme-setting="manual"]'),n){const i=n.content,o=t==="light"?n.dataset.themeLightColorTemp:n.dataset.themeDarkColorTemp;n.content=o||"",setTimeout(()=>{n.content=i},10)}}else{const i=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";if(n=document.querySelector(`meta[name="theme-color"][media*="${i}"]`),n){const o=n.dataset.content,a=n.dataset.contentTemp;n.content=a||"",setTimeout(()=>{n.content=o},10)}}}});{const t=se.local.get("theme");if(t){document.documentElement.classList.add(`is-${t}`),document.querySelector('meta[name="color-scheme"]').setAttribute("content",t||"dark light");const i=document.querySelector('meta[data-theme-setting="manual"]');i&&(i.name="theme-color",i.content=t==="light"?i.dataset.themeLightColor:i.dataset.themeDarkColor),document.querySelectorAll('meta[data-theme-setting="auto"]').forEach(a=>{a.name=""})}const n=se.local.get("textSize");n&&document.documentElement.style.setProperty("--text-size",`${n}px`)}Vn(I,t=>{var n;for(const[i,o,a,s]of t){if(o.join(".")==="settings.shortcutsViewMode"){const u=document.getElementById("app");u&&(u.dataset.shortcutsViewMode=(n=I.shortcuts)!=null&&n.length?a:"")}o.join(".")==="settings.cloakMode"&&document.body.classList.toggle("cloak",a)}});function va(){const[t,n]=$(!1),[i,o]=$("loading");z(()=>{const s=se.local.get("instanceURL"),u=decodeURIComponent((window.location.search.match(/code=([^&]+)/)||[,""])[1]);if(u){window.history.replaceState({},document.title,window.location.pathname||"/");const l=se.session.get("clientID"),c=se.session.get("clientSecret"),d=se.session.get("vapidKey");(async()=>{o("loading");const{access_token:h}=await Ko({instanceURL:s,client_id:l,client_secret:c,code:u}),r=Ls({instance:s,accessToken:h});await Promise.allSettled([sn(r,s),Ms(r,s,h,d)]),on(),an(r),n(!0),o("default")})()}else{window.__IGNORE_GET_ACCOUNT_ERROR__=!0;const l=ct();if(l){se.session.set("currentAccount",l.info.id);const{client:c}=q({account:l}),{instance:d}=c;on(),an(c),o("loading"),(async()=>{try{await sn(c,d)}catch{}finally{n(!0),o("default")}})()}else o("default")}},[]);let a=dt();return I.currentLocation=a.pathname,z(Ft,[a,t]),/\/https?:/.test(a.pathname)?e(zo,{}):e(A,{children:[e(Sa,{isLoggedIn:t,loading:i==="loading"}),e(ka,{isLoggedIn:t}),i==="default"&&e(Gt,{children:e(Ce,{path:"/:instance?/s/:id",element:e(la,{})})}),t&&e(Ys,{}),t&&e(ji,{}),e(zi,{}),t&&e(Hi,{}),e(js,{isLoggedIn:t}),i!=="loading"&&e(Vi,{onClose:Ft}),e(Ws,{})]})}function Sa({isLoggedIn:t,loading:n}){const i=dt(),o=he(()=>{const{pathname:a}=i;return!/^\/(login|welcome)/.test(a)},[i]);return e(Gt,{location:o||i,children:[e(Ce,{path:"/",element:t?e(Fo,{}):n?e(Te,{id:"loader-root"}):e(Rn,{})}),e(Ce,{path:"/login",element:e(Xo,{})}),e(Ce,{path:"/welcome",element:e(Rn,{})})]})}function _n(){return I.prevLocation||null}function ka({isLoggedIn:t}){const n=dt(),i=D(_n());return he(()=>mt("/:instance/s/:id",n.pathname)||mt("/s/:id",n.pathname),[n.pathname,mt])?i.current||(i.current=_n()):i.current=null,e(Gt,{location:i.current||n,children:[t&&e(A,{children:[e(Ce,{path:"/notifications",element:e(ds,{})}),e(Ce,{path:"/mentions",element:e(rs,{})}),e(Ce,{path:"/following",element:e(Xt,{})}),e(Ce,{path:"/b",element:e(is,{})}),e(Ce,{path:"/f",element:e(os,{})}),e(Ce,{path:"/l",children:[e(Ce,{index:!0,element:e(qo,{})}),e(Ce,{path:":id",element:e(cs,{})})]}),e(Ce,{path:"/ft",element:e(ho,{})})]}),e(Ce,{path:"/:instance?/t/:hashtag",element:e(as,{})}),e(Ce,{path:"/:instance?/a/:id",element:e(co,{})}),e(Ce,{path:"/:instance?/p",children:[e(Ce,{index:!0,element:e(zt,{})}),e(Ce,{path:"l",element:e(zt,{local:!0})})]}),e(Ce,{path:"/:instance?/trending",element:e(hs,{})}),e(Ce,{path:"/:instance?/search",element:e(us,{})})]})}"AbortSignal"in window&&(AbortSignal.timeout=AbortSignal.timeout||(t=>{const n=new AbortController;return setTimeout(()=>n.abort(),t),n.signal}));Hs(e(qs,{children:e(va,{})}),document.getElementById("app"));setTimeout(()=>{try{Object.keys(localStorage).forEach(t=>{t.startsWith("iconify")&&localStorage.removeItem(t)}),Object.keys(sessionStorage).forEach(t=>{t.startsWith("iconify")&&sessionStorage.removeItem(t)}),localStorage.removeItem("settings:boostsCarousel")}catch{}},5e3);window.__CLOAK__=()=>{document.body.classList.toggle("cloak")};
//# sourceMappingURL=main-dyjmA1f7.js.map
